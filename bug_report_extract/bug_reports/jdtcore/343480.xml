<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>343480</bug_id>
          
          <creation_ts>2011-04-21 02:50:00 -0400</creation_ts>
          <short_desc>[compiler] Incorrect/confusing error message on inner class static field declaration</short_desc>
          <delta_ts>2012-02-16 01:28:58 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>3.7</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>3.8 M3</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Deepak Azad">deepakazad</reporter>
          <assigned_to name="Ayushman Jain">amj87.iitr</assigned_to>
          <cc>amj87.iitr</cc>
    
    <cc>Olivier_Thomann</cc>
    
    <cc>srikanth_sankaran</cc>
    
    <cc>szymon.ptaszkiewicz</cc>
          
          <votes>0</votes>

      

      

      <flag name="review"
          id="45980"
          type_id="1"
          status="+"
          setter="srikanth_sankaran"
    />

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>1917106</commentid>
    <comment_count>0</comment_count>
    <who name="Deepak Azad">deepakazad</who>
    <bug_when>2011-04-21 02:50:22 -0400</bug_when>
    <thetext>---------------------------------------------------------------
public class A {
    public class B {
        static final int X = 1;
        static final Integer Y = new Integer(2);
        static final String s = &quot;sdf&quot;;
    }
}
---------------------------------------------------------------

There is one error here, with the message &quot;The field Y cannot be declared static; static fields can only be declared in static or top level types&quot;, which is wrong.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1917165</commentid>
    <comment_count>1</comment_count>
    <who name="Ayushman Jain">amj87.iitr</who>
    <bug_when>2011-04-21 04:42:15 -0400</bug_when>
    <thetext>Note that javac 1.7 warns 
&quot;modifier &apos;static&apos; is only allowed in constant variable declarations&quot;.

This will need a new error message, hence deferring to 3.8</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1917282</commentid>
    <comment_count>2</comment_count>
    <who name="Olivier Thomann">Olivier_Thomann</who>
    <bug_when>2011-04-21 08:16:27 -0400</bug_when>
    <thetext>Static fields initialized with a constant expressions are fine.  The error message should reflect that.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2002283</commentid>
    <comment_count>3</comment_count>
      <attachid>204279</attachid>
    <who name="Ayushman Jain">amj87.iitr</who>
    <bug_when>2011-09-29 06:10:43 -0400</bug_when>
    <thetext>Created attachment 204279
proposed fix

Corrects the error message to say &quot;The field {0} cannot be declared static in a non-static inner type, unless initialized with a constant expression&quot;. Updated tests</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2002284</commentid>
    <comment_count>4</comment_count>
    <who name="Ayushman Jain">amj87.iitr</who>
    <bug_when>2011-09-29 06:11:18 -0400</bug_when>
    <thetext>Srikanth, does the new diagnostic look ok?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2011929</commentid>
    <comment_count>5</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2011-10-18 01:51:49 -0400</bug_when>
    <thetext>(In reply to comment #4)
&gt; Srikanth, does the new diagnostic look ok?

Apologize for the delay, Ayush. Agree that the modified diagnostic is
clearer and consistent with javac. For the record, javac also seems 
have to revised the message at JDK7 timeframe.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2012778</commentid>
    <comment_count>6</comment_count>
    <who name="Ayushman Jain">amj87.iitr</who>
    <bug_when>2011-10-19 02:55:37 -0400</bug_when>
    <thetext>Released in HEAD for 3.8M3 via commit 3b4463c1006c09cac09c3007a035ccb5f09314da</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2015113</commentid>
    <comment_count>7</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2011-10-24 02:16:53 -0400</bug_when>
    <thetext>Verified for 3.8 M3 using build id: N20111022-2000.
Raised Bug 361771 as follow up.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2015155</commentid>
    <comment_count>8</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2011-10-24 03:52:23 -0400</bug_when>
    <thetext>(In reply to comment #7)
&gt; Verified for 3.8 M3 using build id: N20111022-2000.
&gt; Raised Bug 361771 as follow up.

That turned out to be a dup of bug 343420</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2066499</commentid>
    <comment_count>9</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2012-02-15 19:40:50 -0500</bug_when>
    <thetext>Now I see an issue with:

public class X {
    public static void main(String[] args) {
        class Local {
            private static final long CONSTANT = 1L; // code select fails
            static int x = 10;
        }
        new X() {
            private static final long FINAL = 1L; // code select fails
        };
    }
}

we complain: 

The field x cannot be declared static in a non-static inner type, unless initialized with a constant.

It is being with a constant after all. We could do:

The field x cannot be declared static in a non-static inner type, 
unless also final ?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2066535</commentid>
    <comment_count>10</comment_count>
    <who name="Ayushman Jain">amj87.iitr</who>
    <bug_when>2012-02-15 23:57:47 -0500</bug_when>
    <thetext>(In reply to comment #9)
&gt; The field x cannot be declared static in a non-static inner type, 
&gt; unless also final ?
But this would sound ambiguous for the error case shown in comment 0, where all fields are static and final

javac says &quot;modifier &apos;static&apos; is only allowed in constant variable declarations&quot;. This sounds more generic for both of the above cases. So maybe we should also fine-tune the message to say &quot;The field {0} cannot be declared static in a
non-static inner type, unless it is final and initialized with a constant expression&quot;. Too wordy?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2066547</commentid>
    <comment_count>11</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2012-02-16 01:28:58 -0500</bug_when>
    <thetext>(In reply to comment #10)
&gt; (In reply to comment #9)
&gt; &gt; The field x cannot be declared static in a non-static inner type, 
&gt; &gt; unless also final ?
&gt; But this would sound ambiguous for the error case shown in comment 0, where all
&gt; fields are static and final

Mmmh. 
&gt; 
&gt; javac says &quot;modifier &apos;static&apos; is only allowed in constant variable
&gt; declarations&quot;.

Isn&apos;t &quot;constant variable&quot; oxymoronic ? :)

How about &quot;The field x cannot be declared static in a non-static inner type
as it is not a constant&quot;</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>204279</attachid>
            <date>2011-09-29 06:10:00 -0400</date>
            <delta_ts>2011-09-29 06:10:43 -0400</delta_ts>
            <desc>proposed fix</desc>
            <filename>HEAD--Fixed-bug-343480-compiler-Incorrect-confusing-.patch</filename>
            <type>text/plain</type>
            <size>4319</size>
            <attacher name="Ayushman Jain">amj87.iitr</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLmNvbXBpbGVyL3NyYy9vcmcv
ZWNsaXBzZS9qZHQvY29yZS90ZXN0cy9jb21waWxlci9yZWdyZXNzaW9uL0Fzc2lnbm1lbnRUZXN0
LmphdmEgYi9vcmcuZWNsaXBzZS5qZHQuY29yZS50ZXN0cy5jb21waWxlci9zcmMvb3JnL2VjbGlw
c2UvamR0L2NvcmUvdGVzdHMvY29tcGlsZXIvcmVncmVzc2lvbi9Bc3NpZ25tZW50VGVzdC5qYXZh
CmluZGV4IDQyY2NkYTQuLjcyMzA3ZTggMTAwNjQ0Ci0tLSBhL29yZy5lY2xpcHNlLmpkdC5jb3Jl
LnRlc3RzLmNvbXBpbGVyL3NyYy9vcmcvZWNsaXBzZS9qZHQvY29yZS90ZXN0cy9jb21waWxlci9y
ZWdyZXNzaW9uL0Fzc2lnbm1lbnRUZXN0LmphdmEKKysrIGIvb3JnLmVjbGlwc2UuamR0LmNvcmUu
dGVzdHMuY29tcGlsZXIvc3JjL29yZy9lY2xpcHNlL2pkdC9jb3JlL3Rlc3RzL2NvbXBpbGVyL3Jl
Z3Jlc3Npb24vQXNzaWdubWVudFRlc3QuamF2YQpAQCAtMSw1ICsxLDUgQEAKIC8qKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqCi0gKiBDb3B5cmlnaHQgKGMpIDIwMDUsIDIwMTAgSUJNIENvcnBvcmF0aW9u
IGFuZCBvdGhlcnMuCisgKiBDb3B5cmlnaHQgKGMpIDIwMDUsIDIwMTEgSUJNIENvcnBvcmF0aW9u
IGFuZCBvdGhlcnMuCiAgKiBBbGwgcmlnaHRzIHJlc2VydmVkLiBUaGlzIHByb2dyYW0gYW5kIHRo
ZSBhY2NvbXBhbnlpbmcgbWF0ZXJpYWxzCiAgKiBhcmUgbWFkZSBhdmFpbGFibGUgdW5kZXIgdGhl
IHRlcm1zIG9mIHRoZSBFY2xpcHNlIFB1YmxpYyBMaWNlbnNlIHYxLjAKICAqIHdoaWNoIGFjY29t
cGFuaWVzIHRoaXMgZGlzdHJpYnV0aW9uLCBhbmQgaXMgYXZhaWxhYmxlIGF0CkBAIC0xMjIxLDcg
KzEyMjEsNyBAQAogCQkiMS4gRVJST1IgaW4gcFxcWC5qYXZhIChhdCBsaW5lIDQpXG4iICsKIAkJ
IglwdWJsaWMgc3RhdGljIFN0cmluZyBzO1xuIiArCiAJCSIJICAgICAgICAgICAgICAgICAgICAg
XlxuIiArCi0JCSJUaGUgZmllbGQgcyBjYW5ub3QgYmUgZGVjbGFyZWQgc3RhdGljOyBzdGF0aWMg
ZmllbGRzIGNhbiBvbmx5IGJlIGRlY2xhcmVkIGluIHN0YXRpYyBvciB0b3AgbGV2ZWwgdHlwZXNc
biIgKworCQkiVGhlIGZpZWxkIHMgY2Fubm90IGJlIGRlY2xhcmVkIHN0YXRpYyBpbiBhIG5vbi1z
dGF0aWMgaW5uZXIgdHlwZSwgdW5sZXNzIGluaXRpYWxpemVkIHdpdGggYSBjb25zdGFudCBleHBy
ZXNzaW9uXG4iICsKIAkJIi0tLS0tLS0tLS1cbiIgKwogCQkiMi4gRVJST1IgaW4gcFxcWC5qYXZh
IChhdCBsaW5lIDYpXG4iICsKIAkJIglYLlhYLnMgPSBzOyAgICB9XG4iICsKZGlmZiAtLWdpdCBh
L29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLmNvbXBpbGVyL3NyYy9vcmcvZWNsaXBzZS9qZHQv
Y29yZS90ZXN0cy9jb21waWxlci9yZWdyZXNzaW9uL0NvbnN0YW50VGVzdC5qYXZhIGIvb3JnLmVj
bGlwc2UuamR0LmNvcmUudGVzdHMuY29tcGlsZXIvc3JjL29yZy9lY2xpcHNlL2pkdC9jb3JlL3Rl
c3RzL2NvbXBpbGVyL3JlZ3Jlc3Npb24vQ29uc3RhbnRUZXN0LmphdmEKaW5kZXggNjZlZWIwZC4u
ZjYzYTA2MCAxMDA2NDQKLS0tIGEvb3JnLmVjbGlwc2UuamR0LmNvcmUudGVzdHMuY29tcGlsZXIv
c3JjL29yZy9lY2xpcHNlL2pkdC9jb3JlL3Rlc3RzL2NvbXBpbGVyL3JlZ3Jlc3Npb24vQ29uc3Rh
bnRUZXN0LmphdmEKKysrIGIvb3JnLmVjbGlwc2UuamR0LmNvcmUudGVzdHMuY29tcGlsZXIvc3Jj
L29yZy9lY2xpcHNlL2pkdC9jb3JlL3Rlc3RzL2NvbXBpbGVyL3JlZ3Jlc3Npb24vQ29uc3RhbnRU
ZXN0LmphdmEKQEAgLTExMTksNyArMTExOSw3IEBACiAJCSIxLiBFUlJPUiBpbiBYLmphdmEgKGF0
IGxpbmUgNClcbiIgKwogCQkiCXN0YXRpYyBmaW5hbCBTdHJpbmcgbm90QUNvbnN0YW50ID0gbnVs
bDtcbiIgKwogCQkiCSAgICAgICAgICAgICAgICAgICAgXl5eXl5eXl5eXl5eXG4iICsKLQkJIlRo
ZSBmaWVsZCBub3RBQ29uc3RhbnQgY2Fubm90IGJlIGRlY2xhcmVkIHN0YXRpYzsgc3RhdGljIGZp
ZWxkcyBjYW4gb25seSBiZSBkZWNsYXJlZCBpbiBzdGF0aWMgb3IgdG9wIGxldmVsIHR5cGVzXG4i
ICsKKwkJIlRoZSBmaWVsZCBub3RBQ29uc3RhbnQgY2Fubm90IGJlIGRlY2xhcmVkIHN0YXRpYyBp
biBhIG5vbi1zdGF0aWMgaW5uZXIgdHlwZSwgdW5sZXNzIGluaXRpYWxpemVkIHdpdGggYSBjb25z
dGFudCBleHByZXNzaW9uXG4iICsKIAkJIi0tLS0tLS0tLS1cbiIpOwogfQogcHVibGljIHZvaWQg
dGVzdEFsbENvbnN0YW50cygpIHsKZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRl
c3RzLmNvbXBpbGVyL3NyYy9vcmcvZWNsaXBzZS9qZHQvY29yZS90ZXN0cy9jb21waWxlci9yZWdy
ZXNzaW9uL0VudW1UZXN0LmphdmEgYi9vcmcuZWNsaXBzZS5qZHQuY29yZS50ZXN0cy5jb21waWxl
ci9zcmMvb3JnL2VjbGlwc2UvamR0L2NvcmUvdGVzdHMvY29tcGlsZXIvcmVncmVzc2lvbi9FbnVt
VGVzdC5qYXZhCmluZGV4IGI5ZjU4MGYuLmFhNGQ0NzIgMTAwNjQ0Ci0tLSBhL29yZy5lY2xpcHNl
LmpkdC5jb3JlLnRlc3RzLmNvbXBpbGVyL3NyYy9vcmcvZWNsaXBzZS9qZHQvY29yZS90ZXN0cy9j
b21waWxlci9yZWdyZXNzaW9uL0VudW1UZXN0LmphdmEKKysrIGIvb3JnLmVjbGlwc2UuamR0LmNv
cmUudGVzdHMuY29tcGlsZXIvc3JjL29yZy9lY2xpcHNlL2pkdC9jb3JlL3Rlc3RzL2NvbXBpbGVy
L3JlZ3Jlc3Npb24vRW51bVRlc3QuamF2YQpAQCAtMzc2MSw3ICszNzYxLDcgQEAKIAkJIjEuIEVS
Uk9SIGluIFguamF2YSAoYXQgbGluZSAzKVxuIiArCiAJCSIJc3RhdGljIGludCBiYXI7XG4iICsK
IAkJIgkgICAgICAgICAgIF5eXlxuIiArCi0JCSJUaGUgZmllbGQgYmFyIGNhbm5vdCBiZSBkZWNs
YXJlZCBzdGF0aWM7IHN0YXRpYyBmaWVsZHMgY2FuIG9ubHkgYmUgZGVjbGFyZWQgaW4gc3RhdGlj
IG9yIHRvcCBsZXZlbCB0eXBlc1xuIiArCisJCSJUaGUgZmllbGQgYmFyIGNhbm5vdCBiZSBkZWNs
YXJlZCBzdGF0aWMgaW4gYSBub24tc3RhdGljIGlubmVyIHR5cGUsIHVubGVzcyBpbml0aWFsaXpl
ZCB3aXRoIGEgY29uc3RhbnQgZXhwcmVzc2lvblxuIiArCiAJCSItLS0tLS0tLS0tXG4iKTsKIH0K
IC8vaHR0cHM6Ly9idWdzLmVjbGlwc2Uub3JnL2J1Z3Mvc2hvd19idWcuY2dpP2lkPTk5NDI4IGFu
ZCBodHRwczovL2J1Z3MuZWNsaXBzZS5vcmcvYnVncy9zaG93X2J1Zy5jZ2k/aWQ9OTk2NTUKZGlm
ZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlL2NvbXBpbGVyL29yZy9lY2xpcHNlL2pkdC9p
bnRlcm5hbC9jb21waWxlci9wcm9ibGVtL21lc3NhZ2VzLnByb3BlcnRpZXMgYi9vcmcuZWNsaXBz
ZS5qZHQuY29yZS9jb21waWxlci9vcmcvZWNsaXBzZS9qZHQvaW50ZXJuYWwvY29tcGlsZXIvcHJv
YmxlbS9tZXNzYWdlcy5wcm9wZXJ0aWVzCmluZGV4IGQ2MjA3NGIuLjlkYjFiYTIgMTAwNjQ0Ci0t
LSBhL29yZy5lY2xpcHNlLmpkdC5jb3JlL2NvbXBpbGVyL29yZy9lY2xpcHNlL2pkdC9pbnRlcm5h
bC9jb21waWxlci9wcm9ibGVtL21lc3NhZ2VzLnByb3BlcnRpZXMKKysrIGIvb3JnLmVjbGlwc2Uu
amR0LmNvcmUvY29tcGlsZXIvb3JnL2VjbGlwc2UvamR0L2ludGVybmFsL2NvbXBpbGVyL3Byb2Js
ZW0vbWVzc2FnZXMucHJvcGVydGllcwpAQCAtMjg5LDcgKzI4OSw3IEBACiAzNDMgPSBJbGxlZ2Fs
IG1vZGlmaWVyIGZvciB0aGUgaW50ZXJmYWNlIGZpZWxkIHswfS57MX07IG9ubHkgcHVibGljLCBz
dGF0aWMgJiBmaW5hbCBhcmUgcGVybWl0dGVkCiAzNDQgPSBUaGUgZmllbGQgezB9IGNhbiBvbmx5
IHNldCBvbmUgb2YgcHVibGljIC8gcHJvdGVjdGVkIC8gcHJpdmF0ZQogMzQ1ID0gVGhlIGZpZWxk
IHswfSBjYW4gYmUgZWl0aGVyIGZpbmFsIG9yIHZvbGF0aWxlLCBub3QgYm90aAotMzQ2ID0gVGhl
IGZpZWxkIHswfSBjYW5ub3QgYmUgZGVjbGFyZWQgc3RhdGljOyBzdGF0aWMgZmllbGRzIGNhbiBv
bmx5IGJlIGRlY2xhcmVkIGluIHN0YXRpYyBvciB0b3AgbGV2ZWwgdHlwZXMKKzM0NiA9IFRoZSBm
aWVsZCB7MH0gY2Fubm90IGJlIGRlY2xhcmVkIHN0YXRpYyBpbiBhIG5vbi1zdGF0aWMgaW5uZXIg
dHlwZSwgdW5sZXNzIGluaXRpYWxpemVkIHdpdGggYSBjb25zdGFudCBleHByZXNzaW9uCiAKICMj
I1tvYnNvbGV0ZV0gMzUwID0gezJ9IGNhbm5vdCBiZSByZXNvbHZlZCAob3IgaXMgbm90IGEgdmFs
aWQgdHlwZSkgZm9yIHRoZSBmaWVsZCB7MX0uezB9CiAjIyNbb2Jzb2xldGVdIDM1MSA9IFRoZSB0
eXBlIHsyfSBpcyBub3QgdmlzaWJsZSBmb3IgdGhlIGZpZWxkIHsxfS57MH0=
</data>

          </attachment>
      

    </bug>

</bugzilla>