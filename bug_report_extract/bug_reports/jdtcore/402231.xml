<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>402231</bug_id>
          
          <creation_ts>2013-03-03 04:54:00 -0500</creation_ts>
          <short_desc>[1.8][ast rewrite] Rewrite support for lambda expressions.</short_desc>
          <delta_ts>2013-04-09 05:03:43 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>4.3</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows 7</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>BETA J8</target_milestone>
          
          <blocked>380188</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Srikanth Sankaran">srikanth_sankaran</reporter>
          <assigned_to name="Manoj Palat Away Until May 11 2015">manpalat</assigned_to>
          <cc>daniel_megert</cc>
    
    <cc>jarthana</cc>
    
    <cc>manpalat</cc>
    
    <cc>markus_keller</cc>
          
          <votes>0</votes>

      

      

      <flag name="review"
          id="56249"
          type_id="1"
          status="+"
          setter="markus_keller"
    />

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2225058</commentid>
    <comment_count>0</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2013-03-03 04:54:34 -0500</bug_when>
    <thetext>BETA_JAVA8: 

Now that bug 399793 is closed, we should start work on ASTRewrite support
for lambda expressions as a top priority.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2225059</commentid>
    <comment_count>1</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2013-03-03 04:55:23 -0500</bug_when>
    <thetext>Manoj, please follow up as top priority, TIA.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2227847</commentid>
    <comment_count>2</comment_count>
      <attachid>228121</attachid>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2013-03-07 23:04:30 -0500</bug_when>
    <thetext>Created attachment 228121
WIP - a few test cases</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2233512</commentid>
    <comment_count>3</comment_count>
      <attachid>228622</attachid>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2013-03-19 07:04:10 -0400</bug_when>
    <thetext>Created attachment 228622
Proposed Patch - WIP</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2234639</commentid>
    <comment_count>4</comment_count>
      <attachid>228804</attachid>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2013-03-20 23:14:47 -0400</bug_when>
    <thetext>Created attachment 228804
Proposed Patch

Note: Tested on b81</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2234893</commentid>
    <comment_count>5</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-03-21 09:37:00 -0400</bug_when>
    <thetext>Here are the review comments:

1. Removing the PARENTHESES_PROPERTY (set it to null) causes an NPE at the following line:

boolean hasParentheses = getNewValue(node, LambdaExpression.PARENTHESES_PROPERTY).equals(Boolean.TRUE);

Need to investigate if it&apos;s a valid scenario. If so, the remove event needs to be handled too.

To add some more details, the following two lines should result in the same output but that&apos;s not happening.

			// rewrite.set(lambdaExpression, LambdaExpression.PARENTHESES_PROPERTY, Boolean.FALSE, null);
			rewrite.set(lambdaExpression, LambdaExpression.PARENTHESES_PROPERTY, null, null);

2. We invoke getNewValue() twice to get the new value for PARENTHESES_PROPERTY. The second call event.getNewValue() can be avoided by storing the value in a local variable.

3. List parameters = (List)getNewValue(node, LambdaExpression.PARAMETERS_PROPERTY);

As per our formatting conventions, add a space after the cast.

4. Please remove the trailing white space. With the command line diff, it&apos;s easier to see the whitespace that is introduced by the patch.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2236118</commentid>
    <comment_count>6</comment_count>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2013-03-25 06:48:27 -0400</bug_when>
    <thetext>(In reply to comment #5)
&gt; Here are the review comments:
&gt; 
&gt; 1. Removing the PARENTHESES_PROPERTY (set it to null) causes an NPE at the
&gt; following line:
&gt; 
&gt; boolean hasParentheses = getNewValue(node,
&gt; LambdaExpression.PARENTHESES_PROPERTY).equals(Boolean.TRUE);
&gt; 
&gt; Need to investigate if it&apos;s a valid scenario. If so, the remove event needs
&gt; to be handled too.
&gt; 
&gt; To add some more details, the following two lines should result in the same
&gt; output but that&apos;s not happening.
&gt; 
&gt; 			// rewrite.set(lambdaExpression, LambdaExpression.PARENTHESES_PROPERTY,
&gt; Boolean.FALSE, null);
&gt; 			rewrite.set(lambdaExpression, LambdaExpression.PARENTHESES_PROPERTY,
&gt; null, null);

Markus: Any comments from the client&apos;s point of view for this case? Is the case of null to be handled for Boolean.class in this context?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2236565</commentid>
    <comment_count>7</comment_count>
      <attachid>229030</attachid>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2013-03-26 05:57:42 -0400</bug_when>
    <thetext>Created attachment 229030
Proposed Patch

Reworked. passing null will not cause not cause NPE.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2236575</commentid>
    <comment_count>8</comment_count>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2013-03-26 06:08:07 -0400</bug_when>
    <thetext>(In reply to comment #7)
&gt; Created attachment 229030 [details]
&gt; Proposed Patch
&gt; 
&gt; Reworked. passing null will not cause NPE.

Markus: Since similar Boolean.class properties, CONSRUCTOR_PROPERTY (MethodDeclaration) and INTERFACE_PROPERTY (TypeDeclaration) did not throw NPE, though there was no explicit code handling the null case, the patch was reworked not to throw a NPE. Please comment.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2241130</commentid>
    <comment_count>9</comment_count>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2013-04-08 14:42:56 -0400</bug_when>
    <thetext>(In reply to comment #8)
Looking for prior art is a good way to make such decisions. Unfortunately, the cited examples just work &quot;by accident&quot; in the ASTRewriteAnalyzer, since we only access the old property and check whether the property has been changed.

But they already fail in ASTRewriteFlattener, e.g. with this code:

	TypeDeclaration td = ast.newTypeDeclaration();
	rewrite.set(td, TypeDeclaration.INTERFACE_PROPERTY, null, null);
	rewrite.getListRewrite(astRoot, CompilationUnit.TYPES_PROPERTY)
		.insertFirst(td, null);


The Javadoc of ASTRewrite#set(..) says:
	 * If the given property is a simple property, the value must be the new
	 * value (primitive types must be boxed) or &lt;code&gt;null&lt;/code&gt;.

That excludes null as allowed value for boolean properties (since null is not a boxed value). The setter API ASTNode#setStructuralProperty(StructuralPropertyDescriptor, Object) also doesn&apos;t support null. If you set the &quot;org.eclipse.jdt.core/debug/dom/rewrite&quot; debug option (bug 404451), you also get an exception.

=&gt; &quot;.equals(Boolean.TRUE)&quot; is a better solution. This also has prior art in SingleVariableDeclaration.VARARGS_PROPERTY.

Note that &quot;newValue != Boolean.FALSE&quot; is wrong, since a client could also set the new value to &quot;new Boolean(false)&quot; (not very smart, but legal).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2241136</commentid>
    <comment_count>10</comment_count>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2013-04-08 15:06:06 -0400</bug_when>
    <thetext>In ASTRewriteAnalyzer#visit(LambdaExpression), the second assignment to hasParentheses could be written without the conditional:

	hasParentheses = !(parameters.size() == 1 &amp;&amp; parameters.get(0) instanceof VariableDeclarationFragment);


Likewise in ASTRewriteFlattener#visit(LambdaExpression), where this would also be easier to read:

	if (!hasParentheses) {
		List parameters = getChildList(node, LambdaExpression.PARAMETERS_PROPERTY);
		hasParentheses = !(parameters.size() == 1 &amp;&amp; parameters.get(0) instanceof VariableDeclarationFragment);
	}

The rest looks good.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2241230</commentid>
    <comment_count>11</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2013-04-08 23:19:03 -0400</bug_when>
    <thetext>(In reply to comment #10)

&gt; The rest looks good.

Markus, Thanks for the quick turnaround Markus. 

Manoj, please study the review comments and if the open issues are
peripheral in nature, let us release the patch and address the concerns
in a follow up defects asap.

This fix would unblock the UI team on the lambda expressions side and let us
not hold it up on account of non-core issues such as whether we deal with
a broken client appropriately. It is good to always make sure that the UI
team has something to chew on.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2241241</commentid>
    <comment_count>12</comment_count>
      <attachid>229477</attachid>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2013-04-09 01:37:52 -0400</bug_when>
    <thetext>Created attachment 229477
Proposed Patch

Thanks Markus for the review. 
Srikanth: Markus&apos; suggestion has been incorporated in this patch itself.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2241243</commentid>
    <comment_count>13</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2013-04-09 01:49:34 -0400</bug_when>
    <thetext>Fix and tests released here: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?h=BETA_JAVA8&amp;id=8a2a28b44267beff0fdfbe7d6582425d224ea02d.

With this, DOM/AST, ASTRewrite and formatter support for lambda expressions
is complete and released and the UI team can start to schedule work in this
area, bug reports are welcome.

[Manoj, is there a reason why we build the program text via dozens of
buf.append calls instead a single one ? Notwithstanding the fact that
this is test code, should we perpetuate this coding practice ?]

Thanks Manoj.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2241248</commentid>
    <comment_count>14</comment_count>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2013-04-09 01:57:23 -0400</bug_when>
    <thetext>(In reply to comment #13)
&gt; Fix and tests released here:
&gt; http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/
&gt; ?h=BETA_JAVA8&amp;id=8a2a28b44267beff0fdfbe7d6582425d224ea02d.
&gt; 
Thanks Srikanth.


&gt; [Manoj, is there a reason why we build the program text via dozens of
&gt; buf.append calls instead a single one ? Notwithstanding the fact that
&gt; this is test code, should we perpetuate this coding practice ?]
&gt; 
wondered the same; couldn&apos;t get any &quot;reasonable&quot; reason. Will cleanup periodically the tests and thus, hopefully making the tests a little faster.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2241254</commentid>
    <comment_count>15</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2013-04-09 02:14:40 -0400</bug_when>
    <thetext>(In reply to comment #14)

&gt; &gt; [Manoj, is there a reason why we build the program text via dozens of
&gt; &gt; buf.append calls instead a single one ? Notwithstanding the fact that
&gt; &gt; this is test code, should we perpetuate this coding practice ?]
&gt; &gt; 
&gt; wondered the same; couldn&apos;t get any &quot;reasonable&quot; reason. Will cleanup
&gt; periodically the tests and thus, hopefully making the tests a little faster.

I wouldn&apos;t worry about cleaning up the existing tests. As long as we don&apos;t
continue to perpetuate this practice, it should be good.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2241315</commentid>
    <comment_count>16</comment_count>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2013-04-09 05:03:43 -0400</bug_when>
    <thetext>&gt; reason why we build the program text via dozens of buf.append calls?

The historical reason is that Martin once wrote this infrastructure, and he added a quick assist to the jdt.ui.tests plug-in, which lets you select some source in the runtime workbench, do Ctrl+1 and choose &quot;Wrap in buf.append() (to clipboard)&quot;.

That way, you never have to manually fiddle with formatting and line delimiters when you create multi-line source code in tests (always indents with spaces and always uses \n).</thetext>
  </long_desc>
      
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>228121</attachid>
            <date>2013-03-07 23:04:00 -0500</date>
            <delta_ts>2013-03-20 23:14:47 -0400</delta_ts>
            <desc>WIP - a few test cases</desc>
            <filename>Bug-402231--Lambda-Rewrite--WIP.patch</filename>
            <type>text/plain</type>
            <size>10052</size>
            <attacher name="Manoj Palat Away Until May 11 2015">manpalat</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3NyYy9vcmcvZWNs
aXBzZS9qZHQvY29yZS90ZXN0cy9yZXdyaXRlL2Rlc2NyaWJpbmcvQVNUUmV3cml0aW5nTGFtYmRh
RXhwcmVzc2lvblRlc3QuamF2YSBiL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3Ny
Yy9vcmcvZWNsaXBzZS9qZHQvY29yZS90ZXN0cy9yZXdyaXRlL2Rlc2NyaWJpbmcvQVNUUmV3cml0
aW5nTGFtYmRhRXhwcmVzc2lvblRlc3QuamF2YQpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAw
MDAwMDAwLi41MjNmOTI0Ci0tLSAvZGV2L251bGwKKysrIGIvb3JnLmVjbGlwc2UuamR0LmNvcmUu
dGVzdHMubW9kZWwvc3JjL29yZy9lY2xpcHNlL2pkdC9jb3JlL3Rlc3RzL3Jld3JpdGUvZGVzY3Jp
YmluZy9BU1RSZXdyaXRpbmdMYW1iZGFFeHByZXNzaW9uVGVzdC5qYXZhCkBAIC0wLDAgKzEsMjE3
IEBACisvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKgorICogQ29weXJpZ2h0IChjKSAyMDEzIElCTSBD
b3Jwb3JhdGlvbiBhbmQgb3RoZXJzLgorICogQWxsIHJpZ2h0cyByZXNlcnZlZC4gVGhpcyBwcm9n
cmFtIGFuZCB0aGUgYWNjb21wYW55aW5nIG1hdGVyaWFscworICogYXJlIG1hZGUgYXZhaWxhYmxl
IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgRWNsaXBzZSBQdWJsaWMgTGljZW5zZSB2MS4wCisgKiB3
aGljaCBhY2NvbXBhbmllcyB0aGlzIGRpc3RyaWJ1dGlvbiwgYW5kIGlzIGF2YWlsYWJsZSBhdAor
ICogaHR0cDovL3d3dy5lY2xpcHNlLm9yZy9sZWdhbC9lcGwtdjEwLmh0bWwKKyAqCisgKiBUaGlz
IGlzIGFuIGltcGxlbWVudGF0aW9uIG9mIGFuIGVhcmx5LWRyYWZ0IHNwZWNpZmljYXRpb24gZGV2
ZWxvcGVkIHVuZGVyIHRoZSBKYXZhCisgKiBDb21tdW5pdHkgUHJvY2VzcyAoSkNQKSBhbmQgaXMg
bWFkZSBhdmFpbGFibGUgZm9yIHRlc3RpbmcgYW5kIGV2YWx1YXRpb24gcHVycG9zZXMKKyAqIG9u
bHkuIFRoZSBjb2RlIGlzIG5vdCBjb21wYXRpYmxlIHdpdGggYW55IHNwZWNpZmljYXRpb24gb2Yg
dGhlIEpDUC4KKyAqCisgKiBDb250cmlidXRvcnM6CisgKiAgICAgSUJNIENvcnBvcmF0aW9uIC0g
aW5pdGlhbCBBUEkgYW5kIGltcGxlbWVudGF0aW9uCisgKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8K
K3BhY2thZ2Ugb3JnLmVjbGlwc2UuamR0LmNvcmUudGVzdHMucmV3cml0ZS5kZXNjcmliaW5nOwor
CitpbXBvcnQgamF2YS51dGlsLkxpc3Q7CisKK2ltcG9ydCBqdW5pdC5mcmFtZXdvcmsuVGVzdDsK
KworaW1wb3J0IG9yZy5lY2xpcHNlLmpkdC5jb3JlLklDb21waWxhdGlvblVuaXQ7CitpbXBvcnQg
b3JnLmVjbGlwc2UuamR0LmNvcmUuSVBhY2thZ2VGcmFnbWVudDsKK2ltcG9ydCBvcmcuZWNsaXBz
ZS5qZHQuY29yZS5kb20uKjsKK2ltcG9ydCBvcmcuZWNsaXBzZS5qZHQuY29yZS5kb20ucmV3cml0
ZS5BU1RSZXdyaXRlOworCitwdWJsaWMgY2xhc3MgQVNUUmV3cml0aW5nTGFtYmRhRXhwcmVzc2lv
blRlc3QgZXh0ZW5kcyBBU1RSZXdyaXRpbmdUZXN0IHsKKworCXB1YmxpYyBBU1RSZXdyaXRpbmdM
YW1iZGFFeHByZXNzaW9uVGVzdChTdHJpbmcgbmFtZSkgeworCQlzdXBlcihuYW1lKTsKKwl9CisK
KwlwdWJsaWMgQVNUUmV3cml0aW5nTGFtYmRhRXhwcmVzc2lvblRlc3QoU3RyaW5nIG5hbWUsIGlu
dCBhcGlMZXZlbCkgeworCQlzdXBlcihuYW1lLCBhcGlMZXZlbCk7CisJfQorCisJcHVibGljIHN0
YXRpYyBUZXN0IHN1aXRlKCkgeworCQlyZXR1cm4gY3JlYXRlU3VpdGUoQVNUUmV3cml0aW5nTGFt
YmRhRXhwcmVzc2lvblRlc3QuY2xhc3MpOworCX0KKworCXB1YmxpYyB2b2lkIHRlc3RMYW1iZGFF
eHByZXNzaW9uc18xKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CisJCUlQYWNrYWdlRnJhZ21lbnQgcGFj
azE9IHRoaXMuc291cmNlRm9sZGVyLmNyZWF0ZVBhY2thZ2VGcmFnbWVudCgidGVzdDEiLCBmYWxz
ZSwgbnVsbCk7CisJCVN0cmluZ0J1ZmZlciBidWY9IG5ldyBTdHJpbmdCdWZmZXIoKTsKKwkJYnVm
LmFwcGVuZCgicGFja2FnZSB0ZXN0MTtcbiIpOworCQlidWYuYXBwZW5kKCJpbnRlcmZhY2UgSSB7
XG4iKTsKKwkJYnVmLmFwcGVuZCgiCWludCBmb28oaW50IHgpO1xuIik7CisJCWJ1Zi5hcHBlbmQo
In1cbiIpOworCQlidWYuYXBwZW5kKCJwdWJsaWMgY2xhc3MgWCB7XG4iKTsKKwkJYnVmLmFwcGVu
ZCgiIEkgaSA9ICB2bGFtYmRhIC0+IHtyZXR1cm4gMjAwO307XG4iKTsKKwkJYnVmLmFwcGVuZCgi
fVxuIik7CisJCUlDb21waWxhdGlvblVuaXQgY3U9IHBhY2sxLmNyZWF0ZUNvbXBpbGF0aW9uVW5p
dCgiWC5qYXZhIiwgYnVmLnRvU3RyaW5nKCksIGZhbHNlLCBudWxsKTsKKworCQlDb21waWxhdGlv
blVuaXQgYXN0Um9vdD0gY3JlYXRlQVNUKGN1KTsKKwkJQVNUUmV3cml0ZSByZXdyaXRlPSBBU1RS
ZXdyaXRlLmNyZWF0ZShhc3RSb290LmdldEFTVCgpKTsKKwkJQVNUIGFzdD0gYXN0Um9vdC5nZXRB
U1QoKTsKKworCQlUeXBlRGVjbGFyYXRpb24gdHlwZWRlY2xhcmF0aW9uPSBmaW5kVHlwZURlY2xh
cmF0aW9uKGFzdFJvb3QsICJJIik7CisKKwkJeyAvLyBjaGFuZ2UgcmV0dXJuIHR5cGUKKwkJCU1l
dGhvZERlY2xhcmF0aW9uIG1ldGhvZERlY2w9IGZpbmRNZXRob2REZWNsYXJhdGlvbih0eXBlZGVj
bGFyYXRpb24sICJmb28iKTsKKwkJCWFzc2VydFRydWUoIm51bGwgcmV0dXJuIHR5cGU6IGZvbyIs
IG1ldGhvZERlY2wuZ2V0UmV0dXJuVHlwZTIoKSAhPSBudWxsKTsKKworCQkJVHlwZSByZXR1cm5U
eXBlPSBtZXRob2REZWNsLmdldFJldHVyblR5cGUyKCk7CisJCQlUeXBlIG5ld1JldHVyblR5cGU9
IGFzdFJvb3QuZ2V0QVNUKCkubmV3UHJpbWl0aXZlVHlwZShQcmltaXRpdmVUeXBlLkZMT0FUKTsK
KwkJCXJld3JpdGUucmVwbGFjZShyZXR1cm5UeXBlLCBuZXdSZXR1cm5UeXBlLCBudWxsKTsKKwkJ
fQorCQl7IC8vIGFkZCBhIHBhcmFtZXRlciB0byB0aGUgc2luZ2xldG9uIGZ1bmN0aW9uIGluIHRo
ZSBpbnRlcmZhY2UuCisJCQlNZXRob2REZWNsYXJhdGlvbiBtZXRob2REZWNsPSBmaW5kTWV0aG9k
RGVjbGFyYXRpb24odHlwZWRlY2xhcmF0aW9uLCAiZm9vIik7CisJCQlMaXN0IHBhcmFtZXRlcnM9
IG1ldGhvZERlY2wucGFyYW1ldGVycygpOworCQkJYXNzZXJ0VHJ1ZSgibXVzdCBiZSAxIHBhcmFt
ZXRlciIsIHBhcmFtZXRlcnMuc2l6ZSgpID09IDEpOworCisJCQlTaW5nbGVWYXJpYWJsZURlY2xh
cmF0aW9uIGRlY2w9IGFzdC5uZXdTaW5nbGVWYXJpYWJsZURlY2xhcmF0aW9uKCk7CisJCQlkZWNs
LnNldFR5cGUoYXN0Lm5ld1ByaW1pdGl2ZVR5cGUoUHJpbWl0aXZlVHlwZS5JTlQpKTsKKwkJCWRl
Y2wuc2V0TmFtZShhc3QubmV3U2ltcGxlTmFtZSgieSIpKTsKKwkJCXJld3JpdGUuZ2V0TGlzdFJl
d3JpdGUobWV0aG9kRGVjbCwgTWV0aG9kRGVjbGFyYXRpb24uUEFSQU1FVEVSU19QUk9QRVJUWSku
aW5zZXJ0TGFzdChkZWNsLCBudWxsKTsKKwkJfQorCisJCXR5cGVkZWNsYXJhdGlvbj0gZmluZFR5
cGVEZWNsYXJhdGlvbihhc3RSb290LCAiWCIpOworCQlGaWVsZERlY2xhcmF0aW9uIGZpZWxkRGVj
bGFyYXRpb24gPSAoRmllbGREZWNsYXJhdGlvbikgdHlwZWRlY2xhcmF0aW9uLmJvZHlEZWNsYXJh
dGlvbnMoKS5nZXQoMCk7CisJCVZhcmlhYmxlRGVjbGFyYXRpb25GcmFnbWVudCBmcmFnbWVudCA9
IChWYXJpYWJsZURlY2xhcmF0aW9uRnJhZ21lbnQpZmllbGREZWNsYXJhdGlvbi5mcmFnbWVudHMo
KS5nZXQoMCk7CisJCUV4cHJlc3Npb24gZXhwcmVzc2lvbiA9IGZyYWdtZW50LmdldEluaXRpYWxp
emVyKCk7CisJCWFzc2VydFRydWUoZXhwcmVzc2lvbiBpbnN0YW5jZW9mIExhbWJkYUV4cHJlc3Np
b24pOworCQlMYW1iZGFFeHByZXNzaW9uIGxhbWJkYUV4cHJlc3Npb24gPSAoTGFtYmRhRXhwcmVz
c2lvbilleHByZXNzaW9uOworCQkKKwkJey8vIGFkZCBhIHBhcmFtZXRlciB0byB0aGUgbGFtYmRh
IGV4cHJlc3Npb24KKwkJCUxpc3QgcGFyYW1ldGVycz0gbGFtYmRhRXhwcmVzc2lvbi5wYXJhbWV0
ZXJzKCk7CisJCQlhc3NlcnRUcnVlKCJtdXN0IGJlIDEgcGFyYW1ldGVyIiwgcGFyYW1ldGVycy5z
aXplKCkgPT0gMSk7CisJCQlBU1ROb2RlIGZpcnN0UGFyYW09IChBU1ROb2RlKSBwYXJhbWV0ZXJz
LmdldCgwKTsKKwkJCVZhcmlhYmxlRGVjbGFyYXRpb25GcmFnbWVudCBuZXdQYXJhbT0gYXN0Lm5l
d1ZhcmlhYmxlRGVjbGFyYXRpb25GcmFnbWVudCgpOworCQkJbmV3UGFyYW0uc2V0TmFtZShhc3Qu
bmV3U2ltcGxlTmFtZSgid2xhbWJkYSIpKTsKKwkJCXJld3JpdGUuZ2V0TGlzdFJld3JpdGUobGFt
YmRhRXhwcmVzc2lvbiwgTGFtYmRhRXhwcmVzc2lvbi5QQVJBTUVURVJTX1BST1BFUlRZKS5pbnNl
cnRBZnRlcihuZXdQYXJhbSwgZmlyc3RQYXJhbSwgbnVsbCk7CQkKKwkJfQorCQkKKwkJey8vIHJl
cGxhY2UgdGhlIGJsb2NrIGJvZHkgd2l0aCBhIGZsb2F0IGxpdGVyYWwgZXhwcmVzc2lvbiBib2R5
LgorCQkJQVNUTm9kZSBib2R5ID0gbGFtYmRhRXhwcmVzc2lvbi5nZXRCb2R5KCk7CisJCQlBU1RO
b2RlIG5ld0JvZHkgPSBhc3QubmV3TnVtYmVyTGl0ZXJhbCgiMy4xNCIpOworCQkJcmV3cml0ZS5y
ZXBsYWNlKGJvZHksIG5ld0JvZHksIG51bGwpOworCQl9CisJCVN0cmluZyBwcmV2aWV3PSBldmFs
dWF0ZVJld3JpdGUoY3UsIHJld3JpdGUpOworCisJCWJ1Zj0gbmV3IFN0cmluZ0J1ZmZlcigpOwor
CQlidWYuYXBwZW5kKCJwYWNrYWdlIHRlc3QxO1xuIik7CisJCWJ1Zi5hcHBlbmQoImludGVyZmFj
ZSBJIHtcbiIpOworCQlidWYuYXBwZW5kKCIJZmxvYXQgZm9vKGludCB4LCBpbnQgeSk7XG4iKTsK
KwkJYnVmLmFwcGVuZCgifVxuIik7CisJCWJ1Zi5hcHBlbmQoInB1YmxpYyBjbGFzcyBYIHtcbiIp
OworCQlidWYuYXBwZW5kKCIgSSBpID0gICh2bGFtYmRhLCB3bGFtYmRhKSAtPiAzLjE0O1xuIik7
CisJCWJ1Zi5hcHBlbmQoIn1cbiIpOworCQlhc3NlcnRFcXVhbFN0cmluZyhwcmV2aWV3LCBidWYu
dG9TdHJpbmcoKSk7CisJfQorCQorCXB1YmxpYyB2b2lkIHRlc3RMYW1iZGFFeHByZXNzaW9uc19Q
YXJlbnRoZXNlcygpIHRocm93cyBFeGNlcHRpb24geworCQlJUGFja2FnZUZyYWdtZW50IHBhY2sx
PSB0aGlzLnNvdXJjZUZvbGRlci5jcmVhdGVQYWNrYWdlRnJhZ21lbnQoInRlc3QxIiwgZmFsc2Us
IG51bGwpOworCQlTdHJpbmdCdWZmZXIgYnVmPSBuZXcgU3RyaW5nQnVmZmVyKCk7CisJCWJ1Zi5h
cHBlbmQoInBhY2thZ2UgdGVzdDE7XG4iKTsKKwkJYnVmLmFwcGVuZCgiaW50ZXJmYWNlIEkge1xu
Iik7CisJCWJ1Zi5hcHBlbmQoIglpbnQgZm9vKGludCB4KTtcbiIpOworCQlidWYuYXBwZW5kKCJ9
XG4iKTsKKwkJYnVmLmFwcGVuZCgiaW50ZXJmYWNlIEoge1xuIik7CisJCWJ1Zi5hcHBlbmQoIglp
bnQgZm9vKCk7XG4iKTsKKwkJYnVmLmFwcGVuZCgifVxuIik7CisJCWJ1Zi5hcHBlbmQoImludGVy
ZmFjZSBLIHtcbiIpOworCQlidWYuYXBwZW5kKCIJaW50IGZvbyhpbnQgeCwgaW50IHkpO1xuIik7
CisJCWJ1Zi5hcHBlbmQoIn1cbiIpOworCQlidWYuYXBwZW5kKCJwdWJsaWMgY2xhc3MgWCB7XG4i
KTsKKwkJYnVmLmFwcGVuZCgiIEkgaSA9ICB2bGFtYmRhIC0+IDIyMTIxODg3O1xuIik7CisJCWJ1
Zi5hcHBlbmQoIiBKIGogPSAgKCkgLT4gMjYwNDE5MjA7XG4iKTsKKwkJYnVmLmFwcGVuZCgiIEsg
ayA9ICAoeCwgeSkgLT4gMTcyOTtcbiIpOworCQlidWYuYXBwZW5kKCIgSyBrZGFzaCA9ICAoaW50
IHgsIGludCB5KSAtPiAxNzI5O1xuIik7CisJCWJ1Zi5hcHBlbmQoIn1cbiIpOworCQlJQ29tcGls
YXRpb25Vbml0IGN1PSBwYWNrMS5jcmVhdGVDb21waWxhdGlvblVuaXQoIlguamF2YSIsIGJ1Zi50
b1N0cmluZygpLCBmYWxzZSwgbnVsbCk7CisKKwkJQ29tcGlsYXRpb25Vbml0IGFzdFJvb3Q9IGNy
ZWF0ZUFTVChjdSk7CisJCUFTVFJld3JpdGUgcmV3cml0ZT0gQVNUUmV3cml0ZS5jcmVhdGUoYXN0
Um9vdC5nZXRBU1QoKSk7CisJCUFTVCBhc3Q9IGFzdFJvb3QuZ2V0QVNUKCk7CisKKwkJVHlwZURl
Y2xhcmF0aW9uIHR5cGVkZWNsYXJhdGlvbj0gZmluZFR5cGVEZWNsYXJhdGlvbihhc3RSb290LCAi
WCIpOworCQlGaWVsZERlY2xhcmF0aW9uIGZpZWxkRGVjbGFyYXRpb24gPSAoRmllbGREZWNsYXJh
dGlvbikgdHlwZWRlY2xhcmF0aW9uLmJvZHlEZWNsYXJhdGlvbnMoKS5nZXQoMCk7CisJCVZhcmlh
YmxlRGVjbGFyYXRpb25GcmFnbWVudCBmcmFnbWVudCA9IChWYXJpYWJsZURlY2xhcmF0aW9uRnJh
Z21lbnQpZmllbGREZWNsYXJhdGlvbi5mcmFnbWVudHMoKS5nZXQoMCk7CisJCUxhbWJkYUV4cHJl
c3Npb24gbGFtYmRhRXhwcmVzc2lvbiA9IChMYW1iZGFFeHByZXNzaW9uKWZyYWdtZW50LmdldElu
aXRpYWxpemVyKCk7CisJCQorCQl7Ly8gc2V0IHBhcmVudGhlc2VzIC0gYSBsZWdhbCBvcGVyYXRp
b24gaGVyZS4KKwkJCWFzc2VydFRydWUoImxhbWJkYSBleHByZXNzaW9uIGhhcyBwYXJhbnRoZXNl
cyIsIGxhbWJkYUV4cHJlc3Npb24uaGFzUGFyZW50aGVzZXMoKSA9PSBmYWxzZSk7CisJCQlyZXdy
aXRlLnNldChsYW1iZGFFeHByZXNzaW9uLCBMYW1iZGFFeHByZXNzaW9uLlBBUkVOVEhFU0VTX1BS
T1BFUlRZLCBCb29sZWFuLlRSVUUsIG51bGwpOworCQl9CisJCQorCQl7Ly8gcmVwbGFjZSB0aGUg
YmxvY2sgYm9keSB3aXRoIGEgZmxvYXQgbGl0ZXJhbCBleHByZXNzaW9uIGJvZHkuCisJCQlBU1RO
b2RlIGJvZHkgPSBsYW1iZGFFeHByZXNzaW9uLmdldEJvZHkoKTsKKwkJCUFTVE5vZGUgbmV3Qm9k
eSA9IGFzdC5uZXdOdW1iZXJMaXRlcmFsKCIzLjE0Iik7CisJCQlyZXdyaXRlLnJlcGxhY2UoYm9k
eSwgbmV3Qm9keSwgbnVsbCk7CisJCX0KKworCQlmaWVsZERlY2xhcmF0aW9uID0gKEZpZWxkRGVj
bGFyYXRpb24pIHR5cGVkZWNsYXJhdGlvbi5ib2R5RGVjbGFyYXRpb25zKCkuZ2V0KDEpOworCQlm
cmFnbWVudCA9IChWYXJpYWJsZURlY2xhcmF0aW9uRnJhZ21lbnQpZmllbGREZWNsYXJhdGlvbi5m
cmFnbWVudHMoKS5nZXQoMCk7CisJCWxhbWJkYUV4cHJlc3Npb24gPSAoTGFtYmRhRXhwcmVzc2lv
bilmcmFnbWVudC5nZXRJbml0aWFsaXplcigpOworCisJCXsvLyByZXNldCBwYXJlbnRoZXNlcyAt
IGFuIGlsbGVnYWwgb3BlcmF0aW9uIGhlcmUuCisJCQlhc3NlcnRUcnVlKCJsYW1iZGEgZXhwcmVz
c2lvbiBkb2VzIG5vdCBoYXZlIHBhcmFudGhlc2VzIiwgbGFtYmRhRXhwcmVzc2lvbi5oYXNQYXJl
bnRoZXNlcygpID09IHRydWUpOworCQkJcmV3cml0ZS5zZXQobGFtYmRhRXhwcmVzc2lvbiwgTGFt
YmRhRXhwcmVzc2lvbi5QQVJFTlRIRVNFU19QUk9QRVJUWSwgQm9vbGVhbi5GQUxTRSwgbnVsbCk7
CisJCX0KKworCQlmaWVsZERlY2xhcmF0aW9uID0gKEZpZWxkRGVjbGFyYXRpb24pIHR5cGVkZWNs
YXJhdGlvbi5ib2R5RGVjbGFyYXRpb25zKCkuZ2V0KDIpOworCQlmcmFnbWVudCA9IChWYXJpYWJs
ZURlY2xhcmF0aW9uRnJhZ21lbnQpZmllbGREZWNsYXJhdGlvbi5mcmFnbWVudHMoKS5nZXQoMCk7
CisJCWxhbWJkYUV4cHJlc3Npb24gPSAoTGFtYmRhRXhwcmVzc2lvbilmcmFnbWVudC5nZXRJbml0
aWFsaXplcigpOworCisJCXsvLyByZXNldCBwYXJlbnRoZXNlcyAtIGFuIGlsbGVnYWwgb3BlcmF0
aW9uIGhlcmUuCisJCQlhc3NlcnRUcnVlKCJsYW1iZGEgZXhwcmVzc2lvbiBkb2VzIG5vdCBoYXZl
IHBhcmFudGhlc2VzIiwgbGFtYmRhRXhwcmVzc2lvbi5oYXNQYXJlbnRoZXNlcygpID09IHRydWUp
OworCQkJcmV3cml0ZS5zZXQobGFtYmRhRXhwcmVzc2lvbiwgTGFtYmRhRXhwcmVzc2lvbi5QQVJF
TlRIRVNFU19QUk9QRVJUWSwgQm9vbGVhbi5GQUxTRSwgbnVsbCk7CisJCX0KKwkJCisJCXsvLyBj
aGFuZ2UgYWxsIHRoZSBwYXJhbWV0ZXIgdG8gU1ZEIGllIGFkZCB0eXBlIGluZm8gdG8gdGhlIHBh
cmFtZXRlcnMuCisJCQlMaXN0IHBhcmFtZXRlcnMgPSBsYW1iZGFFeHByZXNzaW9uLnBhcmFtZXRl
cnMoKTsKKwkJCVZhcmlhYmxlRGVjbGFyYXRpb24gcGFyYW0gPSAoVmFyaWFibGVEZWNsYXJhdGlv
bilwYXJhbWV0ZXJzLmdldCgwKTsKKwkJCVNpbmdsZVZhcmlhYmxlRGVjbGFyYXRpb24gbmV3UGFy
YW09IGFzdC5uZXdTaW5nbGVWYXJpYWJsZURlY2xhcmF0aW9uKCk7CisJCQluZXdQYXJhbS5zZXRO
YW1lKGFzdC5uZXdTaW1wbGVOYW1lKG5ldyBTdHJpbmcocGFyYW0udG9TdHJpbmcoKSkpKTsKKwkJ
CW5ld1BhcmFtLnNldFR5cGUoYXN0Lm5ld1ByaW1pdGl2ZVR5cGUoUHJpbWl0aXZlVHlwZS5JTlQp
KTsKKwkJCXJld3JpdGUuZ2V0TGlzdFJld3JpdGUobGFtYmRhRXhwcmVzc2lvbiwgTGFtYmRhRXhw
cmVzc2lvbi5QQVJBTUVURVJTX1BST1BFUlRZKS5yZXBsYWNlKHBhcmFtLCBuZXdQYXJhbSwgbnVs
bCk7CisJCQkKKwkJCXBhcmFtID0gKFZhcmlhYmxlRGVjbGFyYXRpb24pcGFyYW1ldGVycy5nZXQo
MSk7CisJCQluZXdQYXJhbT0gYXN0Lm5ld1NpbmdsZVZhcmlhYmxlRGVjbGFyYXRpb24oKTsKKwkJ
CW5ld1BhcmFtLnNldE5hbWUoYXN0Lm5ld1NpbXBsZU5hbWUobmV3IFN0cmluZyhwYXJhbS50b1N0
cmluZygpKSkpOworCQkJbmV3UGFyYW0uc2V0VHlwZShhc3QubmV3UHJpbWl0aXZlVHlwZShQcmlt
aXRpdmVUeXBlLklOVCkpOworCQkJcmV3cml0ZS5nZXRMaXN0UmV3cml0ZShsYW1iZGFFeHByZXNz
aW9uLCBMYW1iZGFFeHByZXNzaW9uLlBBUkFNRVRFUlNfUFJPUEVSVFkpLnJlcGxhY2UocGFyYW0s
IG5ld1BhcmFtLCBudWxsKTsKKwkJfQorCisJCXsvLyBSZW1vdmUgdHlwZSBpbmZvIGZyb20gdGhl
IHBhcmFtZXRlcnMuCisKKwkJCUxpc3QgcGFyYW1ldGVycyA9IGxhbWJkYUV4cHJlc3Npb24ucGFy
YW1ldGVycygpOworCQkJZm9yIChpbnQgaSA9IDA7IGkgPCBwYXJhbWV0ZXJzLnNpemUoKTsgKytp
KSB7CisJCQkJU2luZ2xlVmFyaWFibGVEZWNsYXJhdGlvbiBwYXJhbSA9IChTaW5nbGVWYXJpYWJs
ZURlY2xhcmF0aW9uKXBhcmFtZXRlcnMuZ2V0KGkpOworCQkJCVZhcmlhYmxlRGVjbGFyYXRpb25G
cmFnbWVudCBuZXdQYXJhbT0gYXN0Lm5ld1ZhcmlhYmxlRGVjbGFyYXRpb25GcmFnbWVudCgpOwor
CQkJCW5ld1BhcmFtLnNldE5hbWUoYXN0Lm5ld1NpbXBsZU5hbWUobmV3IFN0cmluZyhwYXJhbS50
b1N0cmluZygpKSkpOworCQkJCXJld3JpdGUuZ2V0TGlzdFJld3JpdGUobGFtYmRhRXhwcmVzc2lv
biwgTGFtYmRhRXhwcmVzc2lvbi5QQVJBTUVURVJTX1BST1BFUlRZKS5yZXBsYWNlKHBhcmFtLCBu
ZXdQYXJhbSwgbnVsbCk7CQkJCQorCQkJfQorCQl9CisKKwkJU3RyaW5nIHByZXZpZXc9IGV2YWx1
YXRlUmV3cml0ZShjdSwgcmV3cml0ZSk7CisKKwkJYnVmPSBuZXcgU3RyaW5nQnVmZmVyKCk7CisJ
CWJ1Zi5hcHBlbmQoInBhY2thZ2UgdGVzdDE7XG4iKTsKKwkJYnVmLmFwcGVuZCgiaW50ZXJmYWNl
IEkge1xuIik7CisJCWJ1Zi5hcHBlbmQoIglpbnQgZm9vKGludCB4KTtcbiIpOworCQlidWYuYXBw
ZW5kKCJ9XG4iKTsKKwkJYnVmLmFwcGVuZCgiaW50ZXJmYWNlIEoge1xuIik7CisJCWJ1Zi5hcHBl
bmQoIglpbnQgZm9vKCk7XG4iKTsKKwkJYnVmLmFwcGVuZCgifVxuIik7CisJCWJ1Zi5hcHBlbmQo
ImludGVyZmFjZSBLIHtcbiIpOworCQlidWYuYXBwZW5kKCIJaW50IGZvbyhpbnQgeCwgaW50IHkp
O1xuIik7CisJCWJ1Zi5hcHBlbmQoIn1cbiIpOworCQlidWYuYXBwZW5kKCJwdWJsaWMgY2xhc3Mg
WCB7XG4iKTsKKwkJYnVmLmFwcGVuZCgiIEkgaSA9ICB2bGFtYmRhIC0+IDIyMTIxODg3O1xuIik7
CisJCWJ1Zi5hcHBlbmQoIiBKIGogPSAgKCkgLT4gMjYwNDE5MjA7XG4iKTsKKwkJYnVmLmFwcGVu
ZCgiIEsgayA9ICAoaW50IHgsIGludCB5KSAtPiAxNzI5O1xuIik7CisJCWJ1Zi5hcHBlbmQoIiBL
IGtkYXNoID0gICh4LCB5KSAtPiAxNzI5O1xuIik7CisJCWJ1Zi5hcHBlbmQoIn1cbiIpOworCQlh
c3NlcnRFcXVhbFN0cmluZyhwcmV2aWV3LCBidWYudG9TdHJpbmcoKSk7CisJfQorfQpcIE5vIG5l
d2xpbmUgYXQgZW5kIG9mIGZpbGU=
</data>

          </attachment>
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>228622</attachid>
            <date>2013-03-19 07:04:00 -0400</date>
            <delta_ts>2013-03-20 23:14:47 -0400</delta_ts>
            <desc>Proposed Patch - WIP</desc>
            <filename>Bug-402231--18ast-rewrite-Rewrite-support-for-lambda.patch</filename>
            <type>text/plain</type>
            <size>19331</size>
            <attacher name="Manoj Palat Away Until May 11 2015">manpalat</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3NyYy9vcmcvZWNs
aXBzZS9qZHQvY29yZS90ZXN0cy9yZXdyaXRlL2Rlc2NyaWJpbmcvQVNUUmV3cml0aW5nTGFtYmRh
RXhwcmVzc2lvblRlc3QuamF2YSBiL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3Ny
Yy9vcmcvZWNsaXBzZS9qZHQvY29yZS90ZXN0cy9yZXdyaXRlL2Rlc2NyaWJpbmcvQVNUUmV3cml0
aW5nTGFtYmRhRXhwcmVzc2lvblRlc3QuamF2YQpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAw
MDAwMDAwLi5lMGFjNDZiCi0tLSAvZGV2L251bGwKKysrIGIvb3JnLmVjbGlwc2UuamR0LmNvcmUu
dGVzdHMubW9kZWwvc3JjL29yZy9lY2xpcHNlL2pkdC9jb3JlL3Rlc3RzL3Jld3JpdGUvZGVzY3Jp
YmluZy9BU1RSZXdyaXRpbmdMYW1iZGFFeHByZXNzaW9uVGVzdC5qYXZhCkBAIC0wLDAgKzEsMjg5
IEBACisvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKgorICogQ29weXJpZ2h0IChjKSAyMDEzIElCTSBD
b3Jwb3JhdGlvbiBhbmQgb3RoZXJzLgorICogQWxsIHJpZ2h0cyByZXNlcnZlZC4gVGhpcyBwcm9n
cmFtIGFuZCB0aGUgYWNjb21wYW55aW5nIG1hdGVyaWFscworICogYXJlIG1hZGUgYXZhaWxhYmxl
IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgRWNsaXBzZSBQdWJsaWMgTGljZW5zZSB2MS4wCisgKiB3
aGljaCBhY2NvbXBhbmllcyB0aGlzIGRpc3RyaWJ1dGlvbiwgYW5kIGlzIGF2YWlsYWJsZSBhdAor
ICogaHR0cDovL3d3dy5lY2xpcHNlLm9yZy9sZWdhbC9lcGwtdjEwLmh0bWwKKyAqCisgKiBUaGlz
IGlzIGFuIGltcGxlbWVudGF0aW9uIG9mIGFuIGVhcmx5LWRyYWZ0IHNwZWNpZmljYXRpb24gZGV2
ZWxvcGVkIHVuZGVyIHRoZSBKYXZhCisgKiBDb21tdW5pdHkgUHJvY2VzcyAoSkNQKSBhbmQgaXMg
bWFkZSBhdmFpbGFibGUgZm9yIHRlc3RpbmcgYW5kIGV2YWx1YXRpb24gcHVycG9zZXMKKyAqIG9u
bHkuIFRoZSBjb2RlIGlzIG5vdCBjb21wYXRpYmxlIHdpdGggYW55IHNwZWNpZmljYXRpb24gb2Yg
dGhlIEpDUC4KKyAqCisgKiBDb250cmlidXRvcnM6CisgKiAgICAgSUJNIENvcnBvcmF0aW9uIC0g
aW5pdGlhbCBBUEkgYW5kIGltcGxlbWVudGF0aW9uCisgKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8K
K3BhY2thZ2Ugb3JnLmVjbGlwc2UuamR0LmNvcmUudGVzdHMucmV3cml0ZS5kZXNjcmliaW5nOwor
CitpbXBvcnQgamF2YS51dGlsLkxpc3Q7CisKK2ltcG9ydCBqdW5pdC5mcmFtZXdvcmsuVGVzdDsK
KworaW1wb3J0IG9yZy5lY2xpcHNlLmpkdC5jb3JlLklDb21waWxhdGlvblVuaXQ7CitpbXBvcnQg
b3JnLmVjbGlwc2UuamR0LmNvcmUuSVBhY2thZ2VGcmFnbWVudDsKK2ltcG9ydCBvcmcuZWNsaXBz
ZS5qZHQuY29yZS5kb20uKjsKK2ltcG9ydCBvcmcuZWNsaXBzZS5qZHQuY29yZS5kb20ucmV3cml0
ZS5BU1RSZXdyaXRlOworCitwdWJsaWMgY2xhc3MgQVNUUmV3cml0aW5nTGFtYmRhRXhwcmVzc2lv
blRlc3QgZXh0ZW5kcyBBU1RSZXdyaXRpbmdUZXN0IHsKKworCXB1YmxpYyBBU1RSZXdyaXRpbmdM
YW1iZGFFeHByZXNzaW9uVGVzdChTdHJpbmcgbmFtZSkgeworCQlzdXBlcihuYW1lKTsKKwl9CisK
KwlwdWJsaWMgQVNUUmV3cml0aW5nTGFtYmRhRXhwcmVzc2lvblRlc3QoU3RyaW5nIG5hbWUsIGlu
dCBhcGlMZXZlbCkgeworCQlzdXBlcihuYW1lLCBhcGlMZXZlbCk7CisJfQorCisJcHVibGljIHN0
YXRpYyBUZXN0IHN1aXRlKCkgeworCQlyZXR1cm4gY3JlYXRlU3VpdGUoQVNUUmV3cml0aW5nTGFt
YmRhRXhwcmVzc2lvblRlc3QuY2xhc3MpOworCX0KKworCXB1YmxpYyB2b2lkIHRlc3RMYW1iZGFF
eHByZXNzaW9uc19zaW5jZV84KCkgdGhyb3dzIEV4Y2VwdGlvbiB7CisJCUlQYWNrYWdlRnJhZ21l
bnQgcGFjazE9IHRoaXMuc291cmNlRm9sZGVyLmNyZWF0ZVBhY2thZ2VGcmFnbWVudCgidGVzdDEi
LCBmYWxzZSwgbnVsbCk7CisJCVN0cmluZ0J1ZmZlciBidWY9IG5ldyBTdHJpbmdCdWZmZXIoKTsK
KwkJYnVmLmFwcGVuZCgicGFja2FnZSB0ZXN0MTtcbiIpOworCQlidWYuYXBwZW5kKCJpbnRlcmZh
Y2UgSSB7XG4iKTsKKwkJYnVmLmFwcGVuZCgiCWludCBmb28oaW50IHgpO1xuIik7CisJCWJ1Zi5h
cHBlbmQoIn1cbiIpOworCQlidWYuYXBwZW5kKCJpbnRlcmZhY2UgSiB7XG4iKTsKKwkJYnVmLmFw
cGVuZCgiCWludCBmb28oKTtcbiIpOworCQlidWYuYXBwZW5kKCJ9XG4iKTsKKwkJYnVmLmFwcGVu
ZCgicHVibGljIGNsYXNzIFgge1xuIik7CisJCWJ1Zi5hcHBlbmQoIiBJIGkgPSAgdmxhbWJkYSAt
PiB7cmV0dXJuIDIwMDt9O1xuIik7CisJCWJ1Zi5hcHBlbmQoIiBKIGogPSAgKCkgLT4gMTcyOTtc
biIpOworCQlidWYuYXBwZW5kKCJ9XG4iKTsKKwkJSUNvbXBpbGF0aW9uVW5pdCBjdT0gcGFjazEu
Y3JlYXRlQ29tcGlsYXRpb25Vbml0KCJYLmphdmEiLCBidWYudG9TdHJpbmcoKSwgZmFsc2UsIG51
bGwpOworCisJCUNvbXBpbGF0aW9uVW5pdCBhc3RSb290PSBjcmVhdGVBU1QoY3UpOworCQlBU1RS
ZXdyaXRlIHJld3JpdGU9IEFTVFJld3JpdGUuY3JlYXRlKGFzdFJvb3QuZ2V0QVNUKCkpOworCQlB
U1QgYXN0PSBhc3RSb290LmdldEFTVCgpOworCisJCVR5cGVEZWNsYXJhdGlvbiB0eXBlZGVjbGFy
YXRpb249IGZpbmRUeXBlRGVjbGFyYXRpb24oYXN0Um9vdCwgIkkiKTsKKworCQl7IC8vIGNoYW5n
ZSByZXR1cm4gdHlwZQorCQkJTWV0aG9kRGVjbGFyYXRpb24gbWV0aG9kRGVjbD0gZmluZE1ldGhv
ZERlY2xhcmF0aW9uKHR5cGVkZWNsYXJhdGlvbiwgImZvbyIpOworCQkJYXNzZXJ0VHJ1ZSgibnVs
bCByZXR1cm4gdHlwZTogZm9vIiwgbWV0aG9kRGVjbC5nZXRSZXR1cm5UeXBlMigpICE9IG51bGwp
OworCisJCQlUeXBlIHJldHVyblR5cGU9IG1ldGhvZERlY2wuZ2V0UmV0dXJuVHlwZTIoKTsKKwkJ
CVR5cGUgbmV3UmV0dXJuVHlwZT0gYXN0Um9vdC5nZXRBU1QoKS5uZXdQcmltaXRpdmVUeXBlKFBy
aW1pdGl2ZVR5cGUuRkxPQVQpOworCQkJcmV3cml0ZS5yZXBsYWNlKHJldHVyblR5cGUsIG5ld1Jl
dHVyblR5cGUsIG51bGwpOworCQl9CisJCXsgLy8gYWRkIGEgcGFyYW1ldGVyIHRvIHRoZSBzaW5n
bGV0b24gZnVuY3Rpb24gaW4gdGhlIGludGVyZmFjZS4KKwkJCU1ldGhvZERlY2xhcmF0aW9uIG1l
dGhvZERlY2w9IGZpbmRNZXRob2REZWNsYXJhdGlvbih0eXBlZGVjbGFyYXRpb24sICJmb28iKTsK
KwkJCUxpc3QgcGFyYW1ldGVycz0gbWV0aG9kRGVjbC5wYXJhbWV0ZXJzKCk7CisJCQlhc3NlcnRU
cnVlKCJtdXN0IGJlIDEgcGFyYW1ldGVyIiwgcGFyYW1ldGVycy5zaXplKCkgPT0gMSk7CisKKwkJ
CVNpbmdsZVZhcmlhYmxlRGVjbGFyYXRpb24gZGVjbD0gYXN0Lm5ld1NpbmdsZVZhcmlhYmxlRGVj
bGFyYXRpb24oKTsKKwkJCWRlY2wuc2V0VHlwZShhc3QubmV3UHJpbWl0aXZlVHlwZShQcmltaXRp
dmVUeXBlLklOVCkpOworCQkJZGVjbC5zZXROYW1lKGFzdC5uZXdTaW1wbGVOYW1lKCJ5IikpOwor
CQkJcmV3cml0ZS5nZXRMaXN0UmV3cml0ZShtZXRob2REZWNsLCBNZXRob2REZWNsYXJhdGlvbi5Q
QVJBTUVURVJTX1BST1BFUlRZKS5pbnNlcnRMYXN0KGRlY2wsIG51bGwpOworCQl9CisKKwkJeyAv
LyBpbnNlcnQgYSBwYXJhbWV0ZXIKKwkJCXR5cGVkZWNsYXJhdGlvbj0gZmluZFR5cGVEZWNsYXJh
dGlvbihhc3RSb290LCAiSiIpOworCQkJTWV0aG9kRGVjbGFyYXRpb24gbWV0aG9kRGVjbCA9IGZp
bmRNZXRob2REZWNsYXJhdGlvbih0eXBlZGVjbGFyYXRpb24sICJmb28iKTsKKwkJCUxpc3QgcGFy
YW1ldGVycyA9IG1ldGhvZERlY2wucGFyYW1ldGVycygpOworCQkJYXNzZXJ0VHJ1ZSgibXVzdCBi
ZSAwIHBhcmFtZXRlcnMiLCBwYXJhbWV0ZXJzLnNpemUoKSA9PSAwKTsKKworCQkJU2luZ2xlVmFy
aWFibGVEZWNsYXJhdGlvbiBuZXdQYXJhbT0gYXN0Lm5ld1NpbmdsZVZhcmlhYmxlRGVjbGFyYXRp
b24oKTsKKwkJCW5ld1BhcmFtLnNldE5hbWUoYXN0Lm5ld1NpbXBsZU5hbWUoIngiKSk7CisJCQlu
ZXdQYXJhbS5zZXRUeXBlKGFzdC5uZXdQcmltaXRpdmVUeXBlKFByaW1pdGl2ZVR5cGUuSU5UKSk7
CisJCQlyZXdyaXRlLmdldExpc3RSZXdyaXRlKG1ldGhvZERlY2wsIE1ldGhvZERlY2xhcmF0aW9u
LlBBUkFNRVRFUlNfUFJPUEVSVFkpLmluc2VydEZpcnN0KG5ld1BhcmFtLCBudWxsKTsKKwkJfQor
CisJCXR5cGVkZWNsYXJhdGlvbj0gZmluZFR5cGVEZWNsYXJhdGlvbihhc3RSb290LCAiWCIpOwor
CQlGaWVsZERlY2xhcmF0aW9uIGZpZWxkRGVjbGFyYXRpb24gPSAoRmllbGREZWNsYXJhdGlvbikg
dHlwZWRlY2xhcmF0aW9uLmJvZHlEZWNsYXJhdGlvbnMoKS5nZXQoMCk7CisJCVZhcmlhYmxlRGVj
bGFyYXRpb25GcmFnbWVudCBmcmFnbWVudCA9IChWYXJpYWJsZURlY2xhcmF0aW9uRnJhZ21lbnQp
ZmllbGREZWNsYXJhdGlvbi5mcmFnbWVudHMoKS5nZXQoMCk7CisJCUV4cHJlc3Npb24gZXhwcmVz
c2lvbiA9IGZyYWdtZW50LmdldEluaXRpYWxpemVyKCk7CisJCWFzc2VydFRydWUoZXhwcmVzc2lv
biBpbnN0YW5jZW9mIExhbWJkYUV4cHJlc3Npb24pOworCQlMYW1iZGFFeHByZXNzaW9uIGxhbWJk
YUV4cHJlc3Npb24gPSAoTGFtYmRhRXhwcmVzc2lvbilleHByZXNzaW9uOworCQkKKwkJey8vIGFk
ZCBhIHBhcmFtZXRlciB0byB0aGUgbGFtYmRhIGV4cHJlc3Npb24KKwkJCUxpc3QgcGFyYW1ldGVy
cz0gbGFtYmRhRXhwcmVzc2lvbi5wYXJhbWV0ZXJzKCk7CisJCQlhc3NlcnRUcnVlKCJtdXN0IGJl
IDEgcGFyYW1ldGVyIiwgcGFyYW1ldGVycy5zaXplKCkgPT0gMSk7CisJCQlBU1ROb2RlIGZpcnN0
UGFyYW09IChBU1ROb2RlKSBwYXJhbWV0ZXJzLmdldCgwKTsKKwkJCVZhcmlhYmxlRGVjbGFyYXRp
b25GcmFnbWVudCBuZXdQYXJhbT0gYXN0Lm5ld1ZhcmlhYmxlRGVjbGFyYXRpb25GcmFnbWVudCgp
OworCQkJbmV3UGFyYW0uc2V0TmFtZShhc3QubmV3U2ltcGxlTmFtZSgid2xhbWJkYSIpKTsKKwkJ
CXJld3JpdGUuZ2V0TGlzdFJld3JpdGUobGFtYmRhRXhwcmVzc2lvbiwgTGFtYmRhRXhwcmVzc2lv
bi5QQVJBTUVURVJTX1BST1BFUlRZKS5pbnNlcnRBZnRlcihuZXdQYXJhbSwgZmlyc3RQYXJhbSwg
bnVsbCk7CQkKKwkJfQorCQkKKwkJey8vIHJlcGxhY2UgdGhlIGJsb2NrIGJvZHkgd2l0aCBhIGZs
b2F0IGxpdGVyYWwgZXhwcmVzc2lvbiBib2R5LgorCQkJQVNUTm9kZSBib2R5ID0gbGFtYmRhRXhw
cmVzc2lvbi5nZXRCb2R5KCk7CisJCQlBU1ROb2RlIG5ld0JvZHkgPSBhc3QubmV3TnVtYmVyTGl0
ZXJhbCgiMy4xNCIpOworCQkJcmV3cml0ZS5yZXBsYWNlKGJvZHksIG5ld0JvZHksIG51bGwpOwor
CQl9CisKKwkJZmllbGREZWNsYXJhdGlvbiA9IChGaWVsZERlY2xhcmF0aW9uKSB0eXBlZGVjbGFy
YXRpb24uYm9keURlY2xhcmF0aW9ucygpLmdldCgxKTsKKwkJZnJhZ21lbnQgPSAoVmFyaWFibGVE
ZWNsYXJhdGlvbkZyYWdtZW50KWZpZWxkRGVjbGFyYXRpb24uZnJhZ21lbnRzKCkuZ2V0KDApOwor
CQlleHByZXNzaW9uID0gZnJhZ21lbnQuZ2V0SW5pdGlhbGl6ZXIoKTsKKwkJYXNzZXJ0VHJ1ZShl
eHByZXNzaW9uIGluc3RhbmNlb2YgTGFtYmRhRXhwcmVzc2lvbik7CisJCWxhbWJkYUV4cHJlc3Np
b24gPSAoTGFtYmRhRXhwcmVzc2lvbilleHByZXNzaW9uOworCQkKKwkJey8vIGFkZCBhIHBhcmFt
ZXRlciB0byB0aGUgbGFtYmRhIGV4cHJlc3Npb24gLSBib3JkZXIgY2FzZSAtIGVtcHR5IGxpc3Qg
aW5pdGlhbGx5CisJCQlMaXN0IHBhcmFtZXRlcnM9IGxhbWJkYUV4cHJlc3Npb24ucGFyYW1ldGVy
cygpOworCQkJYXNzZXJ0VHJ1ZSgibXVzdCBiZSAwIHBhcmFtZXRlciIsIHBhcmFtZXRlcnMuc2l6
ZSgpID09IDApOworCQkJVmFyaWFibGVEZWNsYXJhdGlvbkZyYWdtZW50IG5ld1BhcmFtPSBhc3Qu
bmV3VmFyaWFibGVEZWNsYXJhdGlvbkZyYWdtZW50KCk7CisJCQluZXdQYXJhbS5zZXROYW1lKGFz
dC5uZXdTaW1wbGVOYW1lKCJ2bGFtYmRhIikpOworCQkJcmV3cml0ZS5nZXRMaXN0UmV3cml0ZShs
YW1iZGFFeHByZXNzaW9uLCBMYW1iZGFFeHByZXNzaW9uLlBBUkFNRVRFUlNfUFJPUEVSVFkpLmlu
c2VydEZpcnN0KG5ld1BhcmFtLCBudWxsKTsJCQorCQl9CisJCVN0cmluZyBwcmV2aWV3PSBldmFs
dWF0ZVJld3JpdGUoY3UsIHJld3JpdGUpOworCisJCWJ1Zj0gbmV3IFN0cmluZ0J1ZmZlcigpOwor
CQlidWYuYXBwZW5kKCJwYWNrYWdlIHRlc3QxO1xuIik7CisJCWJ1Zi5hcHBlbmQoImludGVyZmFj
ZSBJIHtcbiIpOworCQlidWYuYXBwZW5kKCIJZmxvYXQgZm9vKGludCB4LCBpbnQgeSk7XG4iKTsK
KwkJYnVmLmFwcGVuZCgifVxuIik7CisJCWJ1Zi5hcHBlbmQoImludGVyZmFjZSBKIHtcbiIpOwor
CQlidWYuYXBwZW5kKCIJaW50IGZvbyhpbnQgeCk7XG4iKTsKKwkJYnVmLmFwcGVuZCgifVxuIik7
CisJCWJ1Zi5hcHBlbmQoInB1YmxpYyBjbGFzcyBYIHtcbiIpOworCQlidWYuYXBwZW5kKCIgSSBp
ID0gICh2bGFtYmRhLCB3bGFtYmRhKSAtPiAzLjE0O1xuIik7CisJCWJ1Zi5hcHBlbmQoIiBKIGog
PSAgKHZsYW1iZGEpIC0+IDE3Mjk7XG4iKTsKKwkJYnVmLmFwcGVuZCgifVxuIik7CisJCWFzc2Vy
dEVxdWFsU3RyaW5nKHByZXZpZXcsIGJ1Zi50b1N0cmluZygpKTsKKwl9CisJCisJcHVibGljIHZv
aWQgdGVzdExhbWJkYUV4cHJlc3Npb25zX1BhcmVudGhlc2VzX3NpbmNlXzgoKSB0aHJvd3MgRXhj
ZXB0aW9uIHsKKwkJSVBhY2thZ2VGcmFnbWVudCBwYWNrMT0gdGhpcy5zb3VyY2VGb2xkZXIuY3Jl
YXRlUGFja2FnZUZyYWdtZW50KCJ0ZXN0MSIsIGZhbHNlLCBudWxsKTsKKwkJU3RyaW5nQnVmZmVy
IGJ1Zj0gbmV3IFN0cmluZ0J1ZmZlcigpOworCQlidWYuYXBwZW5kKCJwYWNrYWdlIHRlc3QxO1xu
Iik7CisJCWJ1Zi5hcHBlbmQoImludGVyZmFjZSBJIHtcbiIpOworCQlidWYuYXBwZW5kKCIJaW50
IGZvbyhpbnQgeCk7XG4iKTsKKwkJYnVmLmFwcGVuZCgifVxuIik7CisJCWJ1Zi5hcHBlbmQoImlu
dGVyZmFjZSBKIHtcbiIpOworCQlidWYuYXBwZW5kKCIJaW50IGZvbygpO1xuIik7CisJCWJ1Zi5h
cHBlbmQoIn1cbiIpOworCQlidWYuYXBwZW5kKCJpbnRlcmZhY2UgSyB7XG4iKTsKKwkJYnVmLmFw
cGVuZCgiCWludCBmb28oaW50IHgsIGludCB5KTtcbiIpOworCQlidWYuYXBwZW5kKCJ9XG4iKTsK
KwkJYnVmLmFwcGVuZCgiaW50ZXJmYWNlIEwge1xuIik7CisJCWJ1Zi5hcHBlbmQoIglpbnQgZm9v
KGludCB4KTtcbiIpOworCQlidWYuYXBwZW5kKCJ9XG4iKTsKKwkJYnVmLmFwcGVuZCgicHVibGlj
IGNsYXNzIFgge1xuIik7CisJCWJ1Zi5hcHBlbmQoIiBJIGkgPSAgdmxhbWJkYSAtPiAyMjEyMTg4
NztcbiIpOworCQlidWYuYXBwZW5kKCIgSSBpZGFzaCA9ICAodmxhbWJkYSkgLT4gMTcyOTtcbiIp
OworCQlidWYuYXBwZW5kKCIgSiBqID0gICgpIC0+IDI2MDQxOTIwO1xuIik7CisJCWJ1Zi5hcHBl
bmQoIiBLIGsgPSAgKHgsIHkpIC0+IDE3Mjk7XG4iKTsKKwkJYnVmLmFwcGVuZCgiIEsga2Rhc2gg
PSAgKGludCB4LCBpbnQgeSkgLT4gMTcyOTtcbiIpOworCQlidWYuYXBwZW5kKCIgTCBsID0gIHZs
YW1iZGEgLT4gMTcyOTtcbiIpOworCQlidWYuYXBwZW5kKCJ9XG4iKTsKKwkJSUNvbXBpbGF0aW9u
VW5pdCBjdT0gcGFjazEuY3JlYXRlQ29tcGlsYXRpb25Vbml0KCJYLmphdmEiLCBidWYudG9TdHJp
bmcoKSwgZmFsc2UsIG51bGwpOworCisJCUNvbXBpbGF0aW9uVW5pdCBhc3RSb290PSBjcmVhdGVB
U1QoY3UpOworCQlBU1RSZXdyaXRlIHJld3JpdGU9IEFTVFJld3JpdGUuY3JlYXRlKGFzdFJvb3Qu
Z2V0QVNUKCkpOworCQlBU1QgYXN0PSBhc3RSb290LmdldEFTVCgpOworCisJCXsgLy8gcmVtb3Zl
IGEgcGFyYW1ldGVyCisJCQlUeXBlRGVjbGFyYXRpb24gdHlwZWRlY2xhcmF0aW9uPSBmaW5kVHlw
ZURlY2xhcmF0aW9uKGFzdFJvb3QsICJMIik7CisJCQlNZXRob2REZWNsYXJhdGlvbiBtZXRob2RE
ZWNsID0gZmluZE1ldGhvZERlY2xhcmF0aW9uKHR5cGVkZWNsYXJhdGlvbiwgImZvbyIpOworCQkJ
TGlzdCBwYXJhbWV0ZXJzID0gbWV0aG9kRGVjbC5wYXJhbWV0ZXJzKCk7CisJCQlhc3NlcnRUcnVl
KCJtdXN0IGJlIDEgcGFyYW1ldGVyIiwgcGFyYW1ldGVycy5zaXplKCkgPT0gMSk7CisJCQlBU1RO
b2RlIHBhcmFtID0gKEFTVE5vZGUpIHBhcmFtZXRlcnMuZ2V0KDApOworCQkJcmV3cml0ZS5nZXRM
aXN0UmV3cml0ZShtZXRob2REZWNsLCBNZXRob2REZWNsYXJhdGlvbi5QQVJBTUVURVJTX1BST1BF
UlRZKS5yZW1vdmUocGFyYW0sIG51bGwpOworCQl9CisKKwkJaW50IGZDb3VudCA9IDA7CisKKwkJ
VHlwZURlY2xhcmF0aW9uIHR5cGVkZWNsYXJhdGlvbj0gZmluZFR5cGVEZWNsYXJhdGlvbihhc3RS
b290LCAiWCIpOworCQlGaWVsZERlY2xhcmF0aW9uIGZpZWxkRGVjbGFyYXRpb24gPSAoRmllbGRE
ZWNsYXJhdGlvbikgdHlwZWRlY2xhcmF0aW9uLmJvZHlEZWNsYXJhdGlvbnMoKS5nZXQoZkNvdW50
KyspOworCQlWYXJpYWJsZURlY2xhcmF0aW9uRnJhZ21lbnQgZnJhZ21lbnQgPSAoVmFyaWFibGVE
ZWNsYXJhdGlvbkZyYWdtZW50KWZpZWxkRGVjbGFyYXRpb24uZnJhZ21lbnRzKCkuZ2V0KDApOwor
CQlMYW1iZGFFeHByZXNzaW9uIGxhbWJkYUV4cHJlc3Npb24gPSAoTGFtYmRhRXhwcmVzc2lvbilm
cmFnbWVudC5nZXRJbml0aWFsaXplcigpOworCQkKKwkJey8vIHNldCBwYXJlbnRoZXNlcworCQkJ
YXNzZXJ0VHJ1ZSgibGFtYmRhIGV4cHJlc3Npb24gaGFzIHBhcmFudGhlc2VzIiwgbGFtYmRhRXhw
cmVzc2lvbi5oYXNQYXJlbnRoZXNlcygpID09IGZhbHNlKTsKKwkJCXJld3JpdGUuc2V0KGxhbWJk
YUV4cHJlc3Npb24sIExhbWJkYUV4cHJlc3Npb24uUEFSRU5USEVTRVNfUFJPUEVSVFksIEJvb2xl
YW4uVFJVRSwgbnVsbCk7CisJCX0KKwkJCisJCWZpZWxkRGVjbGFyYXRpb24gPSAoRmllbGREZWNs
YXJhdGlvbikgdHlwZWRlY2xhcmF0aW9uLmJvZHlEZWNsYXJhdGlvbnMoKS5nZXQoZkNvdW50Kysp
OworCQlmcmFnbWVudCA9IChWYXJpYWJsZURlY2xhcmF0aW9uRnJhZ21lbnQpZmllbGREZWNsYXJh
dGlvbi5mcmFnbWVudHMoKS5nZXQoMCk7CisJCWxhbWJkYUV4cHJlc3Npb24gPSAoTGFtYmRhRXhw
cmVzc2lvbilmcmFnbWVudC5nZXRJbml0aWFsaXplcigpOworCQkKKwkJey8vIHJlc2V0IHBhcmVu
dGhlc2VzIC0gYSBsZWdhbCBvcGVyYXRpb24gaGVyZS4KKwkJCWFzc2VydFRydWUoImxhbWJkYSBl
eHByZXNzaW9uIGhhcyBwYXJhbnRoZXNlcyIsIGxhbWJkYUV4cHJlc3Npb24uaGFzUGFyZW50aGVz
ZXMoKSA9PSB0cnVlKTsKKwkJCXJld3JpdGUuc2V0KGxhbWJkYUV4cHJlc3Npb24sIExhbWJkYUV4
cHJlc3Npb24uUEFSRU5USEVTRVNfUFJPUEVSVFksIEJvb2xlYW4uRkFMU0UsIG51bGwpOworCQl9
CisJCQorCQlmaWVsZERlY2xhcmF0aW9uID0gKEZpZWxkRGVjbGFyYXRpb24pIHR5cGVkZWNsYXJh
dGlvbi5ib2R5RGVjbGFyYXRpb25zKCkuZ2V0KGZDb3VudCsrKTsKKwkJZnJhZ21lbnQgPSAoVmFy
aWFibGVEZWNsYXJhdGlvbkZyYWdtZW50KWZpZWxkRGVjbGFyYXRpb24uZnJhZ21lbnRzKCkuZ2V0
KDApOworCQlsYW1iZGFFeHByZXNzaW9uID0gKExhbWJkYUV4cHJlc3Npb24pZnJhZ21lbnQuZ2V0
SW5pdGlhbGl6ZXIoKTsKKworCQl7Ly8gcmVzZXQgcGFyZW50aGVzZXMgLSBhbiBpbGxlZ2FsIG9w
ZXJhdGlvbiBoZXJlLgorCQkJYXNzZXJ0VHJ1ZSgibGFtYmRhIGV4cHJlc3Npb24gZG9lcyBub3Qg
aGF2ZSBwYXJhbnRoZXNlcyIsIGxhbWJkYUV4cHJlc3Npb24uaGFzUGFyZW50aGVzZXMoKSA9PSB0
cnVlKTsKKwkJCXJld3JpdGUuc2V0KGxhbWJkYUV4cHJlc3Npb24sIExhbWJkYUV4cHJlc3Npb24u
UEFSRU5USEVTRVNfUFJPUEVSVFksIEJvb2xlYW4uRkFMU0UsIG51bGwpOworCQl9CisKKwkJZmll
bGREZWNsYXJhdGlvbiA9IChGaWVsZERlY2xhcmF0aW9uKSB0eXBlZGVjbGFyYXRpb24uYm9keURl
Y2xhcmF0aW9ucygpLmdldChmQ291bnQrKyk7CisJCWZyYWdtZW50ID0gKFZhcmlhYmxlRGVjbGFy
YXRpb25GcmFnbWVudClmaWVsZERlY2xhcmF0aW9uLmZyYWdtZW50cygpLmdldCgwKTsKKwkJbGFt
YmRhRXhwcmVzc2lvbiA9IChMYW1iZGFFeHByZXNzaW9uKWZyYWdtZW50LmdldEluaXRpYWxpemVy
KCk7CisKKwkJey8vIHJlc2V0IHBhcmVudGhlc2VzIC0gYW4gaWxsZWdhbCBvcGVyYXRpb24gaGVy
ZS4KKwkJCWFzc2VydFRydWUoImxhbWJkYSBleHByZXNzaW9uIGRvZXMgbm90IGhhdmUgcGFyYW50
aGVzZXMiLCBsYW1iZGFFeHByZXNzaW9uLmhhc1BhcmVudGhlc2VzKCkgPT0gdHJ1ZSk7CisJCQly
ZXdyaXRlLnNldChsYW1iZGFFeHByZXNzaW9uLCBMYW1iZGFFeHByZXNzaW9uLlBBUkVOVEhFU0VT
X1BST1BFUlRZLCBCb29sZWFuLkZBTFNFLCBudWxsKTsKKwkJfQorCQkKKwkJey8vIGNoYW5nZSBh
bGwgdGhlIHBhcmFtZXRlciB0byBTVkQgaWUgYWRkIHR5cGUgaW5mbyB0byB0aGUgcGFyYW1ldGVy
cy4KKwkJCUxpc3QgcGFyYW1ldGVycyA9IGxhbWJkYUV4cHJlc3Npb24ucGFyYW1ldGVycygpOwor
CQkJVmFyaWFibGVEZWNsYXJhdGlvbiBwYXJhbSA9IChWYXJpYWJsZURlY2xhcmF0aW9uKXBhcmFt
ZXRlcnMuZ2V0KDApOworCQkJU2luZ2xlVmFyaWFibGVEZWNsYXJhdGlvbiBuZXdQYXJhbT0gYXN0
Lm5ld1NpbmdsZVZhcmlhYmxlRGVjbGFyYXRpb24oKTsKKwkJCW5ld1BhcmFtLnNldE5hbWUoYXN0
Lm5ld1NpbXBsZU5hbWUobmV3IFN0cmluZyhwYXJhbS50b1N0cmluZygpKSkpOworCQkJbmV3UGFy
YW0uc2V0VHlwZShhc3QubmV3UHJpbWl0aXZlVHlwZShQcmltaXRpdmVUeXBlLklOVCkpOworCQkJ
cmV3cml0ZS5nZXRMaXN0UmV3cml0ZShsYW1iZGFFeHByZXNzaW9uLCBMYW1iZGFFeHByZXNzaW9u
LlBBUkFNRVRFUlNfUFJPUEVSVFkpLnJlcGxhY2UocGFyYW0sIG5ld1BhcmFtLCBudWxsKTsKKwkJ
CQorCQkJcGFyYW0gPSAoVmFyaWFibGVEZWNsYXJhdGlvbilwYXJhbWV0ZXJzLmdldCgxKTsKKwkJ
CW5ld1BhcmFtPSBhc3QubmV3U2luZ2xlVmFyaWFibGVEZWNsYXJhdGlvbigpOworCQkJbmV3UGFy
YW0uc2V0TmFtZShhc3QubmV3U2ltcGxlTmFtZShuZXcgU3RyaW5nKHBhcmFtLnRvU3RyaW5nKCkp
KSk7CisJCQluZXdQYXJhbS5zZXRUeXBlKGFzdC5uZXdQcmltaXRpdmVUeXBlKFByaW1pdGl2ZVR5
cGUuSU5UKSk7CisJCQlyZXdyaXRlLmdldExpc3RSZXdyaXRlKGxhbWJkYUV4cHJlc3Npb24sIExh
bWJkYUV4cHJlc3Npb24uUEFSQU1FVEVSU19QUk9QRVJUWSkucmVwbGFjZShwYXJhbSwgbmV3UGFy
YW0sIG51bGwpOworCQl9CisKKwkJey8vIFJlbW92ZSB0eXBlIGluZm8gZnJvbSB0aGUgcGFyYW1l
dGVycy4KKworCQkJZmllbGREZWNsYXJhdGlvbiA9IChGaWVsZERlY2xhcmF0aW9uKSB0eXBlZGVj
bGFyYXRpb24uYm9keURlY2xhcmF0aW9ucygpLmdldChmQ291bnQrKyk7CisJCQlmcmFnbWVudCA9
IChWYXJpYWJsZURlY2xhcmF0aW9uRnJhZ21lbnQpZmllbGREZWNsYXJhdGlvbi5mcmFnbWVudHMo
KS5nZXQoMCk7CisJCQlsYW1iZGFFeHByZXNzaW9uID0gKExhbWJkYUV4cHJlc3Npb24pZnJhZ21l
bnQuZ2V0SW5pdGlhbGl6ZXIoKTsKKwkJCUxpc3QgcGFyYW1ldGVycyA9IGxhbWJkYUV4cHJlc3Np
b24ucGFyYW1ldGVycygpOworCisJCQlmb3IgKGludCBpID0gMDsgaSA8IHBhcmFtZXRlcnMuc2l6
ZSgpOyArK2kpIHsKKwkJCQlTaW5nbGVWYXJpYWJsZURlY2xhcmF0aW9uIHBhcmFtID0gKFNpbmds
ZVZhcmlhYmxlRGVjbGFyYXRpb24pcGFyYW1ldGVycy5nZXQoaSk7CisJCQkJVmFyaWFibGVEZWNs
YXJhdGlvbkZyYWdtZW50IG5ld1BhcmFtPSBhc3QubmV3VmFyaWFibGVEZWNsYXJhdGlvbkZyYWdt
ZW50KCk7CisJCQkJbmV3UGFyYW0uc2V0TmFtZShhc3QubmV3U2ltcGxlTmFtZShuZXcgU3RyaW5n
KHBhcmFtLmdldE5hbWUoKS50b1N0cmluZygpKSkpOworCQkJCXJld3JpdGUuZ2V0TGlzdFJld3Jp
dGUobGFtYmRhRXhwcmVzc2lvbiwgTGFtYmRhRXhwcmVzc2lvbi5QQVJBTUVURVJTX1BST1BFUlRZ
KS5yZXBsYWNlKHBhcmFtLCBuZXdQYXJhbSwgbnVsbCk7CQkJCQorCQkJfQorCQl9CisKKwkJZmll
bGREZWNsYXJhdGlvbiA9IChGaWVsZERlY2xhcmF0aW9uKSB0eXBlZGVjbGFyYXRpb24uYm9keURl
Y2xhcmF0aW9ucygpLmdldChmQ291bnQrKyk7CisJCWZyYWdtZW50ID0gKFZhcmlhYmxlRGVjbGFy
YXRpb25GcmFnbWVudClmaWVsZERlY2xhcmF0aW9uLmZyYWdtZW50cygpLmdldCgwKTsKKwkJbGFt
YmRhRXhwcmVzc2lvbiA9IChMYW1iZGFFeHByZXNzaW9uKWZyYWdtZW50LmdldEluaXRpYWxpemVy
KCk7CisJCisJCXsvLyByZW1vdmUgdGhlIG9ubHkgcGFyYW1ldGVyIGFuZCB0aGUgcmV3cml0ZXIg
c2hvdWxkIGF1dG9tYXRpY2FsbHkgYWRkIHRoZSBwYXJlbnRoZXNlcworCQkJTGlzdCBwYXJhbWV0
ZXJzID0gbGFtYmRhRXhwcmVzc2lvbi5wYXJhbWV0ZXJzKCk7CisJCQlBU1ROb2RlIHBhcmFtID0g
KEFTVE5vZGUpcGFyYW1ldGVycy5nZXQoMCk7CisJCQlyZXdyaXRlLmdldExpc3RSZXdyaXRlKGxh
bWJkYUV4cHJlc3Npb24sIExhbWJkYUV4cHJlc3Npb24uUEFSQU1FVEVSU19QUk9QRVJUWSkucmVt
b3ZlKHBhcmFtLCAgbnVsbCk7CisJCX0KKworCQlTdHJpbmcgcHJldmlldz0gZXZhbHVhdGVSZXdy
aXRlKGN1LCByZXdyaXRlKTsKKworCQlidWY9IG5ldyBTdHJpbmdCdWZmZXIoKTsKKwkJYnVmLmFw
cGVuZCgicGFja2FnZSB0ZXN0MTtcbiIpOworCQlidWYuYXBwZW5kKCJpbnRlcmZhY2UgSSB7XG4i
KTsKKwkJYnVmLmFwcGVuZCgiCWludCBmb28oaW50IHgpO1xuIik7CisJCWJ1Zi5hcHBlbmQoIn1c
biIpOworCQlidWYuYXBwZW5kKCJpbnRlcmZhY2UgSiB7XG4iKTsKKwkJYnVmLmFwcGVuZCgiCWlu
dCBmb28oKTtcbiIpOworCQlidWYuYXBwZW5kKCJ9XG4iKTsKKwkJYnVmLmFwcGVuZCgiaW50ZXJm
YWNlIEsge1xuIik7CisJCWJ1Zi5hcHBlbmQoIglpbnQgZm9vKGludCB4LCBpbnQgeSk7XG4iKTsK
KwkJYnVmLmFwcGVuZCgifVxuIik7CisJCWJ1Zi5hcHBlbmQoImludGVyZmFjZSBMIHtcbiIpOwor
CQlidWYuYXBwZW5kKCIJaW50IGZvbygpO1xuIik7CisJCWJ1Zi5hcHBlbmQoIn1cbiIpOworCQli
dWYuYXBwZW5kKCJwdWJsaWMgY2xhc3MgWCB7XG4iKTsKKwkJYnVmLmFwcGVuZCgiIEkgaSA9ICAo
dmxhbWJkYSkgLT4gMjIxMjE4ODc7XG4iKTsKKwkJYnVmLmFwcGVuZCgiIEkgaWRhc2ggPSAgdmxh
bWJkYSAtPiAxNzI5O1xuIik7CisJCWJ1Zi5hcHBlbmQoIiBKIGogPSAgKCkgLT4gMjYwNDE5MjA7
XG4iKTsKKwkJYnVmLmFwcGVuZCgiIEsgayA9ICAoaW50IHgsIGludCB5KSAtPiAxNzI5O1xuIik7
CisJCWJ1Zi5hcHBlbmQoIiBLIGtkYXNoID0gICh4LCB5KSAtPiAxNzI5O1xuIik7CisJCWJ1Zi5h
cHBlbmQoIiBMIGwgPSAgKCkgLT4gMTcyOTtcbiIpOworCQlidWYuYXBwZW5kKCJ9XG4iKTsKKwkJ
YXNzZXJ0RXF1YWxTdHJpbmcocHJldmlldywgYnVmLnRvU3RyaW5nKCkpOworCX0KK30KXCBObyBu
ZXdsaW5lIGF0IGVuZCBvZiBmaWxlCmRpZmYgLS1naXQgYS9vcmcuZWNsaXBzZS5qZHQuY29yZS50
ZXN0cy5tb2RlbC9zcmMvb3JnL2VjbGlwc2UvamR0L2NvcmUvdGVzdHMvcmV3cml0ZS9kZXNjcmli
aW5nL0FTVFJld3JpdGluZ1Rlc3QuamF2YSBiL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1v
ZGVsL3NyYy9vcmcvZWNsaXBzZS9qZHQvY29yZS90ZXN0cy9yZXdyaXRlL2Rlc2NyaWJpbmcvQVNU
UmV3cml0aW5nVGVzdC5qYXZhCmluZGV4IDUxNzliYWYuLjlmMzVjZWIgMTAwNjQ0Ci0tLSBhL29y
Zy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3NyYy9vcmcvZWNsaXBzZS9qZHQvY29yZS90
ZXN0cy9yZXdyaXRlL2Rlc2NyaWJpbmcvQVNUUmV3cml0aW5nVGVzdC5qYXZhCisrKyBiL29yZy5l
Y2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3NyYy9vcmcvZWNsaXBzZS9qZHQvY29yZS90ZXN0
cy9yZXdyaXRlL2Rlc2NyaWJpbmcvQVNUUmV3cml0aW5nVGVzdC5qYXZhCkBAIC0xMTMsNyArMTEz
LDcgQEAKIAkJc3VpdGUuYWRkVGVzdChBU1RSZXdyaXRpbmdXaXRoU3RhdGVtZW50c1JlY292ZXJ5
VGVzdC5zdWl0ZSgpKTsKIAkJc3VpdGUuYWRkVGVzdChBU1RSZXdyaXRlUHJvcGVydHlUZXN0LnN1
aXRlKCkpOwogCQlzdWl0ZS5hZGRUZXN0KEFTVFJld3JpdGluZ1BhY2thZ2VEZWNsVGVzdC5zdWl0
ZSgpKTsKLQkJCisJCXN1aXRlLmFkZFRlc3QoQVNUUmV3cml0aW5nTGFtYmRhRXhwcmVzc2lvblRl
c3Quc3VpdGUoKSk7CQkKIAkJc3VpdGUuYWRkVGVzdChTb3VyY2VNb2RpZmllclRlc3Quc3VpdGUo
KSk7CiAJCXN1aXRlLmFkZFRlc3QoSW1wb3J0UmV3cml0ZVRlc3Quc3VpdGUoKSk7CiAJCXJldHVy
biBzdWl0ZTsKZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlL2RvbS9vcmcvZWNsaXBz
ZS9qZHQvaW50ZXJuYWwvY29yZS9kb20vcmV3cml0ZS9BU1RSZXdyaXRlQW5hbHl6ZXIuamF2YSBi
L29yZy5lY2xpcHNlLmpkdC5jb3JlL2RvbS9vcmcvZWNsaXBzZS9qZHQvaW50ZXJuYWwvY29yZS9k
b20vcmV3cml0ZS9BU1RSZXdyaXRlQW5hbHl6ZXIuamF2YQppbmRleCA1NTM3MWE3Li41M2FiZjky
IDEwMDY0NAotLS0gYS9vcmcuZWNsaXBzZS5qZHQuY29yZS9kb20vb3JnL2VjbGlwc2UvamR0L2lu
dGVybmFsL2NvcmUvZG9tL3Jld3JpdGUvQVNUUmV3cml0ZUFuYWx5emVyLmphdmEKKysrIGIvb3Jn
LmVjbGlwc2UuamR0LmNvcmUvZG9tL29yZy9lY2xpcHNlL2pkdC9pbnRlcm5hbC9jb3JlL2RvbS9y
ZXdyaXRlL0FTVFJld3JpdGVBbmFseXplci5qYXZhCkBAIC0yODEzLDYgKzI4MTMsODcgQEAKIAl9
CiAKIAkvKiAobm9uLUphdmFkb2MpCisJICogQHNlZSBvcmcuZWNsaXBzZS5qZHQuY29yZS5kb20u
QVNUVmlzaXRvciN2aXNpdChMYW1iZGFFeHByZXNzaW9uKQorCSAqLworCXB1YmxpYyBib29sZWFu
IHZpc2l0KExhbWJkYUV4cHJlc3Npb24gbm9kZSkgeworCQlpZiAoIWhhc0NoaWxkcmVuQ2hhbmdl
cyhub2RlKSkgeworCQkJcmV0dXJuIGRvVmlzaXRVbmNoYW5nZWRDaGlsZHJlbihub2RlKTsKKwkJ
fQorCQlib29sZWFuIGhhc1BhcmVudGhlc2VzID0gZ2V0TmV3VmFsdWUobm9kZSwgTGFtYmRhRXhw
cmVzc2lvbi5QQVJFTlRIRVNFU19QUk9QRVJUWSkuZXF1YWxzKEJvb2xlYW4uVFJVRSk7CisJCWJv
b2xlYW4gb2xkSGFzUGFyZW50aGVzZXMgPSBoYXNQYXJlbnRoZXNlczsKKwkJUmV3cml0ZUV2ZW50
IHBhcmFtc0V2ZW50ID0gbnVsbDsKKwkJLy8gUGFyZW50aGVzZXMgY2FuIGJlIGFic2VudCBpZiBh
bmQgb25seSBpZiB0aGVyZSBpcyBvbmUgYW5kIG9ubHkgb25lIHR5cGUgZWxpZGVkIHBhcmFtZXRl
ci4KKwkJaWYgKCFoYXNQYXJlbnRoZXNlcykgeworCQkJTGlzdCBwYXJhbWV0ZXJzID0gKExpc3Qp
Z2V0TmV3VmFsdWUobm9kZSwgTGFtYmRhRXhwcmVzc2lvbi5QQVJBTUVURVJTX1BST1BFUlRZKTsK
KwkJCVZhcmlhYmxlRGVjbGFyYXRpb24gdmFyRGVjbCA9IHBhcmFtZXRlcnMuc2l6ZSgpID09IDEg
PyAoVmFyaWFibGVEZWNsYXJhdGlvbikgcGFyYW1ldGVycy5nZXQoMCkgOiBudWxsOworCQkJaGFz
UGFyZW50aGVzZXMgPSB2YXJEZWNsIGluc3RhbmNlb2YgVmFyaWFibGVEZWNsYXJhdGlvbkZyYWdt
ZW50ID8gaGFzUGFyZW50aGVzZXMgOiB0cnVlOworCQkJaWYgKGhhc1BhcmVudGhlc2VzKSB7CisJ
CQkJcGFyYW1zRXZlbnQgPSBnZXRFdmVudChub2RlLCBMYW1iZGFFeHByZXNzaW9uLlBBUkFNRVRF
UlNfUFJPUEVSVFkpOworCQkJfQorCQl9CisKKwkJaW50IHBvcyA9IG5vZGUuZ2V0U3RhcnRQb3Np
dGlvbigpOworCQlSZXdyaXRlRXZlbnQgZXZlbnQgPSBnZXRFdmVudChub2RlLCBMYW1iZGFFeHBy
ZXNzaW9uLlBBUkVOVEhFU0VTX1BST1BFUlRZKTsKKwkJYm9vbGVhbiBkZWxldGVQYXJlbnRoZXNl
cyA9IGZhbHNlOworCQlib29sZWFuIGluc2VydFBhcmVudGhlc2VzID0gZmFsc2U7CisJCVRleHRF
ZGl0R3JvdXAgZWRpdEdyb3VwID0gbnVsbDsKKworCQlpZiAoZXZlbnQgIT0gbnVsbCkgeworCQkJ
ZWRpdEdyb3VwPSBnZXRFZGl0R3JvdXAoZXZlbnQpOworCQkJaW50IGNoYW5nZUtpbmQgPSBldmVu
dC5nZXRDaGFuZ2VLaW5kKCk7CisJCQlpZiAoY2hhbmdlS2luZCA9PSBSZXdyaXRlRXZlbnQuUkVQ
TEFDRUQpIHsKKwkJCQlpZiAoZXZlbnQuZ2V0TmV3VmFsdWUoKS5lcXVhbHMoQm9vbGVhbi5UUlVF
KSkgeworCQkJCQlpbnNlcnRQYXJlbnRoZXNlcyA9IHRydWU7CisJCQkJCW9sZEhhc1BhcmVudGhl
c2VzID0gZmFsc2U7CQkJCQkKKwkJCQl9IGVsc2UgeworCQkJCQlkZWxldGVQYXJlbnRoZXNlcyA9
IGhhc1BhcmVudGhlc2VzID8gZmFsc2UgOiB0cnVlOworCQkJCQlvbGRIYXNQYXJlbnRoZXNlcyA9
IHRydWU7CQkKKwkJCQl9CisJCQl9CisJCX0gZWxzZSBpZiAob2xkSGFzUGFyZW50aGVzZXMgPT0g
ZmFsc2UgJiYgcGFyYW1zRXZlbnQgIT0gbnVsbCkgeworCQkJZWRpdEdyb3VwID0gZ2V0RWRpdEdy
b3VwKHBhcmFtc0V2ZW50KTsKKwkJCWluc2VydFBhcmVudGhlc2VzID0gdHJ1ZTsKKwkJfQorCQkK
KwkJaWYgKGluc2VydFBhcmVudGhlc2VzKSB7CisJCQlkb1RleHRJbnNlcnQocG9zLCAiKCIsIGVk
aXRHcm91cCk7IC8vJE5PTi1OTFMtMSQKKwkJfSBlbHNlIGlmIChkZWxldGVQYXJlbnRoZXNlcykg
eworCQkJdHJ5IHsKKwkJCQlpbnQgbHBhcmVuc0VuZCA9IGdldFNjYW5uZXIoKS5nZXRUb2tlbkVu
ZE9mZnNldChUZXJtaW5hbFRva2Vucy5Ub2tlbk5hbWVMUEFSRU4sIHBvcyk7CisJCQkJZG9UZXh0
UmVtb3ZlKHBvcywgbHBhcmVuc0VuZCAtIHBvcywgZWRpdEdyb3VwKTsKKwkJCQlwb3MgPSBscGFy
ZW5zRW5kOworCQkJfSBjYXRjaCAoQ29yZUV4Y2VwdGlvbiBlKSB7CisJCQkJaGFuZGxlRXhjZXB0
aW9uKGUpOworCQkJfQorCQl9CisKKwkJaWYgKGlzQ2hhbmdlZChub2RlLCBMYW1iZGFFeHByZXNz
aW9uLlBBUkFNRVRFUlNfUFJPUEVSVFkpKSB7CisJCQl0cnkgeworCQkJCXBvcyA9IG9sZEhhc1Bh
cmVudGhlc2VzID8gZ2V0U2Nhbm5lcigpLmdldFRva2VuRW5kT2Zmc2V0KFRlcm1pbmFsVG9rZW5z
LlRva2VuTmFtZUxQQVJFTiwgcG9zKSA6IHBvczsKKwkJCQlwb3MgPSByZXdyaXRlTm9kZUxpc3Qo
bm9kZSwgTGFtYmRhRXhwcmVzc2lvbi5QQVJBTUVURVJTX1BST1BFUlRZLCBwb3MsIFV0aWwuRU1Q
VFlfU1RSSU5HLCAiLCAiKTsgLy8kTk9OLU5MUy0xJCAKKwkJCX0gY2F0Y2ggKENvcmVFeGNlcHRp
b24gZSkgeworCQkJCWhhbmRsZUV4Y2VwdGlvbihlKTsKKwkJCX0KKwkJfSBlbHNlIHsKKwkJCXBv
cyA9IGRvVmlzaXQobm9kZSwgTGFtYmRhRXhwcmVzc2lvbi5QQVJBTUVURVJTX1BST1BFUlRZLCBw
b3MpOworCQl9CisKKwkJaWYgKGluc2VydFBhcmVudGhlc2VzKSB7CisJCQlkb1RleHRJbnNlcnQo
cG9zLCAiKSIsIGVkaXRHcm91cCk7IC8vJE5PTi1OTFMtMSQKKwkJfSBlbHNlIGlmIChkZWxldGVQ
YXJlbnRoZXNlcykgeworCQkJdHJ5IHsKKwkJCQlpbnQgcnBhcmVuc0VuZCA9IGdldFNjYW5uZXIo
KS5nZXRUb2tlbkVuZE9mZnNldChUZXJtaW5hbFRva2Vucy5Ub2tlbk5hbWVSUEFSRU4sIHBvcyk7
CisJCQkJZG9UZXh0UmVtb3ZlKHBvcywgcnBhcmVuc0VuZCAtIHBvcywgZWRpdEdyb3VwKTsJCQkJ
CisJCQl9IGNhdGNoIChDb3JlRXhjZXB0aW9uIGUpIHsKKwkJCQloYW5kbGVFeGNlcHRpb24oZSk7
CisJCQl9CisJCX0KKwkJcmV3cml0ZVJlcXVpcmVkTm9kZShub2RlLCBMYW1iZGFFeHByZXNzaW9u
LkJPRFlfUFJPUEVSVFkpOworCisJCXJldHVybiBmYWxzZTsKKwl9CisKKwkvKiAobm9uLUphdmFk
b2MpCiAJICogQHNlZSBvcmcuZWNsaXBzZS5qZHQuY29yZS5kb20uQVNUVmlzaXRvciN2aXNpdChN
ZXRob2RJbnZvY2F0aW9uKQogCSAqLwogCXB1YmxpYyBib29sZWFuIHZpc2l0KE1ldGhvZEludm9j
YXRpb24gbm9kZSkgewpkaWZmIC0tZ2l0IGEvb3JnLmVjbGlwc2UuamR0LmNvcmUvZG9tL29yZy9l
Y2xpcHNlL2pkdC9pbnRlcm5hbC9jb3JlL2RvbS9yZXdyaXRlL0FTVFJld3JpdGVGbGF0dGVuZXIu
amF2YSBiL29yZy5lY2xpcHNlLmpkdC5jb3JlL2RvbS9vcmcvZWNsaXBzZS9qZHQvaW50ZXJuYWwv
Y29yZS9kb20vcmV3cml0ZS9BU1RSZXdyaXRlRmxhdHRlbmVyLmphdmEKaW5kZXggNTY0YTkzNi4u
MjUzNzg5MCAxMDA2NDQKLS0tIGEvb3JnLmVjbGlwc2UuamR0LmNvcmUvZG9tL29yZy9lY2xpcHNl
L2pkdC9pbnRlcm5hbC9jb3JlL2RvbS9yZXdyaXRlL0FTVFJld3JpdGVGbGF0dGVuZXIuamF2YQor
KysgYi9vcmcuZWNsaXBzZS5qZHQuY29yZS9kb20vb3JnL2VjbGlwc2UvamR0L2ludGVybmFsL2Nv
cmUvZG9tL3Jld3JpdGUvQVNUUmV3cml0ZUZsYXR0ZW5lci5qYXZhCkBAIC02NTAsNiArNjUwLDI2
IEBACiAJCXRoaXMucmVzdWx0LmFwcGVuZCgiW10iKTsgLy8kTk9OLU5MUy0xJAogCQlyZXR1cm4g
ZmFsc2U7CiAJfQorCisJLyoKKwkgKiBAc2VlIEFTVFZpc2l0b3IjdmlzaXQoTGFtYmRhRXhwcmVz
c2lvbikKKwkgKi8KKwlwdWJsaWMgYm9vbGVhbiB2aXNpdChMYW1iZGFFeHByZXNzaW9uIG5vZGUp
IHsKKwkJYm9vbGVhbiBoYXNQYXJlbnRoZXNlcyA9IGdldEJvb2xlYW5BdHRyaWJ1dGUobm9kZSwg
TGFtYmRhRXhwcmVzc2lvbi5QQVJFTlRIRVNFU19QUk9QRVJUWSk7CisJCUxpc3QgcGFyYW1ldGVy
cyA9IGdldENoaWxkTGlzdChub2RlLCBMYW1iZGFFeHByZXNzaW9uLlBBUkFNRVRFUlNfUFJPUEVS
VFkpOworCQlWYXJpYWJsZURlY2xhcmF0aW9uIHZhckRlY2wgPSBwYXJhbWV0ZXJzLnNpemUoKSA9
PSAxID8gKFZhcmlhYmxlRGVjbGFyYXRpb24pIHBhcmFtZXRlcnMuZ2V0KDApIDogbnVsbDsKKwkJ
aGFzUGFyZW50aGVzZXMgPSB2YXJEZWNsIGluc3RhbmNlb2YgVmFyaWFibGVEZWNsYXJhdGlvbkZy
YWdtZW50ID8gaGFzUGFyZW50aGVzZXMgOiB0cnVlOworCisJCWlmIChoYXNQYXJlbnRoZXNlcykK
KwkJCXRoaXMucmVzdWx0LmFwcGVuZCgnKCcpOworCQl2aXNpdExpc3Qobm9kZSwgTGFtYmRhRXhw
cmVzc2lvbi5QQVJBTUVURVJTX1BST1BFUlRZLCBTdHJpbmcudmFsdWVPZignLCcpKTsKKwkJaWYg
KGhhc1BhcmVudGhlc2VzKQorCQkJdGhpcy5yZXN1bHQuYXBwZW5kKCcpJyk7CisJCXRoaXMucmVz
dWx0LmFwcGVuZCgiLT4iKTsgLy8kTk9OLU5MUy0xJAorCQlnZXRDaGlsZE5vZGUobm9kZSwgTGFt
YmRhRXhwcmVzc2lvbi5CT0RZX1BST1BFUlRZKS5hY2NlcHQodGhpcyk7CisJCXJldHVybiBmYWxz
ZTsKKwl9CisKIAkvKgogCSAqIEBzZWUgQVNUVmlzaXRvciN2aXNpdChNZXRob2REZWNsYXJhdGlv
bikKIAkgKi8=
</data>

          </attachment>
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>228804</attachid>
            <date>2013-03-20 23:14:00 -0400</date>
            <delta_ts>2013-03-26 05:57:42 -0400</delta_ts>
            <desc>Proposed Patch</desc>
            <filename>Fix-for-Bug-402231--18ast-rewrite-Rewrite-support-fo.patch</filename>
            <type>text/plain</type>
            <size>19317</size>
            <attacher name="Manoj Palat Away Until May 11 2015">manpalat</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3NyYy9vcmcvZWNs
aXBzZS9qZHQvY29yZS90ZXN0cy9yZXdyaXRlL2Rlc2NyaWJpbmcvQVNUUmV3cml0aW5nTGFtYmRh
RXhwcmVzc2lvblRlc3QuamF2YSBiL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3Ny
Yy9vcmcvZWNsaXBzZS9qZHQvY29yZS90ZXN0cy9yZXdyaXRlL2Rlc2NyaWJpbmcvQVNUUmV3cml0
aW5nTGFtYmRhRXhwcmVzc2lvblRlc3QuamF2YQpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAw
MDAwMDAwLi5lMGFjNDZiCi0tLSAvZGV2L251bGwKKysrIGIvb3JnLmVjbGlwc2UuamR0LmNvcmUu
dGVzdHMubW9kZWwvc3JjL29yZy9lY2xpcHNlL2pkdC9jb3JlL3Rlc3RzL3Jld3JpdGUvZGVzY3Jp
YmluZy9BU1RSZXdyaXRpbmdMYW1iZGFFeHByZXNzaW9uVGVzdC5qYXZhCkBAIC0wLDAgKzEsMjg5
IEBACisvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKgorICogQ29weXJpZ2h0IChjKSAyMDEzIElCTSBD
b3Jwb3JhdGlvbiBhbmQgb3RoZXJzLgorICogQWxsIHJpZ2h0cyByZXNlcnZlZC4gVGhpcyBwcm9n
cmFtIGFuZCB0aGUgYWNjb21wYW55aW5nIG1hdGVyaWFscworICogYXJlIG1hZGUgYXZhaWxhYmxl
IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgRWNsaXBzZSBQdWJsaWMgTGljZW5zZSB2MS4wCisgKiB3
aGljaCBhY2NvbXBhbmllcyB0aGlzIGRpc3RyaWJ1dGlvbiwgYW5kIGlzIGF2YWlsYWJsZSBhdAor
ICogaHR0cDovL3d3dy5lY2xpcHNlLm9yZy9sZWdhbC9lcGwtdjEwLmh0bWwKKyAqCisgKiBUaGlz
IGlzIGFuIGltcGxlbWVudGF0aW9uIG9mIGFuIGVhcmx5LWRyYWZ0IHNwZWNpZmljYXRpb24gZGV2
ZWxvcGVkIHVuZGVyIHRoZSBKYXZhCisgKiBDb21tdW5pdHkgUHJvY2VzcyAoSkNQKSBhbmQgaXMg
bWFkZSBhdmFpbGFibGUgZm9yIHRlc3RpbmcgYW5kIGV2YWx1YXRpb24gcHVycG9zZXMKKyAqIG9u
bHkuIFRoZSBjb2RlIGlzIG5vdCBjb21wYXRpYmxlIHdpdGggYW55IHNwZWNpZmljYXRpb24gb2Yg
dGhlIEpDUC4KKyAqCisgKiBDb250cmlidXRvcnM6CisgKiAgICAgSUJNIENvcnBvcmF0aW9uIC0g
aW5pdGlhbCBBUEkgYW5kIGltcGxlbWVudGF0aW9uCisgKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8K
K3BhY2thZ2Ugb3JnLmVjbGlwc2UuamR0LmNvcmUudGVzdHMucmV3cml0ZS5kZXNjcmliaW5nOwor
CitpbXBvcnQgamF2YS51dGlsLkxpc3Q7CisKK2ltcG9ydCBqdW5pdC5mcmFtZXdvcmsuVGVzdDsK
KworaW1wb3J0IG9yZy5lY2xpcHNlLmpkdC5jb3JlLklDb21waWxhdGlvblVuaXQ7CitpbXBvcnQg
b3JnLmVjbGlwc2UuamR0LmNvcmUuSVBhY2thZ2VGcmFnbWVudDsKK2ltcG9ydCBvcmcuZWNsaXBz
ZS5qZHQuY29yZS5kb20uKjsKK2ltcG9ydCBvcmcuZWNsaXBzZS5qZHQuY29yZS5kb20ucmV3cml0
ZS5BU1RSZXdyaXRlOworCitwdWJsaWMgY2xhc3MgQVNUUmV3cml0aW5nTGFtYmRhRXhwcmVzc2lv
blRlc3QgZXh0ZW5kcyBBU1RSZXdyaXRpbmdUZXN0IHsKKworCXB1YmxpYyBBU1RSZXdyaXRpbmdM
YW1iZGFFeHByZXNzaW9uVGVzdChTdHJpbmcgbmFtZSkgeworCQlzdXBlcihuYW1lKTsKKwl9CisK
KwlwdWJsaWMgQVNUUmV3cml0aW5nTGFtYmRhRXhwcmVzc2lvblRlc3QoU3RyaW5nIG5hbWUsIGlu
dCBhcGlMZXZlbCkgeworCQlzdXBlcihuYW1lLCBhcGlMZXZlbCk7CisJfQorCisJcHVibGljIHN0
YXRpYyBUZXN0IHN1aXRlKCkgeworCQlyZXR1cm4gY3JlYXRlU3VpdGUoQVNUUmV3cml0aW5nTGFt
YmRhRXhwcmVzc2lvblRlc3QuY2xhc3MpOworCX0KKworCXB1YmxpYyB2b2lkIHRlc3RMYW1iZGFF
eHByZXNzaW9uc19zaW5jZV84KCkgdGhyb3dzIEV4Y2VwdGlvbiB7CisJCUlQYWNrYWdlRnJhZ21l
bnQgcGFjazE9IHRoaXMuc291cmNlRm9sZGVyLmNyZWF0ZVBhY2thZ2VGcmFnbWVudCgidGVzdDEi
LCBmYWxzZSwgbnVsbCk7CisJCVN0cmluZ0J1ZmZlciBidWY9IG5ldyBTdHJpbmdCdWZmZXIoKTsK
KwkJYnVmLmFwcGVuZCgicGFja2FnZSB0ZXN0MTtcbiIpOworCQlidWYuYXBwZW5kKCJpbnRlcmZh
Y2UgSSB7XG4iKTsKKwkJYnVmLmFwcGVuZCgiCWludCBmb28oaW50IHgpO1xuIik7CisJCWJ1Zi5h
cHBlbmQoIn1cbiIpOworCQlidWYuYXBwZW5kKCJpbnRlcmZhY2UgSiB7XG4iKTsKKwkJYnVmLmFw
cGVuZCgiCWludCBmb28oKTtcbiIpOworCQlidWYuYXBwZW5kKCJ9XG4iKTsKKwkJYnVmLmFwcGVu
ZCgicHVibGljIGNsYXNzIFgge1xuIik7CisJCWJ1Zi5hcHBlbmQoIiBJIGkgPSAgdmxhbWJkYSAt
PiB7cmV0dXJuIDIwMDt9O1xuIik7CisJCWJ1Zi5hcHBlbmQoIiBKIGogPSAgKCkgLT4gMTcyOTtc
biIpOworCQlidWYuYXBwZW5kKCJ9XG4iKTsKKwkJSUNvbXBpbGF0aW9uVW5pdCBjdT0gcGFjazEu
Y3JlYXRlQ29tcGlsYXRpb25Vbml0KCJYLmphdmEiLCBidWYudG9TdHJpbmcoKSwgZmFsc2UsIG51
bGwpOworCisJCUNvbXBpbGF0aW9uVW5pdCBhc3RSb290PSBjcmVhdGVBU1QoY3UpOworCQlBU1RS
ZXdyaXRlIHJld3JpdGU9IEFTVFJld3JpdGUuY3JlYXRlKGFzdFJvb3QuZ2V0QVNUKCkpOworCQlB
U1QgYXN0PSBhc3RSb290LmdldEFTVCgpOworCisJCVR5cGVEZWNsYXJhdGlvbiB0eXBlZGVjbGFy
YXRpb249IGZpbmRUeXBlRGVjbGFyYXRpb24oYXN0Um9vdCwgIkkiKTsKKworCQl7IC8vIGNoYW5n
ZSByZXR1cm4gdHlwZQorCQkJTWV0aG9kRGVjbGFyYXRpb24gbWV0aG9kRGVjbD0gZmluZE1ldGhv
ZERlY2xhcmF0aW9uKHR5cGVkZWNsYXJhdGlvbiwgImZvbyIpOworCQkJYXNzZXJ0VHJ1ZSgibnVs
bCByZXR1cm4gdHlwZTogZm9vIiwgbWV0aG9kRGVjbC5nZXRSZXR1cm5UeXBlMigpICE9IG51bGwp
OworCisJCQlUeXBlIHJldHVyblR5cGU9IG1ldGhvZERlY2wuZ2V0UmV0dXJuVHlwZTIoKTsKKwkJ
CVR5cGUgbmV3UmV0dXJuVHlwZT0gYXN0Um9vdC5nZXRBU1QoKS5uZXdQcmltaXRpdmVUeXBlKFBy
aW1pdGl2ZVR5cGUuRkxPQVQpOworCQkJcmV3cml0ZS5yZXBsYWNlKHJldHVyblR5cGUsIG5ld1Jl
dHVyblR5cGUsIG51bGwpOworCQl9CisJCXsgLy8gYWRkIGEgcGFyYW1ldGVyIHRvIHRoZSBzaW5n
bGV0b24gZnVuY3Rpb24gaW4gdGhlIGludGVyZmFjZS4KKwkJCU1ldGhvZERlY2xhcmF0aW9uIG1l
dGhvZERlY2w9IGZpbmRNZXRob2REZWNsYXJhdGlvbih0eXBlZGVjbGFyYXRpb24sICJmb28iKTsK
KwkJCUxpc3QgcGFyYW1ldGVycz0gbWV0aG9kRGVjbC5wYXJhbWV0ZXJzKCk7CisJCQlhc3NlcnRU
cnVlKCJtdXN0IGJlIDEgcGFyYW1ldGVyIiwgcGFyYW1ldGVycy5zaXplKCkgPT0gMSk7CisKKwkJ
CVNpbmdsZVZhcmlhYmxlRGVjbGFyYXRpb24gZGVjbD0gYXN0Lm5ld1NpbmdsZVZhcmlhYmxlRGVj
bGFyYXRpb24oKTsKKwkJCWRlY2wuc2V0VHlwZShhc3QubmV3UHJpbWl0aXZlVHlwZShQcmltaXRp
dmVUeXBlLklOVCkpOworCQkJZGVjbC5zZXROYW1lKGFzdC5uZXdTaW1wbGVOYW1lKCJ5IikpOwor
CQkJcmV3cml0ZS5nZXRMaXN0UmV3cml0ZShtZXRob2REZWNsLCBNZXRob2REZWNsYXJhdGlvbi5Q
QVJBTUVURVJTX1BST1BFUlRZKS5pbnNlcnRMYXN0KGRlY2wsIG51bGwpOworCQl9CisKKwkJeyAv
LyBpbnNlcnQgYSBwYXJhbWV0ZXIKKwkJCXR5cGVkZWNsYXJhdGlvbj0gZmluZFR5cGVEZWNsYXJh
dGlvbihhc3RSb290LCAiSiIpOworCQkJTWV0aG9kRGVjbGFyYXRpb24gbWV0aG9kRGVjbCA9IGZp
bmRNZXRob2REZWNsYXJhdGlvbih0eXBlZGVjbGFyYXRpb24sICJmb28iKTsKKwkJCUxpc3QgcGFy
YW1ldGVycyA9IG1ldGhvZERlY2wucGFyYW1ldGVycygpOworCQkJYXNzZXJ0VHJ1ZSgibXVzdCBi
ZSAwIHBhcmFtZXRlcnMiLCBwYXJhbWV0ZXJzLnNpemUoKSA9PSAwKTsKKworCQkJU2luZ2xlVmFy
aWFibGVEZWNsYXJhdGlvbiBuZXdQYXJhbT0gYXN0Lm5ld1NpbmdsZVZhcmlhYmxlRGVjbGFyYXRp
b24oKTsKKwkJCW5ld1BhcmFtLnNldE5hbWUoYXN0Lm5ld1NpbXBsZU5hbWUoIngiKSk7CisJCQlu
ZXdQYXJhbS5zZXRUeXBlKGFzdC5uZXdQcmltaXRpdmVUeXBlKFByaW1pdGl2ZVR5cGUuSU5UKSk7
CisJCQlyZXdyaXRlLmdldExpc3RSZXdyaXRlKG1ldGhvZERlY2wsIE1ldGhvZERlY2xhcmF0aW9u
LlBBUkFNRVRFUlNfUFJPUEVSVFkpLmluc2VydEZpcnN0KG5ld1BhcmFtLCBudWxsKTsKKwkJfQor
CisJCXR5cGVkZWNsYXJhdGlvbj0gZmluZFR5cGVEZWNsYXJhdGlvbihhc3RSb290LCAiWCIpOwor
CQlGaWVsZERlY2xhcmF0aW9uIGZpZWxkRGVjbGFyYXRpb24gPSAoRmllbGREZWNsYXJhdGlvbikg
dHlwZWRlY2xhcmF0aW9uLmJvZHlEZWNsYXJhdGlvbnMoKS5nZXQoMCk7CisJCVZhcmlhYmxlRGVj
bGFyYXRpb25GcmFnbWVudCBmcmFnbWVudCA9IChWYXJpYWJsZURlY2xhcmF0aW9uRnJhZ21lbnQp
ZmllbGREZWNsYXJhdGlvbi5mcmFnbWVudHMoKS5nZXQoMCk7CisJCUV4cHJlc3Npb24gZXhwcmVz
c2lvbiA9IGZyYWdtZW50LmdldEluaXRpYWxpemVyKCk7CisJCWFzc2VydFRydWUoZXhwcmVzc2lv
biBpbnN0YW5jZW9mIExhbWJkYUV4cHJlc3Npb24pOworCQlMYW1iZGFFeHByZXNzaW9uIGxhbWJk
YUV4cHJlc3Npb24gPSAoTGFtYmRhRXhwcmVzc2lvbilleHByZXNzaW9uOworCQkKKwkJey8vIGFk
ZCBhIHBhcmFtZXRlciB0byB0aGUgbGFtYmRhIGV4cHJlc3Npb24KKwkJCUxpc3QgcGFyYW1ldGVy
cz0gbGFtYmRhRXhwcmVzc2lvbi5wYXJhbWV0ZXJzKCk7CisJCQlhc3NlcnRUcnVlKCJtdXN0IGJl
IDEgcGFyYW1ldGVyIiwgcGFyYW1ldGVycy5zaXplKCkgPT0gMSk7CisJCQlBU1ROb2RlIGZpcnN0
UGFyYW09IChBU1ROb2RlKSBwYXJhbWV0ZXJzLmdldCgwKTsKKwkJCVZhcmlhYmxlRGVjbGFyYXRp
b25GcmFnbWVudCBuZXdQYXJhbT0gYXN0Lm5ld1ZhcmlhYmxlRGVjbGFyYXRpb25GcmFnbWVudCgp
OworCQkJbmV3UGFyYW0uc2V0TmFtZShhc3QubmV3U2ltcGxlTmFtZSgid2xhbWJkYSIpKTsKKwkJ
CXJld3JpdGUuZ2V0TGlzdFJld3JpdGUobGFtYmRhRXhwcmVzc2lvbiwgTGFtYmRhRXhwcmVzc2lv
bi5QQVJBTUVURVJTX1BST1BFUlRZKS5pbnNlcnRBZnRlcihuZXdQYXJhbSwgZmlyc3RQYXJhbSwg
bnVsbCk7CQkKKwkJfQorCQkKKwkJey8vIHJlcGxhY2UgdGhlIGJsb2NrIGJvZHkgd2l0aCBhIGZs
b2F0IGxpdGVyYWwgZXhwcmVzc2lvbiBib2R5LgorCQkJQVNUTm9kZSBib2R5ID0gbGFtYmRhRXhw
cmVzc2lvbi5nZXRCb2R5KCk7CisJCQlBU1ROb2RlIG5ld0JvZHkgPSBhc3QubmV3TnVtYmVyTGl0
ZXJhbCgiMy4xNCIpOworCQkJcmV3cml0ZS5yZXBsYWNlKGJvZHksIG5ld0JvZHksIG51bGwpOwor
CQl9CisKKwkJZmllbGREZWNsYXJhdGlvbiA9IChGaWVsZERlY2xhcmF0aW9uKSB0eXBlZGVjbGFy
YXRpb24uYm9keURlY2xhcmF0aW9ucygpLmdldCgxKTsKKwkJZnJhZ21lbnQgPSAoVmFyaWFibGVE
ZWNsYXJhdGlvbkZyYWdtZW50KWZpZWxkRGVjbGFyYXRpb24uZnJhZ21lbnRzKCkuZ2V0KDApOwor
CQlleHByZXNzaW9uID0gZnJhZ21lbnQuZ2V0SW5pdGlhbGl6ZXIoKTsKKwkJYXNzZXJ0VHJ1ZShl
eHByZXNzaW9uIGluc3RhbmNlb2YgTGFtYmRhRXhwcmVzc2lvbik7CisJCWxhbWJkYUV4cHJlc3Np
b24gPSAoTGFtYmRhRXhwcmVzc2lvbilleHByZXNzaW9uOworCQkKKwkJey8vIGFkZCBhIHBhcmFt
ZXRlciB0byB0aGUgbGFtYmRhIGV4cHJlc3Npb24gLSBib3JkZXIgY2FzZSAtIGVtcHR5IGxpc3Qg
aW5pdGlhbGx5CisJCQlMaXN0IHBhcmFtZXRlcnM9IGxhbWJkYUV4cHJlc3Npb24ucGFyYW1ldGVy
cygpOworCQkJYXNzZXJ0VHJ1ZSgibXVzdCBiZSAwIHBhcmFtZXRlciIsIHBhcmFtZXRlcnMuc2l6
ZSgpID09IDApOworCQkJVmFyaWFibGVEZWNsYXJhdGlvbkZyYWdtZW50IG5ld1BhcmFtPSBhc3Qu
bmV3VmFyaWFibGVEZWNsYXJhdGlvbkZyYWdtZW50KCk7CisJCQluZXdQYXJhbS5zZXROYW1lKGFz
dC5uZXdTaW1wbGVOYW1lKCJ2bGFtYmRhIikpOworCQkJcmV3cml0ZS5nZXRMaXN0UmV3cml0ZShs
YW1iZGFFeHByZXNzaW9uLCBMYW1iZGFFeHByZXNzaW9uLlBBUkFNRVRFUlNfUFJPUEVSVFkpLmlu
c2VydEZpcnN0KG5ld1BhcmFtLCBudWxsKTsJCQorCQl9CisJCVN0cmluZyBwcmV2aWV3PSBldmFs
dWF0ZVJld3JpdGUoY3UsIHJld3JpdGUpOworCisJCWJ1Zj0gbmV3IFN0cmluZ0J1ZmZlcigpOwor
CQlidWYuYXBwZW5kKCJwYWNrYWdlIHRlc3QxO1xuIik7CisJCWJ1Zi5hcHBlbmQoImludGVyZmFj
ZSBJIHtcbiIpOworCQlidWYuYXBwZW5kKCIJZmxvYXQgZm9vKGludCB4LCBpbnQgeSk7XG4iKTsK
KwkJYnVmLmFwcGVuZCgifVxuIik7CisJCWJ1Zi5hcHBlbmQoImludGVyZmFjZSBKIHtcbiIpOwor
CQlidWYuYXBwZW5kKCIJaW50IGZvbyhpbnQgeCk7XG4iKTsKKwkJYnVmLmFwcGVuZCgifVxuIik7
CisJCWJ1Zi5hcHBlbmQoInB1YmxpYyBjbGFzcyBYIHtcbiIpOworCQlidWYuYXBwZW5kKCIgSSBp
ID0gICh2bGFtYmRhLCB3bGFtYmRhKSAtPiAzLjE0O1xuIik7CisJCWJ1Zi5hcHBlbmQoIiBKIGog
PSAgKHZsYW1iZGEpIC0+IDE3Mjk7XG4iKTsKKwkJYnVmLmFwcGVuZCgifVxuIik7CisJCWFzc2Vy
dEVxdWFsU3RyaW5nKHByZXZpZXcsIGJ1Zi50b1N0cmluZygpKTsKKwl9CisJCisJcHVibGljIHZv
aWQgdGVzdExhbWJkYUV4cHJlc3Npb25zX1BhcmVudGhlc2VzX3NpbmNlXzgoKSB0aHJvd3MgRXhj
ZXB0aW9uIHsKKwkJSVBhY2thZ2VGcmFnbWVudCBwYWNrMT0gdGhpcy5zb3VyY2VGb2xkZXIuY3Jl
YXRlUGFja2FnZUZyYWdtZW50KCJ0ZXN0MSIsIGZhbHNlLCBudWxsKTsKKwkJU3RyaW5nQnVmZmVy
IGJ1Zj0gbmV3IFN0cmluZ0J1ZmZlcigpOworCQlidWYuYXBwZW5kKCJwYWNrYWdlIHRlc3QxO1xu
Iik7CisJCWJ1Zi5hcHBlbmQoImludGVyZmFjZSBJIHtcbiIpOworCQlidWYuYXBwZW5kKCIJaW50
IGZvbyhpbnQgeCk7XG4iKTsKKwkJYnVmLmFwcGVuZCgifVxuIik7CisJCWJ1Zi5hcHBlbmQoImlu
dGVyZmFjZSBKIHtcbiIpOworCQlidWYuYXBwZW5kKCIJaW50IGZvbygpO1xuIik7CisJCWJ1Zi5h
cHBlbmQoIn1cbiIpOworCQlidWYuYXBwZW5kKCJpbnRlcmZhY2UgSyB7XG4iKTsKKwkJYnVmLmFw
cGVuZCgiCWludCBmb28oaW50IHgsIGludCB5KTtcbiIpOworCQlidWYuYXBwZW5kKCJ9XG4iKTsK
KwkJYnVmLmFwcGVuZCgiaW50ZXJmYWNlIEwge1xuIik7CisJCWJ1Zi5hcHBlbmQoIglpbnQgZm9v
KGludCB4KTtcbiIpOworCQlidWYuYXBwZW5kKCJ9XG4iKTsKKwkJYnVmLmFwcGVuZCgicHVibGlj
IGNsYXNzIFgge1xuIik7CisJCWJ1Zi5hcHBlbmQoIiBJIGkgPSAgdmxhbWJkYSAtPiAyMjEyMTg4
NztcbiIpOworCQlidWYuYXBwZW5kKCIgSSBpZGFzaCA9ICAodmxhbWJkYSkgLT4gMTcyOTtcbiIp
OworCQlidWYuYXBwZW5kKCIgSiBqID0gICgpIC0+IDI2MDQxOTIwO1xuIik7CisJCWJ1Zi5hcHBl
bmQoIiBLIGsgPSAgKHgsIHkpIC0+IDE3Mjk7XG4iKTsKKwkJYnVmLmFwcGVuZCgiIEsga2Rhc2gg
PSAgKGludCB4LCBpbnQgeSkgLT4gMTcyOTtcbiIpOworCQlidWYuYXBwZW5kKCIgTCBsID0gIHZs
YW1iZGEgLT4gMTcyOTtcbiIpOworCQlidWYuYXBwZW5kKCJ9XG4iKTsKKwkJSUNvbXBpbGF0aW9u
VW5pdCBjdT0gcGFjazEuY3JlYXRlQ29tcGlsYXRpb25Vbml0KCJYLmphdmEiLCBidWYudG9TdHJp
bmcoKSwgZmFsc2UsIG51bGwpOworCisJCUNvbXBpbGF0aW9uVW5pdCBhc3RSb290PSBjcmVhdGVB
U1QoY3UpOworCQlBU1RSZXdyaXRlIHJld3JpdGU9IEFTVFJld3JpdGUuY3JlYXRlKGFzdFJvb3Qu
Z2V0QVNUKCkpOworCQlBU1QgYXN0PSBhc3RSb290LmdldEFTVCgpOworCisJCXsgLy8gcmVtb3Zl
IGEgcGFyYW1ldGVyCisJCQlUeXBlRGVjbGFyYXRpb24gdHlwZWRlY2xhcmF0aW9uPSBmaW5kVHlw
ZURlY2xhcmF0aW9uKGFzdFJvb3QsICJMIik7CisJCQlNZXRob2REZWNsYXJhdGlvbiBtZXRob2RE
ZWNsID0gZmluZE1ldGhvZERlY2xhcmF0aW9uKHR5cGVkZWNsYXJhdGlvbiwgImZvbyIpOworCQkJ
TGlzdCBwYXJhbWV0ZXJzID0gbWV0aG9kRGVjbC5wYXJhbWV0ZXJzKCk7CisJCQlhc3NlcnRUcnVl
KCJtdXN0IGJlIDEgcGFyYW1ldGVyIiwgcGFyYW1ldGVycy5zaXplKCkgPT0gMSk7CisJCQlBU1RO
b2RlIHBhcmFtID0gKEFTVE5vZGUpIHBhcmFtZXRlcnMuZ2V0KDApOworCQkJcmV3cml0ZS5nZXRM
aXN0UmV3cml0ZShtZXRob2REZWNsLCBNZXRob2REZWNsYXJhdGlvbi5QQVJBTUVURVJTX1BST1BF
UlRZKS5yZW1vdmUocGFyYW0sIG51bGwpOworCQl9CisKKwkJaW50IGZDb3VudCA9IDA7CisKKwkJ
VHlwZURlY2xhcmF0aW9uIHR5cGVkZWNsYXJhdGlvbj0gZmluZFR5cGVEZWNsYXJhdGlvbihhc3RS
b290LCAiWCIpOworCQlGaWVsZERlY2xhcmF0aW9uIGZpZWxkRGVjbGFyYXRpb24gPSAoRmllbGRE
ZWNsYXJhdGlvbikgdHlwZWRlY2xhcmF0aW9uLmJvZHlEZWNsYXJhdGlvbnMoKS5nZXQoZkNvdW50
KyspOworCQlWYXJpYWJsZURlY2xhcmF0aW9uRnJhZ21lbnQgZnJhZ21lbnQgPSAoVmFyaWFibGVE
ZWNsYXJhdGlvbkZyYWdtZW50KWZpZWxkRGVjbGFyYXRpb24uZnJhZ21lbnRzKCkuZ2V0KDApOwor
CQlMYW1iZGFFeHByZXNzaW9uIGxhbWJkYUV4cHJlc3Npb24gPSAoTGFtYmRhRXhwcmVzc2lvbilm
cmFnbWVudC5nZXRJbml0aWFsaXplcigpOworCQkKKwkJey8vIHNldCBwYXJlbnRoZXNlcworCQkJ
YXNzZXJ0VHJ1ZSgibGFtYmRhIGV4cHJlc3Npb24gaGFzIHBhcmFudGhlc2VzIiwgbGFtYmRhRXhw
cmVzc2lvbi5oYXNQYXJlbnRoZXNlcygpID09IGZhbHNlKTsKKwkJCXJld3JpdGUuc2V0KGxhbWJk
YUV4cHJlc3Npb24sIExhbWJkYUV4cHJlc3Npb24uUEFSRU5USEVTRVNfUFJPUEVSVFksIEJvb2xl
YW4uVFJVRSwgbnVsbCk7CisJCX0KKwkJCisJCWZpZWxkRGVjbGFyYXRpb24gPSAoRmllbGREZWNs
YXJhdGlvbikgdHlwZWRlY2xhcmF0aW9uLmJvZHlEZWNsYXJhdGlvbnMoKS5nZXQoZkNvdW50Kysp
OworCQlmcmFnbWVudCA9IChWYXJpYWJsZURlY2xhcmF0aW9uRnJhZ21lbnQpZmllbGREZWNsYXJh
dGlvbi5mcmFnbWVudHMoKS5nZXQoMCk7CisJCWxhbWJkYUV4cHJlc3Npb24gPSAoTGFtYmRhRXhw
cmVzc2lvbilmcmFnbWVudC5nZXRJbml0aWFsaXplcigpOworCQkKKwkJey8vIHJlc2V0IHBhcmVu
dGhlc2VzIC0gYSBsZWdhbCBvcGVyYXRpb24gaGVyZS4KKwkJCWFzc2VydFRydWUoImxhbWJkYSBl
eHByZXNzaW9uIGhhcyBwYXJhbnRoZXNlcyIsIGxhbWJkYUV4cHJlc3Npb24uaGFzUGFyZW50aGVz
ZXMoKSA9PSB0cnVlKTsKKwkJCXJld3JpdGUuc2V0KGxhbWJkYUV4cHJlc3Npb24sIExhbWJkYUV4
cHJlc3Npb24uUEFSRU5USEVTRVNfUFJPUEVSVFksIEJvb2xlYW4uRkFMU0UsIG51bGwpOworCQl9
CisJCQorCQlmaWVsZERlY2xhcmF0aW9uID0gKEZpZWxkRGVjbGFyYXRpb24pIHR5cGVkZWNsYXJh
dGlvbi5ib2R5RGVjbGFyYXRpb25zKCkuZ2V0KGZDb3VudCsrKTsKKwkJZnJhZ21lbnQgPSAoVmFy
aWFibGVEZWNsYXJhdGlvbkZyYWdtZW50KWZpZWxkRGVjbGFyYXRpb24uZnJhZ21lbnRzKCkuZ2V0
KDApOworCQlsYW1iZGFFeHByZXNzaW9uID0gKExhbWJkYUV4cHJlc3Npb24pZnJhZ21lbnQuZ2V0
SW5pdGlhbGl6ZXIoKTsKKworCQl7Ly8gcmVzZXQgcGFyZW50aGVzZXMgLSBhbiBpbGxlZ2FsIG9w
ZXJhdGlvbiBoZXJlLgorCQkJYXNzZXJ0VHJ1ZSgibGFtYmRhIGV4cHJlc3Npb24gZG9lcyBub3Qg
aGF2ZSBwYXJhbnRoZXNlcyIsIGxhbWJkYUV4cHJlc3Npb24uaGFzUGFyZW50aGVzZXMoKSA9PSB0
cnVlKTsKKwkJCXJld3JpdGUuc2V0KGxhbWJkYUV4cHJlc3Npb24sIExhbWJkYUV4cHJlc3Npb24u
UEFSRU5USEVTRVNfUFJPUEVSVFksIEJvb2xlYW4uRkFMU0UsIG51bGwpOworCQl9CisKKwkJZmll
bGREZWNsYXJhdGlvbiA9IChGaWVsZERlY2xhcmF0aW9uKSB0eXBlZGVjbGFyYXRpb24uYm9keURl
Y2xhcmF0aW9ucygpLmdldChmQ291bnQrKyk7CisJCWZyYWdtZW50ID0gKFZhcmlhYmxlRGVjbGFy
YXRpb25GcmFnbWVudClmaWVsZERlY2xhcmF0aW9uLmZyYWdtZW50cygpLmdldCgwKTsKKwkJbGFt
YmRhRXhwcmVzc2lvbiA9IChMYW1iZGFFeHByZXNzaW9uKWZyYWdtZW50LmdldEluaXRpYWxpemVy
KCk7CisKKwkJey8vIHJlc2V0IHBhcmVudGhlc2VzIC0gYW4gaWxsZWdhbCBvcGVyYXRpb24gaGVy
ZS4KKwkJCWFzc2VydFRydWUoImxhbWJkYSBleHByZXNzaW9uIGRvZXMgbm90IGhhdmUgcGFyYW50
aGVzZXMiLCBsYW1iZGFFeHByZXNzaW9uLmhhc1BhcmVudGhlc2VzKCkgPT0gdHJ1ZSk7CisJCQly
ZXdyaXRlLnNldChsYW1iZGFFeHByZXNzaW9uLCBMYW1iZGFFeHByZXNzaW9uLlBBUkVOVEhFU0VT
X1BST1BFUlRZLCBCb29sZWFuLkZBTFNFLCBudWxsKTsKKwkJfQorCQkKKwkJey8vIGNoYW5nZSBh
bGwgdGhlIHBhcmFtZXRlciB0byBTVkQgaWUgYWRkIHR5cGUgaW5mbyB0byB0aGUgcGFyYW1ldGVy
cy4KKwkJCUxpc3QgcGFyYW1ldGVycyA9IGxhbWJkYUV4cHJlc3Npb24ucGFyYW1ldGVycygpOwor
CQkJVmFyaWFibGVEZWNsYXJhdGlvbiBwYXJhbSA9IChWYXJpYWJsZURlY2xhcmF0aW9uKXBhcmFt
ZXRlcnMuZ2V0KDApOworCQkJU2luZ2xlVmFyaWFibGVEZWNsYXJhdGlvbiBuZXdQYXJhbT0gYXN0
Lm5ld1NpbmdsZVZhcmlhYmxlRGVjbGFyYXRpb24oKTsKKwkJCW5ld1BhcmFtLnNldE5hbWUoYXN0
Lm5ld1NpbXBsZU5hbWUobmV3IFN0cmluZyhwYXJhbS50b1N0cmluZygpKSkpOworCQkJbmV3UGFy
YW0uc2V0VHlwZShhc3QubmV3UHJpbWl0aXZlVHlwZShQcmltaXRpdmVUeXBlLklOVCkpOworCQkJ
cmV3cml0ZS5nZXRMaXN0UmV3cml0ZShsYW1iZGFFeHByZXNzaW9uLCBMYW1iZGFFeHByZXNzaW9u
LlBBUkFNRVRFUlNfUFJPUEVSVFkpLnJlcGxhY2UocGFyYW0sIG5ld1BhcmFtLCBudWxsKTsKKwkJ
CQorCQkJcGFyYW0gPSAoVmFyaWFibGVEZWNsYXJhdGlvbilwYXJhbWV0ZXJzLmdldCgxKTsKKwkJ
CW5ld1BhcmFtPSBhc3QubmV3U2luZ2xlVmFyaWFibGVEZWNsYXJhdGlvbigpOworCQkJbmV3UGFy
YW0uc2V0TmFtZShhc3QubmV3U2ltcGxlTmFtZShuZXcgU3RyaW5nKHBhcmFtLnRvU3RyaW5nKCkp
KSk7CisJCQluZXdQYXJhbS5zZXRUeXBlKGFzdC5uZXdQcmltaXRpdmVUeXBlKFByaW1pdGl2ZVR5
cGUuSU5UKSk7CisJCQlyZXdyaXRlLmdldExpc3RSZXdyaXRlKGxhbWJkYUV4cHJlc3Npb24sIExh
bWJkYUV4cHJlc3Npb24uUEFSQU1FVEVSU19QUk9QRVJUWSkucmVwbGFjZShwYXJhbSwgbmV3UGFy
YW0sIG51bGwpOworCQl9CisKKwkJey8vIFJlbW92ZSB0eXBlIGluZm8gZnJvbSB0aGUgcGFyYW1l
dGVycy4KKworCQkJZmllbGREZWNsYXJhdGlvbiA9IChGaWVsZERlY2xhcmF0aW9uKSB0eXBlZGVj
bGFyYXRpb24uYm9keURlY2xhcmF0aW9ucygpLmdldChmQ291bnQrKyk7CisJCQlmcmFnbWVudCA9
IChWYXJpYWJsZURlY2xhcmF0aW9uRnJhZ21lbnQpZmllbGREZWNsYXJhdGlvbi5mcmFnbWVudHMo
KS5nZXQoMCk7CisJCQlsYW1iZGFFeHByZXNzaW9uID0gKExhbWJkYUV4cHJlc3Npb24pZnJhZ21l
bnQuZ2V0SW5pdGlhbGl6ZXIoKTsKKwkJCUxpc3QgcGFyYW1ldGVycyA9IGxhbWJkYUV4cHJlc3Np
b24ucGFyYW1ldGVycygpOworCisJCQlmb3IgKGludCBpID0gMDsgaSA8IHBhcmFtZXRlcnMuc2l6
ZSgpOyArK2kpIHsKKwkJCQlTaW5nbGVWYXJpYWJsZURlY2xhcmF0aW9uIHBhcmFtID0gKFNpbmds
ZVZhcmlhYmxlRGVjbGFyYXRpb24pcGFyYW1ldGVycy5nZXQoaSk7CisJCQkJVmFyaWFibGVEZWNs
YXJhdGlvbkZyYWdtZW50IG5ld1BhcmFtPSBhc3QubmV3VmFyaWFibGVEZWNsYXJhdGlvbkZyYWdt
ZW50KCk7CisJCQkJbmV3UGFyYW0uc2V0TmFtZShhc3QubmV3U2ltcGxlTmFtZShuZXcgU3RyaW5n
KHBhcmFtLmdldE5hbWUoKS50b1N0cmluZygpKSkpOworCQkJCXJld3JpdGUuZ2V0TGlzdFJld3Jp
dGUobGFtYmRhRXhwcmVzc2lvbiwgTGFtYmRhRXhwcmVzc2lvbi5QQVJBTUVURVJTX1BST1BFUlRZ
KS5yZXBsYWNlKHBhcmFtLCBuZXdQYXJhbSwgbnVsbCk7CQkJCQorCQkJfQorCQl9CisKKwkJZmll
bGREZWNsYXJhdGlvbiA9IChGaWVsZERlY2xhcmF0aW9uKSB0eXBlZGVjbGFyYXRpb24uYm9keURl
Y2xhcmF0aW9ucygpLmdldChmQ291bnQrKyk7CisJCWZyYWdtZW50ID0gKFZhcmlhYmxlRGVjbGFy
YXRpb25GcmFnbWVudClmaWVsZERlY2xhcmF0aW9uLmZyYWdtZW50cygpLmdldCgwKTsKKwkJbGFt
YmRhRXhwcmVzc2lvbiA9IChMYW1iZGFFeHByZXNzaW9uKWZyYWdtZW50LmdldEluaXRpYWxpemVy
KCk7CisJCisJCXsvLyByZW1vdmUgdGhlIG9ubHkgcGFyYW1ldGVyIGFuZCB0aGUgcmV3cml0ZXIg
c2hvdWxkIGF1dG9tYXRpY2FsbHkgYWRkIHRoZSBwYXJlbnRoZXNlcworCQkJTGlzdCBwYXJhbWV0
ZXJzID0gbGFtYmRhRXhwcmVzc2lvbi5wYXJhbWV0ZXJzKCk7CisJCQlBU1ROb2RlIHBhcmFtID0g
KEFTVE5vZGUpcGFyYW1ldGVycy5nZXQoMCk7CisJCQlyZXdyaXRlLmdldExpc3RSZXdyaXRlKGxh
bWJkYUV4cHJlc3Npb24sIExhbWJkYUV4cHJlc3Npb24uUEFSQU1FVEVSU19QUk9QRVJUWSkucmVt
b3ZlKHBhcmFtLCAgbnVsbCk7CisJCX0KKworCQlTdHJpbmcgcHJldmlldz0gZXZhbHVhdGVSZXdy
aXRlKGN1LCByZXdyaXRlKTsKKworCQlidWY9IG5ldyBTdHJpbmdCdWZmZXIoKTsKKwkJYnVmLmFw
cGVuZCgicGFja2FnZSB0ZXN0MTtcbiIpOworCQlidWYuYXBwZW5kKCJpbnRlcmZhY2UgSSB7XG4i
KTsKKwkJYnVmLmFwcGVuZCgiCWludCBmb28oaW50IHgpO1xuIik7CisJCWJ1Zi5hcHBlbmQoIn1c
biIpOworCQlidWYuYXBwZW5kKCJpbnRlcmZhY2UgSiB7XG4iKTsKKwkJYnVmLmFwcGVuZCgiCWlu
dCBmb28oKTtcbiIpOworCQlidWYuYXBwZW5kKCJ9XG4iKTsKKwkJYnVmLmFwcGVuZCgiaW50ZXJm
YWNlIEsge1xuIik7CisJCWJ1Zi5hcHBlbmQoIglpbnQgZm9vKGludCB4LCBpbnQgeSk7XG4iKTsK
KwkJYnVmLmFwcGVuZCgifVxuIik7CisJCWJ1Zi5hcHBlbmQoImludGVyZmFjZSBMIHtcbiIpOwor
CQlidWYuYXBwZW5kKCIJaW50IGZvbygpO1xuIik7CisJCWJ1Zi5hcHBlbmQoIn1cbiIpOworCQli
dWYuYXBwZW5kKCJwdWJsaWMgY2xhc3MgWCB7XG4iKTsKKwkJYnVmLmFwcGVuZCgiIEkgaSA9ICAo
dmxhbWJkYSkgLT4gMjIxMjE4ODc7XG4iKTsKKwkJYnVmLmFwcGVuZCgiIEkgaWRhc2ggPSAgdmxh
bWJkYSAtPiAxNzI5O1xuIik7CisJCWJ1Zi5hcHBlbmQoIiBKIGogPSAgKCkgLT4gMjYwNDE5MjA7
XG4iKTsKKwkJYnVmLmFwcGVuZCgiIEsgayA9ICAoaW50IHgsIGludCB5KSAtPiAxNzI5O1xuIik7
CisJCWJ1Zi5hcHBlbmQoIiBLIGtkYXNoID0gICh4LCB5KSAtPiAxNzI5O1xuIik7CisJCWJ1Zi5h
cHBlbmQoIiBMIGwgPSAgKCkgLT4gMTcyOTtcbiIpOworCQlidWYuYXBwZW5kKCJ9XG4iKTsKKwkJ
YXNzZXJ0RXF1YWxTdHJpbmcocHJldmlldywgYnVmLnRvU3RyaW5nKCkpOworCX0KK30KXCBObyBu
ZXdsaW5lIGF0IGVuZCBvZiBmaWxlCmRpZmYgLS1naXQgYS9vcmcuZWNsaXBzZS5qZHQuY29yZS50
ZXN0cy5tb2RlbC9zcmMvb3JnL2VjbGlwc2UvamR0L2NvcmUvdGVzdHMvcmV3cml0ZS9kZXNjcmli
aW5nL0FTVFJld3JpdGluZ1Rlc3QuamF2YSBiL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1v
ZGVsL3NyYy9vcmcvZWNsaXBzZS9qZHQvY29yZS90ZXN0cy9yZXdyaXRlL2Rlc2NyaWJpbmcvQVNU
UmV3cml0aW5nVGVzdC5qYXZhCmluZGV4IDUxNzliYWYuLjlmMzVjZWIgMTAwNjQ0Ci0tLSBhL29y
Zy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3NyYy9vcmcvZWNsaXBzZS9qZHQvY29yZS90
ZXN0cy9yZXdyaXRlL2Rlc2NyaWJpbmcvQVNUUmV3cml0aW5nVGVzdC5qYXZhCisrKyBiL29yZy5l
Y2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3NyYy9vcmcvZWNsaXBzZS9qZHQvY29yZS90ZXN0
cy9yZXdyaXRlL2Rlc2NyaWJpbmcvQVNUUmV3cml0aW5nVGVzdC5qYXZhCkBAIC0xMTMsNyArMTEz
LDcgQEAKIAkJc3VpdGUuYWRkVGVzdChBU1RSZXdyaXRpbmdXaXRoU3RhdGVtZW50c1JlY292ZXJ5
VGVzdC5zdWl0ZSgpKTsKIAkJc3VpdGUuYWRkVGVzdChBU1RSZXdyaXRlUHJvcGVydHlUZXN0LnN1
aXRlKCkpOwogCQlzdWl0ZS5hZGRUZXN0KEFTVFJld3JpdGluZ1BhY2thZ2VEZWNsVGVzdC5zdWl0
ZSgpKTsKLQkJCisJCXN1aXRlLmFkZFRlc3QoQVNUUmV3cml0aW5nTGFtYmRhRXhwcmVzc2lvblRl
c3Quc3VpdGUoKSk7CQkKIAkJc3VpdGUuYWRkVGVzdChTb3VyY2VNb2RpZmllclRlc3Quc3VpdGUo
KSk7CiAJCXN1aXRlLmFkZFRlc3QoSW1wb3J0UmV3cml0ZVRlc3Quc3VpdGUoKSk7CiAJCXJldHVy
biBzdWl0ZTsKZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlL2RvbS9vcmcvZWNsaXBz
ZS9qZHQvaW50ZXJuYWwvY29yZS9kb20vcmV3cml0ZS9BU1RSZXdyaXRlQW5hbHl6ZXIuamF2YSBi
L29yZy5lY2xpcHNlLmpkdC5jb3JlL2RvbS9vcmcvZWNsaXBzZS9qZHQvaW50ZXJuYWwvY29yZS9k
b20vcmV3cml0ZS9BU1RSZXdyaXRlQW5hbHl6ZXIuamF2YQppbmRleCA1NTM3MWE3Li4yYWYxNjM5
IDEwMDY0NAotLS0gYS9vcmcuZWNsaXBzZS5qZHQuY29yZS9kb20vb3JnL2VjbGlwc2UvamR0L2lu
dGVybmFsL2NvcmUvZG9tL3Jld3JpdGUvQVNUUmV3cml0ZUFuYWx5emVyLmphdmEKKysrIGIvb3Jn
LmVjbGlwc2UuamR0LmNvcmUvZG9tL29yZy9lY2xpcHNlL2pkdC9pbnRlcm5hbC9jb3JlL2RvbS9y
ZXdyaXRlL0FTVFJld3JpdGVBbmFseXplci5qYXZhCkBAIC0yODEzLDYgKzI4MTMsODAgQEAKIAl9
CiAKIAkvKiAobm9uLUphdmFkb2MpCisJICogQHNlZSBvcmcuZWNsaXBzZS5qZHQuY29yZS5kb20u
QVNUVmlzaXRvciN2aXNpdChMYW1iZGFFeHByZXNzaW9uKQorCSAqLworCXB1YmxpYyBib29sZWFu
IHZpc2l0KExhbWJkYUV4cHJlc3Npb24gbm9kZSkgeworCQlpZiAoIWhhc0NoaWxkcmVuQ2hhbmdl
cyhub2RlKSkgeworCQkJcmV0dXJuIGRvVmlzaXRVbmNoYW5nZWRDaGlsZHJlbihub2RlKTsKKwkJ
fQorCQlib29sZWFuIGhhc1BhcmVudGhlc2VzID0gZ2V0TmV3VmFsdWUobm9kZSwgTGFtYmRhRXhw
cmVzc2lvbi5QQVJFTlRIRVNFU19QUk9QRVJUWSkuZXF1YWxzKEJvb2xlYW4uVFJVRSk7CisJCWlm
ICghaGFzUGFyZW50aGVzZXMpIHsvLyBQYXJlbnRoZXNlcyBjYW4gYmUgYWJzZW50IGlmIGFuZCBv
bmx5IGlmIHRoZXJlIGlzIG9uZSBhbmQgb25seSBvbmUgdHlwZSBlbGlkZWQgcGFyYW1ldGVyLgor
CQkJTGlzdCBwYXJhbWV0ZXJzID0gKExpc3QpZ2V0TmV3VmFsdWUobm9kZSwgTGFtYmRhRXhwcmVz
c2lvbi5QQVJBTUVURVJTX1BST1BFUlRZKTsKKwkJCVZhcmlhYmxlRGVjbGFyYXRpb24gdmFyRGVj
bCA9IHBhcmFtZXRlcnMuc2l6ZSgpID09IDEgPyAoVmFyaWFibGVEZWNsYXJhdGlvbikgcGFyYW1l
dGVycy5nZXQoMCkgOiBudWxsOworCQkJaGFzUGFyZW50aGVzZXMgPSAhKHZhckRlY2wgaW5zdGFu
Y2VvZiBWYXJpYWJsZURlY2xhcmF0aW9uRnJhZ21lbnQpOworCQl9CisKKwkJYm9vbGVhbiBkZWxl
dGVQYXJlbnRoZXNlcyA9IGZhbHNlOworCQlib29sZWFuIGluc2VydFBhcmVudGhlc2VzID0gZmFs
c2U7CisJCVRleHRFZGl0R3JvdXAgZWRpdEdyb3VwID0gbnVsbDsKKworCQlib29sZWFuIG9sZEhh
c1BhcmVudGhlc2VzID0gZ2V0T3JpZ2luYWxWYWx1ZShub2RlLCBMYW1iZGFFeHByZXNzaW9uLlBB
UkVOVEhFU0VTX1BST1BFUlRZKS5lcXVhbHMoQm9vbGVhbi5UUlVFKTsKKwkJUmV3cml0ZUV2ZW50
IGV2ZW50ID0gZ2V0RXZlbnQobm9kZSwgTGFtYmRhRXhwcmVzc2lvbi5QQVJFTlRIRVNFU19QUk9Q
RVJUWSk7CisJCWlmIChldmVudCAhPSBudWxsKSB7CisJCQllZGl0R3JvdXAgPSBnZXRFZGl0R3Jv
dXAoZXZlbnQpOworCQkJaWYgKGV2ZW50LmdldENoYW5nZUtpbmQoKSA9PSBSZXdyaXRlRXZlbnQu
UkVQTEFDRUQpIHsKKwkJCQlpZiAoZXZlbnQuZ2V0TmV3VmFsdWUoKS5lcXVhbHMoQm9vbGVhbi5U
UlVFKSkgeworCQkJCQlpbnNlcnRQYXJlbnRoZXNlcyA9IHRydWU7CisJCQkJfSBlbHNlIHsvLyBh
cHBseSB0aGUgc3RyaWN0ZXIgY2hlY2sgZm9yIHBhcmVudGhlc2VzIGRlbGV0aW9uCisJCQkJCWRl
bGV0ZVBhcmVudGhlc2VzID0gIWhhc1BhcmVudGhlc2VzOworCQkJCX0KKwkJCX0KKwkJfSBlbHNl
IGlmICghb2xkSGFzUGFyZW50aGVzZXMgJiYgaGFzUGFyZW50aGVzZXMpIHsvLyBwYXJhbWV0ZXIg
cHJvcGVydHkgY2hhbmdlZCB0byBlZmZlY3QgcGFyZW50aGVzZXMgaW5zZXJ0aW9uCisJCQlpZiAo
KGV2ZW50ID0gZ2V0RXZlbnQobm9kZSwgTGFtYmRhRXhwcmVzc2lvbi5QQVJBTUVURVJTX1BST1BF
UlRZKSkgIT0gbnVsbCkgey8vIGEgbnVsbCBjaGVjayB0aG91Z2ggZXZlbnQgY2Fubm90IGJlIG51
bGwgaGVyZQorCQkJCWVkaXRHcm91cCA9IGdldEVkaXRHcm91cChldmVudCk7CisJCQkJaW5zZXJ0
UGFyZW50aGVzZXMgPSB0cnVlOwkJCQkKKwkJCX0KKwkJfQorCQkKKwkJaW50IHBvcyA9IG5vZGUu
Z2V0U3RhcnRQb3NpdGlvbigpOworCQlpZiAoaW5zZXJ0UGFyZW50aGVzZXMpIHsKKwkJCWRvVGV4
dEluc2VydChwb3MsICIoIiwgZWRpdEdyb3VwKTsgLy8kTk9OLU5MUy0xJAorCQl9IGVsc2UgaWYg
KGRlbGV0ZVBhcmVudGhlc2VzKSB7CisJCQl0cnkgeworCQkJCWludCBscGFyZW5zRW5kID0gZ2V0
U2Nhbm5lcigpLmdldFRva2VuRW5kT2Zmc2V0KFRlcm1pbmFsVG9rZW5zLlRva2VuTmFtZUxQQVJF
TiwgcG9zKTsKKwkJCQlkb1RleHRSZW1vdmUocG9zLCBscGFyZW5zRW5kIC0gcG9zLCBlZGl0R3Jv
dXApOworCQkJCXBvcyA9IGxwYXJlbnNFbmQ7CisJCQl9IGNhdGNoIChDb3JlRXhjZXB0aW9uIGUp
IHsKKwkJCQloYW5kbGVFeGNlcHRpb24oZSk7CisJCQl9CisJCX0KKworCQlpZiAoaXNDaGFuZ2Vk
KG5vZGUsIExhbWJkYUV4cHJlc3Npb24uUEFSQU1FVEVSU19QUk9QRVJUWSkpIHsKKwkJCXRyeSB7
CisJCQkJcG9zID0gb2xkSGFzUGFyZW50aGVzZXMgPyBnZXRTY2FubmVyKCkuZ2V0VG9rZW5FbmRP
ZmZzZXQoVGVybWluYWxUb2tlbnMuVG9rZW5OYW1lTFBBUkVOLCBwb3MpIDogcG9zOworCQkJCXBv
cyA9IHJld3JpdGVOb2RlTGlzdChub2RlLCBMYW1iZGFFeHByZXNzaW9uLlBBUkFNRVRFUlNfUFJP
UEVSVFksIHBvcywgVXRpbC5FTVBUWV9TVFJJTkcsICIsICIpOyAvLyROT04tTkxTLTEkIAorCQkJ
fSBjYXRjaCAoQ29yZUV4Y2VwdGlvbiBlKSB7CisJCQkJaGFuZGxlRXhjZXB0aW9uKGUpOworCQkJ
fQorCQl9IGVsc2UgeworCQkJcG9zID0gZG9WaXNpdChub2RlLCBMYW1iZGFFeHByZXNzaW9uLlBB
UkFNRVRFUlNfUFJPUEVSVFksIHBvcyk7CisJCX0KKworCQlpZiAoaW5zZXJ0UGFyZW50aGVzZXMp
IHsKKwkJCWRvVGV4dEluc2VydChwb3MsICIpIiwgZWRpdEdyb3VwKTsgLy8kTk9OLU5MUy0xJAor
CQl9IGVsc2UgaWYgKGRlbGV0ZVBhcmVudGhlc2VzKSB7CisJCQl0cnkgeworCQkJCWRvVGV4dFJl
bW92ZShwb3MsIGdldFNjYW5uZXIoKS5nZXRUb2tlbkVuZE9mZnNldChUZXJtaW5hbFRva2Vucy5U
b2tlbk5hbWVSUEFSRU4sIHBvcykgLSBwb3MsIGVkaXRHcm91cCk7CQkJCQorCQkJfSBjYXRjaCAo
Q29yZUV4Y2VwdGlvbiBlKSB7CisJCQkJaGFuZGxlRXhjZXB0aW9uKGUpOworCQkJfQorCQl9CisJ
CXJld3JpdGVSZXF1aXJlZE5vZGUobm9kZSwgTGFtYmRhRXhwcmVzc2lvbi5CT0RZX1BST1BFUlRZ
KTsKKworCQlyZXR1cm4gZmFsc2U7CisJfQorCisJLyogKG5vbi1KYXZhZG9jKQogCSAqIEBzZWUg
b3JnLmVjbGlwc2UuamR0LmNvcmUuZG9tLkFTVFZpc2l0b3IjdmlzaXQoTWV0aG9kSW52b2NhdGlv
bikKIAkgKi8KIAlwdWJsaWMgYm9vbGVhbiB2aXNpdChNZXRob2RJbnZvY2F0aW9uIG5vZGUpIHsK
ZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlL2RvbS9vcmcvZWNsaXBzZS9qZHQvaW50
ZXJuYWwvY29yZS9kb20vcmV3cml0ZS9BU1RSZXdyaXRlRmxhdHRlbmVyLmphdmEgYi9vcmcuZWNs
aXBzZS5qZHQuY29yZS9kb20vb3JnL2VjbGlwc2UvamR0L2ludGVybmFsL2NvcmUvZG9tL3Jld3Jp
dGUvQVNUUmV3cml0ZUZsYXR0ZW5lci5qYXZhCmluZGV4IDU2NGE5MzYuLjI1Mzc4OTAgMTAwNjQ0
Ci0tLSBhL29yZy5lY2xpcHNlLmpkdC5jb3JlL2RvbS9vcmcvZWNsaXBzZS9qZHQvaW50ZXJuYWwv
Y29yZS9kb20vcmV3cml0ZS9BU1RSZXdyaXRlRmxhdHRlbmVyLmphdmEKKysrIGIvb3JnLmVjbGlw
c2UuamR0LmNvcmUvZG9tL29yZy9lY2xpcHNlL2pkdC9pbnRlcm5hbC9jb3JlL2RvbS9yZXdyaXRl
L0FTVFJld3JpdGVGbGF0dGVuZXIuamF2YQpAQCAtNjUwLDYgKzY1MCwyNiBAQAogCQl0aGlzLnJl
c3VsdC5hcHBlbmQoIltdIik7IC8vJE5PTi1OTFMtMSQKIAkJcmV0dXJuIGZhbHNlOwogCX0KKwor
CS8qCisJICogQHNlZSBBU1RWaXNpdG9yI3Zpc2l0KExhbWJkYUV4cHJlc3Npb24pCisJICovCisJ
cHVibGljIGJvb2xlYW4gdmlzaXQoTGFtYmRhRXhwcmVzc2lvbiBub2RlKSB7CisJCWJvb2xlYW4g
aGFzUGFyZW50aGVzZXMgPSBnZXRCb29sZWFuQXR0cmlidXRlKG5vZGUsIExhbWJkYUV4cHJlc3Np
b24uUEFSRU5USEVTRVNfUFJPUEVSVFkpOworCQlMaXN0IHBhcmFtZXRlcnMgPSBnZXRDaGlsZExp
c3Qobm9kZSwgTGFtYmRhRXhwcmVzc2lvbi5QQVJBTUVURVJTX1BST1BFUlRZKTsKKwkJVmFyaWFi
bGVEZWNsYXJhdGlvbiB2YXJEZWNsID0gcGFyYW1ldGVycy5zaXplKCkgPT0gMSA/IChWYXJpYWJs
ZURlY2xhcmF0aW9uKSBwYXJhbWV0ZXJzLmdldCgwKSA6IG51bGw7CisJCWhhc1BhcmVudGhlc2Vz
ID0gdmFyRGVjbCBpbnN0YW5jZW9mIFZhcmlhYmxlRGVjbGFyYXRpb25GcmFnbWVudCA/IGhhc1Bh
cmVudGhlc2VzIDogdHJ1ZTsKKworCQlpZiAoaGFzUGFyZW50aGVzZXMpCisJCQl0aGlzLnJlc3Vs
dC5hcHBlbmQoJygnKTsKKwkJdmlzaXRMaXN0KG5vZGUsIExhbWJkYUV4cHJlc3Npb24uUEFSQU1F
VEVSU19QUk9QRVJUWSwgU3RyaW5nLnZhbHVlT2YoJywnKSk7CisJCWlmIChoYXNQYXJlbnRoZXNl
cykKKwkJCXRoaXMucmVzdWx0LmFwcGVuZCgnKScpOworCQl0aGlzLnJlc3VsdC5hcHBlbmQoIi0+
Iik7IC8vJE5PTi1OTFMtMSQKKwkJZ2V0Q2hpbGROb2RlKG5vZGUsIExhbWJkYUV4cHJlc3Npb24u
Qk9EWV9QUk9QRVJUWSkuYWNjZXB0KHRoaXMpOworCQlyZXR1cm4gZmFsc2U7CisJfQorCiAJLyoK
IAkgKiBAc2VlIEFTVFZpc2l0b3IjdmlzaXQoTWV0aG9kRGVjbGFyYXRpb24pCiAJICov
</data>

          </attachment>
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>229030</attachid>
            <date>2013-03-26 05:57:00 -0400</date>
            <delta_ts>2013-04-09 01:37:52 -0400</delta_ts>
            <desc>Proposed Patch</desc>
            <filename>Fix-for-Bug-402231--18ast-rewrite-Rewrite-support-fo.patch</filename>
            <type>text/plain</type>
            <size>21093</size>
            <attacher name="Manoj Palat Away Until May 11 2015">manpalat</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3NyYy9vcmcvZWNs
aXBzZS9qZHQvY29yZS90ZXN0cy9yZXdyaXRlL2Rlc2NyaWJpbmcvQVNUUmV3cml0aW5nTGFtYmRh
RXhwcmVzc2lvblRlc3QuamF2YSBiL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3Ny
Yy9vcmcvZWNsaXBzZS9qZHQvY29yZS90ZXN0cy9yZXdyaXRlL2Rlc2NyaWJpbmcvQVNUUmV3cml0
aW5nTGFtYmRhRXhwcmVzc2lvblRlc3QuamF2YQpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAw
MDAwMDAwLi5lMjQwNmNiCi0tLSAvZGV2L251bGwKKysrIGIvb3JnLmVjbGlwc2UuamR0LmNvcmUu
dGVzdHMubW9kZWwvc3JjL29yZy9lY2xpcHNlL2pkdC9jb3JlL3Rlc3RzL3Jld3JpdGUvZGVzY3Jp
YmluZy9BU1RSZXdyaXRpbmdMYW1iZGFFeHByZXNzaW9uVGVzdC5qYXZhCkBAIC0wLDAgKzEsMzIx
IEBACisvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKgorICogQ29weXJpZ2h0IChjKSAyMDEzIElCTSBD
b3Jwb3JhdGlvbiBhbmQgb3RoZXJzLgorICogQWxsIHJpZ2h0cyByZXNlcnZlZC4gVGhpcyBwcm9n
cmFtIGFuZCB0aGUgYWNjb21wYW55aW5nIG1hdGVyaWFscworICogYXJlIG1hZGUgYXZhaWxhYmxl
IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgRWNsaXBzZSBQdWJsaWMgTGljZW5zZSB2MS4wCisgKiB3
aGljaCBhY2NvbXBhbmllcyB0aGlzIGRpc3RyaWJ1dGlvbiwgYW5kIGlzIGF2YWlsYWJsZSBhdAor
ICogaHR0cDovL3d3dy5lY2xpcHNlLm9yZy9sZWdhbC9lcGwtdjEwLmh0bWwKKyAqCisgKiBUaGlz
IGlzIGFuIGltcGxlbWVudGF0aW9uIG9mIGFuIGVhcmx5LWRyYWZ0IHNwZWNpZmljYXRpb24gZGV2
ZWxvcGVkIHVuZGVyIHRoZSBKYXZhCisgKiBDb21tdW5pdHkgUHJvY2VzcyAoSkNQKSBhbmQgaXMg
bWFkZSBhdmFpbGFibGUgZm9yIHRlc3RpbmcgYW5kIGV2YWx1YXRpb24gcHVycG9zZXMKKyAqIG9u
bHkuIFRoZSBjb2RlIGlzIG5vdCBjb21wYXRpYmxlIHdpdGggYW55IHNwZWNpZmljYXRpb24gb2Yg
dGhlIEpDUC4KKyAqCisgKiBDb250cmlidXRvcnM6CisgKiAgICAgSUJNIENvcnBvcmF0aW9uIC0g
aW5pdGlhbCBBUEkgYW5kIGltcGxlbWVudGF0aW9uCisgKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8K
K3BhY2thZ2Ugb3JnLmVjbGlwc2UuamR0LmNvcmUudGVzdHMucmV3cml0ZS5kZXNjcmliaW5nOwor
CitpbXBvcnQgamF2YS51dGlsLkxpc3Q7CisKK2ltcG9ydCBqdW5pdC5mcmFtZXdvcmsuVGVzdDsK
KworaW1wb3J0IG9yZy5lY2xpcHNlLmpkdC5jb3JlLklDb21waWxhdGlvblVuaXQ7CitpbXBvcnQg
b3JnLmVjbGlwc2UuamR0LmNvcmUuSVBhY2thZ2VGcmFnbWVudDsKK2ltcG9ydCBvcmcuZWNsaXBz
ZS5qZHQuY29yZS5kb20uKjsKK2ltcG9ydCBvcmcuZWNsaXBzZS5qZHQuY29yZS5kb20ucmV3cml0
ZS5BU1RSZXdyaXRlOworCitwdWJsaWMgY2xhc3MgQVNUUmV3cml0aW5nTGFtYmRhRXhwcmVzc2lv
blRlc3QgZXh0ZW5kcyBBU1RSZXdyaXRpbmdUZXN0IHsKKworCXB1YmxpYyBBU1RSZXdyaXRpbmdM
YW1iZGFFeHByZXNzaW9uVGVzdChTdHJpbmcgbmFtZSkgeworCQlzdXBlcihuYW1lKTsKKwl9CisK
KwlwdWJsaWMgQVNUUmV3cml0aW5nTGFtYmRhRXhwcmVzc2lvblRlc3QoU3RyaW5nIG5hbWUsIGlu
dCBhcGlMZXZlbCkgeworCQlzdXBlcihuYW1lLCBhcGlMZXZlbCk7CisJfQorCisJcHVibGljIHN0
YXRpYyBUZXN0IHN1aXRlKCkgeworCQlyZXR1cm4gY3JlYXRlU3VpdGUoQVNUUmV3cml0aW5nTGFt
YmRhRXhwcmVzc2lvblRlc3QuY2xhc3MpOworCX0KKworCXB1YmxpYyB2b2lkIHRlc3RMYW1iZGFF
eHByZXNzaW9uc19zaW5jZV84KCkgdGhyb3dzIEV4Y2VwdGlvbiB7CisJCUlQYWNrYWdlRnJhZ21l
bnQgcGFjazE9IHRoaXMuc291cmNlRm9sZGVyLmNyZWF0ZVBhY2thZ2VGcmFnbWVudCgidGVzdDEi
LCBmYWxzZSwgbnVsbCk7CisJCVN0cmluZ0J1ZmZlciBidWY9IG5ldyBTdHJpbmdCdWZmZXIoKTsK
KwkJYnVmLmFwcGVuZCgicGFja2FnZSB0ZXN0MTtcbiIpOworCQlidWYuYXBwZW5kKCJpbnRlcmZh
Y2UgSSB7XG4iKTsKKwkJYnVmLmFwcGVuZCgiCWludCBmb28oaW50IHgpO1xuIik7CisJCWJ1Zi5h
cHBlbmQoIn1cbiIpOworCQlidWYuYXBwZW5kKCJpbnRlcmZhY2UgSiB7XG4iKTsKKwkJYnVmLmFw
cGVuZCgiCWludCBmb28oKTtcbiIpOworCQlidWYuYXBwZW5kKCJ9XG4iKTsKKwkJYnVmLmFwcGVu
ZCgicHVibGljIGNsYXNzIFgge1xuIik7CisJCWJ1Zi5hcHBlbmQoIiBJIGkgPSAgdmxhbWJkYSAt
PiB7cmV0dXJuIDIwMDt9O1xuIik7CisJCWJ1Zi5hcHBlbmQoIiBKIGogPSAgKCkgLT4gMTcyOTtc
biIpOworCQlidWYuYXBwZW5kKCJ9XG4iKTsKKwkJSUNvbXBpbGF0aW9uVW5pdCBjdT0gcGFjazEu
Y3JlYXRlQ29tcGlsYXRpb25Vbml0KCJYLmphdmEiLCBidWYudG9TdHJpbmcoKSwgZmFsc2UsIG51
bGwpOworCisJCUNvbXBpbGF0aW9uVW5pdCBhc3RSb290PSBjcmVhdGVBU1QoY3UpOworCQlBU1RS
ZXdyaXRlIHJld3JpdGU9IEFTVFJld3JpdGUuY3JlYXRlKGFzdFJvb3QuZ2V0QVNUKCkpOworCQlB
U1QgYXN0PSBhc3RSb290LmdldEFTVCgpOworCisJCVR5cGVEZWNsYXJhdGlvbiB0eXBlZGVjbGFy
YXRpb249IGZpbmRUeXBlRGVjbGFyYXRpb24oYXN0Um9vdCwgIkkiKTsKKworCQl7IC8vIGNoYW5n
ZSByZXR1cm4gdHlwZQorCQkJTWV0aG9kRGVjbGFyYXRpb24gbWV0aG9kRGVjbD0gZmluZE1ldGhv
ZERlY2xhcmF0aW9uKHR5cGVkZWNsYXJhdGlvbiwgImZvbyIpOworCQkJYXNzZXJ0VHJ1ZSgibnVs
bCByZXR1cm4gdHlwZTogZm9vIiwgbWV0aG9kRGVjbC5nZXRSZXR1cm5UeXBlMigpICE9IG51bGwp
OworCisJCQlUeXBlIHJldHVyblR5cGU9IG1ldGhvZERlY2wuZ2V0UmV0dXJuVHlwZTIoKTsKKwkJ
CVR5cGUgbmV3UmV0dXJuVHlwZT0gYXN0Um9vdC5nZXRBU1QoKS5uZXdQcmltaXRpdmVUeXBlKFBy
aW1pdGl2ZVR5cGUuRkxPQVQpOworCQkJcmV3cml0ZS5yZXBsYWNlKHJldHVyblR5cGUsIG5ld1Jl
dHVyblR5cGUsIG51bGwpOworCQl9CisJCXsgLy8gYWRkIGEgcGFyYW1ldGVyIHRvIHRoZSBzaW5n
bGV0b24gZnVuY3Rpb24gaW4gdGhlIGludGVyZmFjZS4KKwkJCU1ldGhvZERlY2xhcmF0aW9uIG1l
dGhvZERlY2w9IGZpbmRNZXRob2REZWNsYXJhdGlvbih0eXBlZGVjbGFyYXRpb24sICJmb28iKTsK
KwkJCUxpc3QgcGFyYW1ldGVycz0gbWV0aG9kRGVjbC5wYXJhbWV0ZXJzKCk7CisJCQlhc3NlcnRU
cnVlKCJtdXN0IGJlIDEgcGFyYW1ldGVyIiwgcGFyYW1ldGVycy5zaXplKCkgPT0gMSk7CisKKwkJ
CVNpbmdsZVZhcmlhYmxlRGVjbGFyYXRpb24gZGVjbD0gYXN0Lm5ld1NpbmdsZVZhcmlhYmxlRGVj
bGFyYXRpb24oKTsKKwkJCWRlY2wuc2V0VHlwZShhc3QubmV3UHJpbWl0aXZlVHlwZShQcmltaXRp
dmVUeXBlLklOVCkpOworCQkJZGVjbC5zZXROYW1lKGFzdC5uZXdTaW1wbGVOYW1lKCJ5IikpOwor
CQkJcmV3cml0ZS5nZXRMaXN0UmV3cml0ZShtZXRob2REZWNsLCBNZXRob2REZWNsYXJhdGlvbi5Q
QVJBTUVURVJTX1BST1BFUlRZKS5pbnNlcnRMYXN0KGRlY2wsIG51bGwpOworCQl9CisKKwkJeyAv
LyBpbnNlcnQgYSBwYXJhbWV0ZXIKKwkJCXR5cGVkZWNsYXJhdGlvbj0gZmluZFR5cGVEZWNsYXJh
dGlvbihhc3RSb290LCAiSiIpOworCQkJTWV0aG9kRGVjbGFyYXRpb24gbWV0aG9kRGVjbCA9IGZp
bmRNZXRob2REZWNsYXJhdGlvbih0eXBlZGVjbGFyYXRpb24sICJmb28iKTsKKwkJCUxpc3QgcGFy
YW1ldGVycyA9IG1ldGhvZERlY2wucGFyYW1ldGVycygpOworCQkJYXNzZXJ0VHJ1ZSgibXVzdCBi
ZSAwIHBhcmFtZXRlcnMiLCBwYXJhbWV0ZXJzLnNpemUoKSA9PSAwKTsKKworCQkJU2luZ2xlVmFy
aWFibGVEZWNsYXJhdGlvbiBuZXdQYXJhbT0gYXN0Lm5ld1NpbmdsZVZhcmlhYmxlRGVjbGFyYXRp
b24oKTsKKwkJCW5ld1BhcmFtLnNldE5hbWUoYXN0Lm5ld1NpbXBsZU5hbWUoIngiKSk7CisJCQlu
ZXdQYXJhbS5zZXRUeXBlKGFzdC5uZXdQcmltaXRpdmVUeXBlKFByaW1pdGl2ZVR5cGUuSU5UKSk7
CisJCQlyZXdyaXRlLmdldExpc3RSZXdyaXRlKG1ldGhvZERlY2wsIE1ldGhvZERlY2xhcmF0aW9u
LlBBUkFNRVRFUlNfUFJPUEVSVFkpLmluc2VydEZpcnN0KG5ld1BhcmFtLCBudWxsKTsKKwkJfQor
CisJCXR5cGVkZWNsYXJhdGlvbj0gZmluZFR5cGVEZWNsYXJhdGlvbihhc3RSb290LCAiWCIpOwor
CQlGaWVsZERlY2xhcmF0aW9uIGZpZWxkRGVjbGFyYXRpb24gPSAoRmllbGREZWNsYXJhdGlvbikg
dHlwZWRlY2xhcmF0aW9uLmJvZHlEZWNsYXJhdGlvbnMoKS5nZXQoMCk7CisJCVZhcmlhYmxlRGVj
bGFyYXRpb25GcmFnbWVudCBmcmFnbWVudCA9IChWYXJpYWJsZURlY2xhcmF0aW9uRnJhZ21lbnQp
ZmllbGREZWNsYXJhdGlvbi5mcmFnbWVudHMoKS5nZXQoMCk7CisJCUV4cHJlc3Npb24gZXhwcmVz
c2lvbiA9IGZyYWdtZW50LmdldEluaXRpYWxpemVyKCk7CisJCWFzc2VydFRydWUoZXhwcmVzc2lv
biBpbnN0YW5jZW9mIExhbWJkYUV4cHJlc3Npb24pOworCQlMYW1iZGFFeHByZXNzaW9uIGxhbWJk
YUV4cHJlc3Npb24gPSAoTGFtYmRhRXhwcmVzc2lvbilleHByZXNzaW9uOworCQkKKwkJey8vIGFk
ZCBhIHBhcmFtZXRlciB0byB0aGUgbGFtYmRhIGV4cHJlc3Npb24KKwkJCUxpc3QgcGFyYW1ldGVy
cz0gbGFtYmRhRXhwcmVzc2lvbi5wYXJhbWV0ZXJzKCk7CisJCQlhc3NlcnRUcnVlKCJtdXN0IGJl
IDEgcGFyYW1ldGVyIiwgcGFyYW1ldGVycy5zaXplKCkgPT0gMSk7CisJCQlBU1ROb2RlIGZpcnN0
UGFyYW09IChBU1ROb2RlKSBwYXJhbWV0ZXJzLmdldCgwKTsKKwkJCVZhcmlhYmxlRGVjbGFyYXRp
b25GcmFnbWVudCBuZXdQYXJhbT0gYXN0Lm5ld1ZhcmlhYmxlRGVjbGFyYXRpb25GcmFnbWVudCgp
OworCQkJbmV3UGFyYW0uc2V0TmFtZShhc3QubmV3U2ltcGxlTmFtZSgid2xhbWJkYSIpKTsKKwkJ
CXJld3JpdGUuZ2V0TGlzdFJld3JpdGUobGFtYmRhRXhwcmVzc2lvbiwgTGFtYmRhRXhwcmVzc2lv
bi5QQVJBTUVURVJTX1BST1BFUlRZKS5pbnNlcnRBZnRlcihuZXdQYXJhbSwgZmlyc3RQYXJhbSwg
bnVsbCk7CQkKKwkJfQorCQkKKwkJey8vIHJlcGxhY2UgdGhlIGJsb2NrIGJvZHkgd2l0aCBhIGZs
b2F0IGxpdGVyYWwgZXhwcmVzc2lvbiBib2R5LgorCQkJQVNUTm9kZSBib2R5ID0gbGFtYmRhRXhw
cmVzc2lvbi5nZXRCb2R5KCk7CisJCQlBU1ROb2RlIG5ld0JvZHkgPSBhc3QubmV3TnVtYmVyTGl0
ZXJhbCgiMy4xNCIpOworCQkJcmV3cml0ZS5yZXBsYWNlKGJvZHksIG5ld0JvZHksIG51bGwpOwor
CQl9CisKKwkJZmllbGREZWNsYXJhdGlvbiA9IChGaWVsZERlY2xhcmF0aW9uKSB0eXBlZGVjbGFy
YXRpb24uYm9keURlY2xhcmF0aW9ucygpLmdldCgxKTsKKwkJZnJhZ21lbnQgPSAoVmFyaWFibGVE
ZWNsYXJhdGlvbkZyYWdtZW50KWZpZWxkRGVjbGFyYXRpb24uZnJhZ21lbnRzKCkuZ2V0KDApOwor
CQlleHByZXNzaW9uID0gZnJhZ21lbnQuZ2V0SW5pdGlhbGl6ZXIoKTsKKwkJYXNzZXJ0VHJ1ZShl
eHByZXNzaW9uIGluc3RhbmNlb2YgTGFtYmRhRXhwcmVzc2lvbik7CisJCWxhbWJkYUV4cHJlc3Np
b24gPSAoTGFtYmRhRXhwcmVzc2lvbilleHByZXNzaW9uOworCQkKKwkJey8vIGFkZCBhIHBhcmFt
ZXRlciB0byB0aGUgbGFtYmRhIGV4cHJlc3Npb24gLSBib3JkZXIgY2FzZSAtIGVtcHR5IGxpc3Qg
aW5pdGlhbGx5CisJCQlMaXN0IHBhcmFtZXRlcnM9IGxhbWJkYUV4cHJlc3Npb24ucGFyYW1ldGVy
cygpOworCQkJYXNzZXJ0VHJ1ZSgibXVzdCBiZSAwIHBhcmFtZXRlciIsIHBhcmFtZXRlcnMuc2l6
ZSgpID09IDApOworCQkJVmFyaWFibGVEZWNsYXJhdGlvbkZyYWdtZW50IG5ld1BhcmFtPSBhc3Qu
bmV3VmFyaWFibGVEZWNsYXJhdGlvbkZyYWdtZW50KCk7CisJCQluZXdQYXJhbS5zZXROYW1lKGFz
dC5uZXdTaW1wbGVOYW1lKCJ2bGFtYmRhIikpOworCQkJcmV3cml0ZS5nZXRMaXN0UmV3cml0ZShs
YW1iZGFFeHByZXNzaW9uLCBMYW1iZGFFeHByZXNzaW9uLlBBUkFNRVRFUlNfUFJPUEVSVFkpLmlu
c2VydEZpcnN0KG5ld1BhcmFtLCBudWxsKTsJCQorCQl9CisJCVN0cmluZyBwcmV2aWV3PSBldmFs
dWF0ZVJld3JpdGUoY3UsIHJld3JpdGUpOworCisJCWJ1Zj0gbmV3IFN0cmluZ0J1ZmZlcigpOwor
CQlidWYuYXBwZW5kKCJwYWNrYWdlIHRlc3QxO1xuIik7CisJCWJ1Zi5hcHBlbmQoImludGVyZmFj
ZSBJIHtcbiIpOworCQlidWYuYXBwZW5kKCIJZmxvYXQgZm9vKGludCB4LCBpbnQgeSk7XG4iKTsK
KwkJYnVmLmFwcGVuZCgifVxuIik7CisJCWJ1Zi5hcHBlbmQoImludGVyZmFjZSBKIHtcbiIpOwor
CQlidWYuYXBwZW5kKCIJaW50IGZvbyhpbnQgeCk7XG4iKTsKKwkJYnVmLmFwcGVuZCgifVxuIik7
CisJCWJ1Zi5hcHBlbmQoInB1YmxpYyBjbGFzcyBYIHtcbiIpOworCQlidWYuYXBwZW5kKCIgSSBp
ID0gICh2bGFtYmRhLCB3bGFtYmRhKSAtPiAzLjE0O1xuIik7CisJCWJ1Zi5hcHBlbmQoIiBKIGog
PSAgKHZsYW1iZGEpIC0+IDE3Mjk7XG4iKTsKKwkJYnVmLmFwcGVuZCgifVxuIik7CisJCWFzc2Vy
dEVxdWFsU3RyaW5nKHByZXZpZXcsIGJ1Zi50b1N0cmluZygpKTsKKwl9CisJCisJcHVibGljIHZv
aWQgdGVzdExhbWJkYUV4cHJlc3Npb25zX1BhcmVudGhlc2VzX3NpbmNlXzgoKSB0aHJvd3MgRXhj
ZXB0aW9uIHsKKwkJSVBhY2thZ2VGcmFnbWVudCBwYWNrMT0gdGhpcy5zb3VyY2VGb2xkZXIuY3Jl
YXRlUGFja2FnZUZyYWdtZW50KCJ0ZXN0MSIsIGZhbHNlLCBudWxsKTsKKwkJU3RyaW5nQnVmZmVy
IGJ1Zj0gbmV3IFN0cmluZ0J1ZmZlcigpOworCQlidWYuYXBwZW5kKCJwYWNrYWdlIHRlc3QxO1xu
Iik7CisJCWJ1Zi5hcHBlbmQoImludGVyZmFjZSBJIHtcbiIpOworCQlidWYuYXBwZW5kKCIJaW50
IGZvbyhpbnQgeCk7XG4iKTsKKwkJYnVmLmFwcGVuZCgifVxuIik7CisJCWJ1Zi5hcHBlbmQoImlu
dGVyZmFjZSBKIHtcbiIpOworCQlidWYuYXBwZW5kKCIJaW50IGZvbygpO1xuIik7CisJCWJ1Zi5h
cHBlbmQoIn1cbiIpOworCQlidWYuYXBwZW5kKCJpbnRlcmZhY2UgSyB7XG4iKTsKKwkJYnVmLmFw
cGVuZCgiCWludCBmb28oaW50IHgsIGludCB5KTtcbiIpOworCQlidWYuYXBwZW5kKCJ9XG4iKTsK
KwkJYnVmLmFwcGVuZCgiaW50ZXJmYWNlIEwge1xuIik7CisJCWJ1Zi5hcHBlbmQoIglpbnQgZm9v
KGludCB4KTtcbiIpOworCQlidWYuYXBwZW5kKCJ9XG4iKTsKKwkJYnVmLmFwcGVuZCgicHVibGlj
IGNsYXNzIFgge1xuIik7CisJCWJ1Zi5hcHBlbmQoIiBJIGkgPSAgdmxhbWJkYSAtPiAyMjEyMTg4
NztcbiIpOworCQlidWYuYXBwZW5kKCIgSSBpZGFzaCA9ICAodmxhbWJkYSkgLT4gMTcyOTtcbiIp
OworCQlidWYuYXBwZW5kKCIgSiBqID0gICgpIC0+IDI2MDQxOTIwO1xuIik7CisJCWJ1Zi5hcHBl
bmQoIiBLIGsgPSAgKHgsIHkpIC0+IDE3Mjk7XG4iKTsKKwkJYnVmLmFwcGVuZCgiIEsga2Rhc2gg
PSAgKGludCB4LCBpbnQgeSkgLT4gMTcyOTtcbiIpOworCQlidWYuYXBwZW5kKCIgTCBsID0gIHZs
YW1iZGEgLT4gMTcyOTtcbiIpOworCQlidWYuYXBwZW5kKCIgTCBsZGFzaCA9ICAodmxhbWJkYSkg
LT4gMTcyOTtcbiIpOworCQlidWYuYXBwZW5kKCIgSyBra2Rhc2ggPSAgKGludCB4LCBpbnQgeSkg
LT4gMTcyOTtcbiIpOworCQlidWYuYXBwZW5kKCJ9XG4iKTsKKwkJSUNvbXBpbGF0aW9uVW5pdCBj
dT0gcGFjazEuY3JlYXRlQ29tcGlsYXRpb25Vbml0KCJYLmphdmEiLCBidWYudG9TdHJpbmcoKSwg
ZmFsc2UsIG51bGwpOworCisJCUNvbXBpbGF0aW9uVW5pdCBhc3RSb290PSBjcmVhdGVBU1QoY3Up
OworCQlBU1RSZXdyaXRlIHJld3JpdGU9IEFTVFJld3JpdGUuY3JlYXRlKGFzdFJvb3QuZ2V0QVNU
KCkpOworCQlBU1QgYXN0PSBhc3RSb290LmdldEFTVCgpOworCisJCXsgLy8gcmVtb3ZlIGEgcGFy
YW1ldGVyCisJCQlUeXBlRGVjbGFyYXRpb24gdHlwZWRlY2xhcmF0aW9uPSBmaW5kVHlwZURlY2xh
cmF0aW9uKGFzdFJvb3QsICJMIik7CisJCQlNZXRob2REZWNsYXJhdGlvbiBtZXRob2REZWNsID0g
ZmluZE1ldGhvZERlY2xhcmF0aW9uKHR5cGVkZWNsYXJhdGlvbiwgImZvbyIpOworCQkJTGlzdCBw
YXJhbWV0ZXJzID0gbWV0aG9kRGVjbC5wYXJhbWV0ZXJzKCk7CisJCQlhc3NlcnRUcnVlKCJtdXN0
IGJlIDEgcGFyYW1ldGVyIiwgcGFyYW1ldGVycy5zaXplKCkgPT0gMSk7CisJCQlBU1ROb2RlIHBh
cmFtID0gKEFTVE5vZGUpIHBhcmFtZXRlcnMuZ2V0KDApOworCQkJcmV3cml0ZS5nZXRMaXN0UmV3
cml0ZShtZXRob2REZWNsLCBNZXRob2REZWNsYXJhdGlvbi5QQVJBTUVURVJTX1BST1BFUlRZKS5y
ZW1vdmUocGFyYW0sIG51bGwpOworCQl9CisKKwkJaW50IGZDb3VudCA9IDA7CisKKwkJVHlwZURl
Y2xhcmF0aW9uIHR5cGVkZWNsYXJhdGlvbj0gZmluZFR5cGVEZWNsYXJhdGlvbihhc3RSb290LCAi
WCIpOworCQlGaWVsZERlY2xhcmF0aW9uIGZpZWxkRGVjbGFyYXRpb24gPSAoRmllbGREZWNsYXJh
dGlvbikgdHlwZWRlY2xhcmF0aW9uLmJvZHlEZWNsYXJhdGlvbnMoKS5nZXQoZkNvdW50KyspOwor
CQlWYXJpYWJsZURlY2xhcmF0aW9uRnJhZ21lbnQgZnJhZ21lbnQgPSAoVmFyaWFibGVEZWNsYXJh
dGlvbkZyYWdtZW50KWZpZWxkRGVjbGFyYXRpb24uZnJhZ21lbnRzKCkuZ2V0KDApOworCQlMYW1i
ZGFFeHByZXNzaW9uIGxhbWJkYUV4cHJlc3Npb24gPSAoTGFtYmRhRXhwcmVzc2lvbilmcmFnbWVu
dC5nZXRJbml0aWFsaXplcigpOworCQkKKwkJey8vIHNldCBwYXJlbnRoZXNlcworCQkJYXNzZXJ0
VHJ1ZSgibGFtYmRhIGV4cHJlc3Npb24gaGFzIHBhcmFudGhlc2VzIiwgbGFtYmRhRXhwcmVzc2lv
bi5oYXNQYXJlbnRoZXNlcygpID09IGZhbHNlKTsKKwkJCXJld3JpdGUuc2V0KGxhbWJkYUV4cHJl
c3Npb24sIExhbWJkYUV4cHJlc3Npb24uUEFSRU5USEVTRVNfUFJPUEVSVFksIEJvb2xlYW4uVFJV
RSwgbnVsbCk7CisJCX0KKwkJCisJCWZpZWxkRGVjbGFyYXRpb24gPSAoRmllbGREZWNsYXJhdGlv
bikgdHlwZWRlY2xhcmF0aW9uLmJvZHlEZWNsYXJhdGlvbnMoKS5nZXQoZkNvdW50KyspOworCQlm
cmFnbWVudCA9IChWYXJpYWJsZURlY2xhcmF0aW9uRnJhZ21lbnQpZmllbGREZWNsYXJhdGlvbi5m
cmFnbWVudHMoKS5nZXQoMCk7CisJCWxhbWJkYUV4cHJlc3Npb24gPSAoTGFtYmRhRXhwcmVzc2lv
bilmcmFnbWVudC5nZXRJbml0aWFsaXplcigpOworCQkKKwkJey8vIHJlc2V0IHBhcmVudGhlc2Vz
IC0gYSBsZWdhbCBvcGVyYXRpb24gaGVyZS4KKwkJCWFzc2VydFRydWUoImxhbWJkYSBleHByZXNz
aW9uIGhhcyBwYXJhbnRoZXNlcyIsIGxhbWJkYUV4cHJlc3Npb24uaGFzUGFyZW50aGVzZXMoKSA9
PSB0cnVlKTsKKwkJCXJld3JpdGUuc2V0KGxhbWJkYUV4cHJlc3Npb24sIExhbWJkYUV4cHJlc3Np
b24uUEFSRU5USEVTRVNfUFJPUEVSVFksIEJvb2xlYW4uRkFMU0UsIG51bGwpOworCQl9CisJCQor
CQlmaWVsZERlY2xhcmF0aW9uID0gKEZpZWxkRGVjbGFyYXRpb24pIHR5cGVkZWNsYXJhdGlvbi5i
b2R5RGVjbGFyYXRpb25zKCkuZ2V0KGZDb3VudCsrKTsKKwkJZnJhZ21lbnQgPSAoVmFyaWFibGVE
ZWNsYXJhdGlvbkZyYWdtZW50KWZpZWxkRGVjbGFyYXRpb24uZnJhZ21lbnRzKCkuZ2V0KDApOwor
CQlsYW1iZGFFeHByZXNzaW9uID0gKExhbWJkYUV4cHJlc3Npb24pZnJhZ21lbnQuZ2V0SW5pdGlh
bGl6ZXIoKTsKKworCQl7Ly8gcmVzZXQgcGFyZW50aGVzZXMgLSBhbiBpbGxlZ2FsIG9wZXJhdGlv
biBoZXJlLgorCQkJYXNzZXJ0VHJ1ZSgibGFtYmRhIGV4cHJlc3Npb24gZG9lcyBub3QgaGF2ZSBw
YXJhbnRoZXNlcyIsIGxhbWJkYUV4cHJlc3Npb24uaGFzUGFyZW50aGVzZXMoKSA9PSB0cnVlKTsK
KwkJCXJld3JpdGUuc2V0KGxhbWJkYUV4cHJlc3Npb24sIExhbWJkYUV4cHJlc3Npb24uUEFSRU5U
SEVTRVNfUFJPUEVSVFksIEJvb2xlYW4uRkFMU0UsIG51bGwpOworCQl9CisKKwkJZmllbGREZWNs
YXJhdGlvbiA9IChGaWVsZERlY2xhcmF0aW9uKSB0eXBlZGVjbGFyYXRpb24uYm9keURlY2xhcmF0
aW9ucygpLmdldChmQ291bnQrKyk7CisJCWZyYWdtZW50ID0gKFZhcmlhYmxlRGVjbGFyYXRpb25G
cmFnbWVudClmaWVsZERlY2xhcmF0aW9uLmZyYWdtZW50cygpLmdldCgwKTsKKwkJbGFtYmRhRXhw
cmVzc2lvbiA9IChMYW1iZGFFeHByZXNzaW9uKWZyYWdtZW50LmdldEluaXRpYWxpemVyKCk7CisK
KwkJey8vIHJlc2V0IHBhcmVudGhlc2VzIC0gYW4gaWxsZWdhbCBvcGVyYXRpb24gaGVyZS4KKwkJ
CWFzc2VydFRydWUoImxhbWJkYSBleHByZXNzaW9uIGRvZXMgbm90IGhhdmUgcGFyYW50aGVzZXMi
LCBsYW1iZGFFeHByZXNzaW9uLmhhc1BhcmVudGhlc2VzKCkgPT0gdHJ1ZSk7CisJCQlyZXdyaXRl
LnNldChsYW1iZGFFeHByZXNzaW9uLCBMYW1iZGFFeHByZXNzaW9uLlBBUkVOVEhFU0VTX1BST1BF
UlRZLCBCb29sZWFuLkZBTFNFLCBudWxsKTsKKwkJfQorCQkKKwkJey8vIGNoYW5nZSBhbGwgdGhl
IHBhcmFtZXRlciB0byBTVkQgaWUgYWRkIHR5cGUgaW5mbyB0byB0aGUgcGFyYW1ldGVycy4KKwkJ
CUxpc3QgcGFyYW1ldGVycyA9IGxhbWJkYUV4cHJlc3Npb24ucGFyYW1ldGVycygpOworCQkJVmFy
aWFibGVEZWNsYXJhdGlvbiBwYXJhbSA9IChWYXJpYWJsZURlY2xhcmF0aW9uKXBhcmFtZXRlcnMu
Z2V0KDApOworCQkJU2luZ2xlVmFyaWFibGVEZWNsYXJhdGlvbiBuZXdQYXJhbT0gYXN0Lm5ld1Np
bmdsZVZhcmlhYmxlRGVjbGFyYXRpb24oKTsKKwkJCW5ld1BhcmFtLnNldE5hbWUoYXN0Lm5ld1Np
bXBsZU5hbWUobmV3IFN0cmluZyhwYXJhbS50b1N0cmluZygpKSkpOworCQkJbmV3UGFyYW0uc2V0
VHlwZShhc3QubmV3UHJpbWl0aXZlVHlwZShQcmltaXRpdmVUeXBlLklOVCkpOworCQkJcmV3cml0
ZS5nZXRMaXN0UmV3cml0ZShsYW1iZGFFeHByZXNzaW9uLCBMYW1iZGFFeHByZXNzaW9uLlBBUkFN
RVRFUlNfUFJPUEVSVFkpLnJlcGxhY2UocGFyYW0sIG5ld1BhcmFtLCBudWxsKTsKKwkJCQorCQkJ
cGFyYW0gPSAoVmFyaWFibGVEZWNsYXJhdGlvbilwYXJhbWV0ZXJzLmdldCgxKTsKKwkJCW5ld1Bh
cmFtPSBhc3QubmV3U2luZ2xlVmFyaWFibGVEZWNsYXJhdGlvbigpOworCQkJbmV3UGFyYW0uc2V0
TmFtZShhc3QubmV3U2ltcGxlTmFtZShuZXcgU3RyaW5nKHBhcmFtLnRvU3RyaW5nKCkpKSk7CisJ
CQluZXdQYXJhbS5zZXRUeXBlKGFzdC5uZXdQcmltaXRpdmVUeXBlKFByaW1pdGl2ZVR5cGUuSU5U
KSk7CisJCQlyZXdyaXRlLmdldExpc3RSZXdyaXRlKGxhbWJkYUV4cHJlc3Npb24sIExhbWJkYUV4
cHJlc3Npb24uUEFSQU1FVEVSU19QUk9QRVJUWSkucmVwbGFjZShwYXJhbSwgbmV3UGFyYW0sIG51
bGwpOworCQl9CisKKwkJey8vIFJlbW92ZSB0eXBlIGluZm8gZnJvbSB0aGUgcGFyYW1ldGVycy4K
KworCQkJZmllbGREZWNsYXJhdGlvbiA9IChGaWVsZERlY2xhcmF0aW9uKSB0eXBlZGVjbGFyYXRp
b24uYm9keURlY2xhcmF0aW9ucygpLmdldChmQ291bnQrKyk7CisJCQlmcmFnbWVudCA9IChWYXJp
YWJsZURlY2xhcmF0aW9uRnJhZ21lbnQpZmllbGREZWNsYXJhdGlvbi5mcmFnbWVudHMoKS5nZXQo
MCk7CisJCQlsYW1iZGFFeHByZXNzaW9uID0gKExhbWJkYUV4cHJlc3Npb24pZnJhZ21lbnQuZ2V0
SW5pdGlhbGl6ZXIoKTsKKwkJCUxpc3QgcGFyYW1ldGVycyA9IGxhbWJkYUV4cHJlc3Npb24ucGFy
YW1ldGVycygpOworCisJCQlmb3IgKGludCBpID0gMDsgaSA8IHBhcmFtZXRlcnMuc2l6ZSgpOyAr
K2kpIHsKKwkJCQlTaW5nbGVWYXJpYWJsZURlY2xhcmF0aW9uIHBhcmFtID0gKFNpbmdsZVZhcmlh
YmxlRGVjbGFyYXRpb24pcGFyYW1ldGVycy5nZXQoaSk7CisJCQkJVmFyaWFibGVEZWNsYXJhdGlv
bkZyYWdtZW50IG5ld1BhcmFtPSBhc3QubmV3VmFyaWFibGVEZWNsYXJhdGlvbkZyYWdtZW50KCk7
CisJCQkJbmV3UGFyYW0uc2V0TmFtZShhc3QubmV3U2ltcGxlTmFtZShuZXcgU3RyaW5nKHBhcmFt
LmdldE5hbWUoKS50b1N0cmluZygpKSkpOworCQkJCXJld3JpdGUuZ2V0TGlzdFJld3JpdGUobGFt
YmRhRXhwcmVzc2lvbiwgTGFtYmRhRXhwcmVzc2lvbi5QQVJBTUVURVJTX1BST1BFUlRZKS5yZXBs
YWNlKHBhcmFtLCBuZXdQYXJhbSwgbnVsbCk7CQkJCQorCQkJfQorCQl9CisKKwkJZmllbGREZWNs
YXJhdGlvbiA9IChGaWVsZERlY2xhcmF0aW9uKSB0eXBlZGVjbGFyYXRpb24uYm9keURlY2xhcmF0
aW9ucygpLmdldChmQ291bnQrKyk7CisJCWZyYWdtZW50ID0gKFZhcmlhYmxlRGVjbGFyYXRpb25G
cmFnbWVudClmaWVsZERlY2xhcmF0aW9uLmZyYWdtZW50cygpLmdldCgwKTsKKwkJbGFtYmRhRXhw
cmVzc2lvbiA9IChMYW1iZGFFeHByZXNzaW9uKWZyYWdtZW50LmdldEluaXRpYWxpemVyKCk7CisJ
CisJCXsvLyByZW1vdmUgdGhlIG9ubHkgcGFyYW1ldGVyIGFuZCB0aGUgcmV3cml0ZXIgc2hvdWxk
IGF1dG9tYXRpY2FsbHkgYWRkIHRoZSBwYXJlbnRoZXNlcworCQkJTGlzdCBwYXJhbWV0ZXJzID0g
bGFtYmRhRXhwcmVzc2lvbi5wYXJhbWV0ZXJzKCk7CisJCQlBU1ROb2RlIHBhcmFtID0gKEFTVE5v
ZGUpcGFyYW1ldGVycy5nZXQoMCk7CisJCQlyZXdyaXRlLmdldExpc3RSZXdyaXRlKGxhbWJkYUV4
cHJlc3Npb24sIExhbWJkYUV4cHJlc3Npb24uUEFSQU1FVEVSU19QUk9QRVJUWSkucmVtb3ZlKHBh
cmFtLCAgbnVsbCk7CisJCX0KKworCQlmaWVsZERlY2xhcmF0aW9uID0gKEZpZWxkRGVjbGFyYXRp
b24pIHR5cGVkZWNsYXJhdGlvbi5ib2R5RGVjbGFyYXRpb25zKCkuZ2V0KGZDb3VudCsrKTsKKwkJ
ZnJhZ21lbnQgPSAoVmFyaWFibGVEZWNsYXJhdGlvbkZyYWdtZW50KWZpZWxkRGVjbGFyYXRpb24u
ZnJhZ21lbnRzKCkuZ2V0KDApOworCQlsYW1iZGFFeHByZXNzaW9uID0gKExhbWJkYUV4cHJlc3Np
b24pZnJhZ21lbnQuZ2V0SW5pdGlhbGl6ZXIoKTsKKwkKKwkJey8vIHNldCBwYXJlbnRoZXNlcyBw
cm9wZXJ0eSB0byBudWxsIGFuZCB0aGUgcmV3cml0ZXIgc2hvdWxkIGF1dG9tYXRpY2FsbHkgYWRk
IHRoZSBwYXJlbnRoZXNlcworCQkJcmV3cml0ZS5zZXQobGFtYmRhRXhwcmVzc2lvbiwgTGFtYmRh
RXhwcmVzc2lvbi5QQVJFTlRIRVNFU19QUk9QRVJUWSwgbnVsbCwgbnVsbCk7CisJCX0KKworCQlm
aWVsZERlY2xhcmF0aW9uID0gKEZpZWxkRGVjbGFyYXRpb24pIHR5cGVkZWNsYXJhdGlvbi5ib2R5
RGVjbGFyYXRpb25zKCkuZ2V0KGZDb3VudCsrKTsKKwkJZnJhZ21lbnQgPSAoVmFyaWFibGVEZWNs
YXJhdGlvbkZyYWdtZW50KWZpZWxkRGVjbGFyYXRpb24uZnJhZ21lbnRzKCkuZ2V0KDApOworCQls
YW1iZGFFeHByZXNzaW9uID0gKExhbWJkYUV4cHJlc3Npb24pZnJhZ21lbnQuZ2V0SW5pdGlhbGl6
ZXIoKTsKKwkKKwkJey8vIHNldCBwYXJlbnRoZXNlcyBwcm9wZXJ0eSB0byBudWxsIGFuZCB0aGUg
cmV3cml0ZXIgc2hvdWxkIGF1dG9tYXRpY2FsbHkgYWRkIHRoZSBwYXJlbnRoZXNlcworCQkJcmV3
cml0ZS5zZXQobGFtYmRhRXhwcmVzc2lvbiwgTGFtYmRhRXhwcmVzc2lvbi5QQVJFTlRIRVNFU19Q
Uk9QRVJUWSwgbnVsbCwgbnVsbCk7CisKKwkJCS8vIHJlcGxhY2Ugd2l0aCBhIHZhcmlhYmxlZnJh
Z21lbnQKKwkJCUxpc3QgcGFyYW1ldGVycyA9IGxhbWJkYUV4cHJlc3Npb24ucGFyYW1ldGVycygp
OworCQkJU2luZ2xlVmFyaWFibGVEZWNsYXJhdGlvbiBwYXJhbSA9IChTaW5nbGVWYXJpYWJsZURl
Y2xhcmF0aW9uKXBhcmFtZXRlcnMuZ2V0KDEpOworCQkJVmFyaWFibGVEZWNsYXJhdGlvbkZyYWdt
ZW50IG5ld1BhcmFtPSBhc3QubmV3VmFyaWFibGVEZWNsYXJhdGlvbkZyYWdtZW50KCk7CisJCQlu
ZXdQYXJhbS5zZXROYW1lKGFzdC5uZXdTaW1wbGVOYW1lKG5ldyBTdHJpbmcocGFyYW0uZ2V0TmFt
ZSgpLnRvU3RyaW5nKCkpKSk7CisJCQlyZXdyaXRlLmdldExpc3RSZXdyaXRlKGxhbWJkYUV4cHJl
c3Npb24sIExhbWJkYUV4cHJlc3Npb24uUEFSQU1FVEVSU19QUk9QRVJUWSkucmVwbGFjZShwYXJh
bSwgbmV3UGFyYW0sIG51bGwpOwkJCQkKKworCQkJLy8gcmVtb3ZlIHRoZSBmaXJzdCBwYXJhbQor
CQkJQVNUTm9kZSBwYXJhbTAgPSAoQVNUTm9kZSlwYXJhbWV0ZXJzLmdldCgwKTsKKwkJCXJld3Jp
dGUuZ2V0TGlzdFJld3JpdGUobGFtYmRhRXhwcmVzc2lvbiwgTGFtYmRhRXhwcmVzc2lvbi5QQVJB
TUVURVJTX1BST1BFUlRZKS5yZW1vdmUocGFyYW0wLCAgbnVsbCk7CisKKwkJfQorCisJCVN0cmlu
ZyBwcmV2aWV3PSBldmFsdWF0ZVJld3JpdGUoY3UsIHJld3JpdGUpOworCisJCWJ1Zj0gbmV3IFN0
cmluZ0J1ZmZlcigpOworCQlidWYuYXBwZW5kKCJwYWNrYWdlIHRlc3QxO1xuIik7CisJCWJ1Zi5h
cHBlbmQoImludGVyZmFjZSBJIHtcbiIpOworCQlidWYuYXBwZW5kKCIJaW50IGZvbyhpbnQgeCk7
XG4iKTsKKwkJYnVmLmFwcGVuZCgifVxuIik7CisJCWJ1Zi5hcHBlbmQoImludGVyZmFjZSBKIHtc
biIpOworCQlidWYuYXBwZW5kKCIJaW50IGZvbygpO1xuIik7CisJCWJ1Zi5hcHBlbmQoIn1cbiIp
OworCQlidWYuYXBwZW5kKCJpbnRlcmZhY2UgSyB7XG4iKTsKKwkJYnVmLmFwcGVuZCgiCWludCBm
b28oaW50IHgsIGludCB5KTtcbiIpOworCQlidWYuYXBwZW5kKCJ9XG4iKTsKKwkJYnVmLmFwcGVu
ZCgiaW50ZXJmYWNlIEwge1xuIik7CisJCWJ1Zi5hcHBlbmQoIglpbnQgZm9vKCk7XG4iKTsKKwkJ
YnVmLmFwcGVuZCgifVxuIik7CisJCWJ1Zi5hcHBlbmQoInB1YmxpYyBjbGFzcyBYIHtcbiIpOwor
CQlidWYuYXBwZW5kKCIgSSBpID0gICh2bGFtYmRhKSAtPiAyMjEyMTg4NztcbiIpOworCQlidWYu
YXBwZW5kKCIgSSBpZGFzaCA9ICB2bGFtYmRhIC0+IDE3Mjk7XG4iKTsKKwkJYnVmLmFwcGVuZCgi
IEogaiA9ICAoKSAtPiAyNjA0MTkyMDtcbiIpOworCQlidWYuYXBwZW5kKCIgSyBrID0gIChpbnQg
eCwgaW50IHkpIC0+IDE3Mjk7XG4iKTsKKwkJYnVmLmFwcGVuZCgiIEsga2Rhc2ggPSAgKHgsIHkp
IC0+IDE3Mjk7XG4iKTsKKwkJYnVmLmFwcGVuZCgiIEwgbCA9ICAoKSAtPiAxNzI5O1xuIik7CisJ
CWJ1Zi5hcHBlbmQoIiBMIGxkYXNoID0gICh2bGFtYmRhKSAtPiAxNzI5O1xuIik7CisJCWJ1Zi5h
cHBlbmQoIiBLIGtrZGFzaCA9ICAoeSkgLT4gMTcyOTtcbiIpOworCQlidWYuYXBwZW5kKCJ9XG4i
KTsKKwkJYXNzZXJ0RXF1YWxTdHJpbmcocHJldmlldywgYnVmLnRvU3RyaW5nKCkpOworCX0KK30K
XCBObyBuZXdsaW5lIGF0IGVuZCBvZiBmaWxlCmRpZmYgLS1naXQgYS9vcmcuZWNsaXBzZS5qZHQu
Y29yZS50ZXN0cy5tb2RlbC9zcmMvb3JnL2VjbGlwc2UvamR0L2NvcmUvdGVzdHMvcmV3cml0ZS9k
ZXNjcmliaW5nL0FTVFJld3JpdGluZ1Rlc3QuamF2YSBiL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRl
c3RzLm1vZGVsL3NyYy9vcmcvZWNsaXBzZS9qZHQvY29yZS90ZXN0cy9yZXdyaXRlL2Rlc2NyaWJp
bmcvQVNUUmV3cml0aW5nVGVzdC5qYXZhCmluZGV4IDUxNzliYWYuLjlmMzVjZWIgMTAwNjQ0Ci0t
LSBhL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3NyYy9vcmcvZWNsaXBzZS9qZHQv
Y29yZS90ZXN0cy9yZXdyaXRlL2Rlc2NyaWJpbmcvQVNUUmV3cml0aW5nVGVzdC5qYXZhCisrKyBi
L29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3NyYy9vcmcvZWNsaXBzZS9qZHQvY29y
ZS90ZXN0cy9yZXdyaXRlL2Rlc2NyaWJpbmcvQVNUUmV3cml0aW5nVGVzdC5qYXZhCkBAIC0xMTMs
NyArMTEzLDcgQEAKIAkJc3VpdGUuYWRkVGVzdChBU1RSZXdyaXRpbmdXaXRoU3RhdGVtZW50c1Jl
Y292ZXJ5VGVzdC5zdWl0ZSgpKTsKIAkJc3VpdGUuYWRkVGVzdChBU1RSZXdyaXRlUHJvcGVydHlU
ZXN0LnN1aXRlKCkpOwogCQlzdWl0ZS5hZGRUZXN0KEFTVFJld3JpdGluZ1BhY2thZ2VEZWNsVGVz
dC5zdWl0ZSgpKTsKLQkJCisJCXN1aXRlLmFkZFRlc3QoQVNUUmV3cml0aW5nTGFtYmRhRXhwcmVz
c2lvblRlc3Quc3VpdGUoKSk7CQkKIAkJc3VpdGUuYWRkVGVzdChTb3VyY2VNb2RpZmllclRlc3Qu
c3VpdGUoKSk7CiAJCXN1aXRlLmFkZFRlc3QoSW1wb3J0UmV3cml0ZVRlc3Quc3VpdGUoKSk7CiAJ
CXJldHVybiBzdWl0ZTsKZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlL2RvbS9vcmcv
ZWNsaXBzZS9qZHQvaW50ZXJuYWwvY29yZS9kb20vcmV3cml0ZS9BU1RSZXdyaXRlQW5hbHl6ZXIu
amF2YSBiL29yZy5lY2xpcHNlLmpkdC5jb3JlL2RvbS9vcmcvZWNsaXBzZS9qZHQvaW50ZXJuYWwv
Y29yZS9kb20vcmV3cml0ZS9BU1RSZXdyaXRlQW5hbHl6ZXIuamF2YQppbmRleCA1ZGFjMTliLi5l
NDYwMmY5IDEwMDY0NAotLS0gYS9vcmcuZWNsaXBzZS5qZHQuY29yZS9kb20vb3JnL2VjbGlwc2Uv
amR0L2ludGVybmFsL2NvcmUvZG9tL3Jld3JpdGUvQVNUUmV3cml0ZUFuYWx5emVyLmphdmEKKysr
IGIvb3JnLmVjbGlwc2UuamR0LmNvcmUvZG9tL29yZy9lY2xpcHNlL2pkdC9pbnRlcm5hbC9jb3Jl
L2RvbS9yZXdyaXRlL0FTVFJld3JpdGVBbmFseXplci5qYXZhCkBAIC0yODE2LDYgKzI4MTYsODEg
QEAKIAl9CiAKIAkvKiAobm9uLUphdmFkb2MpCisJICogQHNlZSBvcmcuZWNsaXBzZS5qZHQuY29y
ZS5kb20uQVNUVmlzaXRvciN2aXNpdChMYW1iZGFFeHByZXNzaW9uKQorCSAqLworCXB1YmxpYyBi
b29sZWFuIHZpc2l0KExhbWJkYUV4cHJlc3Npb24gbm9kZSkgeworCQlpZiAoIWhhc0NoaWxkcmVu
Q2hhbmdlcyhub2RlKSkgeworCQkJcmV0dXJuIGRvVmlzaXRVbmNoYW5nZWRDaGlsZHJlbihub2Rl
KTsKKwkJfQorCQlCb29sZWFuIG5ld1ZhbHVlID0gKEJvb2xlYW4pIGdldE5ld1ZhbHVlKG5vZGUs
IExhbWJkYUV4cHJlc3Npb24uUEFSRU5USEVTRVNfUFJPUEVSVFkpOworCQlib29sZWFuIGhhc1Bh
cmVudGhlc2VzID0gKG5ld1ZhbHVlICE9IEJvb2xlYW4uRkFMU0UpOy8vIHRoaXMgdGFrZXMgY2Fy
ZSBvZiB0aGUgbnVsbCBjYXNlIGFzIHdlbGwKKwkJaWYgKCFoYXNQYXJlbnRoZXNlcykgey8vIFBh
cmVudGhlc2VzIGNhbiBiZSBhYnNlbnQgaWYgYW5kIG9ubHkgaWYgdGhlcmUgaXMgb25lIGFuZCBv
bmx5IG9uZSB0eXBlIGVsaWRlZCBwYXJhbWV0ZXIuCisJCQlMaXN0IHBhcmFtZXRlcnMgPSAoTGlz
dCkgZ2V0TmV3VmFsdWUobm9kZSwgTGFtYmRhRXhwcmVzc2lvbi5QQVJBTUVURVJTX1BST1BFUlRZ
KTsKKwkJCVZhcmlhYmxlRGVjbGFyYXRpb24gdmFyRGVjbCA9IHBhcmFtZXRlcnMuc2l6ZSgpID09
IDEgPyAoVmFyaWFibGVEZWNsYXJhdGlvbikgcGFyYW1ldGVycy5nZXQoMCkgOiBudWxsOworCQkJ
aGFzUGFyZW50aGVzZXMgPSAhKHZhckRlY2wgaW5zdGFuY2VvZiBWYXJpYWJsZURlY2xhcmF0aW9u
RnJhZ21lbnQpOworCQl9CisKKwkJYm9vbGVhbiBkZWxldGVQYXJlbnRoZXNlcyA9IGZhbHNlOwor
CQlib29sZWFuIGluc2VydFBhcmVudGhlc2VzID0gZmFsc2U7CisJCVRleHRFZGl0R3JvdXAgZWRp
dEdyb3VwID0gbnVsbDsKKworCQlib29sZWFuIG9sZEhhc1BhcmVudGhlc2VzID0gZ2V0T3JpZ2lu
YWxWYWx1ZShub2RlLCBMYW1iZGFFeHByZXNzaW9uLlBBUkVOVEhFU0VTX1BST1BFUlRZKS5lcXVh
bHMoQm9vbGVhbi5UUlVFKTsKKwkJUmV3cml0ZUV2ZW50IGV2ZW50ID0gZ2V0RXZlbnQobm9kZSwg
TGFtYmRhRXhwcmVzc2lvbi5QQVJFTlRIRVNFU19QUk9QRVJUWSk7CisJCWlmIChldmVudCAhPSBu
dWxsKSB7CisJCQllZGl0R3JvdXAgPSBnZXRFZGl0R3JvdXAoZXZlbnQpOworCQkJaWYgKGV2ZW50
LmdldENoYW5nZUtpbmQoKSA9PSBSZXdyaXRlRXZlbnQuUkVQTEFDRUQpIHsKKwkJCQlpZiAobmV3
VmFsdWUgIT0gQm9vbGVhbi5GQUxTRSkgeworCQkJCQlpbnNlcnRQYXJlbnRoZXNlcyA9IHRydWU7
CisJCQkJfSBlbHNlIHsvLyBhcHBseSB0aGUgc3RyaWN0ZXIgY2hlY2sgZm9yIHBhcmVudGhlc2Vz
IGRlbGV0aW9uCisJCQkJCWRlbGV0ZVBhcmVudGhlc2VzID0gIWhhc1BhcmVudGhlc2VzOworCQkJ
CX0KKwkJCX0KKwkJfSBlbHNlIGlmICghb2xkSGFzUGFyZW50aGVzZXMgJiYgaGFzUGFyZW50aGVz
ZXMpIHsvLyBwYXJhbWV0ZXIgcHJvcGVydHkgY2hhbmdlZCB0byBlZmZlY3QgcGFyZW50aGVzZXMg
aW5zZXJ0aW9uCisJCQlpZiAoKGV2ZW50ID0gZ2V0RXZlbnQobm9kZSwgTGFtYmRhRXhwcmVzc2lv
bi5QQVJBTUVURVJTX1BST1BFUlRZKSkgIT0gbnVsbCkgey8vIGEgbnVsbCBjaGVjayB0aG91Z2gg
ZXZlbnQgY2Fubm90IGJlIG51bGwgaGVyZQorCQkJCWVkaXRHcm91cCA9IGdldEVkaXRHcm91cChl
dmVudCk7CisJCQkJaW5zZXJ0UGFyZW50aGVzZXMgPSB0cnVlOworCQkJfQorCQl9CisJCQorCQlp
bnQgcG9zID0gbm9kZS5nZXRTdGFydFBvc2l0aW9uKCk7CisJCWlmIChpbnNlcnRQYXJlbnRoZXNl
cykgeworCQkJZG9UZXh0SW5zZXJ0KHBvcywgIigiLCBlZGl0R3JvdXApOyAvLyROT04tTkxTLTEk
CisJCX0gZWxzZSBpZiAoZGVsZXRlUGFyZW50aGVzZXMpIHsKKwkJCXRyeSB7CisJCQkJaW50IGxw
YXJlbnNFbmQgPSBnZXRTY2FubmVyKCkuZ2V0VG9rZW5FbmRPZmZzZXQoVGVybWluYWxUb2tlbnMu
VG9rZW5OYW1lTFBBUkVOLCBwb3MpOworCQkJCWRvVGV4dFJlbW92ZShwb3MsIGxwYXJlbnNFbmQg
LSBwb3MsIGVkaXRHcm91cCk7CisJCQkJcG9zID0gbHBhcmVuc0VuZDsKKwkJCX0gY2F0Y2ggKENv
cmVFeGNlcHRpb24gZSkgeworCQkJCWhhbmRsZUV4Y2VwdGlvbihlKTsKKwkJCX0KKwkJfQorCisJ
CWlmIChpc0NoYW5nZWQobm9kZSwgTGFtYmRhRXhwcmVzc2lvbi5QQVJBTUVURVJTX1BST1BFUlRZ
KSkgeworCQkJdHJ5IHsKKwkJCQlwb3MgPSBvbGRIYXNQYXJlbnRoZXNlcyA/IGdldFNjYW5uZXIo
KS5nZXRUb2tlbkVuZE9mZnNldChUZXJtaW5hbFRva2Vucy5Ub2tlbk5hbWVMUEFSRU4sIHBvcykg
OiBwb3M7CisJCQkJcG9zID0gcmV3cml0ZU5vZGVMaXN0KG5vZGUsIExhbWJkYUV4cHJlc3Npb24u
UEFSQU1FVEVSU19QUk9QRVJUWSwgcG9zLCBVdGlsLkVNUFRZX1NUUklORywgIiwgIik7IC8vJE5P
Ti1OTFMtMSQKKwkJCX0gY2F0Y2ggKENvcmVFeGNlcHRpb24gZSkgeworCQkJCWhhbmRsZUV4Y2Vw
dGlvbihlKTsKKwkJCX0KKwkJfSBlbHNlIHsKKwkJCXBvcyA9IGRvVmlzaXQobm9kZSwgTGFtYmRh
RXhwcmVzc2lvbi5QQVJBTUVURVJTX1BST1BFUlRZLCBwb3MpOworCQl9CisKKwkJaWYgKGluc2Vy
dFBhcmVudGhlc2VzKSB7CisJCQlkb1RleHRJbnNlcnQocG9zLCAiKSIsIGVkaXRHcm91cCk7IC8v
JE5PTi1OTFMtMSQKKwkJfSBlbHNlIGlmIChkZWxldGVQYXJlbnRoZXNlcykgeworCQkJdHJ5IHsK
KwkJCQlkb1RleHRSZW1vdmUocG9zLCBnZXRTY2FubmVyKCkuZ2V0VG9rZW5FbmRPZmZzZXQoVGVy
bWluYWxUb2tlbnMuVG9rZW5OYW1lUlBBUkVOLCBwb3MpIC0gcG9zLCBlZGl0R3JvdXApOworCQkJ
fSBjYXRjaCAoQ29yZUV4Y2VwdGlvbiBlKSB7CisJCQkJaGFuZGxlRXhjZXB0aW9uKGUpOworCQkJ
fQorCQl9CisJCXJld3JpdGVSZXF1aXJlZE5vZGUobm9kZSwgTGFtYmRhRXhwcmVzc2lvbi5CT0RZ
X1BST1BFUlRZKTsKKworCQlyZXR1cm4gZmFsc2U7CisJfQorCisJLyogKG5vbi1KYXZhZG9jKQog
CSAqIEBzZWUgb3JnLmVjbGlwc2UuamR0LmNvcmUuZG9tLkFTVFZpc2l0b3IjdmlzaXQoTWV0aG9k
SW52b2NhdGlvbikKIAkgKi8KIAlwdWJsaWMgYm9vbGVhbiB2aXNpdChNZXRob2RJbnZvY2F0aW9u
IG5vZGUpIHsKZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlL2RvbS9vcmcvZWNsaXBz
ZS9qZHQvaW50ZXJuYWwvY29yZS9kb20vcmV3cml0ZS9BU1RSZXdyaXRlRmxhdHRlbmVyLmphdmEg
Yi9vcmcuZWNsaXBzZS5qZHQuY29yZS9kb20vb3JnL2VjbGlwc2UvamR0L2ludGVybmFsL2NvcmUv
ZG9tL3Jld3JpdGUvQVNUUmV3cml0ZUZsYXR0ZW5lci5qYXZhCmluZGV4IDlhMzAxNDQuLjRkZTE5
YWYgMTAwNjQ0Ci0tLSBhL29yZy5lY2xpcHNlLmpkdC5jb3JlL2RvbS9vcmcvZWNsaXBzZS9qZHQv
aW50ZXJuYWwvY29yZS9kb20vcmV3cml0ZS9BU1RSZXdyaXRlRmxhdHRlbmVyLmphdmEKKysrIGIv
b3JnLmVjbGlwc2UuamR0LmNvcmUvZG9tL29yZy9lY2xpcHNlL2pkdC9pbnRlcm5hbC9jb3JlL2Rv
bS9yZXdyaXRlL0FTVFJld3JpdGVGbGF0dGVuZXIuamF2YQpAQCAtNjUzLDYgKzY1MywyNiBAQAog
CQl0aGlzLnJlc3VsdC5hcHBlbmQoIltdIik7IC8vJE5PTi1OTFMtMSQKIAkJcmV0dXJuIGZhbHNl
OwogCX0KKworCS8qCisJICogQHNlZSBBU1RWaXNpdG9yI3Zpc2l0KExhbWJkYUV4cHJlc3Npb24p
CisJICovCisJcHVibGljIGJvb2xlYW4gdmlzaXQoTGFtYmRhRXhwcmVzc2lvbiBub2RlKSB7CisJ
CWJvb2xlYW4gaGFzUGFyZW50aGVzZXMgPSBnZXRCb29sZWFuQXR0cmlidXRlKG5vZGUsIExhbWJk
YUV4cHJlc3Npb24uUEFSRU5USEVTRVNfUFJPUEVSVFkpOworCQlMaXN0IHBhcmFtZXRlcnMgPSBn
ZXRDaGlsZExpc3Qobm9kZSwgTGFtYmRhRXhwcmVzc2lvbi5QQVJBTUVURVJTX1BST1BFUlRZKTsK
KwkJVmFyaWFibGVEZWNsYXJhdGlvbiB2YXJEZWNsID0gcGFyYW1ldGVycy5zaXplKCkgPT0gMSA/
IChWYXJpYWJsZURlY2xhcmF0aW9uKSBwYXJhbWV0ZXJzLmdldCgwKSA6IG51bGw7CisJCWhhc1Bh
cmVudGhlc2VzID0gdmFyRGVjbCBpbnN0YW5jZW9mIFZhcmlhYmxlRGVjbGFyYXRpb25GcmFnbWVu
dCA/IGhhc1BhcmVudGhlc2VzIDogdHJ1ZTsKKworCQlpZiAoaGFzUGFyZW50aGVzZXMpCisJCQl0
aGlzLnJlc3VsdC5hcHBlbmQoJygnKTsKKwkJdmlzaXRMaXN0KG5vZGUsIExhbWJkYUV4cHJlc3Np
b24uUEFSQU1FVEVSU19QUk9QRVJUWSwgU3RyaW5nLnZhbHVlT2YoJywnKSk7CisJCWlmIChoYXNQ
YXJlbnRoZXNlcykKKwkJCXRoaXMucmVzdWx0LmFwcGVuZCgnKScpOworCQl0aGlzLnJlc3VsdC5h
cHBlbmQoIi0+Iik7IC8vJE5PTi1OTFMtMSQKKwkJZ2V0Q2hpbGROb2RlKG5vZGUsIExhbWJkYUV4
cHJlc3Npb24uQk9EWV9QUk9QRVJUWSkuYWNjZXB0KHRoaXMpOworCQlyZXR1cm4gZmFsc2U7CisJ
fQorCiAJLyoKIAkgKiBAc2VlIEFTVFZpc2l0b3IjdmlzaXQoTWV0aG9kRGVjbGFyYXRpb24pCiAJ
ICov
</data>

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>229477</attachid>
            <date>2013-04-09 01:37:00 -0400</date>
            <delta_ts>2013-04-09 01:37:52 -0400</delta_ts>
            <desc>Proposed Patch</desc>
            <filename>Fix-for-Bug-402231--18ast-rewrite-Rewrite-support-fo.patch</filename>
            <type>text/plain</type>
            <size>19207</size>
            <attacher name="Manoj Palat Away Until May 11 2015">manpalat</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3NyYy9vcmcvZWNs
aXBzZS9qZHQvY29yZS90ZXN0cy9yZXdyaXRlL2Rlc2NyaWJpbmcvQVNUUmV3cml0aW5nTGFtYmRh
RXhwcmVzc2lvblRlc3QuamF2YSBiL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3Ny
Yy9vcmcvZWNsaXBzZS9qZHQvY29yZS90ZXN0cy9yZXdyaXRlL2Rlc2NyaWJpbmcvQVNUUmV3cml0
aW5nTGFtYmRhRXhwcmVzc2lvblRlc3QuamF2YQpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAw
MDAwMDAwLi5lMGFjNDZiCi0tLSAvZGV2L251bGwKKysrIGIvb3JnLmVjbGlwc2UuamR0LmNvcmUu
dGVzdHMubW9kZWwvc3JjL29yZy9lY2xpcHNlL2pkdC9jb3JlL3Rlc3RzL3Jld3JpdGUvZGVzY3Jp
YmluZy9BU1RSZXdyaXRpbmdMYW1iZGFFeHByZXNzaW9uVGVzdC5qYXZhCkBAIC0wLDAgKzEsMjg5
IEBACisvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKgorICogQ29weXJpZ2h0IChjKSAyMDEzIElCTSBD
b3Jwb3JhdGlvbiBhbmQgb3RoZXJzLgorICogQWxsIHJpZ2h0cyByZXNlcnZlZC4gVGhpcyBwcm9n
cmFtIGFuZCB0aGUgYWNjb21wYW55aW5nIG1hdGVyaWFscworICogYXJlIG1hZGUgYXZhaWxhYmxl
IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgRWNsaXBzZSBQdWJsaWMgTGljZW5zZSB2MS4wCisgKiB3
aGljaCBhY2NvbXBhbmllcyB0aGlzIGRpc3RyaWJ1dGlvbiwgYW5kIGlzIGF2YWlsYWJsZSBhdAor
ICogaHR0cDovL3d3dy5lY2xpcHNlLm9yZy9sZWdhbC9lcGwtdjEwLmh0bWwKKyAqCisgKiBUaGlz
IGlzIGFuIGltcGxlbWVudGF0aW9uIG9mIGFuIGVhcmx5LWRyYWZ0IHNwZWNpZmljYXRpb24gZGV2
ZWxvcGVkIHVuZGVyIHRoZSBKYXZhCisgKiBDb21tdW5pdHkgUHJvY2VzcyAoSkNQKSBhbmQgaXMg
bWFkZSBhdmFpbGFibGUgZm9yIHRlc3RpbmcgYW5kIGV2YWx1YXRpb24gcHVycG9zZXMKKyAqIG9u
bHkuIFRoZSBjb2RlIGlzIG5vdCBjb21wYXRpYmxlIHdpdGggYW55IHNwZWNpZmljYXRpb24gb2Yg
dGhlIEpDUC4KKyAqCisgKiBDb250cmlidXRvcnM6CisgKiAgICAgSUJNIENvcnBvcmF0aW9uIC0g
aW5pdGlhbCBBUEkgYW5kIGltcGxlbWVudGF0aW9uCisgKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8K
K3BhY2thZ2Ugb3JnLmVjbGlwc2UuamR0LmNvcmUudGVzdHMucmV3cml0ZS5kZXNjcmliaW5nOwor
CitpbXBvcnQgamF2YS51dGlsLkxpc3Q7CisKK2ltcG9ydCBqdW5pdC5mcmFtZXdvcmsuVGVzdDsK
KworaW1wb3J0IG9yZy5lY2xpcHNlLmpkdC5jb3JlLklDb21waWxhdGlvblVuaXQ7CitpbXBvcnQg
b3JnLmVjbGlwc2UuamR0LmNvcmUuSVBhY2thZ2VGcmFnbWVudDsKK2ltcG9ydCBvcmcuZWNsaXBz
ZS5qZHQuY29yZS5kb20uKjsKK2ltcG9ydCBvcmcuZWNsaXBzZS5qZHQuY29yZS5kb20ucmV3cml0
ZS5BU1RSZXdyaXRlOworCitwdWJsaWMgY2xhc3MgQVNUUmV3cml0aW5nTGFtYmRhRXhwcmVzc2lv
blRlc3QgZXh0ZW5kcyBBU1RSZXdyaXRpbmdUZXN0IHsKKworCXB1YmxpYyBBU1RSZXdyaXRpbmdM
YW1iZGFFeHByZXNzaW9uVGVzdChTdHJpbmcgbmFtZSkgeworCQlzdXBlcihuYW1lKTsKKwl9CisK
KwlwdWJsaWMgQVNUUmV3cml0aW5nTGFtYmRhRXhwcmVzc2lvblRlc3QoU3RyaW5nIG5hbWUsIGlu
dCBhcGlMZXZlbCkgeworCQlzdXBlcihuYW1lLCBhcGlMZXZlbCk7CisJfQorCisJcHVibGljIHN0
YXRpYyBUZXN0IHN1aXRlKCkgeworCQlyZXR1cm4gY3JlYXRlU3VpdGUoQVNUUmV3cml0aW5nTGFt
YmRhRXhwcmVzc2lvblRlc3QuY2xhc3MpOworCX0KKworCXB1YmxpYyB2b2lkIHRlc3RMYW1iZGFF
eHByZXNzaW9uc19zaW5jZV84KCkgdGhyb3dzIEV4Y2VwdGlvbiB7CisJCUlQYWNrYWdlRnJhZ21l
bnQgcGFjazE9IHRoaXMuc291cmNlRm9sZGVyLmNyZWF0ZVBhY2thZ2VGcmFnbWVudCgidGVzdDEi
LCBmYWxzZSwgbnVsbCk7CisJCVN0cmluZ0J1ZmZlciBidWY9IG5ldyBTdHJpbmdCdWZmZXIoKTsK
KwkJYnVmLmFwcGVuZCgicGFja2FnZSB0ZXN0MTtcbiIpOworCQlidWYuYXBwZW5kKCJpbnRlcmZh
Y2UgSSB7XG4iKTsKKwkJYnVmLmFwcGVuZCgiCWludCBmb28oaW50IHgpO1xuIik7CisJCWJ1Zi5h
cHBlbmQoIn1cbiIpOworCQlidWYuYXBwZW5kKCJpbnRlcmZhY2UgSiB7XG4iKTsKKwkJYnVmLmFw
cGVuZCgiCWludCBmb28oKTtcbiIpOworCQlidWYuYXBwZW5kKCJ9XG4iKTsKKwkJYnVmLmFwcGVu
ZCgicHVibGljIGNsYXNzIFgge1xuIik7CisJCWJ1Zi5hcHBlbmQoIiBJIGkgPSAgdmxhbWJkYSAt
PiB7cmV0dXJuIDIwMDt9O1xuIik7CisJCWJ1Zi5hcHBlbmQoIiBKIGogPSAgKCkgLT4gMTcyOTtc
biIpOworCQlidWYuYXBwZW5kKCJ9XG4iKTsKKwkJSUNvbXBpbGF0aW9uVW5pdCBjdT0gcGFjazEu
Y3JlYXRlQ29tcGlsYXRpb25Vbml0KCJYLmphdmEiLCBidWYudG9TdHJpbmcoKSwgZmFsc2UsIG51
bGwpOworCisJCUNvbXBpbGF0aW9uVW5pdCBhc3RSb290PSBjcmVhdGVBU1QoY3UpOworCQlBU1RS
ZXdyaXRlIHJld3JpdGU9IEFTVFJld3JpdGUuY3JlYXRlKGFzdFJvb3QuZ2V0QVNUKCkpOworCQlB
U1QgYXN0PSBhc3RSb290LmdldEFTVCgpOworCisJCVR5cGVEZWNsYXJhdGlvbiB0eXBlZGVjbGFy
YXRpb249IGZpbmRUeXBlRGVjbGFyYXRpb24oYXN0Um9vdCwgIkkiKTsKKworCQl7IC8vIGNoYW5n
ZSByZXR1cm4gdHlwZQorCQkJTWV0aG9kRGVjbGFyYXRpb24gbWV0aG9kRGVjbD0gZmluZE1ldGhv
ZERlY2xhcmF0aW9uKHR5cGVkZWNsYXJhdGlvbiwgImZvbyIpOworCQkJYXNzZXJ0VHJ1ZSgibnVs
bCByZXR1cm4gdHlwZTogZm9vIiwgbWV0aG9kRGVjbC5nZXRSZXR1cm5UeXBlMigpICE9IG51bGwp
OworCisJCQlUeXBlIHJldHVyblR5cGU9IG1ldGhvZERlY2wuZ2V0UmV0dXJuVHlwZTIoKTsKKwkJ
CVR5cGUgbmV3UmV0dXJuVHlwZT0gYXN0Um9vdC5nZXRBU1QoKS5uZXdQcmltaXRpdmVUeXBlKFBy
aW1pdGl2ZVR5cGUuRkxPQVQpOworCQkJcmV3cml0ZS5yZXBsYWNlKHJldHVyblR5cGUsIG5ld1Jl
dHVyblR5cGUsIG51bGwpOworCQl9CisJCXsgLy8gYWRkIGEgcGFyYW1ldGVyIHRvIHRoZSBzaW5n
bGV0b24gZnVuY3Rpb24gaW4gdGhlIGludGVyZmFjZS4KKwkJCU1ldGhvZERlY2xhcmF0aW9uIG1l
dGhvZERlY2w9IGZpbmRNZXRob2REZWNsYXJhdGlvbih0eXBlZGVjbGFyYXRpb24sICJmb28iKTsK
KwkJCUxpc3QgcGFyYW1ldGVycz0gbWV0aG9kRGVjbC5wYXJhbWV0ZXJzKCk7CisJCQlhc3NlcnRU
cnVlKCJtdXN0IGJlIDEgcGFyYW1ldGVyIiwgcGFyYW1ldGVycy5zaXplKCkgPT0gMSk7CisKKwkJ
CVNpbmdsZVZhcmlhYmxlRGVjbGFyYXRpb24gZGVjbD0gYXN0Lm5ld1NpbmdsZVZhcmlhYmxlRGVj
bGFyYXRpb24oKTsKKwkJCWRlY2wuc2V0VHlwZShhc3QubmV3UHJpbWl0aXZlVHlwZShQcmltaXRp
dmVUeXBlLklOVCkpOworCQkJZGVjbC5zZXROYW1lKGFzdC5uZXdTaW1wbGVOYW1lKCJ5IikpOwor
CQkJcmV3cml0ZS5nZXRMaXN0UmV3cml0ZShtZXRob2REZWNsLCBNZXRob2REZWNsYXJhdGlvbi5Q
QVJBTUVURVJTX1BST1BFUlRZKS5pbnNlcnRMYXN0KGRlY2wsIG51bGwpOworCQl9CisKKwkJeyAv
LyBpbnNlcnQgYSBwYXJhbWV0ZXIKKwkJCXR5cGVkZWNsYXJhdGlvbj0gZmluZFR5cGVEZWNsYXJh
dGlvbihhc3RSb290LCAiSiIpOworCQkJTWV0aG9kRGVjbGFyYXRpb24gbWV0aG9kRGVjbCA9IGZp
bmRNZXRob2REZWNsYXJhdGlvbih0eXBlZGVjbGFyYXRpb24sICJmb28iKTsKKwkJCUxpc3QgcGFy
YW1ldGVycyA9IG1ldGhvZERlY2wucGFyYW1ldGVycygpOworCQkJYXNzZXJ0VHJ1ZSgibXVzdCBi
ZSAwIHBhcmFtZXRlcnMiLCBwYXJhbWV0ZXJzLnNpemUoKSA9PSAwKTsKKworCQkJU2luZ2xlVmFy
aWFibGVEZWNsYXJhdGlvbiBuZXdQYXJhbT0gYXN0Lm5ld1NpbmdsZVZhcmlhYmxlRGVjbGFyYXRp
b24oKTsKKwkJCW5ld1BhcmFtLnNldE5hbWUoYXN0Lm5ld1NpbXBsZU5hbWUoIngiKSk7CisJCQlu
ZXdQYXJhbS5zZXRUeXBlKGFzdC5uZXdQcmltaXRpdmVUeXBlKFByaW1pdGl2ZVR5cGUuSU5UKSk7
CisJCQlyZXdyaXRlLmdldExpc3RSZXdyaXRlKG1ldGhvZERlY2wsIE1ldGhvZERlY2xhcmF0aW9u
LlBBUkFNRVRFUlNfUFJPUEVSVFkpLmluc2VydEZpcnN0KG5ld1BhcmFtLCBudWxsKTsKKwkJfQor
CisJCXR5cGVkZWNsYXJhdGlvbj0gZmluZFR5cGVEZWNsYXJhdGlvbihhc3RSb290LCAiWCIpOwor
CQlGaWVsZERlY2xhcmF0aW9uIGZpZWxkRGVjbGFyYXRpb24gPSAoRmllbGREZWNsYXJhdGlvbikg
dHlwZWRlY2xhcmF0aW9uLmJvZHlEZWNsYXJhdGlvbnMoKS5nZXQoMCk7CisJCVZhcmlhYmxlRGVj
bGFyYXRpb25GcmFnbWVudCBmcmFnbWVudCA9IChWYXJpYWJsZURlY2xhcmF0aW9uRnJhZ21lbnQp
ZmllbGREZWNsYXJhdGlvbi5mcmFnbWVudHMoKS5nZXQoMCk7CisJCUV4cHJlc3Npb24gZXhwcmVz
c2lvbiA9IGZyYWdtZW50LmdldEluaXRpYWxpemVyKCk7CisJCWFzc2VydFRydWUoZXhwcmVzc2lv
biBpbnN0YW5jZW9mIExhbWJkYUV4cHJlc3Npb24pOworCQlMYW1iZGFFeHByZXNzaW9uIGxhbWJk
YUV4cHJlc3Npb24gPSAoTGFtYmRhRXhwcmVzc2lvbilleHByZXNzaW9uOworCQkKKwkJey8vIGFk
ZCBhIHBhcmFtZXRlciB0byB0aGUgbGFtYmRhIGV4cHJlc3Npb24KKwkJCUxpc3QgcGFyYW1ldGVy
cz0gbGFtYmRhRXhwcmVzc2lvbi5wYXJhbWV0ZXJzKCk7CisJCQlhc3NlcnRUcnVlKCJtdXN0IGJl
IDEgcGFyYW1ldGVyIiwgcGFyYW1ldGVycy5zaXplKCkgPT0gMSk7CisJCQlBU1ROb2RlIGZpcnN0
UGFyYW09IChBU1ROb2RlKSBwYXJhbWV0ZXJzLmdldCgwKTsKKwkJCVZhcmlhYmxlRGVjbGFyYXRp
b25GcmFnbWVudCBuZXdQYXJhbT0gYXN0Lm5ld1ZhcmlhYmxlRGVjbGFyYXRpb25GcmFnbWVudCgp
OworCQkJbmV3UGFyYW0uc2V0TmFtZShhc3QubmV3U2ltcGxlTmFtZSgid2xhbWJkYSIpKTsKKwkJ
CXJld3JpdGUuZ2V0TGlzdFJld3JpdGUobGFtYmRhRXhwcmVzc2lvbiwgTGFtYmRhRXhwcmVzc2lv
bi5QQVJBTUVURVJTX1BST1BFUlRZKS5pbnNlcnRBZnRlcihuZXdQYXJhbSwgZmlyc3RQYXJhbSwg
bnVsbCk7CQkKKwkJfQorCQkKKwkJey8vIHJlcGxhY2UgdGhlIGJsb2NrIGJvZHkgd2l0aCBhIGZs
b2F0IGxpdGVyYWwgZXhwcmVzc2lvbiBib2R5LgorCQkJQVNUTm9kZSBib2R5ID0gbGFtYmRhRXhw
cmVzc2lvbi5nZXRCb2R5KCk7CisJCQlBU1ROb2RlIG5ld0JvZHkgPSBhc3QubmV3TnVtYmVyTGl0
ZXJhbCgiMy4xNCIpOworCQkJcmV3cml0ZS5yZXBsYWNlKGJvZHksIG5ld0JvZHksIG51bGwpOwor
CQl9CisKKwkJZmllbGREZWNsYXJhdGlvbiA9IChGaWVsZERlY2xhcmF0aW9uKSB0eXBlZGVjbGFy
YXRpb24uYm9keURlY2xhcmF0aW9ucygpLmdldCgxKTsKKwkJZnJhZ21lbnQgPSAoVmFyaWFibGVE
ZWNsYXJhdGlvbkZyYWdtZW50KWZpZWxkRGVjbGFyYXRpb24uZnJhZ21lbnRzKCkuZ2V0KDApOwor
CQlleHByZXNzaW9uID0gZnJhZ21lbnQuZ2V0SW5pdGlhbGl6ZXIoKTsKKwkJYXNzZXJ0VHJ1ZShl
eHByZXNzaW9uIGluc3RhbmNlb2YgTGFtYmRhRXhwcmVzc2lvbik7CisJCWxhbWJkYUV4cHJlc3Np
b24gPSAoTGFtYmRhRXhwcmVzc2lvbilleHByZXNzaW9uOworCQkKKwkJey8vIGFkZCBhIHBhcmFt
ZXRlciB0byB0aGUgbGFtYmRhIGV4cHJlc3Npb24gLSBib3JkZXIgY2FzZSAtIGVtcHR5IGxpc3Qg
aW5pdGlhbGx5CisJCQlMaXN0IHBhcmFtZXRlcnM9IGxhbWJkYUV4cHJlc3Npb24ucGFyYW1ldGVy
cygpOworCQkJYXNzZXJ0VHJ1ZSgibXVzdCBiZSAwIHBhcmFtZXRlciIsIHBhcmFtZXRlcnMuc2l6
ZSgpID09IDApOworCQkJVmFyaWFibGVEZWNsYXJhdGlvbkZyYWdtZW50IG5ld1BhcmFtPSBhc3Qu
bmV3VmFyaWFibGVEZWNsYXJhdGlvbkZyYWdtZW50KCk7CisJCQluZXdQYXJhbS5zZXROYW1lKGFz
dC5uZXdTaW1wbGVOYW1lKCJ2bGFtYmRhIikpOworCQkJcmV3cml0ZS5nZXRMaXN0UmV3cml0ZShs
YW1iZGFFeHByZXNzaW9uLCBMYW1iZGFFeHByZXNzaW9uLlBBUkFNRVRFUlNfUFJPUEVSVFkpLmlu
c2VydEZpcnN0KG5ld1BhcmFtLCBudWxsKTsJCQorCQl9CisJCVN0cmluZyBwcmV2aWV3PSBldmFs
dWF0ZVJld3JpdGUoY3UsIHJld3JpdGUpOworCisJCWJ1Zj0gbmV3IFN0cmluZ0J1ZmZlcigpOwor
CQlidWYuYXBwZW5kKCJwYWNrYWdlIHRlc3QxO1xuIik7CisJCWJ1Zi5hcHBlbmQoImludGVyZmFj
ZSBJIHtcbiIpOworCQlidWYuYXBwZW5kKCIJZmxvYXQgZm9vKGludCB4LCBpbnQgeSk7XG4iKTsK
KwkJYnVmLmFwcGVuZCgifVxuIik7CisJCWJ1Zi5hcHBlbmQoImludGVyZmFjZSBKIHtcbiIpOwor
CQlidWYuYXBwZW5kKCIJaW50IGZvbyhpbnQgeCk7XG4iKTsKKwkJYnVmLmFwcGVuZCgifVxuIik7
CisJCWJ1Zi5hcHBlbmQoInB1YmxpYyBjbGFzcyBYIHtcbiIpOworCQlidWYuYXBwZW5kKCIgSSBp
ID0gICh2bGFtYmRhLCB3bGFtYmRhKSAtPiAzLjE0O1xuIik7CisJCWJ1Zi5hcHBlbmQoIiBKIGog
PSAgKHZsYW1iZGEpIC0+IDE3Mjk7XG4iKTsKKwkJYnVmLmFwcGVuZCgifVxuIik7CisJCWFzc2Vy
dEVxdWFsU3RyaW5nKHByZXZpZXcsIGJ1Zi50b1N0cmluZygpKTsKKwl9CisJCisJcHVibGljIHZv
aWQgdGVzdExhbWJkYUV4cHJlc3Npb25zX1BhcmVudGhlc2VzX3NpbmNlXzgoKSB0aHJvd3MgRXhj
ZXB0aW9uIHsKKwkJSVBhY2thZ2VGcmFnbWVudCBwYWNrMT0gdGhpcy5zb3VyY2VGb2xkZXIuY3Jl
YXRlUGFja2FnZUZyYWdtZW50KCJ0ZXN0MSIsIGZhbHNlLCBudWxsKTsKKwkJU3RyaW5nQnVmZmVy
IGJ1Zj0gbmV3IFN0cmluZ0J1ZmZlcigpOworCQlidWYuYXBwZW5kKCJwYWNrYWdlIHRlc3QxO1xu
Iik7CisJCWJ1Zi5hcHBlbmQoImludGVyZmFjZSBJIHtcbiIpOworCQlidWYuYXBwZW5kKCIJaW50
IGZvbyhpbnQgeCk7XG4iKTsKKwkJYnVmLmFwcGVuZCgifVxuIik7CisJCWJ1Zi5hcHBlbmQoImlu
dGVyZmFjZSBKIHtcbiIpOworCQlidWYuYXBwZW5kKCIJaW50IGZvbygpO1xuIik7CisJCWJ1Zi5h
cHBlbmQoIn1cbiIpOworCQlidWYuYXBwZW5kKCJpbnRlcmZhY2UgSyB7XG4iKTsKKwkJYnVmLmFw
cGVuZCgiCWludCBmb28oaW50IHgsIGludCB5KTtcbiIpOworCQlidWYuYXBwZW5kKCJ9XG4iKTsK
KwkJYnVmLmFwcGVuZCgiaW50ZXJmYWNlIEwge1xuIik7CisJCWJ1Zi5hcHBlbmQoIglpbnQgZm9v
KGludCB4KTtcbiIpOworCQlidWYuYXBwZW5kKCJ9XG4iKTsKKwkJYnVmLmFwcGVuZCgicHVibGlj
IGNsYXNzIFgge1xuIik7CisJCWJ1Zi5hcHBlbmQoIiBJIGkgPSAgdmxhbWJkYSAtPiAyMjEyMTg4
NztcbiIpOworCQlidWYuYXBwZW5kKCIgSSBpZGFzaCA9ICAodmxhbWJkYSkgLT4gMTcyOTtcbiIp
OworCQlidWYuYXBwZW5kKCIgSiBqID0gICgpIC0+IDI2MDQxOTIwO1xuIik7CisJCWJ1Zi5hcHBl
bmQoIiBLIGsgPSAgKHgsIHkpIC0+IDE3Mjk7XG4iKTsKKwkJYnVmLmFwcGVuZCgiIEsga2Rhc2gg
PSAgKGludCB4LCBpbnQgeSkgLT4gMTcyOTtcbiIpOworCQlidWYuYXBwZW5kKCIgTCBsID0gIHZs
YW1iZGEgLT4gMTcyOTtcbiIpOworCQlidWYuYXBwZW5kKCJ9XG4iKTsKKwkJSUNvbXBpbGF0aW9u
VW5pdCBjdT0gcGFjazEuY3JlYXRlQ29tcGlsYXRpb25Vbml0KCJYLmphdmEiLCBidWYudG9TdHJp
bmcoKSwgZmFsc2UsIG51bGwpOworCisJCUNvbXBpbGF0aW9uVW5pdCBhc3RSb290PSBjcmVhdGVB
U1QoY3UpOworCQlBU1RSZXdyaXRlIHJld3JpdGU9IEFTVFJld3JpdGUuY3JlYXRlKGFzdFJvb3Qu
Z2V0QVNUKCkpOworCQlBU1QgYXN0PSBhc3RSb290LmdldEFTVCgpOworCisJCXsgLy8gcmVtb3Zl
IGEgcGFyYW1ldGVyCisJCQlUeXBlRGVjbGFyYXRpb24gdHlwZWRlY2xhcmF0aW9uPSBmaW5kVHlw
ZURlY2xhcmF0aW9uKGFzdFJvb3QsICJMIik7CisJCQlNZXRob2REZWNsYXJhdGlvbiBtZXRob2RE
ZWNsID0gZmluZE1ldGhvZERlY2xhcmF0aW9uKHR5cGVkZWNsYXJhdGlvbiwgImZvbyIpOworCQkJ
TGlzdCBwYXJhbWV0ZXJzID0gbWV0aG9kRGVjbC5wYXJhbWV0ZXJzKCk7CisJCQlhc3NlcnRUcnVl
KCJtdXN0IGJlIDEgcGFyYW1ldGVyIiwgcGFyYW1ldGVycy5zaXplKCkgPT0gMSk7CisJCQlBU1RO
b2RlIHBhcmFtID0gKEFTVE5vZGUpIHBhcmFtZXRlcnMuZ2V0KDApOworCQkJcmV3cml0ZS5nZXRM
aXN0UmV3cml0ZShtZXRob2REZWNsLCBNZXRob2REZWNsYXJhdGlvbi5QQVJBTUVURVJTX1BST1BF
UlRZKS5yZW1vdmUocGFyYW0sIG51bGwpOworCQl9CisKKwkJaW50IGZDb3VudCA9IDA7CisKKwkJ
VHlwZURlY2xhcmF0aW9uIHR5cGVkZWNsYXJhdGlvbj0gZmluZFR5cGVEZWNsYXJhdGlvbihhc3RS
b290LCAiWCIpOworCQlGaWVsZERlY2xhcmF0aW9uIGZpZWxkRGVjbGFyYXRpb24gPSAoRmllbGRE
ZWNsYXJhdGlvbikgdHlwZWRlY2xhcmF0aW9uLmJvZHlEZWNsYXJhdGlvbnMoKS5nZXQoZkNvdW50
KyspOworCQlWYXJpYWJsZURlY2xhcmF0aW9uRnJhZ21lbnQgZnJhZ21lbnQgPSAoVmFyaWFibGVE
ZWNsYXJhdGlvbkZyYWdtZW50KWZpZWxkRGVjbGFyYXRpb24uZnJhZ21lbnRzKCkuZ2V0KDApOwor
CQlMYW1iZGFFeHByZXNzaW9uIGxhbWJkYUV4cHJlc3Npb24gPSAoTGFtYmRhRXhwcmVzc2lvbilm
cmFnbWVudC5nZXRJbml0aWFsaXplcigpOworCQkKKwkJey8vIHNldCBwYXJlbnRoZXNlcworCQkJ
YXNzZXJ0VHJ1ZSgibGFtYmRhIGV4cHJlc3Npb24gaGFzIHBhcmFudGhlc2VzIiwgbGFtYmRhRXhw
cmVzc2lvbi5oYXNQYXJlbnRoZXNlcygpID09IGZhbHNlKTsKKwkJCXJld3JpdGUuc2V0KGxhbWJk
YUV4cHJlc3Npb24sIExhbWJkYUV4cHJlc3Npb24uUEFSRU5USEVTRVNfUFJPUEVSVFksIEJvb2xl
YW4uVFJVRSwgbnVsbCk7CisJCX0KKwkJCisJCWZpZWxkRGVjbGFyYXRpb24gPSAoRmllbGREZWNs
YXJhdGlvbikgdHlwZWRlY2xhcmF0aW9uLmJvZHlEZWNsYXJhdGlvbnMoKS5nZXQoZkNvdW50Kysp
OworCQlmcmFnbWVudCA9IChWYXJpYWJsZURlY2xhcmF0aW9uRnJhZ21lbnQpZmllbGREZWNsYXJh
dGlvbi5mcmFnbWVudHMoKS5nZXQoMCk7CisJCWxhbWJkYUV4cHJlc3Npb24gPSAoTGFtYmRhRXhw
cmVzc2lvbilmcmFnbWVudC5nZXRJbml0aWFsaXplcigpOworCQkKKwkJey8vIHJlc2V0IHBhcmVu
dGhlc2VzIC0gYSBsZWdhbCBvcGVyYXRpb24gaGVyZS4KKwkJCWFzc2VydFRydWUoImxhbWJkYSBl
eHByZXNzaW9uIGhhcyBwYXJhbnRoZXNlcyIsIGxhbWJkYUV4cHJlc3Npb24uaGFzUGFyZW50aGVz
ZXMoKSA9PSB0cnVlKTsKKwkJCXJld3JpdGUuc2V0KGxhbWJkYUV4cHJlc3Npb24sIExhbWJkYUV4
cHJlc3Npb24uUEFSRU5USEVTRVNfUFJPUEVSVFksIEJvb2xlYW4uRkFMU0UsIG51bGwpOworCQl9
CisJCQorCQlmaWVsZERlY2xhcmF0aW9uID0gKEZpZWxkRGVjbGFyYXRpb24pIHR5cGVkZWNsYXJh
dGlvbi5ib2R5RGVjbGFyYXRpb25zKCkuZ2V0KGZDb3VudCsrKTsKKwkJZnJhZ21lbnQgPSAoVmFy
aWFibGVEZWNsYXJhdGlvbkZyYWdtZW50KWZpZWxkRGVjbGFyYXRpb24uZnJhZ21lbnRzKCkuZ2V0
KDApOworCQlsYW1iZGFFeHByZXNzaW9uID0gKExhbWJkYUV4cHJlc3Npb24pZnJhZ21lbnQuZ2V0
SW5pdGlhbGl6ZXIoKTsKKworCQl7Ly8gcmVzZXQgcGFyZW50aGVzZXMgLSBhbiBpbGxlZ2FsIG9w
ZXJhdGlvbiBoZXJlLgorCQkJYXNzZXJ0VHJ1ZSgibGFtYmRhIGV4cHJlc3Npb24gZG9lcyBub3Qg
aGF2ZSBwYXJhbnRoZXNlcyIsIGxhbWJkYUV4cHJlc3Npb24uaGFzUGFyZW50aGVzZXMoKSA9PSB0
cnVlKTsKKwkJCXJld3JpdGUuc2V0KGxhbWJkYUV4cHJlc3Npb24sIExhbWJkYUV4cHJlc3Npb24u
UEFSRU5USEVTRVNfUFJPUEVSVFksIEJvb2xlYW4uRkFMU0UsIG51bGwpOworCQl9CisKKwkJZmll
bGREZWNsYXJhdGlvbiA9IChGaWVsZERlY2xhcmF0aW9uKSB0eXBlZGVjbGFyYXRpb24uYm9keURl
Y2xhcmF0aW9ucygpLmdldChmQ291bnQrKyk7CisJCWZyYWdtZW50ID0gKFZhcmlhYmxlRGVjbGFy
YXRpb25GcmFnbWVudClmaWVsZERlY2xhcmF0aW9uLmZyYWdtZW50cygpLmdldCgwKTsKKwkJbGFt
YmRhRXhwcmVzc2lvbiA9IChMYW1iZGFFeHByZXNzaW9uKWZyYWdtZW50LmdldEluaXRpYWxpemVy
KCk7CisKKwkJey8vIHJlc2V0IHBhcmVudGhlc2VzIC0gYW4gaWxsZWdhbCBvcGVyYXRpb24gaGVy
ZS4KKwkJCWFzc2VydFRydWUoImxhbWJkYSBleHByZXNzaW9uIGRvZXMgbm90IGhhdmUgcGFyYW50
aGVzZXMiLCBsYW1iZGFFeHByZXNzaW9uLmhhc1BhcmVudGhlc2VzKCkgPT0gdHJ1ZSk7CisJCQly
ZXdyaXRlLnNldChsYW1iZGFFeHByZXNzaW9uLCBMYW1iZGFFeHByZXNzaW9uLlBBUkVOVEhFU0VT
X1BST1BFUlRZLCBCb29sZWFuLkZBTFNFLCBudWxsKTsKKwkJfQorCQkKKwkJey8vIGNoYW5nZSBh
bGwgdGhlIHBhcmFtZXRlciB0byBTVkQgaWUgYWRkIHR5cGUgaW5mbyB0byB0aGUgcGFyYW1ldGVy
cy4KKwkJCUxpc3QgcGFyYW1ldGVycyA9IGxhbWJkYUV4cHJlc3Npb24ucGFyYW1ldGVycygpOwor
CQkJVmFyaWFibGVEZWNsYXJhdGlvbiBwYXJhbSA9IChWYXJpYWJsZURlY2xhcmF0aW9uKXBhcmFt
ZXRlcnMuZ2V0KDApOworCQkJU2luZ2xlVmFyaWFibGVEZWNsYXJhdGlvbiBuZXdQYXJhbT0gYXN0
Lm5ld1NpbmdsZVZhcmlhYmxlRGVjbGFyYXRpb24oKTsKKwkJCW5ld1BhcmFtLnNldE5hbWUoYXN0
Lm5ld1NpbXBsZU5hbWUobmV3IFN0cmluZyhwYXJhbS50b1N0cmluZygpKSkpOworCQkJbmV3UGFy
YW0uc2V0VHlwZShhc3QubmV3UHJpbWl0aXZlVHlwZShQcmltaXRpdmVUeXBlLklOVCkpOworCQkJ
cmV3cml0ZS5nZXRMaXN0UmV3cml0ZShsYW1iZGFFeHByZXNzaW9uLCBMYW1iZGFFeHByZXNzaW9u
LlBBUkFNRVRFUlNfUFJPUEVSVFkpLnJlcGxhY2UocGFyYW0sIG5ld1BhcmFtLCBudWxsKTsKKwkJ
CQorCQkJcGFyYW0gPSAoVmFyaWFibGVEZWNsYXJhdGlvbilwYXJhbWV0ZXJzLmdldCgxKTsKKwkJ
CW5ld1BhcmFtPSBhc3QubmV3U2luZ2xlVmFyaWFibGVEZWNsYXJhdGlvbigpOworCQkJbmV3UGFy
YW0uc2V0TmFtZShhc3QubmV3U2ltcGxlTmFtZShuZXcgU3RyaW5nKHBhcmFtLnRvU3RyaW5nKCkp
KSk7CisJCQluZXdQYXJhbS5zZXRUeXBlKGFzdC5uZXdQcmltaXRpdmVUeXBlKFByaW1pdGl2ZVR5
cGUuSU5UKSk7CisJCQlyZXdyaXRlLmdldExpc3RSZXdyaXRlKGxhbWJkYUV4cHJlc3Npb24sIExh
bWJkYUV4cHJlc3Npb24uUEFSQU1FVEVSU19QUk9QRVJUWSkucmVwbGFjZShwYXJhbSwgbmV3UGFy
YW0sIG51bGwpOworCQl9CisKKwkJey8vIFJlbW92ZSB0eXBlIGluZm8gZnJvbSB0aGUgcGFyYW1l
dGVycy4KKworCQkJZmllbGREZWNsYXJhdGlvbiA9IChGaWVsZERlY2xhcmF0aW9uKSB0eXBlZGVj
bGFyYXRpb24uYm9keURlY2xhcmF0aW9ucygpLmdldChmQ291bnQrKyk7CisJCQlmcmFnbWVudCA9
IChWYXJpYWJsZURlY2xhcmF0aW9uRnJhZ21lbnQpZmllbGREZWNsYXJhdGlvbi5mcmFnbWVudHMo
KS5nZXQoMCk7CisJCQlsYW1iZGFFeHByZXNzaW9uID0gKExhbWJkYUV4cHJlc3Npb24pZnJhZ21l
bnQuZ2V0SW5pdGlhbGl6ZXIoKTsKKwkJCUxpc3QgcGFyYW1ldGVycyA9IGxhbWJkYUV4cHJlc3Np
b24ucGFyYW1ldGVycygpOworCisJCQlmb3IgKGludCBpID0gMDsgaSA8IHBhcmFtZXRlcnMuc2l6
ZSgpOyArK2kpIHsKKwkJCQlTaW5nbGVWYXJpYWJsZURlY2xhcmF0aW9uIHBhcmFtID0gKFNpbmds
ZVZhcmlhYmxlRGVjbGFyYXRpb24pcGFyYW1ldGVycy5nZXQoaSk7CisJCQkJVmFyaWFibGVEZWNs
YXJhdGlvbkZyYWdtZW50IG5ld1BhcmFtPSBhc3QubmV3VmFyaWFibGVEZWNsYXJhdGlvbkZyYWdt
ZW50KCk7CisJCQkJbmV3UGFyYW0uc2V0TmFtZShhc3QubmV3U2ltcGxlTmFtZShuZXcgU3RyaW5n
KHBhcmFtLmdldE5hbWUoKS50b1N0cmluZygpKSkpOworCQkJCXJld3JpdGUuZ2V0TGlzdFJld3Jp
dGUobGFtYmRhRXhwcmVzc2lvbiwgTGFtYmRhRXhwcmVzc2lvbi5QQVJBTUVURVJTX1BST1BFUlRZ
KS5yZXBsYWNlKHBhcmFtLCBuZXdQYXJhbSwgbnVsbCk7CQkJCQorCQkJfQorCQl9CisKKwkJZmll
bGREZWNsYXJhdGlvbiA9IChGaWVsZERlY2xhcmF0aW9uKSB0eXBlZGVjbGFyYXRpb24uYm9keURl
Y2xhcmF0aW9ucygpLmdldChmQ291bnQrKyk7CisJCWZyYWdtZW50ID0gKFZhcmlhYmxlRGVjbGFy
YXRpb25GcmFnbWVudClmaWVsZERlY2xhcmF0aW9uLmZyYWdtZW50cygpLmdldCgwKTsKKwkJbGFt
YmRhRXhwcmVzc2lvbiA9IChMYW1iZGFFeHByZXNzaW9uKWZyYWdtZW50LmdldEluaXRpYWxpemVy
KCk7CisJCisJCXsvLyByZW1vdmUgdGhlIG9ubHkgcGFyYW1ldGVyIGFuZCB0aGUgcmV3cml0ZXIg
c2hvdWxkIGF1dG9tYXRpY2FsbHkgYWRkIHRoZSBwYXJlbnRoZXNlcworCQkJTGlzdCBwYXJhbWV0
ZXJzID0gbGFtYmRhRXhwcmVzc2lvbi5wYXJhbWV0ZXJzKCk7CisJCQlBU1ROb2RlIHBhcmFtID0g
KEFTVE5vZGUpcGFyYW1ldGVycy5nZXQoMCk7CisJCQlyZXdyaXRlLmdldExpc3RSZXdyaXRlKGxh
bWJkYUV4cHJlc3Npb24sIExhbWJkYUV4cHJlc3Npb24uUEFSQU1FVEVSU19QUk9QRVJUWSkucmVt
b3ZlKHBhcmFtLCAgbnVsbCk7CisJCX0KKworCQlTdHJpbmcgcHJldmlldz0gZXZhbHVhdGVSZXdy
aXRlKGN1LCByZXdyaXRlKTsKKworCQlidWY9IG5ldyBTdHJpbmdCdWZmZXIoKTsKKwkJYnVmLmFw
cGVuZCgicGFja2FnZSB0ZXN0MTtcbiIpOworCQlidWYuYXBwZW5kKCJpbnRlcmZhY2UgSSB7XG4i
KTsKKwkJYnVmLmFwcGVuZCgiCWludCBmb28oaW50IHgpO1xuIik7CisJCWJ1Zi5hcHBlbmQoIn1c
biIpOworCQlidWYuYXBwZW5kKCJpbnRlcmZhY2UgSiB7XG4iKTsKKwkJYnVmLmFwcGVuZCgiCWlu
dCBmb28oKTtcbiIpOworCQlidWYuYXBwZW5kKCJ9XG4iKTsKKwkJYnVmLmFwcGVuZCgiaW50ZXJm
YWNlIEsge1xuIik7CisJCWJ1Zi5hcHBlbmQoIglpbnQgZm9vKGludCB4LCBpbnQgeSk7XG4iKTsK
KwkJYnVmLmFwcGVuZCgifVxuIik7CisJCWJ1Zi5hcHBlbmQoImludGVyZmFjZSBMIHtcbiIpOwor
CQlidWYuYXBwZW5kKCIJaW50IGZvbygpO1xuIik7CisJCWJ1Zi5hcHBlbmQoIn1cbiIpOworCQli
dWYuYXBwZW5kKCJwdWJsaWMgY2xhc3MgWCB7XG4iKTsKKwkJYnVmLmFwcGVuZCgiIEkgaSA9ICAo
dmxhbWJkYSkgLT4gMjIxMjE4ODc7XG4iKTsKKwkJYnVmLmFwcGVuZCgiIEkgaWRhc2ggPSAgdmxh
bWJkYSAtPiAxNzI5O1xuIik7CisJCWJ1Zi5hcHBlbmQoIiBKIGogPSAgKCkgLT4gMjYwNDE5MjA7
XG4iKTsKKwkJYnVmLmFwcGVuZCgiIEsgayA9ICAoaW50IHgsIGludCB5KSAtPiAxNzI5O1xuIik7
CisJCWJ1Zi5hcHBlbmQoIiBLIGtkYXNoID0gICh4LCB5KSAtPiAxNzI5O1xuIik7CisJCWJ1Zi5h
cHBlbmQoIiBMIGwgPSAgKCkgLT4gMTcyOTtcbiIpOworCQlidWYuYXBwZW5kKCJ9XG4iKTsKKwkJ
YXNzZXJ0RXF1YWxTdHJpbmcocHJldmlldywgYnVmLnRvU3RyaW5nKCkpOworCX0KK30KXCBObyBu
ZXdsaW5lIGF0IGVuZCBvZiBmaWxlCmRpZmYgLS1naXQgYS9vcmcuZWNsaXBzZS5qZHQuY29yZS50
ZXN0cy5tb2RlbC9zcmMvb3JnL2VjbGlwc2UvamR0L2NvcmUvdGVzdHMvcmV3cml0ZS9kZXNjcmli
aW5nL0FTVFJld3JpdGluZ1Rlc3QuamF2YSBiL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1v
ZGVsL3NyYy9vcmcvZWNsaXBzZS9qZHQvY29yZS90ZXN0cy9yZXdyaXRlL2Rlc2NyaWJpbmcvQVNU
UmV3cml0aW5nVGVzdC5qYXZhCmluZGV4IGRhYzJhMWUuLjhiNTNkNGMgMTAwNjQ0Ci0tLSBhL29y
Zy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3NyYy9vcmcvZWNsaXBzZS9qZHQvY29yZS90
ZXN0cy9yZXdyaXRlL2Rlc2NyaWJpbmcvQVNUUmV3cml0aW5nVGVzdC5qYXZhCisrKyBiL29yZy5l
Y2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3NyYy9vcmcvZWNsaXBzZS9qZHQvY29yZS90ZXN0
cy9yZXdyaXRlL2Rlc2NyaWJpbmcvQVNUUmV3cml0aW5nVGVzdC5qYXZhCkBAIC0xMTQsNyArMTE0
LDcgQEAKIAkJc3VpdGUuYWRkVGVzdChBU1RSZXdyaXRpbmdXaXRoU3RhdGVtZW50c1JlY292ZXJ5
VGVzdC5zdWl0ZSgpKTsKIAkJc3VpdGUuYWRkVGVzdChBU1RSZXdyaXRlUHJvcGVydHlUZXN0LnN1
aXRlKCkpOwogCQlzdWl0ZS5hZGRUZXN0KEFTVFJld3JpdGluZ1BhY2thZ2VEZWNsVGVzdC5zdWl0
ZSgpKTsKLQkJCisJCXN1aXRlLmFkZFRlc3QoQVNUUmV3cml0aW5nTGFtYmRhRXhwcmVzc2lvblRl
c3Quc3VpdGUoKSk7CQkKIAkJc3VpdGUuYWRkVGVzdChTb3VyY2VNb2RpZmllclRlc3Quc3VpdGUo
KSk7CiAJCXN1aXRlLmFkZFRlc3QoSW1wb3J0UmV3cml0ZVRlc3Quc3VpdGUoKSk7CiAJCXJldHVy
biBzdWl0ZTsKZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlL2RvbS9vcmcvZWNsaXBz
ZS9qZHQvaW50ZXJuYWwvY29yZS9kb20vcmV3cml0ZS9BU1RSZXdyaXRlQW5hbHl6ZXIuamF2YSBi
L29yZy5lY2xpcHNlLmpkdC5jb3JlL2RvbS9vcmcvZWNsaXBzZS9qZHQvaW50ZXJuYWwvY29yZS9k
b20vcmV3cml0ZS9BU1RSZXdyaXRlQW5hbHl6ZXIuamF2YQppbmRleCA1ZGFjMTliLi4zY2QyM2Iz
IDEwMDY0NAotLS0gYS9vcmcuZWNsaXBzZS5qZHQuY29yZS9kb20vb3JnL2VjbGlwc2UvamR0L2lu
dGVybmFsL2NvcmUvZG9tL3Jld3JpdGUvQVNUUmV3cml0ZUFuYWx5emVyLmphdmEKKysrIGIvb3Jn
LmVjbGlwc2UuamR0LmNvcmUvZG9tL29yZy9lY2xpcHNlL2pkdC9pbnRlcm5hbC9jb3JlL2RvbS9y
ZXdyaXRlL0FTVFJld3JpdGVBbmFseXplci5qYXZhCkBAIC0yODE2LDYgKzI4MTYsODAgQEAKIAl9
CiAKIAkvKiAobm9uLUphdmFkb2MpCisJICogQHNlZSBvcmcuZWNsaXBzZS5qZHQuY29yZS5kb20u
QVNUVmlzaXRvciN2aXNpdChMYW1iZGFFeHByZXNzaW9uKQorCSAqLworCXB1YmxpYyBib29sZWFu
IHZpc2l0KExhbWJkYUV4cHJlc3Npb24gbm9kZSkgeworCQlpZiAoIWhhc0NoaWxkcmVuQ2hhbmdl
cyhub2RlKSkgeworCQkJcmV0dXJuIGRvVmlzaXRVbmNoYW5nZWRDaGlsZHJlbihub2RlKTsKKwkJ
fQorCQlCb29sZWFuIG5ld1ZhbHVlID0gKEJvb2xlYW4pIGdldE5ld1ZhbHVlKG5vZGUsIExhbWJk
YUV4cHJlc3Npb24uUEFSRU5USEVTRVNfUFJPUEVSVFkpOworCQlib29sZWFuIGhhc1BhcmVudGhl
c2VzID0gbmV3VmFsdWUuZXF1YWxzKEJvb2xlYW4uVFJVRSk7CisJCWlmICghaGFzUGFyZW50aGVz
ZXMpIHsvLyBQYXJlbnRoZXNlcyBjYW4gYmUgYWJzZW50IGlmIGFuZCBvbmx5IGlmIHRoZXJlIGlz
IG9uZSBhbmQgb25seSBvbmUgdHlwZSBlbGlkZWQgcGFyYW1ldGVyLgorCQkJTGlzdCBwYXJhbWV0
ZXJzID0gKExpc3QpIGdldE5ld1ZhbHVlKG5vZGUsIExhbWJkYUV4cHJlc3Npb24uUEFSQU1FVEVS
U19QUk9QRVJUWSk7CisJCQloYXNQYXJlbnRoZXNlcyA9ICEocGFyYW1ldGVycy5zaXplKCkgPT0g
MSAmJiBwYXJhbWV0ZXJzLmdldCgwKSBpbnN0YW5jZW9mIFZhcmlhYmxlRGVjbGFyYXRpb25GcmFn
bWVudCk7CisJCX0KKworCQlib29sZWFuIGRlbGV0ZVBhcmVudGhlc2VzID0gZmFsc2U7CisJCWJv
b2xlYW4gaW5zZXJ0UGFyZW50aGVzZXMgPSBmYWxzZTsKKwkJVGV4dEVkaXRHcm91cCBlZGl0R3Jv
dXAgPSBudWxsOworCisJCWJvb2xlYW4gb2xkSGFzUGFyZW50aGVzZXMgPSBnZXRPcmlnaW5hbFZh
bHVlKG5vZGUsIExhbWJkYUV4cHJlc3Npb24uUEFSRU5USEVTRVNfUFJPUEVSVFkpLmVxdWFscyhC
b29sZWFuLlRSVUUpOworCQlSZXdyaXRlRXZlbnQgZXZlbnQgPSBnZXRFdmVudChub2RlLCBMYW1i
ZGFFeHByZXNzaW9uLlBBUkVOVEhFU0VTX1BST1BFUlRZKTsKKwkJaWYgKGV2ZW50ICE9IG51bGwp
IHsKKwkJCWVkaXRHcm91cCA9IGdldEVkaXRHcm91cChldmVudCk7CisJCQlpZiAoZXZlbnQuZ2V0
Q2hhbmdlS2luZCgpID09IFJld3JpdGVFdmVudC5SRVBMQUNFRCkgeworCQkJCWlmIChuZXdWYWx1
ZSAhPSBCb29sZWFuLkZBTFNFKSB7CisJCQkJCWluc2VydFBhcmVudGhlc2VzID0gdHJ1ZTsKKwkJ
CQl9IGVsc2Ugey8vIGFwcGx5IHRoZSBzdHJpY3RlciBjaGVjayBmb3IgcGFyZW50aGVzZXMgZGVs
ZXRpb24KKwkJCQkJZGVsZXRlUGFyZW50aGVzZXMgPSAhaGFzUGFyZW50aGVzZXM7CisJCQkJfQor
CQkJfQorCQl9IGVsc2UgaWYgKCFvbGRIYXNQYXJlbnRoZXNlcyAmJiBoYXNQYXJlbnRoZXNlcykg
ey8vIHBhcmFtZXRlciBwcm9wZXJ0eSBjaGFuZ2VkIHRvIGVmZmVjdCBwYXJlbnRoZXNlcyBpbnNl
cnRpb24KKwkJCWlmICgoZXZlbnQgPSBnZXRFdmVudChub2RlLCBMYW1iZGFFeHByZXNzaW9uLlBB
UkFNRVRFUlNfUFJPUEVSVFkpKSAhPSBudWxsKSB7Ly8gYSBudWxsIGNoZWNrIHRob3VnaCBldmVu
dCBjYW5ub3QgYmUgbnVsbCBoZXJlCisJCQkJZWRpdEdyb3VwID0gZ2V0RWRpdEdyb3VwKGV2ZW50
KTsKKwkJCQlpbnNlcnRQYXJlbnRoZXNlcyA9IHRydWU7CisJCQl9CisJCX0KKwkJCisJCWludCBw
b3MgPSBub2RlLmdldFN0YXJ0UG9zaXRpb24oKTsKKwkJaWYgKGluc2VydFBhcmVudGhlc2VzKSB7
CisJCQlkb1RleHRJbnNlcnQocG9zLCAiKCIsIGVkaXRHcm91cCk7IC8vJE5PTi1OTFMtMSQKKwkJ
fSBlbHNlIGlmIChkZWxldGVQYXJlbnRoZXNlcykgeworCQkJdHJ5IHsKKwkJCQlpbnQgbHBhcmVu
c0VuZCA9IGdldFNjYW5uZXIoKS5nZXRUb2tlbkVuZE9mZnNldChUZXJtaW5hbFRva2Vucy5Ub2tl
bk5hbWVMUEFSRU4sIHBvcyk7CisJCQkJZG9UZXh0UmVtb3ZlKHBvcywgbHBhcmVuc0VuZCAtIHBv
cywgZWRpdEdyb3VwKTsKKwkJCQlwb3MgPSBscGFyZW5zRW5kOworCQkJfSBjYXRjaCAoQ29yZUV4
Y2VwdGlvbiBlKSB7CisJCQkJaGFuZGxlRXhjZXB0aW9uKGUpOworCQkJfQorCQl9CisKKwkJaWYg
KGlzQ2hhbmdlZChub2RlLCBMYW1iZGFFeHByZXNzaW9uLlBBUkFNRVRFUlNfUFJPUEVSVFkpKSB7
CisJCQl0cnkgeworCQkJCXBvcyA9IG9sZEhhc1BhcmVudGhlc2VzID8gZ2V0U2Nhbm5lcigpLmdl
dFRva2VuRW5kT2Zmc2V0KFRlcm1pbmFsVG9rZW5zLlRva2VuTmFtZUxQQVJFTiwgcG9zKSA6IHBv
czsKKwkJCQlwb3MgPSByZXdyaXRlTm9kZUxpc3Qobm9kZSwgTGFtYmRhRXhwcmVzc2lvbi5QQVJB
TUVURVJTX1BST1BFUlRZLCBwb3MsIFV0aWwuRU1QVFlfU1RSSU5HLCAiLCAiKTsgLy8kTk9OLU5M
Uy0xJAorCQkJfSBjYXRjaCAoQ29yZUV4Y2VwdGlvbiBlKSB7CisJCQkJaGFuZGxlRXhjZXB0aW9u
KGUpOworCQkJfQorCQl9IGVsc2UgeworCQkJcG9zID0gZG9WaXNpdChub2RlLCBMYW1iZGFFeHBy
ZXNzaW9uLlBBUkFNRVRFUlNfUFJPUEVSVFksIHBvcyk7CisJCX0KKworCQlpZiAoaW5zZXJ0UGFy
ZW50aGVzZXMpIHsKKwkJCWRvVGV4dEluc2VydChwb3MsICIpIiwgZWRpdEdyb3VwKTsgLy8kTk9O
LU5MUy0xJAorCQl9IGVsc2UgaWYgKGRlbGV0ZVBhcmVudGhlc2VzKSB7CisJCQl0cnkgeworCQkJ
CWRvVGV4dFJlbW92ZShwb3MsIGdldFNjYW5uZXIoKS5nZXRUb2tlbkVuZE9mZnNldChUZXJtaW5h
bFRva2Vucy5Ub2tlbk5hbWVSUEFSRU4sIHBvcykgLSBwb3MsIGVkaXRHcm91cCk7CisJCQl9IGNh
dGNoIChDb3JlRXhjZXB0aW9uIGUpIHsKKwkJCQloYW5kbGVFeGNlcHRpb24oZSk7CisJCQl9CisJ
CX0KKwkJcmV3cml0ZVJlcXVpcmVkTm9kZShub2RlLCBMYW1iZGFFeHByZXNzaW9uLkJPRFlfUFJP
UEVSVFkpOworCisJCXJldHVybiBmYWxzZTsKKwl9CisKKwkvKiAobm9uLUphdmFkb2MpCiAJICog
QHNlZSBvcmcuZWNsaXBzZS5qZHQuY29yZS5kb20uQVNUVmlzaXRvciN2aXNpdChNZXRob2RJbnZv
Y2F0aW9uKQogCSAqLwogCXB1YmxpYyBib29sZWFuIHZpc2l0KE1ldGhvZEludm9jYXRpb24gbm9k
ZSkgewpkaWZmIC0tZ2l0IGEvb3JnLmVjbGlwc2UuamR0LmNvcmUvZG9tL29yZy9lY2xpcHNlL2pk
dC9pbnRlcm5hbC9jb3JlL2RvbS9yZXdyaXRlL0FTVFJld3JpdGVGbGF0dGVuZXIuamF2YSBiL29y
Zy5lY2xpcHNlLmpkdC5jb3JlL2RvbS9vcmcvZWNsaXBzZS9qZHQvaW50ZXJuYWwvY29yZS9kb20v
cmV3cml0ZS9BU1RSZXdyaXRlRmxhdHRlbmVyLmphdmEKaW5kZXggOWEzMDE0NC4uMjIxN2JkYiAx
MDA2NDQKLS0tIGEvb3JnLmVjbGlwc2UuamR0LmNvcmUvZG9tL29yZy9lY2xpcHNlL2pkdC9pbnRl
cm5hbC9jb3JlL2RvbS9yZXdyaXRlL0FTVFJld3JpdGVGbGF0dGVuZXIuamF2YQorKysgYi9vcmcu
ZWNsaXBzZS5qZHQuY29yZS9kb20vb3JnL2VjbGlwc2UvamR0L2ludGVybmFsL2NvcmUvZG9tL3Jl
d3JpdGUvQVNUUmV3cml0ZUZsYXR0ZW5lci5qYXZhCkBAIC02NTMsNiArNjUzLDI3IEBACiAJCXRo
aXMucmVzdWx0LmFwcGVuZCgiW10iKTsgLy8kTk9OLU5MUy0xJAogCQlyZXR1cm4gZmFsc2U7CiAJ
fQorCisJLyoKKwkgKiBAc2VlIEFTVFZpc2l0b3IjdmlzaXQoTGFtYmRhRXhwcmVzc2lvbikKKwkg
Ki8KKwlwdWJsaWMgYm9vbGVhbiB2aXNpdChMYW1iZGFFeHByZXNzaW9uIG5vZGUpIHsKKwkJYm9v
bGVhbiBoYXNQYXJlbnRoZXNlcyA9IGdldEJvb2xlYW5BdHRyaWJ1dGUobm9kZSwgTGFtYmRhRXhw
cmVzc2lvbi5QQVJFTlRIRVNFU19QUk9QRVJUWSk7CisJCWlmICghaGFzUGFyZW50aGVzZXMpIHsK
KwkJCUxpc3QgcGFyYW1ldGVycyA9IGdldENoaWxkTGlzdChub2RlLCBMYW1iZGFFeHByZXNzaW9u
LlBBUkFNRVRFUlNfUFJPUEVSVFkpOworCQkJaGFzUGFyZW50aGVzZXMgPSAhKHBhcmFtZXRlcnMu
c2l6ZSgpID09IDEgJiYgcGFyYW1ldGVycy5nZXQoMCkgaW5zdGFuY2VvZiBWYXJpYWJsZURlY2xh
cmF0aW9uRnJhZ21lbnQpOworCQl9CisKKwkJaWYgKGhhc1BhcmVudGhlc2VzKQorCQkJdGhpcy5y
ZXN1bHQuYXBwZW5kKCcoJyk7CisJCXZpc2l0TGlzdChub2RlLCBMYW1iZGFFeHByZXNzaW9uLlBB
UkFNRVRFUlNfUFJPUEVSVFksIFN0cmluZy52YWx1ZU9mKCcsJykpOworCQlpZiAoaGFzUGFyZW50
aGVzZXMpCisJCQl0aGlzLnJlc3VsdC5hcHBlbmQoJyknKTsKKwkJdGhpcy5yZXN1bHQuYXBwZW5k
KCItPiIpOyAvLyROT04tTkxTLTEkCisJCWdldENoaWxkTm9kZShub2RlLCBMYW1iZGFFeHByZXNz
aW9uLkJPRFlfUFJPUEVSVFkpLmFjY2VwdCh0aGlzKTsKKwkJcmV0dXJuIGZhbHNlOworCX0KKwog
CS8qCiAJICogQHNlZSBBU1RWaXNpdG9yI3Zpc2l0KE1ldGhvZERlY2xhcmF0aW9uKQogCSAqLw==
</data>

          </attachment>
      

    </bug>

</bugzilla>