<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>398920</bug_id>
          
          <creation_ts>2013-01-23 15:21:00 -0500</creation_ts>
          <short_desc>ASTParser#createBindings(..) fails for IType of package-info.class</short_desc>
          <delta_ts>2013-01-30 09:57:05 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>4.3</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>4.3 M5</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Markus Keller">markus_keller</reporter>
          <assigned_to name="Markus Keller">markus_keller</assigned_to>
          <cc>jarthana</cc>
    
    <cc>markus_keller</cc>
    
    <cc>srikanth_sankaran</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2206708</commentid>
    <comment_count>0</comment_count>
      <attachid>226000</attachid>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2013-01-23 15:21:04 -0500</bug_when>
    <thetext>Created attachment 226000
Fix &amp; Test

Create a compiled package-info.class from this source:

/**
 * The foo pack.
 */
@Deprecated
package foo;

Calling ASTParser#createBindings(..) for this class file&apos;s IType returns null. I expect to get an ITypeBinding on which I can e.g. call getAnnotations().

The problem is a conflict in the format of binding keys: &apos;-&apos; is considered as a wildcard token, so BindingKeyParser fails to parse the key &quot;Lfoo/package-info;&quot;. 

A possible fix would be to change the format of binding keys (either use a different token for TypeConstants.WILDCARD_MINUS or introduce a special encoding for the &apos;-&apos; in the &quot;package-info&quot; type name. But this would be hard to get right, since the binding key generation and parsing is spread over many places, and both solutions would give cryptic keys.

A pragmatic solution is to add this in BindingKeyParser#parseFullyQualifiedName(), see the attached patch and test.

Srikanth/Jay, please speak up if you don&apos;t like this.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2207763</commentid>
    <comment_count>1</comment_count>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2013-01-25 10:29:38 -0500</bug_when>
    <thetext>Fixed with http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=6be62c3662fecf8904c768fbe89f2cac9c466d44</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2208481</commentid>
    <comment_count>2</comment_count>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2013-01-28 07:21:02 -0500</bug_when>
    <thetext>Sorry, this caused 4 test failures in jdt.core for pathological cases, e.g. ASTConverter15Test.test0312

Fixed with http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=1f21874e63d043a0776525a28519b7f574608ce2</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2209870</commentid>
    <comment_count>3</comment_count>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2013-01-30 09:57:05 -0500</bug_when>
    <thetext>Verified in I20130129-2000.</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>226000</attachid>
            <date>2013-01-23 15:21:00 -0500</date>
            <delta_ts>2013-01-23 15:21:04 -0500</delta_ts>
            <desc>Fix &amp; Test</desc>
            <filename>eclipse.jdt.core.patch</filename>
            <type>text/plain</type>
            <size>3274</size>
            <attacher name="Markus Keller">markus_keller</attacher>
            
              <data encoding="base64">IyMjIEVjbGlwc2UgV29ya3NwYWNlIFBhdGNoIDEuMAojUCBvcmcuZWNsaXBzZS5qZHQuY29yZS50
ZXN0cy5tb2RlbApkaWZmIC0tZ2l0IHNyYy9vcmcvZWNsaXBzZS9qZHQvY29yZS90ZXN0cy9kb20v
QVNUTW9kZWxCcmlkZ2VUZXN0cy5qYXZhIHNyYy9vcmcvZWNsaXBzZS9qZHQvY29yZS90ZXN0cy9k
b20vQVNUTW9kZWxCcmlkZ2VUZXN0cy5qYXZhCmluZGV4IDVhOTRiNTUuLjc3YWRlMTQgMTAwNjQ0
Ci0tLSBzcmMvb3JnL2VjbGlwc2UvamR0L2NvcmUvdGVzdHMvZG9tL0FTVE1vZGVsQnJpZGdlVGVz
dHMuamF2YQorKysgc3JjL29yZy9lY2xpcHNlL2pkdC9jb3JlL3Rlc3RzL2RvbS9BU1RNb2RlbEJy
aWRnZVRlc3RzLmphdmEKQEAgLTEsNSArMSw1IEBACiAvKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgot
ICogQ29weXJpZ2h0IChjKSAyMDA0LCAyMDEyIElCTSBDb3Jwb3JhdGlvbiBhbmQgb3RoZXJzLgor
ICogQ29weXJpZ2h0IChjKSAyMDA0LCAyMDEzIElCTSBDb3Jwb3JhdGlvbiBhbmQgb3RoZXJzLgog
ICogQWxsIHJpZ2h0cyByZXNlcnZlZC4gVGhpcyBwcm9ncmFtIGFuZCB0aGUgYWNjb21wYW55aW5n
IG1hdGVyaWFscwogICogYXJlIG1hZGUgYXZhaWxhYmxlIHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUg
RWNsaXBzZSBQdWJsaWMgTGljZW5zZSB2MS4wCiAgKiB3aGljaCBhY2NvbXBhbmllcyB0aGlzIGRp
c3RyaWJ1dGlvbiwgYW5kIGlzIGF2YWlsYWJsZSBhdApAQCAtMTUsNiArMTUsNyBAQAogCiBpbXBv
cnQgb3JnLmVjbGlwc2UuY29yZS5yZXNvdXJjZXMuSVJlc291cmNlOwogaW1wb3J0IG9yZy5lY2xp
cHNlLmNvcmUucnVudGltZS5Db3JlRXhjZXB0aW9uOworaW1wb3J0IG9yZy5lY2xpcHNlLmNvcmUu
cnVudGltZS5QYXRoOwogaW1wb3J0IG9yZy5lY2xpcHNlLmpkdC5jb3JlLio7CiBpbXBvcnQgb3Jn
LmVjbGlwc2UuamR0LmNvcmUuY29tcGlsZXIuSVByb2JsZW07CiBpbXBvcnQgb3JnLmVjbGlwc2Uu
amR0LmNvcmUuZG9tLio7CkBAIC0xMTk0LDYgKzExOTUsMzEgQEAKIAkJCSJMWDtATFh+TXlBbm5v
dDsiLAogCQkJYmluZGluZ3MpOwogCX0KKwkKKwkvKgorCSAqIEVuc3VyZXMgdGhhdCB0aGUgY29y
cmVjdCBJQmluZGluZyBpcyBjcmVhdGVkIGZvciBwYWNrYWdlLWluZm8uY2xhc3MncyBJVHlwZQor
CSAqLworCXB1YmxpYyB2b2lkIHRlc3RDcmVhdGVCaW5kaW5nczI0KCkgdGhyb3dzIENvcmVFeGNl
cHRpb24geworCQljcmVhdGVDbGFzc0ZpbGUoCisJCQkiL1AvbGliIiwKKwkJCSJwYWNrL3BhY2th
Z2UtaW5mby5jbGFzcyIsCisJCQkiQERlcHJlY2F0ZWRcbiIgKworCQkJInBhY2thZ2UgcGFjazsi
KTsKKwkJSUphdmFQcm9qZWN0IGphdmFQcm9qZWN0ID0gZ2V0SmF2YVByb2plY3QoIlAiKTsKKwkJ
SVBhY2thZ2VGcmFnbWVudCBwYWNrID0gamF2YVByb2plY3QuZmluZFBhY2thZ2VGcmFnbWVudChu
ZXcgUGF0aCgiL1AvbGliL3BhY2siKSk7CisJCUlUeXBlIHR5cGUgPSBwYWNrLmdldENsYXNzRmls
ZSgicGFja2FnZS1pbmZvLmNsYXNzIikuZ2V0VHlwZSgpOworCQlBU1RQYXJzZXIgcGFyc2VyID0g
QVNUUGFyc2VyLm5ld1BhcnNlcihKTFMzX0lOVEVSTkFMKTsKKwkJcGFyc2VyLnNldFByb2plY3Qo
amF2YVByb2plY3QpOworCQlJSmF2YUVsZW1lbnRbXSBlbGVtZW50cyA9IG5ldyBJSmF2YUVsZW1l
bnRbXSB7dHlwZX07CisJCUlCaW5kaW5nW10gYmluZGluZ3MgPSBwYXJzZXIuY3JlYXRlQmluZGlu
Z3MoZWxlbWVudHMsIG51bGwpOworCQlhc3NlcnRCaW5kaW5nc0VxdWFsKAorCQkJIkxwYWNrL3Bh
Y2thZ2UtaW5mbzsiLAorCQkJYmluZGluZ3MpOworCQlJQW5ub3RhdGlvbkJpbmRpbmdbXSBhbm5v
dGF0aW9ucyA9ICgoSVR5cGVCaW5kaW5nKSBiaW5kaW5nc1swXSkuZ2V0QW5ub3RhdGlvbnMoKTsK
KwkJYXNzZXJ0QmluZGluZ3NFcXVhbCgKKwkJCSJATGphdmEvbGFuZy9EZXByZWNhdGVkOyIsCisJ
CQlhbm5vdGF0aW9ucyk7CisJfQogCiAJLyoKIAkgKiBFbnN1cmVzIHRoYXQgdGhlIElKYXZhRWxl
bWVudCBvZiBhbiBJQmluZGluZyByZXByZXNlbnRpbmcgYSBmaWVsZCBpcyBjb3JyZWN0LgojUCBv
cmcuZWNsaXBzZS5qZHQuY29yZQpkaWZmIC0tZ2l0IG1vZGVsL29yZy9lY2xpcHNlL2pkdC9pbnRl
cm5hbC9jb3JlL3V0aWwvQmluZGluZ0tleVBhcnNlci5qYXZhIG1vZGVsL29yZy9lY2xpcHNlL2pk
dC9pbnRlcm5hbC9jb3JlL3V0aWwvQmluZGluZ0tleVBhcnNlci5qYXZhCmluZGV4IDEyNGFkYWEu
LmUwY2E5OTggMTAwNjQ0Ci0tLSBtb2RlbC9vcmcvZWNsaXBzZS9qZHQvaW50ZXJuYWwvY29yZS91
dGlsL0JpbmRpbmdLZXlQYXJzZXIuamF2YQorKysgbW9kZWwvb3JnL2VjbGlwc2UvamR0L2ludGVy
bmFsL2NvcmUvdXRpbC9CaW5kaW5nS2V5UGFyc2VyLmphdmEKQEAgLTEsNSArMSw1IEBACiAvKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKgotICogQ29weXJpZ2h0IChjKSAyMDA1LCAyMDExIElCTSBDb3Jw
b3JhdGlvbiBhbmQgb3RoZXJzLgorICogQ29weXJpZ2h0IChjKSAyMDA1LCAyMDEzIElCTSBDb3Jw
b3JhdGlvbiBhbmQgb3RoZXJzLgogICogQWxsIHJpZ2h0cyByZXNlcnZlZC4gVGhpcyBwcm9ncmFt
IGFuZCB0aGUgYWNjb21wYW55aW5nIG1hdGVyaWFscwogICogYXJlIG1hZGUgYXZhaWxhYmxlIHVu
ZGVyIHRoZSB0ZXJtcyBvZiB0aGUgRWNsaXBzZSBQdWJsaWMgTGljZW5zZSB2MS4wCiAgKiB3aGlj
aCBhY2NvbXBhbmllcyB0aGlzIGRpc3RyaWJ1dGlvbiwgYW5kIGlzIGF2YWlsYWJsZSBhdApAQCAt
NzA0LDYgKzcwNCwxNiBAQAogCQkJCQkJcmV0dXJuOwogCQkJCX0KIAkJCQlicmVhazsKKwkJCWNh
c2UgU2Nhbm5lci5XSUxEQ0FSRDoKKwkJCQkvLyBzdXBwb3J0IHRoZSAnLScgaW4gIkxwYWNrL3Bh
Y2thZ2UtaW5mbzsiCisJCQkJaW50IHN0YXJ0ID0gdGhpcy5zY2FubmVyLnN0YXJ0OworCQkJCWlm
ICh0aGlzLnNjYW5uZXIubmV4dFRva2VuKCkgPT0gU2Nhbm5lci5UWVBFKSB7CisJCQkJCXRoaXMu
c2Nhbm5lci5zdGFydCA9IHN0YXJ0OworCQkJCQl0aGlzLmtleVN0YXJ0ID0gc3RhcnQtMTsKKwkJ
CQkJY29uc3VtZUZ1bGx5UXVhbGlmaWVkTmFtZSh0aGlzLnNjYW5uZXIuZ2V0VG9rZW5Tb3VyY2Uo
KSk7CisJCQkJCWJyZWFrOworCQkJCX0KKwkJCQlicmVhazsKIAkJCWRlZmF1bHQ6CiAJCQkJbWFs
Zm9ybWVkS2V5KCk7CiAJCQkJcmV0dXJuOw==
</data>

          </attachment>
      

    </bug>

</bugzilla>