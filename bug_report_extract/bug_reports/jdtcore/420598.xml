<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>420598</bug_id>
          
          <creation_ts>2013-10-29 05:48:00 -0400</creation_ts>
          <short_desc>[1.8][compiler] Incorrect error about intersection cast type not being a functional interface.</short_desc>
          <delta_ts>2013-11-05 00:17:18 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>4.4</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows 7</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>BETA J8</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Srikanth Sankaran">srikanth_sankaran</reporter>
          <assigned_to name="Srikanth Sankaran">srikanth_sankaran</assigned_to>
          <cc>pbenedict</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2324304</commentid>
    <comment_count>0</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2013-10-29 05:48:31 -0400</bug_when>
    <thetext>BETA_JAVA8:

The following program triggers an incorrect error message: The target type of 
this expression is not a functional interface: more than one of the intersecting 
interfaces are functional

The intersection should collapse to the most specific type when there is a
supertype - subtype relationship between two constituents.

// --
import java.io.Serializable;
interface I {
	void foo();
}
interface J extends I {
	void foo();
}
interface K {
}
public class X {
	public static void main(String[] args) {
		I i = (I &amp; Serializable) () -&gt; {};
		i = (I &amp; J &amp; K) () -&gt; {};
		i = (J &amp; I &amp; K) () -&gt; {};  
	}
}</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2324320</commentid>
    <comment_count>1</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2013-10-29 06:53:47 -0400</bug_when>
    <thetext>Fix and tests released here: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?h=BETA_JAVA8&amp;id=fb41fdb7e255d6e5b46ffe2a413c2cecddfaeeea

it is still possible to elicit the incorrect message by constructing some
perverse cases (we basically have to keep scanning the intersecting types
until there are no ripples), but given 8b111 is broken even on simpler cases,
we will cross the bridge when we get to it.

See that javac incorrectly compiles this code:

// -- 
import java.io.Serializable;
interface I {
	void foo();
}
interface J extends I {
	void foo();
}
interface K {
}
interface L {
	void foo();
}
public class X {
	public static void main(String[] args) {
		I i = (I &amp; Serializable) () -&gt; {};
		i = (I &amp; J &amp; K) () -&gt; {};
		i = (J &amp; I &amp; K) () -&gt; {};  
		i = (J &amp; I &amp; K &amp; L) () -&gt; {};   // Javac 8b111 compiles this incorrectly.
	}
}</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2324322</commentid>
    <comment_count>2</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2013-10-29 06:55:25 -0400</bug_when>
    <thetext>(In reply to Srikanth Sankaran from comment #1)
&gt; Fix and tests released here:
&gt; http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/
&gt; ?h=BETA_JAVA8&amp;id=fb41fdb7e255d6e5b46ffe2a413c2cecddfaeeea

Correct commit id: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?h=BETA_JAVA8&amp;id=e63b9746075cfa36f9c16fdf188f3c8e6604903a</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2325759</commentid>
    <comment_count>3</comment_count>
    <who name="Paul Benedict">pbenedict</who>
    <bug_when>2013-11-01 16:28:05 -0400</bug_when>
    <thetext>Do you want to spin off another ticket for comment #1 so the &quot;ripple&quot; scan can be remembered?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2326533</commentid>
    <comment_count>4</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2013-11-05 00:17:18 -0500</bug_when>
    <thetext>(In reply to Paul Benedict from comment #3)
&gt; Do you want to spin off another ticket for comment #1 so the &quot;ripple&quot; scan
&gt; can be remembered?

I don&apos;t think we will ever hit in real life, but by all means please raise
a bug. TIA.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>