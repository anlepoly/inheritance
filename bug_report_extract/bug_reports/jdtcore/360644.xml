<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>360644</bug_id>
          
          <creation_ts>2011-10-12 06:20:00 -0400</creation_ts>
          <short_desc>Scope.isDefinedInSameUnit(ReferenceBinding) fails for a ParameterizedTypeBinding</short_desc>
          <delta_ts>2011-10-24 04:14:49 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>3.8</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>3.8 M3</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ayushman Jain">amj87.iitr</reporter>
          <assigned_to name="Ayushman Jain">amj87.iitr</assigned_to>
          <cc>srikanth_sankaran</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2008982</commentid>
    <comment_count>0</comment_count>
    <who name="Ayushman Jain">amj87.iitr</who>
    <bug_when>2011-10-12 06:20:35 -0400</bug_when>
    <thetext>HEAD

When one tries to query a ParameterizedTypeBinding using the method Scope.isDefinedInSameUnit(ReferenceBinding) , the return value is false even if the ParameterizedBinding was indeed defined in the same unit. This is because the comparison in the method occurs at line 3046 between the top level types obtained from the compilation unit and the queried type. Since the top level types are always a SourceTypeBinding, the comparison with a parameterized type binding will fail even if it is actually the same type. Hence, for Parameterized types we should compare as follows:

if (enclosingType instanceof ParameterizedTypeBinding)
if (topLevelTypes[i] == ((ParameterizedTypeBinding)enclosingType).type)
  return true;</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2008986</commentid>
    <comment_count>1</comment_count>
    <who name="Ayushman Jain">amj87.iitr</who>
    <bug_when>2011-10-12 06:26:42 -0400</bug_when>
    <thetext>(In reply to comment #0)
&gt; if (enclosingType instanceof ParameterizedTypeBinding)
&gt; if (topLevelTypes[i] == ((ParameterizedTypeBinding)enclosingType).type)
&gt;   return true;

Actually, using enclosingType.original() should suffice.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2009062</commentid>
    <comment_count>2</comment_count>
      <attachid>205028</attachid>
    <who name="Ayushman Jain">amj87.iitr</who>
    <bug_when>2011-10-12 08:56:41 -0400</bug_when>
    <thetext>Created attachment 205028
proposed fix</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2009064</commentid>
    <comment_count>3</comment_count>
    <who name="Ayushman Jain">amj87.iitr</who>
    <bug_when>2011-10-12 08:57:08 -0400</bug_when>
    <thetext>Released in HEAD for 3.8M3 via commit 21098f5e40f4c2eaaad3e643b94e7cf0a54113c9.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2015167</commentid>
    <comment_count>4</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2011-10-24 04:14:49 -0400</bug_when>
    <thetext>Verified for 3.8 M3 via code inspection.</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>205028</attachid>
            <date>2011-10-12 08:56:00 -0400</date>
            <delta_ts>2011-10-12 08:56:41 -0400</delta_ts>
            <desc>proposed fix</desc>
            <filename>HEAD--Fixed-bug-360644-ScopeisDefinedInSameUnitRefer.patch</filename>
            <type>text/plain</type>
            <size>1433</size>
            <attacher name="Ayushman Jain">amj87.iitr</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlL2J1aWxkbm90ZXNfamR0LWNvcmUuaHRt
bCBiL29yZy5lY2xpcHNlLmpkdC5jb3JlL2J1aWxkbm90ZXNfamR0LWNvcmUuaHRtbAppbmRleCAw
NzAyMGMyLi4yMWFmNWExIDEwMDY0NAotLS0gYS9vcmcuZWNsaXBzZS5qZHQuY29yZS9idWlsZG5v
dGVzX2pkdC1jb3JlLmh0bWwKKysrIGIvb3JnLmVjbGlwc2UuamR0LmNvcmUvYnVpbGRub3Rlc19q
ZHQtY29yZS5odG1sCkBAIC01Miw3ICs1Miw5IEBACiA8aDI+V2hhdCdzIG5ldyBpbiB0aGlzIGRy
b3A8L2gyPgogCiA8aDM+UHJvYmxlbSBSZXBvcnRzIEZpeGVkPC9oMz4KLTxhIGhyZWY9Imh0dHBz
Oi8vYnVncy5lY2xpcHNlLm9yZy9idWdzL3Nob3dfYnVnLmNnaT9pZD0zNTg3NjIiPjM1ODc2Mjwv
YT4KKzxhIGhyZWY9Imh0dHBzOi8vYnVncy5lY2xpcHNlLm9yZy9idWdzL3Nob3dfYnVnLmNnaT9p
ZD0zNjA2NDQiPjM2MDY0NDwvYT4KK1Njb3BlLmlzRGVmaW5lZEluU2FtZVVuaXQoUmVmZXJlbmNl
QmluZGluZykgZmFpbHMgZm9yIGEgUGFyYW1ldGVyaXplZFR5cGVCaW5kaW5nCis8YnI+PGEgaHJl
Zj0iaHR0cHM6Ly9idWdzLmVjbGlwc2Uub3JnL2J1Z3Mvc2hvd19idWcuY2dpP2lkPTM1ODc2MiI+
MzU4NzYyPC9hPgogTlBFIGluIEpEVCBjb21waWxlcgogCiA8YSBuYW1lPSJ2X0MxNSI+PC9hPgpk
aWZmIC0tZ2l0IGEvb3JnLmVjbGlwc2UuamR0LmNvcmUvY29tcGlsZXIvb3JnL2VjbGlwc2UvamR0
L2ludGVybmFsL2NvbXBpbGVyL2xvb2t1cC9TY29wZS5qYXZhIGIvb3JnLmVjbGlwc2UuamR0LmNv
cmUvY29tcGlsZXIvb3JnL2VjbGlwc2UvamR0L2ludGVybmFsL2NvbXBpbGVyL2xvb2t1cC9TY29w
ZS5qYXZhCmluZGV4IDRlYWRhMzEuLjllYzdlMGEgMTAwNjQ0Ci0tLSBhL29yZy5lY2xpcHNlLmpk
dC5jb3JlL2NvbXBpbGVyL29yZy9lY2xpcHNlL2pkdC9pbnRlcm5hbC9jb21waWxlci9sb29rdXAv
U2NvcGUuamF2YQorKysgYi9vcmcuZWNsaXBzZS5qZHQuY29yZS9jb21waWxlci9vcmcvZWNsaXBz
ZS9qZHQvaW50ZXJuYWwvY29tcGlsZXIvbG9va3VwL1Njb3BlLmphdmEKQEAgLTMwNDMsNyArMzA0
Myw3IEBACiAJCS8vIHRlc3QgdGhhdCB0aGUgZW5jbG9zaW5nVHlwZSBpcyBub3QgcGFydCBvZiB0
aGUgY29tcGlsYXRpb24gdW5pdAogCQlTb3VyY2VUeXBlQmluZGluZ1tdIHRvcExldmVsVHlwZXMg
PSAoKENvbXBpbGF0aW9uVW5pdFNjb3BlKSB1bml0U2NvcGUpLnRvcExldmVsVHlwZXM7CiAJCWZv
ciAoaW50IGkgPSB0b3BMZXZlbFR5cGVzLmxlbmd0aDsgLS1pID49IDA7KQotCQkJaWYgKHRvcExl
dmVsVHlwZXNbaV0gPT0gZW5jbG9zaW5nVHlwZSkKKwkJCWlmICh0b3BMZXZlbFR5cGVzW2ldID09
IGVuY2xvc2luZ1R5cGUub3JpZ2luYWwoKSkKIAkJCQlyZXR1cm4gdHJ1ZTsKIAkJcmV0dXJuIGZh
bHNlOwogCX0=
</data>

          </attachment>
      

    </bug>

</bugzilla>