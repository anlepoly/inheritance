<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>425031</bug_id>
          
          <creation_ts>2014-01-07 11:15:00 -0500</creation_ts>
          <short_desc>[1.8] nondeterministic inference for GenericsRegressionTest.test283353</short_desc>
          <delta_ts>2014-10-29 06:49:18 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>4.3.1</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>DUPLICATE</resolution>
          <dup_id>430686</dup_id>
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>4.5 M3</target_milestone>
          
          <blocked>404648</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Stephan Herrmann">stephan.herrmann</reporter>
          <assigned_to name="Srikanth Sankaran">srikanth_sankaran</assigned_to>
          <cc>shankhba</cc>
    
    <cc>srikanth_sankaran</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2346585</commentid>
    <comment_count>0</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2014-01-07 11:15:23 -0500</bug_when>
    <thetext>The test GenericsRegressionTest.test283353() exhibits non-deterministic behavior in the inference. Currently in HEAD of BETA_JAVA8 this is masked by using a bogus strategy during resolve, but the fix I&apos;m currently preparing will make this non-determinism observable as failures (most the time) vs. success (rarely).

Non-determinism is not generally suprising, because we iterate over some non-linear collections, but this shouldn&apos;t affect the outcome.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2371115</commentid>
    <comment_count>1</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2014-03-04 07:44:35 -0500</bug_when>
    <thetext>I have a patch under test which eliminates the non-determinism in this test. To be specific, this is done by fixing an obvious bug in CaptureBinding18.isProperType().

However, the net result is, that GenericsRegressionTest.test283353() now constantly *fails* in 1.8.

This takes us back to
 - bug 283353 - which introduced that test
 - bug 347600 - which brought the final final fix for that test
 - http://bugs.java.com/view_bug.do?bug_id=6932571 - referenced from the fix

Looking at the sun bug, javac seems to be short-cutting the spec by some common-sense reasoning, viz. stopping analysis of recursive types by replacment with &apos;?&apos;. Note, that the evaluation makes no reference to the spec, so we don&apos;t learn, why exactly this is the right solution.

In the Java 8 spec, recursive types are handled in the resolution phase (notably, by carefully investigating dependencies between inference variables, detecting circular dependencies, and determining optimal order of resolution attempts) such that the solution from the sun bug should no longer be necessary.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2371146</commentid>
    <comment_count>2</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2014-03-04 08:38:05 -0500</bug_when>
    <thetext>(In reply to Stephan Herrmann from comment #1)
&gt; I have a patch under test which eliminates the non-determinism in this test.

This fix has been released via http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?h=BETA_JAVA8&amp;id=c061de6d65bf019fa9950896cd9e3724a43a4d46

I&apos;m afraid there&apos;s nothing more I can do for this round, but in the next round we should try to coordinate with javac.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2371148</commentid>
    <comment_count>3</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2014-03-04 08:39:54 -0500</bug_when>
    <thetext>Srikanth, another one with need for coordination with javac. Hope you&apos;re OK with deferring.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2371151</commentid>
    <comment_count>4</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2014-03-04 08:42:39 -0500</bug_when>
    <thetext>(In reply to Stephan Herrmann from comment #3)
&gt; Srikanth, another one with need for coordination with javac. Hope you&apos;re OK
&gt; with deferring.

OK, no issues.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2389159</commentid>
    <comment_count>5</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2014-04-15 06:57:25 -0400</bug_when>
    <thetext>Putting this under the umbrella of bug 404648</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2467641</commentid>
    <comment_count>6</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2014-10-19 00:20:08 -0400</bug_when>
    <thetext>I believe the patch at https://bugs.eclipse.org/bugs/show_bug.cgi?id=430686#c11
fixes this problem. That is under review.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2471801</commentid>
    <comment_count>7</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2014-10-25 13:03:26 -0400</bug_when>
    <thetext>Per comment#6, closing as duplicate.

*** This bug has been marked as a duplicate of bug 430686 ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2473468</commentid>
    <comment_count>8</comment_count>
    <who name="shankha banerjee">shankhba</who>
    <bug_when>2014-10-29 06:49:18 -0400</bug_when>
    <thetext>Verified for 4.5 M3 using  I20141027-2000 build.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>