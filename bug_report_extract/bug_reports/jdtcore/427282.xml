<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>427282</bug_id>
          
          <creation_ts>2014-02-03 11:03:00 -0500</creation_ts>
          <short_desc>[1.8][compiler] AIOOB (-1) at org.eclipse.jdt.internal.compiler.ClassFile.traverse(ClassFile.java:6209)</short_desc>
          <delta_ts>2014-02-21 04:37:02 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>4.3.1</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows 7</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>BETA J8</target_milestone>
          
          <blocked>427059</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Mathieu Croizard">mcr</reporter>
          <assigned_to name="Stephan Herrmann">stephan.herrmann</assigned_to>
          <cc>anchakrk</cc>
    
    <cc>marco</cc>
    
    <cc>private</cc>
    
    <cc>srikanth_sankaran</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2358028</commentid>
    <comment_count>0</comment_count>
    <who name="Mathieu Croizard">mcr</who>
    <bug_when>2014-02-03 11:03:53 -0500</bug_when>
    <thetext>Hello, 
I have some compilation problems while trying Java 8 with eclipse 4.3.1
Using Java jdk 8 fcs b127 both on 32 and 64 bits
and
  Eclipse Java Development Tools Patch for Java 8 Support (BETA)	        1.0.0.v20140203-0104_BETA_JAVA8	org.eclipse.jdt.java8patch.feature.group	Eclipse.org
  Eclipse Plugin-in Development Environment Patch for Java 8 Support (BETA)	1.0.0.v20140203-0104_BETA_JAVA8	org.eclipse.pde.java8patch.feature.group	Eclipse.org
  Eclipse RCP Patch for Java 8 Support (BETA)	                                1.0.0.v20140203-0104_BETA_JAVA8	org.eclipse.rcp.java8patch.feature.group	Eclipse.org


sscce :

import java.util.Collection;

public class A 
{
	public A(String... a)
	{
	}
	public static &lt;T&gt; T[] a(T[] a, T[] b)
	{
		return null;
	}
	
	public static void error()
	{
		final Collection&lt;A&gt; as = null;
                for (A a : as)
                {
                	new A(A.a(
                         new String[0],
                         new String[0]));
                }
	}
}

Problems occurred when invoking code from plug-in: &quot;org.eclipse.jdt.ui&quot;.
Error in JDT Core during AST creation



Internal compiler error: java.lang.ArrayIndexOutOfBoundsException: -1
	at org.eclipse.jdt.internal.compiler.ClassFile.traverse(ClassFile.java:6209)
	at org.eclipse.jdt.internal.compiler.ClassFile.generateStackMapTableAttribute(ClassFile.java:4254)
	at org.eclipse.jdt.internal.compiler.ClassFile.completeCodeAttribute(ClassFile.java:1382)
	at org.eclipse.jdt.internal.compiler.ast.AbstractMethodDeclaration.generateCode(AbstractMethodDeclaration.java:341)
	at org.eclipse.jdt.internal.compiler.ast.AbstractMethodDeclaration.generateCode(AbstractMethodDeclaration.java:273)
	at org.eclipse.jdt.internal.compiler.ast.TypeDeclaration.generateCode(TypeDeclaration.java:570)
	at org.eclipse.jdt.internal.compiler.ast.TypeDeclaration.generateCode(TypeDeclaration.java:639)
	at org.eclipse.jdt.internal.compiler.ast.CompilationUnitDeclaration.generateCode(CompilationUnitDeclaration.java:370)
	at org.eclipse.jdt.core.dom.CompilationUnitResolver.resolve(CompilationUnitResolver.java:1214)
	at org.eclipse.jdt.core.dom.CompilationUnitResolver.resolve(CompilationUnitResolver.java:693)
	at org.eclipse.jdt.core.dom.ASTParser.internalCreateAST(ASTParser.java:1187)
	at org.eclipse.jdt.core.dom.ASTParser.createAST(ASTParser.java:813)
	at org.eclipse.jdt.internal.ui.javaeditor.ASTProvider$1.run(ASTProvider.java:548)
	at org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:42)
	at org.eclipse.jdt.internal.ui.javaeditor.ASTProvider.createAST(ASTProvider.java:541)
	at org.eclipse.jdt.internal.ui.javaeditor.ASTProvider.getAST(ASTProvider.java:484)
	at org.eclipse.jdt.ui.SharedASTProvider.getAST(SharedASTProvider.java:132)
	at org.eclipse.jdt.internal.ui.viewsupport.SelectionListenerWithASTManager$PartListenerGroup.calculateASTandInform(SelectionListenerWithASTManager.java:170)
	at org.eclipse.jdt.internal.ui.viewsupport.SelectionListenerWithASTManager$PartListenerGroup$3.run(SelectionListenerWithASTManager.java:155)
	at org.eclipse.core.internal.jobs.Worker.run(Worker.java:53)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2358062</commentid>
    <comment_count>1</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2014-02-03 11:36:51 -0500</bug_when>
    <thetext>Thanks, I&apos;ll follow up.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2358283</commentid>
    <comment_count>2</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2014-02-03 20:36:04 -0500</bug_when>
    <thetext>Unused object allocation appears to do something with it. If I capture
the constructed object, problem goes away. 1.7- modes fine in all cases.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2358284</commentid>
    <comment_count>3</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2014-02-03 20:41:27 -0500</bug_when>
    <thetext>Same underlying problem as https://bugs.eclipse.org/bugs/show_bug.cgi?id=427216,
but different manifestation.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2358285</commentid>
    <comment_count>4</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2014-02-03 20:44:36 -0500</bug_when>
    <thetext>I released a test here: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?h=BETA_JAVA8&amp;id=4168404bef1be66fa92e39948727385e68af408c

(Adjust the compliance check at the top)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2358286</commentid>
    <comment_count>5</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2014-02-03 20:45:04 -0500</bug_when>
    <thetext>(In reply to Srikanth Sankaran from comment #2)
&gt; Unused object allocation appears to do something with it.

Target type is more like it.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2358689</commentid>
    <comment_count>6</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2014-02-04 13:06:21 -0500</bug_when>
    <thetext>Fixed by improving the first change from bug 427218: one more path to ensure reporting of problems against inner invocation.

Two side effects of this fix:
- test427218_reduced reports one secondary error, not ideal, but acceptable
- testBug420525 failed due to imprecise knowledge about variableArity
  -&gt; fixed by checking direct compatibility

Test enabled and fix released via http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?h=BETA_JAVA8&amp;id=a914eaa80cfee2f1a5138d665998598bc293ae8e</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2358696</commentid>
    <comment_count>7</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2014-02-04 13:14:44 -0500</bug_when>
    <thetext>*** Bug 427216 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2358740</commentid>
    <comment_count>8</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2014-02-04 14:35:21 -0500</bug_when>
    <thetext>*** Bug 417764 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2366587</commentid>
    <comment_count>9</comment_count>
    <who name="ANIRBAN CHAKRABORTY">anchakrk</who>
    <bug_when>2014-02-21 04:36:33 -0500</bug_when>
    <thetext>Verified as working for Eclipse + Java 8 RC1 using Kepler SR1 + Eclipse Java Development Tools Patch for Java 8 Support (BETA) 1.0.0.v20140220-2054</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2366588</commentid>
    <comment_count>10</comment_count>
    <who name="ANIRBAN CHAKRABORTY">anchakrk</who>
    <bug_when>2014-02-21 04:37:02 -0500</bug_when>
    <thetext>Verified as working for Eclipse + Java 8 RC1 using Kepler SR1 + Eclipse Java Development Tools Patch for Java 8 Support (BETA) 1.0.0.v20140220-2054</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>