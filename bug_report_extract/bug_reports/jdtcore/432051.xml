<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>432051</bug_id>
          
          <creation_ts>2014-04-04 13:12:00 -0400</creation_ts>
          <short_desc>ASTParser crashes with IAE for broken source</short_desc>
          <delta_ts>2014-04-29 02:47:05 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>4.4</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows 7</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>4.4 M7</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Markus Keller">markus_keller</reporter>
          <assigned_to name="Manoj Palat Away Until May 11 2015">manpalat</assigned_to>
          <cc>jarthana</cc>
    
    <cc>manpalat</cc>
          
          <votes>0</votes>

      

      

      <flag name="review"
          id="62016"
          type_id="1"
          status="+"
          setter="jarthana"
    />

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2384862</commentid>
    <comment_count>0</comment_count>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2014-04-04 13:12:04 -0400</bug_when>
    <thetext>Paste the snippet below and then delete the line
    /**
that starts the Javadoc.
=&gt; ASTParser crashes with an IAE

Originally happened when I tried to edit org.eclipse.jdt.internal.corext.util.JavaModelUtil#getResolvedTypeName(String, IType)

Snippet:

package xy;
public class Crashing {
    /**
     * Delete line &apos;/**&apos; above.
     *
     * @param a (for example &apos;QVector&apos;)
     * @param declaringMember the context for resolving (made in)
     * @return if
     */
    void foo() {
    }
}

java.lang.IllegalArgumentException
	at org.eclipse.jdt.core.dom.ASTNode.setSourceRange(ASTNode.java:2845)
	at org.eclipse.jdt.core.dom.ASTConverter.convert(ASTConverter.java:506)
	at org.eclipse.jdt.core.dom.ASTConverter.buildBodyDeclarations(ASTConverter.java:195)
	at org.eclipse.jdt.core.dom.ASTConverter.convert(ASTConverter.java:2956)
	at org.eclipse.jdt.core.dom.ASTConverter.convert(ASTConverter.java:1372)
	at org.eclipse.jdt.core.dom.CompilationUnitResolver.convert(CompilationUnitResolver.java:292)
	at org.eclipse.jdt.core.dom.ASTParser.internalCreateAST(ASTParser.java:1209)
	at org.eclipse.jdt.core.dom.ASTParser.createAST(ASTParser.java:809)
	at org.eclipse.jdt.internal.ui.javaeditor.ASTProvider$1.run(ASTProvider.java:544)
	at org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:42)
	at org.eclipse.jdt.internal.ui.javaeditor.ASTProvider.createAST(ASTProvider.java:537)
	at org.eclipse.jdt.internal.ui.javaeditor.ASTProvider.getAST(ASTProvider.java:480)
	at org.eclipse.jdt.ui.SharedASTProvider.getAST(SharedASTProvider.java:128)
	at org.eclipse.jdt.ui.OverrideIndicatorLabelDecorator.getOverrideIndicators(OverrideIndicatorLabelDecorator.java:161)
	at ...</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2384990</commentid>
    <comment_count>1</comment_count>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2014-04-05 00:09:15 -0400</bug_when>
    <thetext>I will take a look</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2384996</commentid>
    <comment_count>2</comment_count>
      <attachid>241627</attachid>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2014-04-05 03:40:27 -0400</bug_when>
    <thetext>Created attachment 241627
Proposed Patch

Recovery Scanner returns -1 for the end of source. This is a best effort fix, where the &quot;method&quot; selector name length would be defaulted to such cases.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2385232</commentid>
    <comment_count>3</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2014-04-07 02:12:19 -0400</bug_when>
    <thetext>Fix looks good. Couple of comments:

1. The conditional expression seems unnecessary. We are concerned only about the &quot;end &lt; start&quot;, aren&apos;t we? For that, a simple &apos;if&apos; should be enough.

2. With the recovery, the AST we create contains 3 methods, two of which are bogus ones. Of course, it&apos;s only a problem when the Javadoc has any java like content, such as annotation, &apos;return&apos; etc.

Markus, are you fine with point 2?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2385773</commentid>
    <comment_count>4</comment_count>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2014-04-07 15:02:18 -0400</bug_when>
    <thetext>(In reply to Jayaprakash Arthanareeswaran from comment #3)
&gt; 2. With the recovery, the AST we create contains 3 methods, two of which are
&gt; bogus ones. Of course, it&apos;s only a problem when the Javadoc has any java
&gt; like content, such as annotation, &apos;return&apos; etc.
&gt; 
&gt; Markus, are you fine with point 2?

Totally. In such a case, AST recovery can do whatever it wants, as long as it doesn&apos;t cause exceptions.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2386002</commentid>
    <comment_count>5</comment_count>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2014-04-08 04:41:43 -0400</bug_when>
    <thetext>Thanks Jay for the review. Resolved via commit: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=b9cdfd1bbd7e66ad79e8b7a254a5313e88e4f50c</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2394408</commentid>
    <comment_count>6</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2014-04-29 02:47:05 -0400</bug_when>
    <thetext>Verified for 4.4 M7 with build I20140428-2000</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>241627</attachid>
            <date>2014-04-05 03:40:00 -0400</date>
            <delta_ts>2014-04-05 03:40:27 -0400</delta_ts>
            <desc>Proposed Patch</desc>
            <filename>Fix-for-Bug-432051-ASTParser-crashes-with-IAE-for-br.patch</filename>
            <type>text/plain</type>
            <size>3206</size>
            <attacher name="Manoj Palat Away Until May 11 2015">manpalat</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3NyYy9vcmcvZWNs
aXBzZS9qZHQvY29yZS90ZXN0cy9kb20vQVNUQ29udmVydGVyMThUZXN0LmphdmEgYi9vcmcuZWNs
aXBzZS5qZHQuY29yZS50ZXN0cy5tb2RlbC9zcmMvb3JnL2VjbGlwc2UvamR0L2NvcmUvdGVzdHMv
ZG9tL0FTVENvbnZlcnRlcjE4VGVzdC5qYXZhCmluZGV4IDM4NTY2OGYuLmQxODI2OTUgMTAwNjQ0
Ci0tLSBhL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3NyYy9vcmcvZWNsaXBzZS9q
ZHQvY29yZS90ZXN0cy9kb20vQVNUQ29udmVydGVyMThUZXN0LmphdmEKKysrIGIvb3JnLmVjbGlw
c2UuamR0LmNvcmUudGVzdHMubW9kZWwvc3JjL29yZy9lY2xpcHNlL2pkdC9jb3JlL3Rlc3RzL2Rv
bS9BU1RDb252ZXJ0ZXIxOFRlc3QuamF2YQpAQCAtMjAsNiArMjAsNyBAQAogaW1wb3J0IG9yZy5l
Y2xpcHNlLmpkdC5jb3JlLkJpbmRpbmdLZXk7CiBpbXBvcnQgb3JnLmVjbGlwc2UuamR0LmNvcmUu
SUNvbXBpbGF0aW9uVW5pdDsKIGltcG9ydCBvcmcuZWNsaXBzZS5qZHQuY29yZS5JSmF2YUVsZW1l
bnQ7CitpbXBvcnQgb3JnLmVjbGlwc2UuamR0LmNvcmUuSUphdmFQcm9qZWN0OwogaW1wb3J0IG9y
Zy5lY2xpcHNlLmpkdC5jb3JlLklNZXRob2Q7CiBpbXBvcnQgb3JnLmVjbGlwc2UuamR0LmNvcmUu
SmF2YU1vZGVsRXhjZXB0aW9uOwogCkBAIC00MzI1LDQgKzQzMjYsNDAgQEAKIAkvLyBhc3NlcnQg
dGhhdCBLZXlUb1NpZ25hdHVyZSBkb2Vzbid0IHRocm93IEFJT09CRSwgdGhlIHJlc3VsdCBjb250
YWluaW5nICchKicgaXMgYSB3b3JrYXJvdW5kIGZvciBub3csIHNlZSBodHRwczovL2J1Z3MuZWNs
aXBzZS5vcmcvNDI5MjY0CiAJYXNzZXJ0RXF1YWxzKCJ3cm9uZyBzaWduYXR1cmUiLCAiPFQ6Okxq
YXZhLmxhbmcuQ29tcGFyYWJsZTwtVFQ7Pjs+KClMQ29tcGFyYXRvcjwhKj47IiwgbmV3IEJpbmRp
bmdLZXkobWV0aG9kLmdldEtleSgpKS50b1NpZ25hdHVyZSgpKTsKIH0KKy8qKgorICogaHR0cHM6
Ly9idWdzLmVjbGlwc2Uub3JnL2J1Z3Mvc2hvd19idWcuY2dpP2lkPTQzMjA1MQorICogCisgKiBA
dGhyb3dzIEphdmFNb2RlbEV4Y2VwdGlvbgorICovCitwdWJsaWMgdm9pZCB0ZXN0QnVnNDMyMDUx
KCkgdGhyb3dzIEphdmFNb2RlbEV4Y2VwdGlvbiB7CisJU3RyaW5nIGNvbnRlbnRzID0KKwkJCSJw
dWJsaWMgY2xhc3MgWCB7XG4iICsKKwkJCSIgICAgICogRGVsZXRlIGxpbmUgJy8qKicgYWJvdmUu
XG4iICsKKwkJCSIgICAgICpcbiIgKworCQkJIiAgICAgKiBAcGFyYW0gYSAoZm9yIGV4YW1wbGUg
J1FWZWN0b3InKVxuIiArCisJCQkiICAgICAqIEBwYXJhbSBkZWNsYXJpbmdNZW1iZXIgdGhlIGNv
bnRleHQgZm9yIHJlc29sdmluZyAobWFkZSBpbilcbiIgKworCQkJIiAgICAgKiBAcmV0dXJuIGlm
XG4iICsKKwkJCSIgICAgICovXG4iICsKKwkJCSIgICAgdm9pZCBmb28oKSB7XG4iICsKKwkJCSIg
ICAgfVxuIiArCisJCQkifVxuIjsKKwl0aGlzLndvcmtpbmdDb3B5ID0gZ2V0V29ya2luZ0NvcHko
Ii9Db252ZXJ0ZXIxOC9zcmMvdGVzdDQzMjA1MS9YLmphdmEiLCBjb250ZW50cywgdHJ1ZS8qY29t
cHV0ZVByb2JsZW1zKi8pOworCUlKYXZhUHJvamVjdCBqYXZhUHJvamVjdCA9IHRoaXMud29ya2lu
Z0NvcHkuZ2V0SmF2YVByb2plY3QoKTsKKwljbGFzcyBCaW5kaW5nUmVxdWVzdG9yIGV4dGVuZHMg
QVNUUmVxdWVzdG9yIHsKKwkJSVR5cGVCaW5kaW5nIF9yZXN1bHQgPSBudWxsOworCQlwdWJsaWMg
dm9pZCBhY2NlcHRCaW5kaW5nKFN0cmluZyBiaW5kaW5nS2V5LCBJQmluZGluZyBiaW5kaW5nKSB7
CisJCQlpZiAodGhpcy5fcmVzdWx0ID09IG51bGwgJiYgYmluZGluZyAhPSBudWxsICYmIGJpbmRp
bmcuZ2V0S2luZCgpID09IElCaW5kaW5nLlRZUEUpCisJCQkJdGhpcy5fcmVzdWx0ID0gKElUeXBl
QmluZGluZykgYmluZGluZzsKKwkJfQorCX0KKwlmaW5hbCBCaW5kaW5nUmVxdWVzdG9yIHJlcXVl
c3RvciA9IG5ldyBCaW5kaW5nUmVxdWVzdG9yKCk7CisJZmluYWwgQVNUUGFyc2VyIHBhcnNlciA9
IEFTVFBhcnNlci5uZXdQYXJzZXIoQVNULkpMUzgpOworCXBhcnNlci5zZXRSZXNvbHZlQmluZGlu
Z3MoZmFsc2UpOworCXBhcnNlci5zZXRQcm9qZWN0KGphdmFQcm9qZWN0KTsKKwl0cnkgeworCQlw
YXJzZXIuY3JlYXRlQVNUcyhuZXcgSUNvbXBpbGF0aW9uVW5pdFtdIHt0aGlzLndvcmtpbmdDb3B5
fSwgbmV3IFN0cmluZ1swXSwgcmVxdWVzdG9yLCBudWxsKTsKKwl9IGNhdGNoIChJbGxlZ2FsQXJn
dW1lbnRFeGNlcHRpb24gZSkgeworCQlhc3NlcnRUcnVlKCJUZXN0IEZhaWxlZCIsIGZhbHNlKTsK
Kwl9Cit9CiB9CmRpZmYgLS1naXQgYS9vcmcuZWNsaXBzZS5qZHQuY29yZS9kb20vb3JnL2VjbGlw
c2UvamR0L2NvcmUvZG9tL0FTVENvbnZlcnRlci5qYXZhIGIvb3JnLmVjbGlwc2UuamR0LmNvcmUv
ZG9tL29yZy9lY2xpcHNlL2pkdC9jb3JlL2RvbS9BU1RDb252ZXJ0ZXIuamF2YQppbmRleCBkMDA5
NmM1Li45NjE1Y2JkIDEwMDY0NAotLS0gYS9vcmcuZWNsaXBzZS5qZHQuY29yZS9kb20vb3JnL2Vj
bGlwc2UvamR0L2NvcmUvZG9tL0FTVENvbnZlcnRlci5qYXZhCisrKyBiL29yZy5lY2xpcHNlLmpk
dC5jb3JlL2RvbS9vcmcvZWNsaXBzZS9qZHQvY29yZS9kb20vQVNUQ29udmVydGVyLmphdmEKQEAg
LTUwMyw2ICs1MDMsNyBAQAogCQltZXRob2ROYW1lLmludGVybmFsU2V0SWRlbnRpZmllcihuZXcg
U3RyaW5nKG1ldGhvZERlY2xhcmF0aW9uLnNlbGVjdG9yKSk7CiAJCWludCBzdGFydCA9IG1ldGhv
ZERlY2xhcmF0aW9uLnNvdXJjZVN0YXJ0OwogCQlpbnQgZW5kID0gcmV0cmlldmVJZGVudGlmaWVy
RW5kUG9zaXRpb24oc3RhcnQsIG1ldGhvZERlY2xhcmF0aW9uLnNvdXJjZUVuZCk7CisJCWVuZCA9
IGVuZCA8IHN0YXJ0ID8gc3RhcnQgKyBtZXRob2REZWNsYXJhdGlvbi5zZWxlY3Rvci5sZW5ndGgg
OiBlbmQ7IC8vIG5haXZlIHJlY292ZXJ5IHdpdGggbWV0aG9kIG5hbWUKIAkJbWV0aG9kTmFtZS5z
ZXRTb3VyY2VSYW5nZShzdGFydCwgZW5kIC0gc3RhcnQgKyAxKTsKIAkJbWV0aG9kRGVjbC5zZXRO
YW1lKG1ldGhvZE5hbWUpOwogCQlvcmcuZWNsaXBzZS5qZHQuaW50ZXJuYWwuY29tcGlsZXIuYXN0
LlR5cGVSZWZlcmVuY2VbXSB0aHJvd25FeGNlcHRpb25zID0gbWV0aG9kRGVjbGFyYXRpb24udGhy
b3duRXhjZXB0aW9uczs=
</data>

          </attachment>
      

    </bug>

</bugzilla>