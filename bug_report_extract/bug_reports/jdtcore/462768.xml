<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>462768</bug_id>
          
          <creation_ts>2015-03-21 13:29:00 -0400</creation_ts>
          <short_desc>[null] NPE when using linked folder for external annotations</short_desc>
          <delta_ts>2015-04-24 00:27:50 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>4.5</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          <see_also>https://git.eclipse.org/r/45301</see_also>
    
    <see_also>https://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=07efa537488d0df9da9dc6880afc536aaccc6b60</see_also>
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>4.5 M7</target_milestone>
          <dependson>463931</dependson>
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Stephan Herrmann">stephan.herrmann</reporter>
          <assigned_to name="Stephan Herrmann">stephan.herrmann</assigned_to>
          <cc>manpalat</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2535445</commentid>
    <comment_count>0</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2015-03-21 13:29:58 -0400</bug_when>
    <thetext>I configured a linked folder as the annotationpath for rt.jar and then tried to open j.l.String from the Package Explorer. Here&apos;s what I got:

java.lang.NullPointerException
	at org.eclipse.jdt.internal.core.ClassFile.setupExternalAnnotationProvider(ClassFile.java:401)
	at org.eclipse.jdt.internal.core.ClassFile.getJarBinaryTypeInfo(ClassFile.java:379)
	at org.eclipse.jdt.internal.core.ClassFile.getBinaryTypeInfo(ClassFile.java:300)
	at org.eclipse.jdt.internal.core.ClassFile.getBinaryTypeInfo(ClassFile.java:294)
	at org.eclipse.jdt.internal.core.ClassFile.buildStructure(ClassFile.java:95)
	at org.eclipse.jdt.internal.core.Openable.generateInfos(Openable.java:259)
	at org.eclipse.jdt.internal.core.JavaElement.openWhenClosed(JavaElement.java:642)
	at org.eclipse.jdt.internal.core.JavaElement.getElementInfo(JavaElement.java:336)
	at org.eclipse.jdt.internal.core.JavaElement.getElementInfo(JavaElement.java:319)
	at org.eclipse.jdt.internal.core.Openable.getBuffer(Openable.java:285)
	at org.eclipse.jdt.internal.core.ClassFile.getBuffer(ClassFile.java:439)
	at org.eclipse.jdt.internal.core.ClassFile.getSourceRange(ClassFile.java:598)
	at org.eclipse.jdt.internal.ui.javaeditor.EditorUtility.getEditorID(EditorUtility.java:421)
	at org.eclipse.jdt.internal.ui.javaeditor.EditorUtility.openInEditor(EditorUtility.java:179)
	at org.eclipse.jdt.ui.actions.OpenAction.run(OpenAction.java:268)
	at org.eclipse.jdt.ui.actions.OpenAction.run(OpenAction.java:233)
	at org.eclipse.jdt.ui.actions.SelectionDispatchAction.dispatchRun(SelectionDispatchAction.java:275)
	at org.eclipse.jdt.ui.actions.SelectionDispatchAction.run(SelectionDispatchAction.java:251)
	at org.eclipse.jdt.internal.ui.packageview.PackageExplorerActionGroup.handleOpen(PackageExplorerActionGroup.java:376)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2535447</commentid>
    <comment_count>1</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2015-03-21 13:35:03 -0400</bug_when>
    <thetext>Also using the root of a project doesn&apos;t make us happy:

java.lang.IllegalArgumentException: Path must include project and resource name: /nulltest
	at org.eclipse.core.runtime.Assert.isLegal(Assert.java:63)
	at org.eclipse.core.internal.resources.Workspace.newResource(Workspace.java:2069)
	at org.eclipse.core.internal.resources.Container.getFolder(Container.java:201)
	at org.eclipse.jdt.internal.core.ClassFile.setupExternalAnnotationProvider(ClassFile.java:397)
	at org.eclipse.jdt.internal.core.ClassFile.getJarBinaryTypeInfo(ClassFile.java:379)
	at org.eclipse.jdt.internal.core.ClassFile.getBinaryTypeInfo(ClassFile.java:300)
	at org.eclipse.jdt.internal.core.ClassFile.getBinaryTypeInfo(ClassFile.java:294)
	at org.eclipse.jdt.internal.core.ClassFile.buildStructure(ClassFile.java:95)
	at org.eclipse.jdt.internal.core.Openable.generateInfos(Openable.java:259)


I need to check, which of these can be made to work vs. be prohibited by the configuration dialog.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2542256</commentid>
    <comment_count>2</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2015-04-04 19:09:09 -0400</bug_when>
    <thetext>(In reply to Stephan Herrmann from comment #0)
&gt; I configured a linked folder as the annotationpath for rt.jar and then tried
&gt; to open j.l.String from the Package Explorer. Here&apos;s what I got:

To be precise: error occurs when the annotationpath points to a *virtual* resource.

I feel that javadoc of IResource.getLocation() and the implementation don&apos;t match, but after filing bug 463931 I&apos;m leaning towards seeing this as a specification bug. Which would leave us with the fact that virtual resources are not suitable as an annotation path (where we *need* a java.io.File).

I&apos;ll turn the NPE into a logged error, and add corresponding checks to the UI to prevent this situation in normal usage.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2542257</commentid>
    <comment_count>3</comment_count>
    <who name="Eclipse Genie">genie</who>
    <bug_when>2015-04-04 22:07:29 -0400</bug_when>
    <thetext>New Gerrit change created: https://git.eclipse.org/r/45301</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2542280</commentid>
    <comment_count>4</comment_count>
    <who name="Eclipse Genie">genie</who>
    <bug_when>2015-04-05 07:27:32 -0400</bug_when>
    <thetext>Gerrit change https://git.eclipse.org/r/45301 was merged to [master].
Commit: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=07efa537488d0df9da9dc6880afc536aaccc6b60</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2542282</commentid>
    <comment_count>5</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2015-04-05 07:40:58 -0400</bug_when>
    <thetext>(In reply to Eclipse Genie from comment #4)
&gt; Gerrit change https://git.eclipse.org/r/45301 was merged to [master].
&gt; Commit:
&gt; http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/
&gt; ?id=07efa537488d0df9da9dc6880afc536aaccc6b60

The change addes special-case handling for project roots configured as annotationpath. Also, adding a test for this unveiled insufficient clean-up in ExternalAnnotationTracker - fixed.

Usage of virtual folders no longer triggers NPE, more to follow in bug 463936.

Resolved for 4.5 M7</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2551058</commentid>
    <comment_count>6</comment_count>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2015-04-24 00:27:50 -0400</bug_when>
    <thetext>Verified for Eclipse 4.5 Mars M7 Build id: I20150422-1000</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>