<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>406800</bug_id>
          
          <creation_ts>2013-04-29 10:27:00 -0400</creation_ts>
          <short_desc>[CBI] ECJ.jar produced by CBI build still has maven info</short_desc>
          <delta_ts>2013-05-09 00:57:39 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>4.3</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows 7</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>4.3 RC1</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jay Arthanareeswaran">jarthana</reporter>
          <assigned_to name="Jay Arthanareeswaran">jarthana</assigned_to>
          <cc>daniel_megert</cc>
    
    <cc>david_williams</cc>
    
    <cc>thanh.ha</cc>
          
          <votes>0</votes>

      

      

      <flag name="review"
          id="57108"
          type_id="1"
          status="+"
          setter="david_williams"
    />

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2249861</commentid>
    <comment_count>0</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-04-29 10:27:55 -0400</bug_when>
    <thetext>Refer to bug 401040.

CBI produced ECJ contains META-INF/maven, which isn&apos;t necessary. The folder needs to be removed.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2250062</commentid>
    <comment_count>1</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-04-29 15:29:46 -0400</bug_when>
    <thetext>I was playing around locally with the following change in org.eclipse.jdt.core/pom.xml :

              &lt;archive&gt;
         	        &lt;addMavenDescriptor&gt;false&lt;/addMavenDescriptor&gt;
     		  &lt;/archive&gt;

This fix seem sufficient for &lt;id&gt;antadapter&lt;/id&gt; but not for the &lt;id&gt;batch-compiler&lt;/id&gt;. 

David, do you see why/how the batch-compiler bundle is different from antadapter?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2250076</commentid>
    <comment_count>2</comment_count>
    <who name="David Williams">david_williams</who>
    <bug_when>2013-04-29 16:12:00 -0400</bug_when>
    <thetext>I don&apos;t know about &quot;compiler&quot; per se, but in bug 401040, I found there were three places that needed 

       &lt;archive&gt;
          &lt;addMavenDescriptor&gt;false&lt;/addMavenDescriptor&gt;
       &lt;/archive&gt;

Every instance of tycho-source-plugin and tycho-source-feature-plugin as well as 
   &lt;plugin&gt;
     &lt;groupId&gt;org.eclipse.tycho&lt;/groupId&gt;
     &lt;artifactId&gt;tycho-packaging-plugin&lt;/artifactId&gt;
     &lt;configuration&gt;
       &lt;archive&gt;
          &lt;addMavenDescriptor&gt;false&lt;/addMavenDescriptor&gt;
       &lt;/archive&gt;

Normally, you&apos;d &quot;inherit&quot; these from parent POM, but if you have &quot;overridden&quot; any of these, you may have to add the &quot;configuration&quot; section, and add 
       &lt;archive&gt;
          &lt;addMavenDescriptor&gt;false&lt;/addMavenDescriptor&gt;
       &lt;/archive&gt;

Does that help? Or want me to look at your code/pom closer?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2250432</commentid>
    <comment_count>3</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-04-30 09:37:39 -0400</bug_when>
    <thetext>I have managed to keep the maven info successfully out of the bundle when it&apos;s created first time. However, when it&apos;s repackaged with more classes, it puts it back. The code that does the repackaging is in org.eclipse.compiler.tool/pom.xml.

To be precise, it&apos;s inside:

 &lt;id&gt;update-ecj&lt;/id&gt;
 &lt;phase&gt;process-classes&lt;/phase&gt;

Now addMavenDescriptor tag to this configuration doesn&apos;t seem to help. Should it be something else for this scenario?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2250903</commentid>
    <comment_count>4</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-04-30 23:18:02 -0400</bug_when>
    <thetext>I doubt I can fix this for M7. Adjusting the target.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2253800</commentid>
    <comment_count>5</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-05-08 01:19:46 -0400</bug_when>
    <thetext>Copying Thanh as I believe he authored the pom files for the custom JAR and might be able to guide us. 

Thanh, do you see why the suggestion from David wouldn&apos;t work for the custom JAR when it&apos;s repackaged? I see the JAR being created without the maven info but when it&apos;s being re-packaged, the mavens files find their way back in to the JAR.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2253819</commentid>
    <comment_count>6</comment_count>
    <who name="David Williams">david_williams</who>
    <bug_when>2013-05-08 02:42:39 -0400</bug_when>
    <thetext>(In reply to comment #5)
&gt; Copying Thanh as I believe he authored the pom files for the custom JAR and
&gt; might be able to guide us. 
&gt; 
&gt; Thanh, do you see why the suggestion from David wouldn&apos;t work for the custom
&gt; JAR when it&apos;s repackaged? I see the JAR being created without the maven info
&gt; but when it&apos;s being re-packaged, the mavens files find their way back in to
&gt; the JAR.

I&apos;m sure its more complicated than this, but, to sanity check the easiest explanation ... has &apos;jdt.core&apos; changed qualifiers since doing this work? Since M7? We have the &quot;replaceWithBaseline&quot; turned back on now (post M7) so you might be seeing one thing being produced &quot;on disk&quot;, but then the comparator comes along and says &quot;the qualifier has not changed, I&apos;ll just take the existing one from the reference repo&quot;. So, if you have not changed it for for other reasons, since M7, you should &apos;touch&apos; it. Some projects have a &quot;special file&quot; for this purpose, others add a comment to the end of their build.properties file: 
http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/tree/org.eclipse.jdt.core/build.properties
similar to 
!bug 406800 touching project to make sure qualifier increases

I see from looking at comparator log in last build, though hard to interpret in your case, it does look like an &quot;old&quot; version of jdt.core is being used instead of a freshly generated one. 

http://download.eclipse.org/eclipse/downloads/drops4/I20130507-1100/buildlogs/comparatorlogs/buildtimeComparatorUnanticipated.log

The key lines are: 
   The main artifact has been replaced with the baseline version.
   The following attached artifacts have been replaced with the baseline version: [sources, batch-compiler]


And from there, I&apos;m sure 100 other things could (still) be going wrong :/
So Thanh&apos;s advice most welcome.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2253882</commentid>
    <comment_count>7</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-05-08 04:54:03 -0400</bug_when>
    <thetext>(In reply to comment #6)
&gt; And from there, I&apos;m sure 100 other things could (still) be going wrong :/
&gt; So Thanh&apos;s advice most welcome.

Luckily for me, there weren&apos;t any. It worked and thanks! I will run some more tests, then post the patch.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2253928</commentid>
    <comment_count>8</comment_count>
      <attachid>230641</attachid>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-05-08 06:24:31 -0400</bug_when>
    <thetext>Created attachment 230641
Patch

Patch with pom changes.

Dani, can you please review this change? Thanks!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2253942</commentid>
    <comment_count>9</comment_count>
    <who name="Dani Megert">daniel_megert</who>
    <bug_when>2013-05-08 06:50:01 -0400</bug_when>
    <thetext>(In reply to comment #8)
&gt; Created attachment 230641 [details] [diff]
&gt; Patch
&gt; 
&gt; Patch with pom changes.
&gt; 
&gt; Dani, can you please review this change? Thanks!

I can&apos;t review that patch - not enough knowledge here.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2253994</commentid>
    <comment_count>10</comment_count>
    <who name="David Williams">david_williams</who>
    <bug_when>2013-05-08 08:36:14 -0400</bug_when>
    <thetext>patch looks correct.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2254025</commentid>
    <comment_count>11</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-05-08 09:16:46 -0400</bug_when>
    <thetext>Thanks for the review, David!

Patch released in master via commit:

http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=e429786c61526719e3444113e6426f6ca5ac76c8</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2254032</commentid>
    <comment_count>12</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-05-08 09:21:03 -0400</bug_when>
    <thetext>David, this fix touched both the bundled, o.e.jdt.core and o.e.compiler.tool. I don&apos;t need to touch anything else, do I? Sorry, I can&apos;t quite figure this out and don&apos;t want another build failure.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2254044</commentid>
    <comment_count>13</comment_count>
    <who name="David Williams">david_williams</who>
    <bug_when>2013-05-08 09:35:17 -0400</bug_when>
    <thetext>(In reply to comment #12)
&gt; David, this fix touched both the bundled, o.e.jdt.core and
&gt; o.e.compiler.tool. I don&apos;t need to touch anything else, do I? Sorry, I can&apos;t
&gt; quite figure this out and don&apos;t want another build failure

Well, complication number 142, POM only changes are NOT included in computing the qualifier! Weird, eh? (but, that is what you want, most of the time) ... so I&apos;d still touch another file, such as a comment in build.properties, or add a special file, just for this purpose. You don&apos;t have to do it with &quot;extra file&quot;, but, if you do, the convention is to use &quot;forceQualifierUpdate.txt&quot; at the root (and it is not &quot;exported&quot; to bundle or anything. Such as here&apos;s one example, 

http://git.eclipse.org/c/equinox/rt.equinox.bundles.git/plain/bundles/org.eclipse.equinox.http.servletbridge/forceQualifierUpdate.txt</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2254048</commentid>
    <comment_count>14</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-05-08 09:40:21 -0400</bug_when>
    <thetext>(In reply to comment #13)
&gt; Well, complication number 142, POM only changes are NOT included in
&gt; computing the qualifier! Weird, eh? (but, that is what you want, most of the
&gt; time) ... so I&apos;d still touch another file, such as a comment in
&gt; build.properties, or add a special file, just for this purpose. You don&apos;t
&gt; have to do it with &quot;extra file&quot;, but, if you do, the convention is to use
&gt; &quot;forceQualifierUpdate.txt&quot; at the root (and it is not &quot;exported&quot; to bundle
&gt; or anything. Such as here&apos;s one example, 

Here is another question you may have already answered before - should I &apos;touch&apos; both the bundles?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2254062</commentid>
    <comment_count>15</comment_count>
    <who name="David Williams">david_williams</who>
    <bug_when>2013-05-08 09:57:53 -0400</bug_when>
    <thetext>(In reply to comment #14)
&gt; (In reply to comment #13)

&gt; 
&gt; Here is another question you may have already answered before - should I
&gt; &apos;touch&apos; both the bundles?

I would, just to be safe.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2254397</commentid>
    <comment_count>16</comment_count>
    <who name="David Williams">david_williams</who>
    <bug_when>2013-05-08 16:21:20 -0400</bug_when>
    <thetext>Congratulations! Your jars look clean in latest build

http://download.eclipse.org/eclipse/downloads/drops4/I20130508-1200/

AND the &quot;comparator log&quot; looks clean: 

http://download.eclipse.org/eclipse/downloads/drops4/I20130508-1200/buildlogs/comparatorlogs/buildtimeComparatorUnanticipated.log

Let me know if you make changes before the next 8 PM build, I&apos;m anxious to see how comparator log looks when you _don&apos;t_ make changes ... (just because we had such problems with &quot;jdt.core&quot; before Tycho patch applied).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2254538</commentid>
    <comment_count>17</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-05-09 00:57:39 -0400</bug_when>
    <thetext>(In reply to comment #16)
&gt; Congratulations! Your jars look clean in latest build

Thanks for verifying, David. And I can confirm things are looking good with the 8 PM build also.

&gt; Let me know if you make changes before the next 8 PM build, I&apos;m anxious to
&gt; see how comparator log looks when you _don&apos;t_ make changes ... (just because
&gt; we had such problems with &quot;jdt.core&quot; before Tycho patch applied).

So, we didn&apos;t make any changes for the 8 PM build, but the comparator log looks bigger in size and I don&apos;t know what it means.

http://download.eclipse.org/eclipse/downloads/drops4/I20130508-2000/buildlogs/comparatorlogs/buildtimeComparatorUnanticipated.log</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>230641</attachid>
            <date>2013-05-08 06:24:00 -0400</date>
            <delta_ts>2013-05-08 06:24:31 -0400</delta_ts>
            <desc>Patch</desc>
            <filename>Fix-for-bug-406800.patch</filename>
            <type>text/plain</type>
            <size>2168</size>
            <attacher name="Jay Arthanareeswaran">jarthana</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb21waWxlci5hcHQvcG9tLnhtbCBiL29yZy5l
Y2xpcHNlLmpkdC5jb21waWxlci5hcHQvcG9tLnhtbAppbmRleCAzNzBhYzRmLi5lNDhlMGY0IDEw
MDY0NAotLS0gYS9vcmcuZWNsaXBzZS5qZHQuY29tcGlsZXIuYXB0L3BvbS54bWwKKysrIGIvb3Jn
LmVjbGlwc2UuamR0LmNvbXBpbGVyLmFwdC9wb20ueG1sCkBAIC0yNyw0ICsyNyw5IEBACiAgICAg
ICAgIDxhcnRpZmFjdElkPm1hdmVuLWFudHJ1bi1wbHVnaW48L2FydGlmYWN0SWQ+CiAgICAgICAg
IDx2ZXJzaW9uPjEuNzwvdmVyc2lvbj4KKwkJPGNvbmZpZ3VyYXRpb24+CisJCQk8YXJjaGl2ZT4K
KwkJCQk8YWRkTWF2ZW5EZXNjcmlwdG9yPmZhbHNlPC9hZGRNYXZlbkRlc2NyaXB0b3I+CisJCQk8
L2FyY2hpdmU+CisJCTwvY29uZmlndXJhdGlvbj4KICAgICAgICAgPGV4ZWN1dGlvbnM+CiAgICAg
ICAgICAgPGV4ZWN1dGlvbj4KQEAgLTMyLDQgKzM3LDcgQEAKICAgICAgICAgICAgIDxwaGFzZT5w
cm9jZXNzLWNsYXNzZXM8L3BoYXNlPgogICAgICAgICAgICAgPGNvbmZpZ3VyYXRpb24+CisJCQkJ
PGFyY2hpdmU+CisJCQkJCTxhZGRNYXZlbkRlc2NyaXB0b3I+ZmFsc2U8L2FkZE1hdmVuRGVzY3Jp
cHRvcj4KKwkJCQk8L2FyY2hpdmU+CiAgICAgICAgICAgICAgIDx0YXJnZXQ+CiAKZGlmZiAtLWdp
dCBhL29yZy5lY2xpcHNlLmpkdC5jb21waWxlci50b29sL3BvbS54bWwgYi9vcmcuZWNsaXBzZS5q
ZHQuY29tcGlsZXIudG9vbC9wb20ueG1sCmluZGV4IDdiNzg0ZjAuLjczYzlhNzAgMTAwNjQ0Ci0t
LSBhL29yZy5lY2xpcHNlLmpkdC5jb21waWxlci50b29sL3BvbS54bWwKKysrIGIvb3JnLmVjbGlw
c2UuamR0LmNvbXBpbGVyLnRvb2wvcG9tLnhtbApAQCAtMjcsNCArMjcsOSBAQAogICAgICAgICA8
YXJ0aWZhY3RJZD5tYXZlbi1hbnRydW4tcGx1Z2luPC9hcnRpZmFjdElkPgogICAgICAgICA8dmVy
c2lvbj4xLjc8L3ZlcnNpb24+CisJCTxjb25maWd1cmF0aW9uPgorCQkJPGFyY2hpdmU+CisJCQkJ
PGFkZE1hdmVuRGVzY3JpcHRvcj5mYWxzZTwvYWRkTWF2ZW5EZXNjcmlwdG9yPgorCQkJPC9hcmNo
aXZlPgorCQk8L2NvbmZpZ3VyYXRpb24+CiAgICAgICAgIDxleGVjdXRpb25zPgogICAgICAgICAg
IDxleGVjdXRpb24+CkBAIC0zMiw0ICszNyw3IEBACiAgICAgICAgICAgICA8cGhhc2U+cHJvY2Vz
cy1jbGFzc2VzPC9waGFzZT4KICAgICAgICAgICAgIDxjb25maWd1cmF0aW9uPgorCQkJCTxhcmNo
aXZlPgorCQkJCQk8YWRkTWF2ZW5EZXNjcmlwdG9yPmZhbHNlPC9hZGRNYXZlbkRlc2NyaXB0b3I+
CisJCQkJPC9hcmNoaXZlPgogICAgICAgICAgICAgICA8dGFyZ2V0PgogCmRpZmYgLS1naXQgYS9v
cmcuZWNsaXBzZS5qZHQuY29yZS9wb20ueG1sIGIvb3JnLmVjbGlwc2UuamR0LmNvcmUvcG9tLnht
bAppbmRleCA2OTE2YTU0Li5mOTBlMzcxIDEwMDY0NAotLS0gYS9vcmcuZWNsaXBzZS5qZHQuY29y
ZS9wb20ueG1sCisrKyBiL29yZy5lY2xpcHNlLmpkdC5jb3JlL3BvbS54bWwKQEAgLTM0LDUgKzM0
LDggQEAKICAgICAgICAgICAgICAgPGdvYWw+Y3VzdG9tLWJ1bmRsZTwvZ29hbD4KICAgICAgICAg
ICAgIDwvZ29hbHM+Ci0gICAgICAgICAgICA8Y29uZmlndXJhdGlvbj4KKwkJCTxjb25maWd1cmF0
aW9uPgorCQkJCTxhcmNoaXZlPgorCQkJCQk8YWRkTWF2ZW5EZXNjcmlwdG9yPmZhbHNlPC9hZGRN
YXZlbkRlc2NyaXB0b3I+CisJCQkJPC9hcmNoaXZlPgogICAgICAgICAgICAgICA8YnVuZGxlTG9j
YXRpb24+JHtwcm9qZWN0LmJhc2VkaXJ9L3NjcmlwdHMvYW50YWRhcHRlcjwvYnVuZGxlTG9jYXRp
b24+CiAgICAgICAgICAgICAgIDxjbGFzc2lmaWVyPmFudGFkYXB0ZXI8L2NsYXNzaWZpZXI+CkBA
IC01NSw0ICs1OCw3IEBACiAgICAgICAgICAgICA8L2dvYWxzPgogICAgICAgICAgICAgPGNvbmZp
Z3VyYXRpb24+CisJCQkJPGFyY2hpdmU+CisJCQkJCTxhZGRNYXZlbkRlc2NyaXB0b3I+ZmFsc2U8
L2FkZE1hdmVuRGVzY3JpcHRvcj4KKwkJCQk8L2FyY2hpdmU+CiAgICAgICAgICAgICAgIDxidW5k
bGVMb2NhdGlvbj4ke3Byb2plY3QuYmFzZWRpcn0vc2NyaXB0cy9iaW5hcnk8L2J1bmRsZUxvY2F0
aW9uPgogICAgICAgICAgICAgICA8Y2xhc3NpZmllcj5iYXRjaC1jb21waWxlcjwvY2xhc3NpZmll
cj4=
</data>

          </attachment>
      

    </bug>

</bugzilla>