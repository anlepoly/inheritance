<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>438945</bug_id>
          
          <creation_ts>2014-07-04 14:07:00 -0400</creation_ts>
          <short_desc>[1.8] NullPointerException InferenceContext18.checkExpression in java 8 with generics, primitives, and overloading</short_desc>
          <delta_ts>2015-01-20 00:51:55 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>4.4</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>4.4.2</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Tim W">timw.at.work</reporter>
          <assigned_to name="Stephan Herrmann">stephan.herrmann</assigned_to>
          <cc>alex.blewitt</cc>
    
    <cc>jarthana</cc>
    
    <cc>manpalat</cc>
    
    <cc>shankhba</cc>
    
    <cc>srikanth_sankaran</cc>
    
    <cc>stephan.herrmann</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2424621</commentid>
    <comment_count>0</comment_count>
    <who name="Tim W">timw.at.work</who>
    <bug_when>2014-07-04 14:07:25 -0400</bug_when>
    <thetext>Version: Luna 4.4.0 20140612-0600

Steps:

ensure default-configured eclipse (build-on-save primarily)

1) create a new Java class in a new Java project
2) paste the code included below
3) save the file

Expected result:
save completes

Actual results:
NullPointerException pop-up and logs that point to the JDT

Stack (hand-entered):
!ENTRY org.eclipse.jdt.ui 4 0 2014-07-04 13:54:27.057
!MESSAGE Error in JDT Core during AST creation
!STACK 0
java.lang.NullPointerException
  at org.eclipse.jdt.internal.compiler.lookup.InferenceContext18.checkExpression(InferenceContext18.java:796)
  at org.eclipse.jdt.internal.compiler.lookup.InferenceContext18.moreSpecificMain(InferenceContext18.java:746)
  at org.eclipse.jdt.internal.compiler.lookup.InferenceContext18.isMoreSpecificThan(InferenceContext18.java:694)
  at org.eclipse.jdt.internal.compiler.lookup.Scope.mostSpecificMethodBinding(Scope.java:4445)
...

Code:
public class Test {
    public static void error() {
        test(Test::works);
        test(Test::broken);
    }

    private static &lt;T&gt; void test(ToLongFunction&lt;T&gt; func) {}
    private static &lt;T&gt; void test(ToIntFunction&lt;T&gt; func) {}

    private static int broken(Object o) { return 0; }
    private static long works(Object o) { return 0; }
}

Workarounds:
- do not overload (name the test() methods testInt / testLong)
- OR make test() functions non-generic (remove the &lt;T&gt; and make the argument types ...Function&lt;?&gt; or ...Function&lt;Object&gt;)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2424622</commentid>
    <comment_count>1</comment_count>
    <who name="Tim W">timw.at.work</who>
    <bug_when>2014-07-04 14:10:26 -0400</bug_when>
    <thetext>I forgot to add:
JDK:
java version &quot;1.8.0_05&quot;
Java(TM) SE Runtime Environment (build 1.8.0_05-b13)
Java HotSpot(TM) 64-Bit Server VM (build 25.5-b02, mixed mode)

Javac:
javac 1.8.0_05

The same JDK reported above is the one running Eclipse itself.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2424679</commentid>
    <comment_count>2</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2014-07-04 20:13:19 -0400</bug_when>
    <thetext>Thanks for taking a look - Stephan.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2424727</commentid>
    <comment_count>3</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2014-07-05 11:10:09 -0400</bug_when>
    <thetext>(In reply to Srikanth Sankaran  - On vacation till Jul 13th 2014  from comment #2)
&gt; Thanks for taking a look - Stephan.

Sure.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2429915</commentid>
    <comment_count>4</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2014-07-21 13:42:33 -0400</bug_when>
    <thetext>Given we have a reproducible[1] exception, would this qualify as a training task for type inference? Any volunteer? :)

[1] (hopefully, I haven&apos;t tested)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2430011</commentid>
    <comment_count>5</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2014-07-22 01:15:54 -0400</bug_when>
    <thetext>(In reply to Stephan Herrmann from comment #4)
&gt; Given we have a reproducible[1] exception, would this qualify as a training
&gt; task for type inference? Any volunteer? :)

I&apos;ll take this one.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2435423</commentid>
    <comment_count>6</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2014-08-05 01:52:15 -0400</bug_when>
    <thetext>Retargetting to M2, as I don&apos;t expect to finish work on these before this week&apos;s build(s)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2443677</commentid>
    <comment_count>7</comment_count>
    <who name="shankha banerjee">shankhba</who>
    <bug_when>2014-08-26 12:09:53 -0400</bug_when>
    <thetext>Hi Tim,
Could you please check with the latest build (Mars) and let us know if you still see the issue.

Thanks</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2443911</commentid>
    <comment_count>8</comment_count>
    <who name="shankha banerjee">shankhba</who>
    <bug_when>2014-08-26 23:47:27 -0400</bug_when>
    <thetext>I tried out with I20140606-1215.
I was not able to reproduce the issue.

Thanks</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2443912</commentid>
    <comment_count>9</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2014-08-26 23:55:33 -0400</bug_when>
    <thetext>(In reply to shankha banerjee from comment #8)
&gt; I tried out with I20140606-1215.
&gt; I was not able to reproduce the issue.

Shankha, I can reproduce this with M1 build. I see you tried with a build older than the one reported from. Try a newer version.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2443917</commentid>
    <comment_count>10</comment_count>
    <who name="shankha banerjee">shankhba</who>
    <bug_when>2014-08-27 00:17:55 -0400</bug_when>
    <thetext>The problem is reproducible with tip code.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2446871</commentid>
    <comment_count>11</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2014-09-03 03:04:10 -0400</bug_when>
    <thetext>Shankha is busy with other tasks, so I will look at this one for M2.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2446890</commentid>
    <comment_count>12</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2014-09-03 03:43:31 -0400</bug_when>
    <thetext>Disabled test released here: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=f59b711176ec061fe20b7b3f340d714d67ced1a8</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2452176</commentid>
    <comment_count>13</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2014-09-16 04:37:39 -0400</bug_when>
    <thetext>Hudson is looking into this :)
See https://git.eclipse.org/r/#/c/33425/</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2452235</commentid>
    <comment_count>14</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2014-09-16 05:44:09 -0400</bug_when>
    <thetext>We already know that it&apos;s an exact method reference, which has an exactMethodBinding. Solution is to use just that binding rather than doing it the hard way via findCompileTimeMethodTargeting().

While I was at it I also fixed the block structure: no use looping over checks that don&apos;t even depend on the loop variable.

Released for 4.5 M2 via http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=c9c1bc452cc86c18011e1d146fda7426c2ac0742</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2452352</commentid>
    <comment_count>15</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2014-09-16 08:30:53 -0400</bug_when>
    <thetext>Manoj, please add this to the verification list for M2. 

Thanks a lot Stephan.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2453701</commentid>
    <comment_count>16</comment_count>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2014-09-18 09:42:31 -0400</bug_when>
    <thetext>Verified for Eclipse Mars 4.5M2 Build id: I20140918-0330</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2463147</commentid>
    <comment_count>17</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2014-10-10 16:42:22 -0400</bug_when>
    <thetext>*** Bug 446687 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2463193</commentid>
    <comment_count>18</comment_count>
    <who name="Alex Blewitt">alex.blewitt</who>
    <bug_when>2014-10-10 19:19:59 -0400</bug_when>
    <thetext>Can this be backported for 4.4.2?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2473918</commentid>
    <comment_count>19</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2014-10-30 02:59:12 -0400</bug_when>
    <thetext>Reopening for back porting</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2477656</commentid>
    <comment_count>20</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2014-11-06 03:08:16 -0500</bug_when>
    <thetext>Released in R4_4_maintenance via commit(s):

http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?h=R4_4_maintenance&amp;id=9c168a1081dbde5a93a187e56df1e06a57003b0d

http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?h=R4_4_maintenance&amp;id=9596ae6738dc97993d5238f6f65e0ecaeb634ef7</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2507633</commentid>
    <comment_count>21</comment_count>
    <who name="shankha banerjee">shankhba</who>
    <bug_when>2015-01-20 00:51:55 -0500</bug_when>
    <thetext>Verified for 4.4.2 RC1 with build M20150114-1500.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>