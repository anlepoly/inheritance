<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>461250</bug_id>
          
          <creation_ts>2015-03-02 17:34:00 -0500</creation_ts>
          <short_desc>ArrayIndexOutOfBoundsException in SourceTypeBinding.fields</short_desc>
          <delta_ts>2015-05-02 18:38:31 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>4.4.1</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          <see_also>https://git.eclipse.org/r/43050</see_also>
    
    <see_also>https://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=841e5207182e4cce5a1b83b4f81bf082fd69694f</see_also>
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>4.5 M6</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ca Ca">carmi</reporter>
          <assigned_to name="Stephan Herrmann">stephan.herrmann</assigned_to>
          <cc>carmi</cc>
    
    <cc>jarthana</cc>
    
    <cc>stephan.herrmann</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2525835</commentid>
    <comment_count>0</comment_count>
      <attachid>251227</attachid>
    <who name="Ca Ca">carmi</who>
    <bug_when>2015-03-02 17:34:36 -0500</bug_when>
    <thetext>Created attachment 251227
Repro code. Just run and you&apos;ll get the exception.

Repro case attached.

Stack trace:

Exception in thread &quot;main&quot; java.lang.ArrayIndexOutOfBoundsException: 1
	at org.eclipse.jdt.internal.compiler.lookup.SourceTypeBinding.fields(SourceTypeBinding.java:720)
	at org.eclipse.jdt.internal.compiler.lookup.SourceTypeBinding.faultInTypesForFieldsAndMethods(SourceTypeBinding.java:698)
	at org.eclipse.jdt.internal.compiler.lookup.CompilationUnitScope.faultInTypes(CompilationUnitScope.java:420)
	at org.eclipse.jdt.core.dom.CompilationUnitResolver.resolve(CompilationUnitResolver.java:1193)
	at org.eclipse.jdt.core.dom.CompilationUnitResolver.resolve(CompilationUnitResolver.java:685)
	at org.eclipse.jdt.core.dom.ASTParser.internalCreateAST(ASTParser.java:1181)
	at org.eclipse.jdt.core.dom.ASTParser.createAST(ASTParser.java:807)
	at com.company.HelloWorld.parseAndResolveSource(HelloWorld.java:29)
	at com.company.HelloWorld.main(HelloWorld.java:18)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:601)
	at com.intellij.rt.execution.application.AppMain.main(AppMain.java:134)

(yes, I created the repro in IntelliJ :) )</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2525839</commentid>
    <comment_count>1</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2015-03-02 18:07:14 -0500</bug_when>
    <thetext>Thanks for the convenient repro!

The problem is caused by very unhappy re-entrance during resolution of buggy code.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2525840</commentid>
    <comment_count>2</comment_count>
    <who name="Eclipse Genie">genie</who>
    <bug_when>2015-03-02 18:11:08 -0500</bug_when>
    <thetext>New Gerrit change created: https://git.eclipse.org/r/43050</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2525845</commentid>
    <comment_count>3</comment_count>
    <who name="Eclipse Genie">genie</who>
    <bug_when>2015-03-02 19:35:52 -0500</bug_when>
    <thetext>Gerrit change https://git.eclipse.org/r/43050 was merged to [master].
Commit: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=841e5207182e4cce5a1b83b4f81bf082fd69694f</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2525847</commentid>
    <comment_count>4</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2015-03-02 19:41:42 -0500</bug_when>
    <thetext>During a re-entrant call this.fields was shrunk to remove fields in error. The outer call, however, still used the old length as its loop boundary -&gt; AIOOBE.
Fixed by working on a pair of local variables, instead of a field + a local.

As an optimization we could detect the situation and abort the outer fields() computation (because inner has already done all work), but since this would only help for error cases and probably helps only marginally, I don&apos;t think it&apos;s worth it.

Released for 4.5 M6.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2525848</commentid>
    <comment_count>5</comment_count>
    <who name="Ca Ca">carmi</who>
    <bug_when>2015-03-02 19:54:40 -0500</bug_when>
    <thetext>Wow, I&apos;m seriously surprised it got fixed so fast...  :D
Awesome, thanks so much!!!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2533318</commentid>
    <comment_count>6</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2015-03-18 01:28:39 -0400</bug_when>
    <thetext>Verified for 4.5 M6 with build I20150317-2000</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2555629</commentid>
    <comment_count>7</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2015-05-02 18:38:31 -0400</bug_when>
    <thetext>*** Bug 424900 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="0"
              isprivate="0"
          >
            <attachid>251227</attachid>
            <date>2015-03-02 17:34:00 -0500</date>
            <delta_ts>2015-03-02 17:34:36 -0500</delta_ts>
            <desc>Repro code. Just run and you&apos;ll get the exception.</desc>
            <filename>file_461250.txt</filename>
            <type>text/plain</type>
            <size>1337</size>
            <attacher name="Ca Ca">carmi</attacher>
            
              <data encoding="base64">cGFja2FnZSBjb20uY29tcGFueTsNCg0KaW1wb3J0IG9yZy5lY2xpcHNlLmpkdC5jb3JlLkphdmFD
b3JlOw0KaW1wb3J0IG9yZy5lY2xpcHNlLmpkdC5jb3JlLmRvbS5BU1Q7DQppbXBvcnQgb3JnLmVj
bGlwc2UuamR0LmNvcmUuZG9tLkFTVFBhcnNlcjsNCmltcG9ydCBvcmcuZWNsaXBzZS5qZHQuY29y
ZS5kb20uQ29tcGlsYXRpb25Vbml0Ow0KDQppbXBvcnQgamF2YS51dGlsLk1hcDsNCg0KcHVibGlj
IGNsYXNzIEhlbGxvV29ybGQgew0KICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcgc291cmNl
ID0NCiAgICAgICJjbGFzcyBRSDxUPiBpbXBsZW1lbnRzIFFSLlEge1xuIiArDQogICAgICAiICBR
Ui5RIHE7XG4iICsNCiAgICAgICIgIEBWKHYgPSBBLCBkID0gXCJcIikgTWFwIHA7XG4iICsNCiAg
ICAgICJ9XG4iOw0KDQogIHB1YmxpYyBzdGF0aWMgdm9pZCBtYWluKFN0cmluZ1tdIGFyZ3YpIHsN
CiAgICBwYXJzZUFuZFJlc29sdmVTb3VyY2Uoc291cmNlKTsNCiAgfQ0KDQogIHByaXZhdGUgc3Rh
dGljIENvbXBpbGF0aW9uVW5pdCBwYXJzZUFuZFJlc29sdmVTb3VyY2UoU3RyaW5nIHNvdXJjZSkg
ew0KICAgIEFTVFBhcnNlciBwYXJzZXIgPSBjcmVhdGVDb21waWxhdGlvblVuaXRQYXJzZXIoKTsN
CiAgICBwYXJzZXIuc2V0U291cmNlKHNvdXJjZS50b0NoYXJBcnJheSgpKTsNCiAgICBwYXJzZXIu
c2V0UmVzb2x2ZUJpbmRpbmdzKHRydWUpOw0KICAgIFN0cmluZ1tdIGVtcHR5U3RyaW5nQXJyYXkg
PSBuZXcgU3RyaW5nWzBdOw0KICAgIHBhcnNlci5zZXRFbnZpcm9ubWVudChlbXB0eVN0cmluZ0Fy
cmF5LCBlbXB0eVN0cmluZ0FycmF5LCBlbXB0eVN0cmluZ0FycmF5LA0KICAgICAgICB0cnVlIC8q
IGluY2x1ZGVSdW5uaW5nVk1Cb290Y2xhc3NwYXRoICovKTsNCiAgICBwYXJzZXIuc2V0VW5pdE5h
bWUoImRvbnRDYXJlIik7DQogICAgcmV0dXJuIChDb21waWxhdGlvblVuaXQpIHBhcnNlci5jcmVh
dGVBU1QobnVsbCk7DQogIH0gDQogIA0KICBwcml2YXRlIHN0YXRpYyBBU1RQYXJzZXIgY3JlYXRl
Q29tcGlsYXRpb25Vbml0UGFyc2VyKCkgew0KICAgIEFTVFBhcnNlciBwYXJzZXIgPSBBU1RQYXJz
ZXIubmV3UGFyc2VyKEFTVC5KTFM0KTsNCiAgICBNYXAgb3B0aW9ucyA9IEphdmFDb3JlLmdldE9w
dGlvbnMoKTsNCiAgICBKYXZhQ29yZS5zZXRDb21wbGlhbmNlT3B0aW9ucyhKYXZhQ29yZS5WRVJT
SU9OXzFfNywgb3B0aW9ucyk7DQogICAgcGFyc2VyLnNldENvbXBpbGVyT3B0aW9ucyhvcHRpb25z
KTsNCiAgICBwYXJzZXIuc2V0S2luZChBU1RQYXJzZXIuS19DT01QSUxBVElPTl9VTklUKTsNCiAg
ICByZXR1cm4gcGFyc2VyOw0KICB9DQp9DQo=
</data>

          </attachment>
      

    </bug>

</bugzilla>