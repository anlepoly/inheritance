<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>408447</bug_id>
          
          <creation_ts>2013-05-18 18:24:00 -0400</creation_ts>
          <short_desc>compiler (log message) needs updating for copyright and bundle_qualifier</short_desc>
          <delta_ts>2013-06-05 03:23:28 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>3.8</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>4.3 RC4</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="David Williams">david_williams</reporter>
          <assigned_to name="Jay Arthanareeswaran">jarthana</assigned_to>
          <cc>daniel_megert</cc>
    
    <cc>igor</cc>
    
    <cc>jan.sievers</cc>
    
    <cc>jarthana</cc>
    
    <cc>markus_keller</cc>
    
    <cc>thanh.ha</cc>
          
          <votes>0</votes>

      

      

      <flag name="pmc_approved"
          id="58300"
          type_id="2"
          status="+"
          setter="daniel_megert"
    />
    <flag name="review"
          id="58303"
          type_id="1"
          status="+"
          setter="markus_keller"
    />

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2259226</commentid>
    <comment_count>0</comment_count>
    <who name="David Williams">david_williams</who>
    <bug_when>2013-05-18 18:24:16 -0400</bug_when>
    <thetext>After checking a &quot;compiler log&quot; message tonight, to make sure the RC1 version was being used, I saw: 

&lt;compiler copyright=&quot;Copyright IBM Corp 2000, 2012. All rights reserved.&quot; name=&quot;Eclipse Compiler for Java(TM)&quot; version=&quot;bundle_qualifier, 3.9.0&quot;&gt;

So, 1) copyright needs to be updated to include 2013, and 

2) appears &quot;bundle_qualifier&quot; has broken, moving to Tycho build, I assume, but appears it was correct for M6 ... oh, maybe then we were still using &quot;old&quot; compiler, produced by PDE M5a? 

log from M6 says

&lt;compiler copyright=&quot;Copyright IBM Corp 2000, 2012. All rights reserved.&quot; name=&quot;Eclipse Compiler for Java(TM)&quot; version=&quot;v20130129-050623, 3.9.0&quot;&gt; 

a log from SM5a says: 

&lt;compiler copyright=&quot;Copyright IBM Corp 2000, 2012. All rights reserved.&quot; name=&quot;Eclipse Compiler for Java(TM)&quot; version=&quot;v20121208-144805, 3.9.0&quot;&gt;</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2259356</commentid>
    <comment_count>1</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-05-20 00:46:43 -0400</bug_when>
    <thetext>*** Bug 405870 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2259532</commentid>
    <comment_count>2</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-05-20 05:57:16 -0400</bug_when>
    <thetext>I spent some time playing around with the pom file and I have something might work. I have the following piece of code that seem to update the properties file in question. But only question mark is over the property ${project.version}. Right now I see the value in the pom.xml being used - 3.9.0-SNAPSHOT. Is this something I can expect to work during a build? If not, what is the property I should use to get the correct bundle version?

The following goes to org.eclipse.jdt.core/pom.xml

	  &lt;plugin&gt;
		&lt;artifactId&gt;maven-antrun-plugin&lt;/artifactId&gt;
		&lt;executions&gt;
			&lt;execution&gt;
				&lt;phase&gt;prepare-package&lt;/phase&gt;
				&lt;configuration&gt;
					&lt;tasks&gt;
						&lt;replace token=&quot;bundle_qualifier,&quot; value=&quot;${project.version},&quot; dir=&quot;${project.build.directory}/classes&quot;&gt;
							&lt;include name=&quot;org/eclipse/jdt/internal/compiler/batch/messages.properties&quot; /&gt;
						&lt;/replace&gt;
					&lt;/tasks&gt;
				&lt;/configuration&gt;
				&lt;goals&gt;
					&lt;goal&gt;run&lt;/goal&gt;
				&lt;/goals&gt;
			&lt;/execution&gt;
		&lt;/executions&gt;
	  &lt;/plugin&gt;</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2265729</commentid>
    <comment_count>3</comment_count>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2013-05-30 13:31:49 -0400</bug_when>
    <thetext>I&apos;ve updated the copyright date with http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=16a2b90114b7d82dfc0b904ad237f557c3de69c2 , but I missed the bundle_qualifier.

Any insight from Maven/Tycho experts about how to write the bundle qualifier into a file at build time?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2266817</commentid>
    <comment_count>4</comment_count>
    <who name="Jan Sievers">jan.sievers</who>
    <bug_when>2013-06-03 04:58:29 -0400</bug_when>
    <thetext>(In reply to comment #3)

&gt; Any insight from Maven/Tycho experts about how to write the bundle qualifier
&gt; into a file at build time?

you can use maven properties ${buildQualifier} and ${unqualifiedVersion}, see docs [1]

[1] http://eclipse.org/tycho/sitedocs/tycho-packaging-plugin/build-qualifier-mojo.html</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2267472</commentid>
    <comment_count>5</comment_count>
      <attachid>231913</attachid>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-06-04 03:56:30 -0400</bug_when>
    <thetext>Created attachment 231913
Proposed fix

(In reply to comment #4)
&gt; you can use maven properties ${buildQualifier} and ${unqualifiedVersion},
&gt; see docs [1]
&gt; 
&gt; [1]
&gt; http://eclipse.org/tycho/sitedocs/tycho-packaging-plugin/build-qualifier-
&gt; mojo.html

That&apos;s perfect and thanks for chipping in!

I am attaching the patch, which I have tested and found to be working in my local environment. David, could you take a quick a look at it and see if this would work in the build environment? TIA!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2267664</commentid>
    <comment_count>6</comment_count>
    <who name="David Williams">david_williams</who>
    <bug_when>2013-06-04 09:27:01 -0400</bug_when>
    <thetext>I&apos;m pretty sure this would work as expected. That is, the buildqualifier would basically be updated/changed each build but, I think, that if there was no other changes in jdt.core, it would not effect its own computed qualifier, so it would be &quot;thrown away&quot; and jdt.core replaced with previous version by comparator. I think this is the desired end-result. So, if there was a &quot;real change&quot;, the bundle_qualifier would be updated in the end deliverable, but if there was not, it would simply show up each time in comparator as &quot;something changed&quot;, even when replaced by previous version (which, happens all the time for jdt core anyway, for some reason :/. 

You will have to &quot;touch&quot; jdt.core the first time, in git, to make sure it gets in once (since POM only changes are not used in the computation that a bundle gets a new qualifier). 

Seems important enough to me to put in RC4 and if not quite right then improve on it later. For example, at worse, it will make jdt.core change qualifier each build ... I don&apos;t think that will happen ... but ... hard to know with 100% certainty. 

And, you&apos;ll have to look at jdt_core_* bundle vs. org.eclipse.jdt.core.compiler.batch_* in detail, (such as do binary diff) to make sure each are accurate. For example, while looking at something else, I noticed last night comparing two builds where jdt.core_* did not change, a quick diff said 
Binary files I20130602-2000/plugins/org.eclipse.jdt.core.compiler.batch_3.9.0.v20130530-1629.jar and I20130603-2000/plugins
/org.eclipse.jdt.core.compiler.batch_3.9.0.v20130530-1629.jar differ

Not sure what that difference was, but you&apos;ll probably see that now, with this fix, even for jdt_core_* bundle.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2267677</commentid>
    <comment_count>7</comment_count>
    <who name="Igor Fedorenko">igor</who>
    <bug_when>2013-06-04 09:39:46 -0400</bug_when>
    <thetext>Although attached patch should work, I&apos;d probably use standard maven resource filtering [1] instead of custom ant script.


[1] http://maven.apache.org/plugins/maven-resources-plugin/examples/filter.html</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2267724</commentid>
    <comment_count>8</comment_count>
    <who name="Dani Megert">daniel_megert</who>
    <bug_when>2013-06-04 10:15:53 -0400</bug_when>
    <thetext>(In reply to comment #6)
&gt; Seems important enough to me to put in RC4 and if not quite right then
&gt; improve on it later.

I agree.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2267760</commentid>
    <comment_count>9</comment_count>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2013-06-04 10:36:11 -0400</bug_when>
    <thetext>Since the patch from comment 5 has already been tested and reviewed, I&apos;ve released that one for the next build: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=6fe9d61eea2c00b1cd723dbcfb2c6ce66bf0208b


(In reply to comment #7)
&gt; http://maven.apache.org/plugins/maven-resources-plugin/examples/filter.html

Thanks for the pointer. We would probably have used that if we wouldn&apos;t have been that close to the finish line.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2267862</commentid>
    <comment_count>10</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-06-04 12:02:36 -0400</bug_when>
    <thetext>(In reply to comment #9)
&gt; Since the patch from comment 5 has already been tested and reviewed, I&apos;ve
&gt; released that one for the next build:
&gt; http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/
&gt; ?id=6fe9d61eea2c00b1cd723dbcfb2c6ce66bf0208b

Thanks Markus! Agree, we can probably look at the alternative during 4.4.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2268097</commentid>
    <comment_count>11</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-06-05 01:05:13 -0400</bug_when>
    <thetext>I can confirm that the JAR produced has the correct version (v20130604-1421) set in the messages.properties and also prints the same when this command is invoked:

java -jar ecj-I20130604-2000.jar -version</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2268127</commentid>
    <comment_count>12</comment_count>
    <who name="Dani Megert">daniel_megert</who>
    <bug_when>2013-06-05 03:23:28 -0400</bug_when>
    <thetext>(In reply to comment #11)
&gt; I can confirm that the JAR produced has the correct version (v20130604-1421)
&gt; set in the messages.properties and also prints the same when this command is
&gt; invoked:
&gt; 
&gt; java -jar ecj-I20130604-2000.jar -version

Besides that, I also verified the message.properties file in the ecj and jdt.core JARs.

Verified in I20130604-2000.</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>231913</attachid>
            <date>2013-06-04 03:56:00 -0400</date>
            <delta_ts>2013-06-04 03:56:30 -0400</delta_ts>
            <desc>Proposed fix</desc>
            <filename>Fix-for-bug-408447.patch</filename>
            <type>text/plain</type>
            <size>1283</size>
            <attacher name="Jay Arthanareeswaran">jarthana</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlL2ZvcmNlUXVhbGlmaWVyVXBkYXRlLnR4
dCBiL29yZy5lY2xpcHNlLmpkdC5jb3JlL2ZvcmNlUXVhbGlmaWVyVXBkYXRlLnR4dAppbmRleCA3
NzI0NzgyLi4yMzljODA1IDEwMDY0NAotLS0gYS9vcmcuZWNsaXBzZS5qZHQuY29yZS9mb3JjZVF1
YWxpZmllclVwZGF0ZS50eHQKKysrIGIvb3JnLmVjbGlwc2UuamR0LmNvcmUvZm9yY2VRdWFsaWZp
ZXJVcGRhdGUudHh0CkBAIC0zLDIgKzMsMyBAQAogQnVnIDQwNzg1MyAtIEVDSiBkb3dubG9hZCBt
aXNzZXMgbGVnYWwgZmlsZSAoYWJvdXQuaHRtbCkNCiBCdWcgNDA3ODUyIC0gRUNKIHNvdXJjZSBk
b3dubG9hZCBpcyBub3QgY29ycmVjdA0KK0J1ZyA0MDg0NDcgLSBjb21waWxlciAobG9nIG1lc3Nh
Z2UpIG5lZWRzIHVwZGF0aW5nIGZvciBjb3B5cmlnaHQgYW5kIGJ1bmRsZV9xdWFsaWZpZXIKXCBO
byBuZXdsaW5lIGF0IGVuZCBvZiBmaWxlCmRpZmYgLS1naXQgYS9vcmcuZWNsaXBzZS5qZHQuY29y
ZS9wb20ueG1sIGIvb3JnLmVjbGlwc2UuamR0LmNvcmUvcG9tLnhtbAppbmRleCAwYTg3M2M5Li41
YjAzNWI1IDEwMDY0NAotLS0gYS9vcmcuZWNsaXBzZS5qZHQuY29yZS9wb20ueG1sCisrKyBiL29y
Zy5lY2xpcHNlLmpkdC5jb3JlL3BvbS54bWwKQEAgLTI0LDQgKzI0LDIyIEBACiAgIDxidWlsZD4K
ICAgICA8cGx1Z2lucz4KKyAgICA8cGx1Z2luPgorCQk8YXJ0aWZhY3RJZD5tYXZlbi1hbnRydW4t
cGx1Z2luPC9hcnRpZmFjdElkPgorCQk8ZXhlY3V0aW9ucz4KKwkJCTxleGVjdXRpb24+CisJCQkJ
PHBoYXNlPnByZXBhcmUtcGFja2FnZTwvcGhhc2U+CisJCQkJPGNvbmZpZ3VyYXRpb24+CisJCQkJ
CTx0YXNrcz4KKwkJCQkJCTxyZXBsYWNlIHRva2VuPSJidW5kbGVfcXVhbGlmaWVyLCIgdmFsdWU9
IiR7YnVpbGRRdWFsaWZpZXJ9LCIgZGlyPSIke3Byb2plY3QuYnVpbGQuZGlyZWN0b3J5fS9jbGFz
c2VzIj4KKwkJCQkJCQk8aW5jbHVkZSBuYW1lPSJvcmcvZWNsaXBzZS9qZHQvaW50ZXJuYWwvY29t
cGlsZXIvYmF0Y2gvbWVzc2FnZXMucHJvcGVydGllcyIgLz4KKwkJCQkJCTwvcmVwbGFjZT4KKwkJ
CQkJPC90YXNrcz4KKwkJCQk8L2NvbmZpZ3VyYXRpb24+CisJCQkJPGdvYWxzPgorCQkJCQk8Z29h
bD5ydW48L2dvYWw+CisJCQkJPC9nb2Fscz4KKwkJCTwvZXhlY3V0aW9uPgorCQk8L2V4ZWN1dGlv
bnM+CisJICA8L3BsdWdpbj4KICAgICAgIDxwbHVnaW4+CiAgICAgICAgIDxncm91cElkPm9yZy5l
Y2xpcHNlLnR5Y2hvLmV4dHJhczwvZ3JvdXBJZD4=
</data>

          </attachment>
      

    </bug>

</bugzilla>