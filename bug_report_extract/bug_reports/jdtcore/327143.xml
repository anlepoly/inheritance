<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>327143</bug_id>
          
          <creation_ts>2010-10-06 13:37:00 -0400</creation_ts>
          <short_desc>IndexManager should not accept new jobs if the processing thread is null</short_desc>
          <delta_ts>2011-02-01 09:59:34 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>3.7</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>3.7 M5</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Olivier Thomann">Olivier_Thomann</reporter>
          <assigned_to name="Satyam Kandula">satyam.kandula</assigned_to>
          
          
          <votes>0</votes>

      

      

      <flag name="review"
          id="37820"
          type_id="1"
          status="+"
          setter="Olivier_Thomann"
    />

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>1824535</commentid>
    <comment_count>0</comment_count>
    <who name="Olivier Thomann">Olivier_Thomann</who>
    <bug_when>2010-10-06 13:37:20 -0400</bug_when>
    <thetext>I ran into a case where a simulateExit() was called and the next touch(..) call failed. The consequence was that the simulateRestart() was never called.
But a new jar file added ended up being added into the waiting jobs and the index manager was in an infinite loop and the number of awaiting jobs was always 1 and since the processing thread was null, that job was never run.

So we must make sure that the index manager doesn&apos;t accept new jobs if the processing thread is null or if stops the loop when there is an awaiting job but the thread is null.
Right now the loop never ends unless the number of awaiting jobs is 0.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1857650</commentid>
    <comment_count>1</comment_count>
      <attachid>185305</attachid>
    <who name="Satyam Kandula">satyam.kandula</who>
    <bug_when>2010-12-16 06:26:47 -0500</bug_when>
    <thetext>Created attachment 185305
Proposed patch

Olivier, Please look at the patch and let me know if you are mentioning about the same thing and if so, please review!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1857770</commentid>
    <comment_count>2</comment_count>
    <who name="Olivier Thomann">Olivier_Thomann</who>
    <bug_when>2010-12-16 09:12:36 -0500</bug_when>
    <thetext>This would throw a OperationCanceledException even if the operation was not really canceled.
Why not simply adding: &amp;&amp; this.processingThread != null inside the while condition ?
Since the processingThread is nullify on shutdown, I don&apos;t think this is a big difference.
Satyam, +1 for this and you can decide how you want to fix it.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1857780</commentid>
    <comment_count>3</comment_count>
    <who name="Satyam Kandula">satyam.kandula</who>
    <bug_when>2010-12-16 09:21:21 -0500</bug_when>
    <thetext>(In reply to comment #2)
&gt; This would throw a OperationCanceledException even if the operation was not
&gt; really canceled.
&gt; Why not simply adding: &amp;&amp; this.processingThread != null inside the while
&gt; condition ?
&gt; Since the processingThread is nullify on shutdown, I don&apos;t think this is a big
&gt; difference.
&gt; Satyam, +1 for this and you can decide how you want to fix it.
This is to ensure that client gets to know that the operation didn&apos;t complete properly for whatever reason.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1857795</commentid>
    <comment_count>4</comment_count>
    <who name="Olivier Thomann">Olivier_Thomann</who>
    <bug_when>2010-12-16 09:30:59 -0500</bug_when>
    <thetext>(In reply to comment #3)
&gt; This is to ensure that client gets to know that the operation didn&apos;t complete
&gt; properly for whatever reason.
Fine for me then.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1858930</commentid>
    <comment_count>5</comment_count>
    <who name="Satyam Kandula">satyam.kandula</who>
    <bug_when>2010-12-20 05:25:02 -0500</bug_when>
    <thetext>Released in HEAD</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1872413</commentid>
    <comment_count>6</comment_count>
      <attachid>187517</attachid>
    <who name="Olivier Thomann">Olivier_Thomann</who>
    <bug_when>2011-01-25 09:05:44 -0500</bug_when>
    <thetext>Created attachment 187517
Proposed fix

I wonder if it is not better to fix it that way. When no progress monitor is given, you can still end up with a hang.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1872503</commentid>
    <comment_count>7</comment_count>
    <who name="Olivier Thomann">Olivier_Thomann</who>
    <bug_when>2011-01-25 10:40:25 -0500</bug_when>
    <thetext>This will be verified once a build with the last fix is available.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1876373</commentid>
    <comment_count>8</comment_count>
    <who name="Olivier Thomann">Olivier_Thomann</who>
    <bug_when>2011-02-01 09:59:34 -0500</bug_when>
    <thetext>Verified.</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>185305</attachid>
            <date>2010-12-16 06:26:00 -0500</date>
            <delta_ts>2010-12-16 06:26:47 -0500</delta_ts>
            <desc>Proposed patch</desc>
            <filename>patch.txt</filename>
            <type>text/plain</type>
            <size>1095</size>
            <attacher name="Satyam Kandula">satyam.kandula</attacher>
            
              <data encoding="base64">IyMjIEVjbGlwc2UgV29ya3NwYWNlIFBhdGNoIDEuMAojUCBvcmcuZWNsaXBzZS5qZHQuY29yZQpJ
bmRleDogc2VhcmNoL29yZy9lY2xpcHNlL2pkdC9pbnRlcm5hbC9jb3JlL3NlYXJjaC9wcm9jZXNz
aW5nL0pvYk1hbmFnZXIuamF2YQo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ClJDUyBmaWxlOiAvY3Zzcm9vdC9lY2xpcHNl
L29yZy5lY2xpcHNlLmpkdC5jb3JlL3NlYXJjaC9vcmcvZWNsaXBzZS9qZHQvaW50ZXJuYWwvY29y
ZS9zZWFyY2gvcHJvY2Vzc2luZy9Kb2JNYW5hZ2VyLmphdmEsdgpyZXRyaWV2aW5nIHJldmlzaW9u
IDEuMTAyCmRpZmYgLXUgLXIxLjEwMiBKb2JNYW5hZ2VyLmphdmEKLS0tIHNlYXJjaC9vcmcvZWNs
aXBzZS9qZHQvaW50ZXJuYWwvY29yZS9zZWFyY2gvcHJvY2Vzc2luZy9Kb2JNYW5hZ2VyLmphdmEJ
NyBKYW4gMjAxMCAyMDoxODoxMiAtMDAwMAkxLjEwMgorKysgc2VhcmNoL29yZy9lY2xpcHNlL2pk
dC9pbnRlcm5hbC9jb3JlL3NlYXJjaC9wcm9jZXNzaW5nL0pvYk1hbmFnZXIuamF2YQk5IERlYyAy
MDEwIDA5OjUyOjUxIC0wMDAwCkBAIC0yMjYsNyArMjI2LDcgQEAKIAkJCQkJCQkJZmxvYXQgbGFz
dFdvcmtlZCA9IDA7CiAJCQkJCQkJCWZsb2F0IHRvdGFsV29ya2VkID0gMDsKIAkJCQkJCQkJd2hp
bGUgKChhd2FpdGluZ0pvYnNDb3VudCA9IGF3YWl0aW5nSm9ic0NvdW50KCkpID4gMCkgewotCQkJ
CQkJCQkJaWYgKHN1YlByb2dyZXNzICE9IG51bGwgJiYgc3ViUHJvZ3Jlc3MuaXNDYW5jZWxlZCgp
KQorCQkJCQkJCQkJaWYgKHN1YlByb2dyZXNzICE9IG51bGwgJiYgc3ViUHJvZ3Jlc3MuaXNDYW5j
ZWxlZCgpICYmIHRoaXMucHJvY2Vzc2luZ1RocmVhZCA9PSBudWxsKQogCQkJCQkJCQkJCXRocm93
IG5ldyBPcGVyYXRpb25DYW5jZWxlZEV4Y2VwdGlvbigpOwogCQkJCQkJCQkJSUpvYiBjdXJyZW50
Sm9iID0gY3VycmVudEpvYigpOwogCQkJCQkJCQkJLy8gY3VycmVudEpvYiBjYW4gYmUgbnVsbCB3
aGVuIGpvYnMgaGF2ZSBiZWVuIGFkZGVkIHRvIHRoZSBxdWV1ZSBidXQgam9iIG1hbmFnZXIgaXMg
bm90IGVuYWJsZWQK
</data>
<flag name="review"
          id="37819"
          type_id="6"
          status="?"
          setter="satyam.kandula"
    />
          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>187517</attachid>
            <date>2011-01-25 09:05:00 -0500</date>
            <delta_ts>2011-01-25 09:05:44 -0500</delta_ts>
            <desc>Proposed fix</desc>
            <filename>patch_327143.txt</filename>
            <type>text/plain</type>
            <size>1586</size>
            <attacher name="Olivier Thomann">Olivier_Thomann</attacher>
            
              <data encoding="base64">IyMjIEVjbGlwc2UgV29ya3NwYWNlIFBhdGNoIDEuMA0KI1Agb3JnLmVjbGlwc2UuamR0LmNvcmUN
CkluZGV4OiBzZWFyY2gvb3JnL2VjbGlwc2UvamR0L2ludGVybmFsL2NvcmUvc2VhcmNoL3Byb2Nl
c3NpbmcvSm9iTWFuYWdlci5qYXZhDQo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQpSQ1MgZmlsZTogL2N2c3Jvb3QvZWNs
aXBzZS9vcmcuZWNsaXBzZS5qZHQuY29yZS9zZWFyY2gvb3JnL2VjbGlwc2UvamR0L2ludGVybmFs
L2NvcmUvc2VhcmNoL3Byb2Nlc3NpbmcvSm9iTWFuYWdlci5qYXZhLHYNCnJldHJpZXZpbmcgcmV2
aXNpb24gMS4xMDMNCmRpZmYgLXUgLXIxLjEwMyBKb2JNYW5hZ2VyLmphdmENCi0tLSBzZWFyY2gv
b3JnL2VjbGlwc2UvamR0L2ludGVybmFsL2NvcmUvc2VhcmNoL3Byb2Nlc3NpbmcvSm9iTWFuYWdl
ci5qYXZhCTIwIERlYyAyMDEwIDEwOjIxOjEzIC0wMDAwCTEuMTAzDQorKysgc2VhcmNoL29yZy9l
Y2xpcHNlL2pkdC9pbnRlcm5hbC9jb3JlL3NlYXJjaC9wcm9jZXNzaW5nL0pvYk1hbmFnZXIuamF2
YQkyNSBKYW4gMjAxMSAxNDowNDoyNSAtMDAwMA0KQEAgLTEsNSArMSw1IEBADQogLyoqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioNCi0gKiBDb3B5cmlnaHQgKGMpIDIwMDAsIDIwMTAgSUJNIENvcnBvcmF0
aW9uIGFuZCBvdGhlcnMuDQorICogQ29weXJpZ2h0IChjKSAyMDAwLCAyMDExIElCTSBDb3Jwb3Jh
dGlvbiBhbmQgb3RoZXJzLg0KICAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuIFRoaXMgcHJvZ3JhbSBh
bmQgdGhlIGFjY29tcGFueWluZyBtYXRlcmlhbHMNCiAgKiBhcmUgbWFkZSBhdmFpbGFibGUgdW5k
ZXIgdGhlIHRlcm1zIG9mIHRoZSBFY2xpcHNlIFB1YmxpYyBMaWNlbnNlIHYxLjANCiAgKiB3aGlj
aCBhY2NvbXBhbmllcyB0aGlzIGRpc3RyaWJ1dGlvbiwgYW5kIGlzIGF2YWlsYWJsZSBhdA0KQEAg
LTIyNiw3ICsyMjYsOCBAQA0KIAkJCQkJCQkJZmxvYXQgbGFzdFdvcmtlZCA9IDA7DQogCQkJCQkJ
CQlmbG9hdCB0b3RhbFdvcmtlZCA9IDA7DQogCQkJCQkJCQl3aGlsZSAoKGF3YWl0aW5nSm9ic0Nv
dW50ID0gYXdhaXRpbmdKb2JzQ291bnQoKSkgPiAwKSB7DQotCQkJCQkJCQkJaWYgKHN1YlByb2dy
ZXNzICE9IG51bGwgJiYgc3ViUHJvZ3Jlc3MuaXNDYW5jZWxlZCgpICYmIHRoaXMucHJvY2Vzc2lu
Z1RocmVhZCA9PSBudWxsKQ0KKwkJCQkJCQkJCWlmICgoc3ViUHJvZ3Jlc3MgIT0gbnVsbCAmJiBz
dWJQcm9ncmVzcy5pc0NhbmNlbGVkKCkpDQorCQkJCQkJCQkJCQl8fCB0aGlzLnByb2Nlc3NpbmdU
aHJlYWQgPT0gbnVsbCkNCiAJCQkJCQkJCQkJdGhyb3cgbmV3IE9wZXJhdGlvbkNhbmNlbGVkRXhj
ZXB0aW9uKCk7DQogCQkJCQkJCQkJSUpvYiBjdXJyZW50Sm9iID0gY3VycmVudEpvYigpOw0KIAkJ
CQkJCQkJCS8vIGN1cnJlbnRKb2IgY2FuIGJlIG51bGwgd2hlbiBqb2JzIGhhdmUgYmVlbiBhZGRl
ZCB0byB0aGUgcXVldWUgYnV0IGpvYiBtYW5hZ2VyIGlzIG5vdCBlbmFibGVkDQo=
</data>

          </attachment>
      

    </bug>

</bugzilla>