<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>459739</bug_id>
          
          <creation_ts>2015-02-12 03:30:00 -0500</creation_ts>
          <short_desc>[test][compiler]NullTypeAnnotationTest.testDefault06() failed</short_desc>
          <delta_ts>2015-03-18 02:55:57 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>4.5</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>4.5 M6</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Sasikanth Bharadwaj">saammana</reporter>
          <assigned_to name="Manoj Palat Away Until May 11 2015">manpalat</assigned_to>
          <cc>jarthana</cc>
    
    <cc>manpalat</cc>
    
    <cc>stephan.herrmann</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2517686</commentid>
    <comment_count>0</comment_count>
    <who name="Sasikanth Bharadwaj">saammana</who>
    <bug_when>2015-02-12 03:30:31 -0500</bug_when>
    <thetext>buildId: N20150211-2000
platform: linux
url: https://hudson.eclipse.org/hudson/job/ep45N-unit-lin64/201/

stacktrace: 
junit.framework.ComparisonFailure: Invalid problem log .
----------- Expected ------------
----------\n
1. ERROR in X.java (at line 7)\n
	return null; // ERR\n
	       ^^^^\n
Null type mismatch: required &apos;@NonNull T&apos; but the provided value is null\n
----------\n
2. ERROR in X.java (at line 11)\n
	@NonNull Number nnn = inum.process(null); // ERR on argument\n
	                                   ^^^^\n
Null type mismatch: required &apos;@NonNull Number&apos; but the provided value is null\n
----------\n

------------ but was ------------
----------\n
1. ERROR in X.java (at line 7)\n
	return null; // ERR\n
	       ^^^^\n
Null type mismatch: required &apos;@NonNull T&apos; but the provided value is null\n
----------\n
2. ERROR in X.java (at line 10)\n
	void test(Inner&lt;Number&gt; inum) {\n
	                ^^^^^^\n
Null constraint mismatch: The type &apos;Number&apos; is not a valid substitute for the type parameter &apos;@NonNull T&apos;\n
----------\n
3. ERROR in X.java (at line 11)\n
	@NonNull Number nnn = inum.process(null); // ERR on argument\n
	                                   ^^^^\n
Null type mismatch: required &apos;@NonNull Number&apos; but the provided value is null\n
----------\n

--------- Difference is ----------
 expected:&lt;...in X.java (at line 1[]1)\n
	@NonNull Numbe...&gt; but was:&lt;...in X.java (at line 1[0)\n
	void test(Inner&lt;Number&gt; inum) {\n
	                ^^^^^^\n
Null constraint mismatch: The type &apos;Number&apos; is not a valid substitute for the type parameter &apos;@NonNull T&apos;\n
----------\n
3. ERROR in X.java (at line 1]1)\n
	@NonNull Numbe...&gt;
	at org.eclipse.jdt.core.tests.junit.extension.TestCase.assertStringEquals(TestCase.java:259)
	at org.eclipse.jdt.core.tests.junit.extension.TestCase.assertEquals(TestCase.java:235)
	at org.eclipse.jdt.core.tests.compiler.regression.AbstractRegressionTest.checkCompilerLog(AbstractRegressionTest.java:946)
	at org.eclipse.jdt.core.tests.compiler.regression.AbstractRegressionTest.runTest(AbstractRegressionTest.java:2499)
	at org.eclipse.jdt.core.tests.compiler.regression.AbstractRegressionTest.runTest(AbstractRegressionTest.java:2297)
	at org.eclipse.jdt.core.tests.compiler.regression.AbstractRegressionTest.runNegativeTest(AbstractRegressionTest.java:2881)
	at org.eclipse.jdt.core.tests.compiler.regression.AbstractNullAnnotationTest.runNegativeTestWithLibs(AbstractNullAnnotationTest.java:130)
	at org.eclipse.jdt.core.tests.compiler.regression.AbstractNullAnnotationTest.runNegativeTestWithLibs(AbstractNullAnnotationTest.java:140)
	at org.eclipse.jdt.core.tests.compiler.regression.NullTypeAnnotationTest.testDefault06(NullTypeAnnotationTest.java:4839)
	at org.eclipse.jdt.core.tests.util.CompilerTestSetup.run(CompilerTestSetup.java:56)
	at org.eclipse.test.EclipseTestRunner.run(EclipseTestRunner.java:657)
	at org.eclipse.test.EclipseTestRunner.run(EclipseTestRunner.java:310)
	at org.eclipse.test.CoreTestApplication.runTests(CoreTestApplication.java:36)
	at org.eclipse.test.CoreTestApplication.run(CoreTestApplication.java:32)
	at org.eclipse.equinox.internal.app.EclipseAppContainer.callMethodWithException(EclipseAppContainer.java:587)
	at org.eclipse.equinox.internal.app.EclipseAppHandle.run(EclipseAppHandle.java:198)
	at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:134)
	at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:104)
	at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:380)
	at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:235)
	at org.eclipse.equinox.launcher.Main.invokeFramework(Main.java:648)
	at org.eclipse.equinox.launcher.Main.basicRun(Main.java:603)
	at org.eclipse.equinox.launcher.Main.run(Main.java:1465)
	at org.eclipse.equinox.launcher.Main.main(Main.java:1438)
	at org.eclipse.core.launcher.Main.main(Main.java:34)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2517694</commentid>
    <comment_count>1</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2015-02-12 03:45:26 -0500</bug_when>
    <thetext>I am seeing this in my local environment too, must be a recent thing. Let me take a look.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2517706</commentid>
    <comment_count>2</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2015-02-12 04:06:09 -0500</bug_when>
    <thetext>Fix for bug 425601 caused this.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2517712</commentid>
    <comment_count>3</comment_count>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2015-02-12 04:15:45 -0500</bug_when>
    <thetext>(In reply to Jay Arthanareeswaran from comment #2)
&gt; Fix for bug 425601 caused this.

I reset to a commit prior to 425601. I see this issue still</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2517744</commentid>
    <comment_count>4</comment_count>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2015-02-12 04:49:57 -0500</bug_when>
    <thetext>(In reply to Manoj Palat from comment #3)
&gt; (In reply to Jay Arthanareeswaran from comment #2)
&gt; &gt; Fix for bug 425601 caused this.
&gt; 
&gt; I reset to a commit prior to 425601. I see this issue still

I ran the test individually and saw the failure - My Bad. However, before reverting the fix of bug 425601, I would like to check with Stephan whether this would warrant a change in the test case.

Stephan: The fix of bug 425601 processes the member types in source type binding before processing the fields and methods of type. And this causes this additional error to crop up in the test. I believe that this fix is still valid because in the case of following:
import org.eclipse.jdt.annotation.*;

@NonNullByDefault(DefaultLocation.TYPE_PARAMETER)
class Inner&lt;T&gt; {
	T process(T t) {
		@NonNull T t2 = t; // OK
		return null; // ERR
		}
}

@NonNullByDefault(DefaultLocation.TYPE_PARAMETER)
public class X {
	void test(Inner&lt;Number&gt; inum) {
		@NonNull Number nnn = inum.process(null); // ERR on argument
	}
}

we get the additional error, &quot;Description	Resource	Path	Location	Type
Null constraint mismatch: The type &apos;Number&apos; is not a valid substitute for the type parameter &apos;@NonNull T&apos;	X.java	/459739/src	line 13	Java Problem
&quot; where Inner is moved prior and out of Class X. And this is the additional error we get in this test when we process Inner first before the fields and methods.
Could you please comment on the same?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2517751</commentid>
    <comment_count>5</comment_count>
      <attachid>250746</attachid>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2015-02-12 05:02:07 -0500</bug_when>
    <thetext>Created attachment 250746
Pr

testcase with the additional error message</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2517775</commentid>
    <comment_count>6</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2015-02-12 05:28:19 -0500</bug_when>
    <thetext>Good catch!

Could you please add a variant of the test in question, where you replace
@NonNullByDefault(DefaultLocation.TYPE_PARAMETER)
by
@NonNullByDefault(DefaultLocation.TYPE_PARAMETER,DefaultLocation.TYPE_ARGUMENT)

In that case we should only see the original expected errors. If so, please go ahead and adjust / amend the test.


Given that order of traversal is a very delicate issue, could you please explain in the other bug, which exact events (code-wise) happened in the wrong order, and why the new order is safe? Couldn&apos;t we invent a test case that needs the opposite order, perhaps s.t. in Inner referring to a deprecated field of the outer?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2517783</commentid>
    <comment_count>7</comment_count>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2015-02-12 05:45:22 -0500</bug_when>
    <thetext>(In reply to Stephan Herrmann from comment #6)
&gt; Good catch!
&gt; 
&gt; Could you please add a variant of the test in question, where you replace
&gt; @NonNullByDefault(DefaultLocation.TYPE_PARAMETER)
&gt; by
&gt; @NonNullByDefault(DefaultLocation.TYPE_PARAMETER,DefaultLocation.
&gt; TYPE_ARGUMENT)
&gt; 
&gt; In that case we should only see the original expected errors. If so, please
&gt; go ahead and adjust / amend the test.

Thanks a lot for the immediate response, Stephan. I&apos;ve committed the amended test case and the additional test case which shows only the original errors via: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=d9396647e280a0cdb636c94fae9233a7a2475f6f
&gt; 
&gt; Given that order of traversal is a very delicate issue, could you please
&gt; explain in the other bug, which exact events (code-wise) happened in the
&gt; wrong order, and why the new order is safe? Couldn&apos;t we invent a test case
&gt; that needs the opposite order, perhaps s.t. in Inner referring to a
&gt; deprecated field of the outer?
Will update the other bug.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2519170</commentid>
    <comment_count>8</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2015-02-16 04:22:43 -0500</bug_when>
    <thetext>Marking as resolved.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2526838</commentid>
    <comment_count>9</comment_count>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2015-03-04 19:30:50 -0500</bug_when>
    <thetext>(In reply to Jay Arthanareeswaran from comment #8)
&gt; Marking as resolved.

ref bug 425601 comment 7 , 8 and 9</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2533346</commentid>
    <comment_count>10</comment_count>
    <who name="Sasikanth Bharadwaj">saammana</who>
    <bug_when>2015-03-18 02:55:57 -0400</bug_when>
    <thetext>Verified for 4.5 M6 using I20150316-2000 build</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>250746</attachid>
            <date>2015-02-12 05:02:00 -0500</date>
            <delta_ts>2015-02-12 05:02:07 -0500</delta_ts>
            <desc>Pr</desc>
            <filename>Fix-for-Bug-459739-testcompilerNullTypeAnnotationTes.patch</filename>
            <type>text/plain</type>
            <size>1225</size>
            <attacher name="Manoj Palat Away Until May 11 2015">manpalat</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLmNvbXBpbGVyL3NyYy9vcmcv
ZWNsaXBzZS9qZHQvY29yZS90ZXN0cy9jb21waWxlci9yZWdyZXNzaW9uL051bGxUeXBlQW5ub3Rh
dGlvblRlc3QuamF2YSBiL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLmNvbXBpbGVyL3NyYy9v
cmcvZWNsaXBzZS9qZHQvY29yZS90ZXN0cy9jb21waWxlci9yZWdyZXNzaW9uL051bGxUeXBlQW5u
b3RhdGlvblRlc3QuamF2YQppbmRleCA0Y2E1NWMxLi44MGRmYTIyIDEwMDY0NAotLS0gYS9vcmcu
ZWNsaXBzZS5qZHQuY29yZS50ZXN0cy5jb21waWxlci9zcmMvb3JnL2VjbGlwc2UvamR0L2NvcmUv
dGVzdHMvY29tcGlsZXIvcmVncmVzc2lvbi9OdWxsVHlwZUFubm90YXRpb25UZXN0LmphdmEKKysr
IGIvb3JnLmVjbGlwc2UuamR0LmNvcmUudGVzdHMuY29tcGlsZXIvc3JjL29yZy9lY2xpcHNlL2pk
dC9jb3JlL3Rlc3RzL2NvbXBpbGVyL3JlZ3Jlc3Npb24vTnVsbFR5cGVBbm5vdGF0aW9uVGVzdC5q
YXZhCkBAIC00ODYwLDcgKzQ4NjAsMTIgQEAKIAkJIgkgICAgICAgXl5eXlxuIiArIAogCQkiTnVs
bCB0eXBlIG1pc21hdGNoOiByZXF1aXJlZCBcJ0BOb25OdWxsIFRcJyBidXQgdGhlIHByb3ZpZGVk
IHZhbHVlIGlzIG51bGxcbiIgKyAKIAkJIi0tLS0tLS0tLS1cbiIgKyAKLQkJIjIuIEVSUk9SIGlu
IFguamF2YSAoYXQgbGluZSAxMSlcbiIgKyAKKwkJIjIuIEVSUk9SIGluIFguamF2YSAoYXQgbGlu
ZSAxMClcbiIgKyAKKwkJIgl2b2lkIHRlc3QoSW5uZXI8TnVtYmVyPiBpbnVtKSB7XG4iICsgCisJ
CSIJICAgICAgICAgICAgICAgIF5eXl5eXlxuIiArIAorCQkiTnVsbCBjb25zdHJhaW50IG1pc21h
dGNoOiBUaGUgdHlwZSBcJ051bWJlclwnIGlzIG5vdCBhIHZhbGlkIHN1YnN0aXR1dGUgZm9yIHRo
ZSB0eXBlIHBhcmFtZXRlciBcJ0BOb25OdWxsIFRcJ1xuIiArIAorCQkiLS0tLS0tLS0tLVxuIiAr
IAorCQkiMy4gRVJST1IgaW4gWC5qYXZhIChhdCBsaW5lIDExKVxuIiArIAogCQkiCUBOb25OdWxs
IE51bWJlciBubm4gPSBpbnVtLnByb2Nlc3MobnVsbCk7IC8vIEVSUiBvbiBhcmd1bWVudFxuIiAr
IAogCQkiCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXl5eXlxuIiArIAogCQki
TnVsbCB0eXBlIG1pc21hdGNoOiByZXF1aXJlZCBcJ0BOb25OdWxsIE51bWJlclwnIGJ1dCB0aGUg
cHJvdmlkZWQgdmFsdWUgaXMgbnVsbFxuIiArIA==
</data>

          </attachment>
      

    </bug>

</bugzilla>