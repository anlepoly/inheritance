<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>416912</bug_id>
          
          <creation_ts>2013-09-10 08:14:00 -0400</creation_ts>
          <short_desc>Allow to run tests with tycho-surefire-plugin</short_desc>
          <delta_ts>2015-01-05 17:19:01 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>4.3</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>4.4 M4</target_milestone>
          <dependson>416911</dependson>
          <blocked>416904</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Mickael Istria">mistria</reporter>
          <assigned_to name="Mickael Istria">mistria</assigned_to>
          <cc>bugs.eclipse.org</cc>
    
    <cc>daniel_megert</cc>
    
    <cc>jarthana</cc>
    
    <cc>krzysztof.daniel</cc>
    
    <cc>manpalat</cc>
    
    <cc>stephan.herrmann</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2304828</commentid>
    <comment_count>0</comment_count>
    <who name="Mickael Istria">mistria</who>
    <bug_when>2013-09-10 08:14:33 -0400</bug_when>
    <thetext>+++ This bug was initially created as a clone of Bug #416904 +++

In order to lower entry barrier for contribution and execution of unit tests, it would be quite helpful to make it possible to run tests with tycho-surefire-plugin and a simple &quot;mvn clean verify&quot;.


Gerrit patch: https://git.eclipse.org/r/#/c/16276/</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2306478</commentid>
    <comment_count>1</comment_count>
    <who name="Dani Megert">daniel_megert</who>
    <bug_when>2013-09-13 08:12:07 -0400</bug_when>
    <thetext>Setting target to M3. We have M2 next week and we should not destabilize the current build.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2323136</commentid>
    <comment_count>2</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-10-25 06:48:23 -0400</bug_when>
    <thetext>I may have missed out something, but don&apos;t we need to update org.eclipse.jdt.core.tests.builder/pom.xml as well? Or at least include the RunBuilderTests in org.eclipse.jdt.core.tests.model/pom.xml ?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2323163</commentid>
    <comment_count>3</comment_count>
    <who name="Mickael Istria">mistria</who>
    <bug_when>2013-10-25 07:54:06 -0400</bug_when>
    <thetext>You&apos;re right, current patch set is missing some configuration for org.eclipse.jdt.core.tests.builder/pom.xml</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2323581</commentid>
    <comment_count>4</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-10-26 01:46:02 -0400</bug_when>
    <thetext>Fixed with:

http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=84eb90496358d4e7ac21acc79fa2123659b9b9ff</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2330642</commentid>
    <comment_count>5</comment_count>
    <who name="Mickael Istria">mistria</who>
    <bug_when>2013-11-15 06:47:36 -0500</bug_when>
    <thetext>By the way, this has been closed too early: a couple of module still can&apos;t run their tests.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2330643</commentid>
    <comment_count>6</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-11-15 06:50:18 -0500</bug_when>
    <thetext>(In reply to Mickael Istria from comment #5)
&gt; By the way, this has been closed too early: a couple of module still can&apos;t
&gt; run their tests.

Which ones are they?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2330657</commentid>
    <comment_count>7</comment_count>
    <who name="Mickael Istria">mistria</who>
    <bug_when>2013-11-15 07:13:23 -0500</bug_when>
    <thetext>* org.eclipse.jdt.core.tests.performance runs the whole performance test suite, which is failing, however, the current tests only run OneTest which is working with with surefire. So I&apos;ll configure it to run only this test by default. http://download.eclipse.org/eclipse/downloads/drops4/I20131112-0800/testresults/html/org.eclipse.jdt.core.tests.performance_linux.gtk.x86_6.0.html#OneTest
* org.eclipse.jdt.apt.tests had the change about nested jars reverted, so tests cant&apos;t run
I&apos;m working on them right now and will submit a Gerrit as soon as I can run all jdt.core tests with surefire.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2330677</commentid>
    <comment_count>8</comment_count>
    <who name="Mickael Istria">mistria</who>
    <bug_when>2013-11-15 08:00:14 -0500</bug_when>
    <thetext>I still see the testMirrorsUtil failing, I don&apos;t know the reason, any hint is welcome.
Please see the following patch (all tests passing except testMirrorsUtil)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2335313</commentid>
    <comment_count>9</comment_count>
    <who name="Mickael Istria">mistria</who>
    <bug_when>2013-11-28 02:09:12 -0500</bug_when>
    <thetext>JDT Core can now run tests with Tycho:
  $ mvn clean verify -Pbuild-individual-bundles -Dmaven.test.skip=false
from repository root, of from children module (useful for local development)

The Gerrit Hudson jobs now runs those tests, and will vote -1 in case contribution causes a test failure (and +1 if build and tests are OK).
This build and tests takes about 1h30 to process, which make it able to review about ~16 patches a day.

Thanks to Daniel and Jayaprakash for their reviews and tips.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2335318</commentid>
    <comment_count>10</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-11-28 02:17:03 -0500</bug_when>
    <thetext>(In reply to Mickael Istria from comment #9)
&gt; The Gerrit Hudson jobs now runs those tests, and will vote -1 in case
&gt; contribution causes a test failure (and +1 if build and tests are OK).
&gt; This build and tests takes about 1h30 to process, which make it able to
&gt; review about ~16 patches a day.
&gt; 
&gt; Thanks to Daniel and Jayaprakash for their reviews and tips.

Excellent news! And good work too!

I just kicked off a Hudson job for https://git.eclipse.org/r/#/c/18054/.
Does this mean the tests are being run right now. By the way, is there a way people can &apos;not&apos; run the tests if they didn&apos;t want them to be run?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2335319</commentid>
    <comment_count>11</comment_count>
    <who name="Mickael Istria">mistria</who>
    <bug_when>2013-11-28 02:26:31 -0500</bug_when>
    <thetext>(In reply to Jayaprakash Arthanareeswaran from comment #10)
&gt; Does this mean the tests are being run right now.

Yes, they are being run right now, and you can monitor progress at https://hudson.eclipse.org/platform/job/eclipse.jdt.core-Gerrit/52/

&gt; By the way, is there a way
&gt; people can &apos;not&apos; run the tests if they didn&apos;t want them to be run?

Not that I am aware of. It is possible to configure the Gerrit job on Hudson to run tests or not, but it is a general setting, not a per-review setting.
What is the use-case for not running tests?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2335324</commentid>
    <comment_count>12</comment_count>
    <who name="Dani Megert">daniel_megert</who>
    <bug_when>2013-11-28 02:45:23 -0500</bug_when>
    <thetext>(In reply to Mickael Istria from comment #11)
&gt; Not that I am aware of. It is possible to configure the Gerrit job on Hudson
&gt; to run tests or not, but it is a general setting, not a per-review setting.
&gt; What is the use-case for not running tests?

Maybe if one is in a hurry. But in that case you can still continue with the review and even submit the change.

For the performance of the Gerrit instance(s) I hope they cancel a build when a new patch for the same Gerrit change comes in. But I think I saw the opposite.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2335326</commentid>
    <comment_count>13</comment_count>
    <who name="Mickael Istria">mistria</who>
    <bug_when>2013-11-28 02:52:00 -0500</bug_when>
    <thetext>(In reply to Dani Megert from comment #12)
&gt; Maybe if one is in a hurry. But in that case you can still continue with the
&gt; review and even submit the change.

Yes, Hudson is just here to give a hint. It&apos;s up to the committers to ignore it when it makes sense.

&gt; For the performance of the Gerrit instance(s) I hope they cancel a build
&gt; when a new patch for the same Gerrit change comes in. But I think I saw the
&gt; opposite.

Nope, Gerrit doesn&apos;t automatically cancel jobs when new patch comes. However, committers can follow the link to Hudson pyt in the review and Cancel the job directly on Hudson to save some time.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2335331</commentid>
    <comment_count>14</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-11-28 02:55:09 -0500</bug_when>
    <thetext>(In reply to Mickael Istria from comment #13)
&gt; (In reply to Dani Megert from comment #12)
&gt; &gt; Maybe if one is in a hurry. But in that case you can still continue with the
&gt; &gt; review and even submit the change.
&gt; 
&gt; Yes, Hudson is just here to give a hint. It&apos;s up to the committers to ignore
&gt; it when it makes sense.

In recent past, I found Hudson to be quite handy to just build the bundles and see how the custom bundles turned out. In such case, I wouldn&apos;t want the tests to be run.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2335343</commentid>
    <comment_count>15</comment_count>
    <who name="Mickael Istria">mistria</who>
    <bug_when>2013-11-28 03:04:41 -0500</bug_when>
    <thetext>(In reply to Jayaprakash Arthanareeswaran from comment #14)
&gt; In recent past, I found Hudson to be quite handy to just build the bundles
&gt; and see how the custom bundles turned out. In such case, I wouldn&apos;t want the
&gt; tests to be run.

Ok. Unfortunately, I don&apos;t know how to let Gerrit &amp; Hudson decude whether to run tests of note for a given review. Let&apos;s start by keeping tests working for all reviews.
Note that you can/should try to run the same thing as Hudson is doing locally:
  $ cd eclipse.jdt.core/an-interesting-bundle
  $ mvn clean verify -Pbuild-individual-bundles (-Dmaven.test.skip=false)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2336869</commentid>
    <comment_count>16</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-12-03 05:07:23 -0500</bug_when>
    <thetext>Mickael, the last Hudson job included performance tests (apparently for the first time) and all of them failed. Any idea?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2336870</commentid>
    <comment_count>17</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-12-03 05:08:07 -0500</bug_when>
    <thetext>(In reply to Jayaprakash Arthanareeswaran from comment #16)
&gt; Mickael, the last Hudson job included performance tests (apparently for the
&gt; first time) and all of them failed. Any idea?

https://hudson.eclipse.org/platform/job/eclipse.jdt.core-Gerrit/54/testReport/</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2336871</commentid>
    <comment_count>18</comment_count>
    <who name="Mickael Istria">mistria</who>
    <bug_when>2013-12-03 05:11:51 -0500</bug_when>
    <thetext>The suggested patch is built on top of an older commit which only contains partial support for surefire tests (and that still includes performance tests). You should rebase it on top of master to get the latest changes.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2337925</commentid>
    <comment_count>19</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-12-04 23:39:18 -0500</bug_when>
    <thetext>(In reply to Mickael Istria from comment #18)
&gt; The suggested patch is built on top of an older commit which only contains
&gt; partial support for surefire tests (and that still includes performance
&gt; tests). You should rebase it on top of master to get the latest changes.

That helped, thanks!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2339709</commentid>
    <comment_count>20</comment_count>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2013-12-10 04:09:59 -0500</bug_when>
    <thetext>verified for  Eclipse Luna (4.4M4)Build id: I20131209-2000</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>