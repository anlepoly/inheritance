<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>465900</bug_id>
          
          <creation_ts>2015-04-30 05:30:00 -0400</creation_ts>
          <short_desc>Internal compiler error: java.lang.IllegalArgumentException: info cannot be null at org.eclipse.jdt.internal.compiler.codegen.StackMapFrame.addStackItem(StackMapFrame.java:81)</short_desc>
          <delta_ts>2015-05-08 05:39:28 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>4.5</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>4.5 RC1</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Emond Papegaaij">emond.papegaaij</reporter>
          <assigned_to name="Sasikanth Bharadwaj">saammana</assigned_to>
          <cc>jarthana</cc>
    
    <cc>stephan.herrmann</cc>
          
          <votes>0</votes>

      

      

      <flag name="review"
          id="64621"
          type_id="1"
          status="+"
          setter="stephan.herrmann"
    />

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2554465</commentid>
    <comment_count>0</comment_count>
      <attachid>252943</attachid>
    <who name="Emond Papegaaij">emond.papegaaij</who>
    <bug_when>2015-04-30 05:30:27 -0400</bug_when>
    <thetext>Created attachment 252943
small showcase for the internal compiler error

When trying to compile the attached project (only 2 classes) with the latest 4.5 drop, I get the following stacktrace in the compiler:

java.lang.IllegalArgumentException: info cannot be null
	at org.eclipse.jdt.internal.compiler.codegen.StackMapFrame.addStackItem(StackMapFrame.java:81)
	at org.eclipse.jdt.internal.compiler.ClassFile.traverse(ClassFile.java:5573)
	at org.eclipse.jdt.internal.compiler.ClassFile.generateStackMapTableAttribute(ClassFile.java:4332)
	at org.eclipse.jdt.internal.compiler.ClassFile.completeCodeAttribute(ClassFile.java:1387)
	at org.eclipse.jdt.internal.compiler.ast.AbstractMethodDeclaration.generateCode(AbstractMethodDeclaration.java:357)
	at org.eclipse.jdt.internal.compiler.ast.AbstractMethodDeclaration.generateCode(AbstractMethodDeclaration.java:281)
	at org.eclipse.jdt.internal.compiler.ast.TypeDeclaration.generateCode(TypeDeclaration.java:567)
	at org.eclipse.jdt.internal.compiler.ast.TypeDeclaration.generateCode(TypeDeclaration.java:636)
	at org.eclipse.jdt.internal.compiler.ast.CompilationUnitDeclaration.generateCode(CompilationUnitDeclaration.java:368)
	at org.eclipse.jdt.core.dom.CompilationUnitResolver.resolve(CompilationUnitResolver.java:1217)
	at org.eclipse.jdt.core.dom.CompilationUnitResolver.resolve(CompilationUnitResolver.java:690)
	at org.eclipse.jdt.core.dom.ASTParser.internalCreateAST(ASTParser.java:1190)
	at org.eclipse.jdt.core.dom.ASTParser.createAST(ASTParser.java:812)
	at org.eclipse.jdt.internal.ui.javaeditor.ASTProvider$1.run(ASTProvider.java:535)
	at org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:42)
	at org.eclipse.jdt.internal.ui.javaeditor.ASTProvider.createAST(ASTProvider.java:528)
	at org.eclipse.jdt.internal.ui.javaeditor.ASTProvider.getAST(ASTProvider.java:471)
	at org.eclipse.jdt.internal.ui.javaeditor.ASTProvider.getAST(ASTProvider.java:461)
	at org.eclipse.jdt.ui.SharedASTProvider.getAST(SharedASTProvider.java:128)
	at org.eclipse.jdt.ui.OverrideIndicatorLabelDecorator.getOverrideIndicators(OverrideIndicatorLabelDecorator.java:161)
	at org.eclipse.jdt.ui.OverrideIndicatorLabelDecorator.computeAdornmentFlags(OverrideIndicatorLabelDecorator.java:136)
	at org.eclipse.jdt.ui.OverrideIndicatorLabelDecorator.decorate(OverrideIndicatorLabelDecorator.java:273)
	at org.eclipse.ui.internal.decorators.LightweightDecoratorDefinition.decorate(LightweightDecoratorDefinition.java:273)
	at org.eclipse.ui.internal.decorators.LightweightDecoratorManager$LightweightRunnable.run(LightweightDecoratorManager.java:83)
	at org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:42)
	at org.eclipse.ui.internal.decorators.LightweightDecoratorManager.decorate(LightweightDecoratorManager.java:367)
	at org.eclipse.ui.internal.decorators.LightweightDecoratorManager.getDecorations(LightweightDecoratorManager.java:349)
	at org.eclipse.ui.internal.decorators.DecorationScheduler$1.ensureResultCached(DecorationScheduler.java:372)
	at org.eclipse.ui.internal.decorators.DecorationScheduler$1.run(DecorationScheduler.java:332)
	at org.eclipse.core.internal.jobs.Worker.run(Worker.java:55)

Information about my install:
eclipse.buildId=4.5.0.I20150428-2000
java.version=1.8.0_45
java.vendor=Oracle Corporation
BootLoader constants: OS=linux, ARCH=x86_64, WS=gtk, NL=en_US
Command-line arguments:  -os linux -ws gtk -arch x86_64</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2554474</commentid>
    <comment_count>1</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2015-04-30 05:38:08 -0400</bug_when>
    <thetext>I can reproduce with the latest I build.

Sasi, please take a look at this.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2555831</commentid>
    <comment_count>2</comment_count>
    <who name="Sasikanth Bharadwaj">saammana</who>
    <bug_when>2015-05-04 03:55:10 -0400</bug_when>
    <thetext>Caused by the fix for bug 448556. Problem is that the variable that captures the receiver of the method reference is added multiple times, every time the reference expression is resolved. So, in the case where the reference expression is resolved multiple times for different target types, the variable is added multiple times and later when trying to resolve the body of the implicit lambda, incorrect variable is picked. Solution is to limit the addition of the variable to one time. Tests running with the patch.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2559459</commentid>
    <comment_count>3</comment_count>
      <attachid>253262</attachid>
    <who name="Sasikanth Bharadwaj">saammana</who>
    <bug_when>2015-05-07 01:47:21 -0400</bug_when>
    <thetext>Created attachment 253262
patch</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2559461</commentid>
    <comment_count>4</comment_count>
    <who name="Sasikanth Bharadwaj">saammana</who>
    <bug_when>2015-05-07 01:49:54 -0400</bug_when>
    <thetext>Stephan, please review. It&apos;s a trivial change and needed for RC1 because this is a regression. Thanks</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2559932</commentid>
    <comment_count>5</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2015-05-07 10:50:18 -0400</bug_when>
    <thetext>(In reply to Sasikanth Bharadwaj from comment #4)
&gt; Stephan, please review. It&apos;s a trivial change and needed for RC1 because
&gt; this is a regression. Thanks

I agree.
&quot;Proof-by-analogy&quot;: The fix is nicely in line with the guard for the other side-effect into &apos;scope&apos; (beginning of the same enclosing then-block): 

  	if (this.original == this)
    		recordFunctionalType(scope);

+1 for RC1 (assuming success of full test run :) ).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2560507</commentid>
    <comment_count>6</comment_count>
    <who name="Sasikanth Bharadwaj">saammana</who>
    <bug_when>2015-05-08 05:39:28 -0400</bug_when>
    <thetext>(In reply to comment #5)
&gt; (In reply to Sasikanth Bharadwaj from comment #4)
&gt; &gt; Stephan, please review. It&apos;s a trivial change and needed for RC1 because
&gt; &gt; this is a regression. Thanks
&gt; 

&gt; +1 for RC1 (assuming success of full test run :) ).
Thanks Stephan. Hudson gave a +1 here (https://git.eclipse.org/r/#/c/47016/). Released via http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=6a618f5105b380b0a9a5dc6bfffb855693be7fab</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="0"
              isprivate="0"
          >
            <attachid>252943</attachid>
            <date>2015-04-30 05:30:00 -0400</date>
            <delta_ts>2015-04-30 05:30:27 -0400</delta_ts>
            <desc>small showcase for the internal compiler error</desc>
            <filename>compilererror.tar.gz</filename>
            <type>application/gzip</type>
            <size>1756</size>
            <attacher name="Emond Papegaaij">emond.papegaaij</attacher>
            
              <data encoding="base64">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
</data>

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>253262</attachid>
            <date>2015-05-07 01:47:00 -0400</date>
            <delta_ts>2015-05-07 01:47:21 -0400</delta_ts>
            <desc>patch</desc>
            <filename>fix-and-test-for-bug465900.patch</filename>
            <type>text/plain</type>
            <size>2583</size>
            <attacher name="Sasikanth Bharadwaj">saammana</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLmNvbXBpbGVyL3NyYy9vcmcv
ZWNsaXBzZS9qZHQvY29yZS90ZXN0cy9jb21waWxlci9yZWdyZXNzaW9uL0xhbWJkYVJlZ3Jlc3Np
b25UZXN0LmphdmEgYi9vcmcuZWNsaXBzZS5qZHQuY29yZS50ZXN0cy5jb21waWxlci9zcmMvb3Jn
L2VjbGlwc2UvamR0L2NvcmUvdGVzdHMvY29tcGlsZXIvcmVncmVzc2lvbi9MYW1iZGFSZWdyZXNz
aW9uVGVzdC5qYXZhCmluZGV4IDFjMjhjYTIuLjdlMWI4ODggMTAwNjQ0Ci0tLSBhL29yZy5lY2xp
cHNlLmpkdC5jb3JlLnRlc3RzLmNvbXBpbGVyL3NyYy9vcmcvZWNsaXBzZS9qZHQvY29yZS90ZXN0
cy9jb21waWxlci9yZWdyZXNzaW9uL0xhbWJkYVJlZ3Jlc3Npb25UZXN0LmphdmEKKysrIGIvb3Jn
LmVjbGlwc2UuamR0LmNvcmUudGVzdHMuY29tcGlsZXIvc3JjL29yZy9lY2xpcHNlL2pkdC9jb3Jl
L3Rlc3RzL2NvbXBpbGVyL3JlZ3Jlc3Npb24vTGFtYmRhUmVncmVzc2lvblRlc3QuamF2YQpAQCAt
ODg5LDYgKzg4OSwyOSBAQAogCQkiQ2Fubm90IGNyZWF0ZSBhIGdlbmVyaWMgYXJyYXkgb2YgTGlz
dDxTdHJpbmc+XG4iICsgCiAJCSItLS0tLS0tLS0tXG4iKTsKIH0KKy8vIGh0dHBzOi8vYnVncy5l
Y2xpcHNlLm9yZy9idWdzL3Nob3dfYnVnLmNnaT9pZD00NjU5MDAKKy8vIEludGVybmFsIGNvbXBp
bGVyIGVycm9yOiBqYXZhLmxhbmcuSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uOiBpbmZvIGNhbm5v
dCBiZSBudWxsIGF0IG9yZy5lY2xpcHNlLmpkdC5pbnRlcm5hbC5jb21waWxlci5jb2RlZ2VuLlN0
YWNrTWFwRnJhbWUuYWRkU3RhY2tJdGVtKFN0YWNrTWFwRnJhbWUuamF2YTo4MSkKK3B1YmxpYyB2
b2lkIHRlc3RCdWc0NjU5MDAoKSB7CisJdGhpcy5ydW5Db25mb3JtVGVzdChuZXcgU3RyaW5nIFtd
IHsKKwkJIlguamF2YSIsCisJCSJpbXBvcnQgamF2YS5pby5TZXJpYWxpemFibGU7XG4iICsgCisJ
CSJpbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDtcbiIgKyAKKwkJImltcG9ydCBqYXZhLnV0aWwu
TGlzdDtcbiIgKyAKKwkJImltcG9ydCBqYXZhLnV0aWwuZnVuY3Rpb24uU3VwcGxpZXI7XG4iICsg
CisJCSJwdWJsaWMgY2xhc3MgWCB7XG4iICsgCisJCSIJcHJpdmF0ZSBzdGF0aWMgZmluYWwgbG9u
ZyBzZXJpYWxWZXJzaW9uVUlEID0gMUw7XG4iICsgCisJCSIJcHJvdGVjdGVkIHZvaWQgeCgpIHtc
biIgKyAKKwkJIgkJU3RyaW5nIHN0ciA9IFwiZ3JvZXAua29wcGVsaW5nLlwiICsgKFwiXCIuaXNF
bXB0eSgpID8gXCJ0b2V2b2VnZW5cIiA6IFwiYmV3ZXJrZW5cIik7XG4iICsgCisJCSIJCUxpc3Q8
U3RyaW5nPiBiZWFuID0gbmV3IEFycmF5TGlzdDw+KCk7XG4iICsgCisJCSIJCXRlc3QoYmVhbi5n
ZXQoMCk6OmlzRW1wdHkpO1xuIiArIAorCQkiCX1cbiIgKyAKKwkJIglwcml2YXRlIHZvaWQgdGVz
dChTZXJpYWxpemFibGVTdXBwbGllcjxCb29sZWFuPiB0ZXN0KSB7fVxuIiArIAorCQkifVxuIiAr
IAorCQkiQEZ1bmN0aW9uYWxJbnRlcmZhY2VcbiIgKyAKKwkJImludGVyZmFjZSBTZXJpYWxpemFi
bGVTdXBwbGllcjxUPiBleHRlbmRzIFN1cHBsaWVyPFQ+LCBTZXJpYWxpemFibGUge31cbiIKKwl9
LAorCSIiKTsKK30KIHB1YmxpYyBzdGF0aWMgQ2xhc3MgdGVzdENsYXNzKCkgewogCXJldHVybiBM
YW1iZGFSZWdyZXNzaW9uVGVzdC5jbGFzczsKIH0KZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpk
dC5jb3JlL2NvbXBpbGVyL29yZy9lY2xpcHNlL2pkdC9pbnRlcm5hbC9jb21waWxlci9hc3QvUmVm
ZXJlbmNlRXhwcmVzc2lvbi5qYXZhIGIvb3JnLmVjbGlwc2UuamR0LmNvcmUvY29tcGlsZXIvb3Jn
L2VjbGlwc2UvamR0L2ludGVybmFsL2NvbXBpbGVyL2FzdC9SZWZlcmVuY2VFeHByZXNzaW9uLmph
dmEKaW5kZXggYTRiMGEyYy4uYWVmOGQ2NSAxMDA2NDQKLS0tIGEvb3JnLmVjbGlwc2UuamR0LmNv
cmUvY29tcGlsZXIvb3JnL2VjbGlwc2UvamR0L2ludGVybmFsL2NvbXBpbGVyL2FzdC9SZWZlcmVu
Y2VFeHByZXNzaW9uLmphdmEKKysrIGIvb3JnLmVjbGlwc2UuamR0LmNvcmUvY29tcGlsZXIvb3Jn
L2VjbGlwc2UvamR0L2ludGVybmFsL2NvbXBpbGVyL2FzdC9SZWZlcmVuY2VFeHByZXNzaW9uLmph
dmEKQEAgLTUyMiw3ICs1MjIsNyBAQAogCSAgICAgICAgICAgIH0KIAkgICAgICAgIAl0aGlzLmJp
bmRpbmcgPSB0aGlzLmV4YWN0TWV0aG9kQmluZGluZyA9IHNjb3BlLmdldEV4YWN0Q29uc3RydWN0
b3IobGhzVHlwZSwgdGhpcyk7CiAJICAgICAgICB9Ci0JCQlpZiAoaXNNZXRob2RSZWZlcmVuY2Uo
KSAmJiB0aGlzLmhhdmVSZWNlaXZlcikgeworCQkJaWYgKGlzTWV0aG9kUmVmZXJlbmNlKCkgJiYg
dGhpcy5oYXZlUmVjZWl2ZXIgJiYgKHRoaXMub3JpZ2luYWwgPT0gdGhpcykpIHsKIAkJCQl0aGlz
LnJlY2VpdmVyVmFyaWFibGUgPSBuZXcgTG9jYWxWYXJpYWJsZUJpbmRpbmcoCiAJCQkJCQkoU2Vj
cmV0UmVjZWl2ZXJWYXJpYWJsZU5hbWUgKyB0aGlzLm5hbWVTb3VyY2VTdGFydCkudG9DaGFyQXJy
YXkoKSwgdGhpcy5saHMucmVzb2x2ZWRUeXBlLAogCQkJCQkJQ2xhc3NGaWxlQ29uc3RhbnRzLkFj
Y0RlZmF1bHQsIGZhbHNlKTsK
</data>

          </attachment>
      

    </bug>

</bugzilla>