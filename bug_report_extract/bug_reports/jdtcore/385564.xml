<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>385564</bug_id>
          
          <creation_ts>2012-07-20 02:39:00 -0400</creation_ts>
          <short_desc>[null] document which entities are affected by @NonNullByDefault</short_desc>
          <delta_ts>2012-08-16 01:05:08 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>3.8</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows 7</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>3.8.1</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Deepak Azad">deepakazad</reporter>
          <assigned_to name="Stephan Herrmann">stephan.herrmann</assigned_to>
          <cc>amj87.iitr</cc>
    
    <cc>jarthana</cc>
    
    <cc>srikanth_sankaran</cc>
    
    <cc>stephan.herrmann</cc>
          
          <votes>0</votes>

      

      

      <flag name="review"
          id="52767"
          type_id="1"
          status="+"
          setter="srikanth_sankaran"
    />

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2139393</commentid>
    <comment_count>0</comment_count>
    <who name="Deepak Azad">deepakazad</who>
    <bug_when>2012-07-20 02:39:30 -0400</bug_when>
    <thetext>@NonNullByDefault
public class Test {

	@NonNullByDefault   // warning
	Object foo1(@Nullable Object o, @NonNull Object o2) { // warning
		if(o2!=null) {	
		}
		
		@NonNull Object abc;  // NO WARNING
		return new Object();
	}
}

There is NO redundant annotation warning on local variable &apos;abc&apos;, while the warning is present on the method and the parameter &apos;o2&apos;. Is this by design, or am I missing something here?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2139416</commentid>
    <comment_count>1</comment_count>
    <who name="Ayushman Jain">amj87.iitr</who>
    <bug_when>2012-07-20 04:23:11 -0400</bug_when>
    <thetext>As far as i remember, the null default setting does not apply to local variables. Applying such contracts to locals is much less useful than applying it to return types and parameters because locals are confined to a scope and we already do null analysis without the annotations. Enforcing the null contract of the default on locals will be very prohibitive for a user, because for each local that can possibly be null, he will have to cancel out the contract with an annotation. 
Stephan, we can close this if you concur.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2139419</commentid>
    <comment_count>2</comment_count>
    <who name="Deepak Azad">deepakazad</who>
    <bug_when>2012-07-20 04:32:13 -0400</bug_when>
    <thetext>(In reply to comment #1)
&gt; As far as i remember, the null default setting does not apply to local
&gt; variables.
Is this behavior documented somewhere? If not, it should be.  

http://help.eclipse.org/juno/index.jsp?topic=/org.eclipse.jdt.doc.isv/reference/api/org/eclipse/jdt/annotation/NonNullByDefault.html

Javadoc of @NonNullByDefault refers to &apos;all contained entities&apos; - at least that needs a clarification.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2139503</commentid>
    <comment_count>3</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2012-07-20 07:33:33 -0400</bug_when>
    <thetext>(In reply to comment #1)
&gt; As far as i remember, the null default setting does not apply to local
&gt; variables. 

Exactly.

(In reply to comment #2)
&gt; Javadoc of @NonNullByDefault refers to &apos;all contained entities&apos; - at least that
&gt; needs a clarification.

It seems I tried to state this in a generic way so the doc remains valid when fields will be included. I missed that this phrasing is now too generic.

The JavaCore constant is more explicit:
COMPILER_NONNULL_BY_DEFAULT_ANNOTATION_NAME
&quot;... If the annotation is applied without an argument, all unannotated types in method signatures within the annotated element will be treated as if they were specified with the non-null annotation.&quot;

I&apos;ll take care of aligning these.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2141841</commentid>
    <comment_count>4</comment_count>
    <who name="Ayushman Jain">amj87.iitr</who>
    <bug_when>2012-07-25 13:21:16 -0400</bug_when>
    <thetext>Should be trivial to backport to 3.8.1.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2142489</commentid>
    <comment_count>5</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2012-07-27 00:08:19 -0400</bug_when>
    <thetext>Suggest we keep the 3.8.1 train only for critical/serious/blocker fixes.
While &quot;routiune&quot;/&quot;safe&quot; fixes would also qualify in normal times, at the
present juncture any cycles saved and spent on Java8 is very welcome</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2142715</commentid>
    <comment_count>6</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2012-07-27 11:52:26 -0400</bug_when>
    <thetext>I&apos;ve pushed a proposed doc-only change to https://git.eclipse.org/r/#/c/7002/

Since there&apos;s no risk in this change and the new API published in Juno was not sufficiently documented in this regard, I could still see benefit in releasing also for 3.8.1. I won&apos;t fight for this, however.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2142857</commentid>
    <comment_count>7</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2012-07-27 20:40:36 -0400</bug_when>
    <thetext>(In reply to comment #6)

&gt; Since there&apos;s no risk in this change and the new API published in Juno was
&gt; not sufficiently documented in this regard, I could still see benefit in
&gt; releasing also for 3.8.1. 

Let us release this for 3.8.1 also. Thanks.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2142874</commentid>
    <comment_count>8</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2012-07-28 06:00:10 -0400</bug_when>
    <thetext>Released for 3.8.1 via commit https://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?h=R3_8_maintenance&amp;id=bdffbad17d807f0dd3ee0d4fceef5b80cf8a3082</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2145160</commentid>
    <comment_count>9</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2012-08-06 05:49:43 -0400</bug_when>
    <thetext>Verified by code inspection in I20120805-2000.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2145189</commentid>
    <comment_count>10</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2012-08-06 06:59:52 -0400</bug_when>
    <thetext>The change is missing in the built Javadoc (in I20120805-2000), see bug 385540, comment 16 for the reason.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2145417</commentid>
    <comment_count>11</comment_count>
    <who name="Ayushman Jain">amj87.iitr</who>
    <bug_when>2012-08-07 02:04:25 -0400</bug_when>
    <thetext>(In reply to comment #10)
&gt; The change is missing in the built Javadoc (in I20120805-2000), see bug
&gt; 385540, comment 16 for the reason.

This should be available in today&apos;s (7 Aug) build.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2145866</commentid>
    <comment_count>12</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2012-08-08 01:50:06 -0400</bug_when>
    <thetext>(In reply to comment #11)
&gt; (In reply to comment #10)
&gt; &gt; The change is missing in the built Javadoc (in I20120805-2000), see bug
&gt; &gt; 385540, comment 16 for the reason.
&gt; 
&gt; This should be available in today&apos;s (7 Aug) build.

Good catch Tom.

Verified for 4.3 M1  using Build id: I20120807-2000</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2145898</commentid>
    <comment_count>13</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2012-08-08 03:50:25 -0400</bug_when>
    <thetext>We need to leave this RESOLVED state and change to VERIFIED state after
testing for 3.8.1 completes.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2148878</commentid>
    <comment_count>14</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2012-08-16 01:05:08 -0400</bug_when>
    <thetext>Verified for 3.8.1 with build M20120815-1000</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>