<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>407364</bug_id>
          
          <creation_ts>2013-05-07 04:04:00 -0400</creation_ts>
          <short_desc>[1.8][dom ast] Incorrect ASTRewrite for QualifiedType</short_desc>
          <delta_ts>2013-05-28 01:56:07 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>4.3</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows 7</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>BETA J8</target_milestone>
          <dependson>406469</dependson>
          <blocked>398940</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Manoj Palat Away Until May 11 2015">manpalat</reporter>
          <assigned_to name="Manoj Palat Away Until May 11 2015">manpalat</assigned_to>
          <cc>jarthana</cc>
    
    <cc>markus_keller</cc>
    
    <cc>shankhba</cc>
    
    <cc>srikanth_sankaran</cc>
          
          <votes>0</votes>

      

      

      <flag name="review"
          id="57159"
          type_id="1"
          status="+"
          setter="jarthana"
    />
    <flag name="review"
          id="57160"
          type_id="1"
          status="+"
          setter="markus_keller"
    />

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2253145</commentid>
    <comment_count>0</comment_count>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2013-05-07 04:04:25 -0400</bug_when>
    <thetext>ASTRewrite testcases for QualifiedType need to be added to complete the list.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2254478</commentid>
    <comment_count>1</comment_count>
      <attachid>230691</attachid>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2013-05-08 21:09:15 -0400</bug_when>
    <thetext>Created attachment 230691
Test case to reproduce the issue

Incorrect ASTRewrite transformation for Annotated Qualified Type 
Ref Attached test case:

Expected output is Outer.Inner for Outer.@Marker Inner after ASTRewrite, but the actual output is Inner.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2254557</commentid>
    <comment_count>2</comment_count>
      <attachid>230712</attachid>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2013-05-09 03:13:32 -0400</bug_when>
    <thetext>Created attachment 230712
Proposed Patch

 - Corrected a similar omission in PackageQualifiedType as well.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2254966</commentid>
    <comment_count>3</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2013-05-10 01:45:06 -0400</bug_when>
    <thetext>Jay and Markus, I believe this is the last open item to close bug 398940.
Jay, please review so Markus can have a final glance through the fix and
we can declare done on 308 DOM/AST and ASTRewrite work.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2255040</commentid>
    <comment_count>4</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-05-10 07:24:30 -0400</bug_when>
    <thetext>Patch looks good. Interestingly, testPackageQualifiedTypeAnnotations() was failing too, without the patch, although it&apos;s an existing test. Was it always like that?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2255746</commentid>
    <comment_count>5</comment_count>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2013-05-12 22:23:22 -0400</bug_when>
    <thetext>(In reply to comment #4)
&gt; Patch looks good. Interestingly, testPackageQualifiedTypeAnnotations() was
&gt; failing too, without the patch, although it&apos;s an existing test. Was it
&gt; always like that?

Please refer to comment 2 - there was an omission in PQT and this was corrected in the patch as discussed. The fully qualified name of the type was omitted in the expected result which caused the PQT test to pass earlier - was modified now to reflect the issue, and subsequently corrected - did not raise a new bug for PQT but just mentioned in the comment 2 of this bug.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2255757</commentid>
    <comment_count>6</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-05-13 01:15:41 -0400</bug_when>
    <thetext>(In reply to comment #5)
&gt; Please refer to comment 2 - there was an omission in PQT and this was
&gt; corrected in the patch as discussed. The fully qualified name of the type
&gt; was omitted in the expected result which caused the PQT test to pass earlier
&gt; - was modified now to reflect the issue, and subsequently corrected - did
&gt; not raise a new bug for PQT but just mentioned in the comment 2 of this bug.

Thanks for explaining. I probably didn&apos;t look close enough and thought the test was failing without the fix. But of course, that&apos;s not the case.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2260625</commentid>
    <comment_count>7</comment_count>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2013-05-22 00:12:35 -0400</bug_when>
    <thetext>(In reply to comment #6)

Thanks Jay for the review.

Markus: Any comments?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2260764</commentid>
    <comment_count>8</comment_count>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2013-05-22 07:13:29 -0400</bug_when>
    <thetext>Looks OK, but:

- in visit(QualifiedType), the &apos;try&apos; statement should be moved inside the
&apos;if (node.getAST().apiLevel() &gt;= AST.JLS8)&apos; block

- in visit(PackageQualifiedType), the AST.JLS8 check should be removed (redundant, since a PackageQualifiedType cannot exist in earlier ASTs)

Good to go with these changes.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2261309</commentid>
    <comment_count>9</comment_count>
      <attachid>231344</attachid>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2013-05-23 02:51:18 -0400</bug_when>
    <thetext>Created attachment 231344
Proposed Patch

After rework.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2264023</commentid>
    <comment_count>10</comment_count>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2013-05-28 01:56:07 -0400</bug_when>
    <thetext>Fixed via commit: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?h=BETA_JAVA8&amp;id=dbd0327afde5954f2670683ba00deedae5d6bb02</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="0"
              isprivate="0"
          >
            <attachid>230691</attachid>
            <date>2013-05-08 21:09:00 -0400</date>
            <delta_ts>2013-05-08 21:09:15 -0400</delta_ts>
            <desc>Test case to reproduce the issue</desc>
            <filename>file_407364.txt</filename>
            <type>text/plain</type>
            <size>2211</size>
            <attacher name="Manoj Palat Away Until May 11 2015">manpalat</attacher>
            
              <data encoding="base64">CXB1YmxpYyB2b2lkIHRlc3RRdWFsaWZpZWRUeXBlQW5ub3RhdGlvbnMxKCkgdGhyb3dzIEV4Y2Vw
dGlvbiB7DQoJCUlQYWNrYWdlRnJhZ21lbnQgcGFjazE9IHRoaXMuc291cmNlRm9sZGVyLmNyZWF0
ZVBhY2thZ2VGcmFnbWVudCgidGVzdDQwNzM2NC5idWciLCBmYWxzZSwgbnVsbCk7DQoJCVN0cmlu
ZyBjb250ZW50cyA9ICAicGFja2FnZSB0ZXN0NDA3MzY0LmJ1ZztcbiIgKw0KCQkJCSAiaW1wb3J0
IGphdmEubGFuZy5hbm5vdGF0aW9uLlRhcmdldDtcbiIgKw0KCQkJCSAicHVibGljIGNsYXNzIFgg
e1xuIiArDQoJCQkJICIJcHVibGljIHN0YXRpYyB2b2lkIG1haW4oU3RyaW5nW10gYXJncykge1xu
IiArDQoJCQkJICIJCU91dGVyIG91dGVyID0gbmV3IE91dGVyKCk7XG4iICsNCgkJCQkgIgkJT3V0
ZXIuQE1hcmtlcjEgSW5uZXIgZmlyc3QgPSBvdXRlci5uZXcgSW5uZXIoKTtcbiIgKw0KCQkJCSAi
CX1cbiIgKyANCgkJCQkgIn1cbiIgKyANCgkJCQkgImNsYXNzIE91dGVyIHtcbiIgKw0KCQkJCSAi
CXB1YmxpYyBjbGFzcyBJbm5lciB7XG4iICsgDQoJCQkJICIJCXB1YmxpYyBjbGFzcyBEZWVwZXIg
e1xuIiArDQoJCQkJICIJCX1cbiIgKyANCgkJCQkgIgl9XG4iICsgDQoJCQkJICJ9XG4iICsNCgkJ
CQkgIkBUYXJnZXQgKGphdmEubGFuZy5hbm5vdGF0aW9uLkVsZW1lbnRUeXBlLlRZUEVfVVNFKVxu
IiArDQoJCQkJICJAaW50ZXJmYWNlIE1hcmtlciB7fVxuIjsNCgkJDQoJCVN0cmluZ0J1ZmZlciBi
dWYgPSBuZXcgU3RyaW5nQnVmZmVyKGNvbnRlbnRzKTsJCQkNCgkJSUNvbXBpbGF0aW9uVW5pdCBj
dT0gcGFjazEuY3JlYXRlQ29tcGlsYXRpb25Vbml0KCJYLmphdmEiLCBidWYudG9TdHJpbmcoKSwg
ZmFsc2UsIG51bGwpOw0KCQlDb21waWxhdGlvblVuaXQgYXN0Um9vdD0gY3JlYXRlQVNUKGN1LCAv
KiByZXNvbHZlICovIHRydWUsIGZhbHNlKTsNCgkJQVNUUmV3cml0ZSByZXdyaXRlPSBBU1RSZXdy
aXRlLmNyZWF0ZShhc3RSb290LmdldEFTVCgpKTsNCgkJQVNUIGFzdD0gYXN0Um9vdC5nZXRBU1Qo
KTsNCgkJVHlwZURlY2xhcmF0aW9uIHR5cGVEZWNsYXJhdGlvbj0gZmluZFR5cGVEZWNsYXJhdGlv
bihhc3RSb290LCAiWCIpOw0KCQlNZXRob2REZWNsYXJhdGlvbiBtZXRob2REZWNsYXJhdGlvbj0g
ZmluZE1ldGhvZERlY2xhcmF0aW9uKHR5cGVEZWNsYXJhdGlvbiwgIm1haW4iKTsNCgkJTGlzdCBz
dGF0ZW1lbnRzID0gbWV0aG9kRGVjbGFyYXRpb24uZ2V0Qm9keSgpLnN0YXRlbWVudHMoKTsNCg0K
CQl7ICAgDQoJCQlWYXJpYWJsZURlY2xhcmF0aW9uU3RhdGVtZW50IHZhcmlhYmxlRGVjbGFyYXRp
b25TdGF0ZW1lbnQgPSAoVmFyaWFibGVEZWNsYXJhdGlvblN0YXRlbWVudCkgc3RhdGVtZW50cy5n
ZXQoMSk7DQoJCQlRdWFsaWZpZWRUeXBlIHF1YWxpZmllZFR5cGUgPSAoUXVhbGlmaWVkVHlwZSkg
dmFyaWFibGVEZWNsYXJhdGlvblN0YXRlbWVudC5nZXRUeXBlKCk7DQoJCQlyZXdyaXRlLnJlbW92
ZSgoQVNUTm9kZSkgcXVhbGlmaWVkVHlwZS5hbm5vdGF0aW9ucygpLmdldCgwKSwgbnVsbCk7DQoJ
CX0NCgkJU3RyaW5nIHByZXZpZXc9IGV2YWx1YXRlUmV3cml0ZShjdSwgcmV3cml0ZSk7DQoJCVN0
cmluZyBjb250ZW50c21vZGlmaWVkID0gInBhY2thZ2UgdGVzdDQwNzM2NC5idWc7XG4iICsNCgkJ
CQkgImltcG9ydCBqYXZhLmxhbmcuYW5ub3RhdGlvbi5UYXJnZXQ7XG4iICsNCgkJCQkgInB1Ymxp
YyBjbGFzcyBYIHtcbiIgKw0KCQkJCSAiCXB1YmxpYyBzdGF0aWMgdm9pZCBtYWluKFN0cmluZ1td
IGFyZ3MpIHtcbiIgKw0KCQkJCSAiCQlPdXRlciBvdXRlciA9IG5ldyBPdXRlcigpO1xuIiArDQoJ
CQkJICIJCU91dGVyLkBOZXdNYXJrZXIgSW5uZXIgZmlyc3QgPSBvdXRlci5uZXcgSW5uZXIoKTtc
biIgKw0KCQkJCSAiCX1cbiIgKyANCgkJCQkgIn1cbiIgKyANCgkJCQkgImNsYXNzIE91dGVyIHtc
biIgKw0KCQkJCSAiCXB1YmxpYyBjbGFzcyBJbm5lciB7XG4iICsgDQoJCQkJICIJCXB1YmxpYyBj
bGFzcyBEZWVwZXIge1xuIiArDQoJCQkJICIJCX1cbiIgKyANCgkJCQkgIgl9XG4iICsgDQoJCQkJ
ICJ9XG4iICsNCgkJCQkgIkBUYXJnZXQgKGphdmEubGFuZy5hbm5vdGF0aW9uLkVsZW1lbnRUeXBl
LlRZUEVfVVNFKVxuIiArDQoJCQkJICJAaW50ZXJmYWNlIE1hcmtlciB7fVxuIjsNCgkJYXNzZXJ0
RXF1YWxTdHJpbmcocHJldmlldywgY29udGVudHNtb2RpZmllZCk7DQoJfQ0K
</data>

          </attachment>
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>230712</attachid>
            <date>2013-05-09 03:13:00 -0400</date>
            <delta_ts>2013-05-23 02:51:18 -0400</delta_ts>
            <desc>Proposed Patch</desc>
            <filename>Fix-for-Bug-407364--18dom-ast-Incorrect-ASTRewrite-f.patch</filename>
            <type>text/plain</type>
            <size>8039</size>
            <attacher name="Manoj Palat Away Until May 11 2015">manpalat</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3NyYy9vcmcvZWNs
aXBzZS9qZHQvY29yZS90ZXN0cy9yZXdyaXRlL2Rlc2NyaWJpbmcvQVNUUmV3cml0aW5nVHlwZUFu
bm90YXRpb25zVGVzdC5qYXZhIGIvb3JnLmVjbGlwc2UuamR0LmNvcmUudGVzdHMubW9kZWwvc3Jj
L29yZy9lY2xpcHNlL2pkdC9jb3JlL3Rlc3RzL3Jld3JpdGUvZGVzY3JpYmluZy9BU1RSZXdyaXRp
bmdUeXBlQW5ub3RhdGlvbnNUZXN0LmphdmEKaW5kZXggNTZkNzg4Ni4uY2VhOWQ1OSAxMDA2NDQK
LS0tIGEvb3JnLmVjbGlwc2UuamR0LmNvcmUudGVzdHMubW9kZWwvc3JjL29yZy9lY2xpcHNlL2pk
dC9jb3JlL3Rlc3RzL3Jld3JpdGUvZGVzY3JpYmluZy9BU1RSZXdyaXRpbmdUeXBlQW5ub3RhdGlv
bnNUZXN0LmphdmEKKysrIGIvb3JnLmVjbGlwc2UuamR0LmNvcmUudGVzdHMubW9kZWwvc3JjL29y
Zy9lY2xpcHNlL2pkdC9jb3JlL3Rlc3RzL3Jld3JpdGUvZGVzY3JpYmluZy9BU1RSZXdyaXRpbmdU
eXBlQW5ub3RhdGlvbnNUZXN0LmphdmEKQEAgLTk0Nyw3ICs5NDcsNyBAQAogCQkJCSIgCSogQHBh
cmFtIGFyZyAgXG4iICsKIAkJCQkiIAkqL1xuIiArCiAJCQkJIgl0ZXN0NDA2NDY5LmJ1Zy5ATWFy
a2VyIElPRXhjZXB0aW9uIGZvbyhcbiIgKwotCQkJCSIJCQlGaWxlTm90Rm91bmRFeGNlcHRpb24g
YXJnKVxuIiArCisJCQkJIgkJCXRlc3Q0MDY0NjkuYnVnLkZpbGVOb3RGb3VuZEV4Y2VwdGlvbiBh
cmcpXG4iICsKIAkJCQkiCQl0aHJvd3MgdGVzdDQwNjQ2OS5idWcuQE5vbk51bGwgQE1hcmtlciBF
T0ZFeGNlcHRpb24ge1xuIiArCiAJCQkJIgkJdHJ5IHtcbiIgKwogCQkJCSIJCQl0ZXN0NDA2NDY5
LmJ1Zy5ATm9uTnVsbCBJT0Vycm9yIGUgPSBuZXcgdGVzdDQwNjQ2OS5idWcuQE1hcmtlciBJT0Vy
cm9yKCk7XG4iICsKQEAgLTk3Miw0ICs5NzIsMTAzIEBACiAJCWFzc2VydEVxdWFsU3RyaW5nKHBy
ZXZpZXcsIGNvbnRlbnRzbW9kaWZpZWQpOwogCX0KIAorCS8qKgorCSAqIEFTVFJld3JpdGVyVGVz
dHMgZm9yIFF1YWxpZmllZFR5cGUKKwkgKiBAdGhyb3dzIEV4Y2VwdGlvbgorCSAqIAorCSAqIGh0
dHBzOi8vYnVncy5lY2xpcHNlLm9yZy9idWdzL3Nob3dfYnVnLmNnaT9pZD00MDczNjQKKwkgKi8K
KwlwdWJsaWMgdm9pZCB0ZXN0UXVhbGlmaWVkVHlwZUFubm90YXRpb25zKCkgdGhyb3dzIEV4Y2Vw
dGlvbiB7CisJCUlQYWNrYWdlRnJhZ21lbnQgcGFjazE9IHRoaXMuc291cmNlRm9sZGVyLmNyZWF0
ZVBhY2thZ2VGcmFnbWVudCgidGVzdDQwNzM2NC5idWciLCBmYWxzZSwgbnVsbCk7CisJCVN0cmlu
ZyBjb250ZW50cyA9ICAicGFja2FnZSB0ZXN0MDAwMjtcbiIgKworCQkJCSAiaW1wb3J0IGphdmEu
bGFuZy5hbm5vdGF0aW9uLlRhcmdldDtcbiIgKworCQkJCSAicHVibGljIGNsYXNzIFgge1xuIiAr
CisJCQkJICIJcHVibGljIHN0YXRpYyB2b2lkIG1haW4oU3RyaW5nW10gYXJncykge1xuIiArCisJ
CQkJICIJCU91dGVyIG91dGVyID0gbmV3IE91dGVyKCk7XG4iICsKKwkJCQkgIgkJT3V0ZXIuQE1h
cmtlcjEgSW5uZXIgZmlyc3QgPSBvdXRlci5uZXcgSW5uZXIoKTtcbiIgKworCQkJCSAiCQlPdXRl
ci5ATWFya2VyMiBJbm5lciBzZWNvbmQgPSBvdXRlci5uZXcgSW5uZXIoKSA7XG4iICsKKwkJCQkg
IgkJT3V0ZXIuSW5uZXIuQE1hcmtlcjEgRGVlcGVyIGRlZXBlciA9IHNlY29uZC5uZXcgRGVlcGVy
KCk7XG4iICsKKwkJCQkgIgkJT3V0ZXIuSW5uZXIuRGVlcGVyIGRlZXBlcjIgPSAgc2Vjb25kLm5l
dyBEZWVwZXIoKTtcbiIgKworCQkJCSAiCX1cbiIgKyAifVxuIiArICJjbGFzcyBPdXRlciB7XG4i
ICsKKwkJCQkgIglwdWJsaWMgY2xhc3MgSW5uZXIge1xuIiArIAorCQkJCSAiCQlwdWJsaWMgY2xh
c3MgRGVlcGVyIHtcbiIgKworCQkJCSAiCQl9XG4iICsgCisJCQkJICIJfVxuIiArIAorCQkJCSAi
fVxuIiArCisJCQkJICJAVGFyZ2V0IChqYXZhLmxhbmcuYW5ub3RhdGlvbi5FbGVtZW50VHlwZS5U
WVBFX1VTRSlcbiIgKworCQkJCSAiQGludGVyZmFjZSBNYXJrZXIge31cbiIgKworCQkJCSAiQFRh
cmdldCAoamF2YS5sYW5nLmFubm90YXRpb24uRWxlbWVudFR5cGUuVFlQRV9VU0UpXG4iICsKKwkJ
CQkgIkBpbnRlcmZhY2UgTWFya2VyMSB7fVxuIiArCisJCQkJICJAVGFyZ2V0IChqYXZhLmxhbmcu
YW5ub3RhdGlvbi5FbGVtZW50VHlwZS5UWVBFX1VTRSlcbiIgKworCQkJCSAiQGludGVyZmFjZSBN
YXJrZXIyIHt9XG4iOworCQkKKwkJU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIo
Y29udGVudHMpOwkJCQorCQlJQ29tcGlsYXRpb25Vbml0IGN1PSBwYWNrMS5jcmVhdGVDb21waWxh
dGlvblVuaXQoIlguamF2YSIsIGJ1Zi50b1N0cmluZygpLCBmYWxzZSwgbnVsbCk7CisJCUNvbXBp
bGF0aW9uVW5pdCBhc3RSb290PSBjcmVhdGVBU1QoY3UsIC8qIHJlc29sdmUgKi8gdHJ1ZSwgZmFs
c2UpOworCQlBU1RSZXdyaXRlIHJld3JpdGU9IEFTVFJld3JpdGUuY3JlYXRlKGFzdFJvb3QuZ2V0
QVNUKCkpOworCQlBU1QgYXN0PSBhc3RSb290LmdldEFTVCgpOworCQlUeXBlRGVjbGFyYXRpb24g
dHlwZURlY2xhcmF0aW9uPSBmaW5kVHlwZURlY2xhcmF0aW9uKGFzdFJvb3QsICJYIik7CisJCU1l
dGhvZERlY2xhcmF0aW9uIG1ldGhvZERlY2xhcmF0aW9uPSBmaW5kTWV0aG9kRGVjbGFyYXRpb24o
dHlwZURlY2xhcmF0aW9uLCAibWFpbiIpOworCQlMaXN0IHN0YXRlbWVudHMgPSBtZXRob2REZWNs
YXJhdGlvbi5nZXRCb2R5KCkuc3RhdGVtZW50cygpOworCQlpbnQgc0NvdW50ID0gMTsKKworCQl7
ICAgLy9yZXBsYWNlIGFuIGFubm90YXRpb24uCisJCQlWYXJpYWJsZURlY2xhcmF0aW9uU3RhdGVt
ZW50IHZhcmlhYmxlRGVjbGFyYXRpb25TdGF0ZW1lbnQgPSAoVmFyaWFibGVEZWNsYXJhdGlvblN0
YXRlbWVudCkgc3RhdGVtZW50cy5nZXQoc0NvdW50KyspOworCQkJUXVhbGlmaWVkVHlwZSBxdWFs
aWZpZWRUeXBlID0gKFF1YWxpZmllZFR5cGUpIHZhcmlhYmxlRGVjbGFyYXRpb25TdGF0ZW1lbnQu
Z2V0VHlwZSgpOworCQkJTWFya2VyQW5ub3RhdGlvbiBtYXJrZXJBbm5vdGF0aW9uPSBhc3QubmV3
TWFya2VyQW5ub3RhdGlvbigpOworCQkJbWFya2VyQW5ub3RhdGlvbi5zZXRUeXBlTmFtZShhc3Qu
bmV3U2ltcGxlTmFtZSgiTmV3TWFya2VyIikpOworCQkJcmV3cml0ZS5yZXBsYWNlKChBU1ROb2Rl
KSBxdWFsaWZpZWRUeXBlLmFubm90YXRpb25zKCkuZ2V0KDApLCBtYXJrZXJBbm5vdGF0aW9uLCBu
dWxsKTsKKwkJCQorCQkJLy8gcmVtb3ZlIGFuIGFubm90YXRpb24KKwkJCXZhcmlhYmxlRGVjbGFy
YXRpb25TdGF0ZW1lbnQgPSAoVmFyaWFibGVEZWNsYXJhdGlvblN0YXRlbWVudCkgc3RhdGVtZW50
cy5nZXQoc0NvdW50KyspOworCQkJcXVhbGlmaWVkVHlwZSA9IChRdWFsaWZpZWRUeXBlKSB2YXJp
YWJsZURlY2xhcmF0aW9uU3RhdGVtZW50LmdldFR5cGUoKTsKKwkJCXJld3JpdGUucmVtb3ZlKChB
U1ROb2RlKSBxdWFsaWZpZWRUeXBlLmFubm90YXRpb25zKCkuZ2V0KDApLCBudWxsKTsKKwkJCQor
CQkJLy8gaW5zZXJ0IGFuIGFubm90YXRpb24gYWZ0ZXIgYW4gZXhpc3RpbmcgYW5ub3RhdGlvbgor
CQkJdmFyaWFibGVEZWNsYXJhdGlvblN0YXRlbWVudCA9IChWYXJpYWJsZURlY2xhcmF0aW9uU3Rh
dGVtZW50KSBzdGF0ZW1lbnRzLmdldChzQ291bnQrKyk7CisJCQlxdWFsaWZpZWRUeXBlID0gKFF1
YWxpZmllZFR5cGUpIHZhcmlhYmxlRGVjbGFyYXRpb25TdGF0ZW1lbnQuZ2V0VHlwZSgpOworCQkJ
bWFya2VyQW5ub3RhdGlvbj0gYXN0Lm5ld01hcmtlckFubm90YXRpb24oKTsKKwkJCW1hcmtlckFu
bm90YXRpb24uc2V0VHlwZU5hbWUoYXN0Lm5ld1NpbXBsZU5hbWUoIk5ld01hcmtlciIpKTsKKwkJ
CXJld3JpdGUuZ2V0TGlzdFJld3JpdGUocXVhbGlmaWVkVHlwZSwgUXVhbGlmaWVkVHlwZS5BTk5P
VEFUSU9OU19QUk9QRVJUWSkuaW5zZXJ0TGFzdChtYXJrZXJBbm5vdGF0aW9uLCBudWxsKTsKKwkJ
CQorCQkJLyogaW5zZXJ0IGFuIGFubm90YXRpb24gaW4gYSB0eXBlIG5vdCBjb252ZXJ0ZWQgYXMg
UXVhbGlmaWVkVHlwZS4gVGhpcyB3b3VsZCBpbnZvbHZlCisJCQkgKiAgY3JlYXRpb24gb2YgYSBR
dWFsaWZpZWRUeXBlIGZyb20gZmllbGRzIG9mIHRoZSBleGlzdGluZyB0eXBlLgorCQkJICovCisJ
CQl2YXJpYWJsZURlY2xhcmF0aW9uU3RhdGVtZW50ID0gKFZhcmlhYmxlRGVjbGFyYXRpb25TdGF0
ZW1lbnQpIHN0YXRlbWVudHMuZ2V0KHNDb3VudCsrKTsKKwkJCVNpbXBsZVR5cGUgc2ltcGxlVHlw
ZSA9IChTaW1wbGVUeXBlKSB2YXJpYWJsZURlY2xhcmF0aW9uU3RhdGVtZW50LmdldFR5cGUoKTsK
KwkJCVF1YWxpZmllZE5hbWUgcXVhbGlmaWVkTmFtZSA9IChRdWFsaWZpZWROYW1lKSBzaW1wbGVU
eXBlLmdldE5hbWUoKTsKKwkJCVNpbXBsZU5hbWUgc2ltcGxlTmFtZSA9IGFzdC5uZXdTaW1wbGVO
YW1lKHF1YWxpZmllZE5hbWUuZ2V0TmFtZSgpLmdldElkZW50aWZpZXIoKSk7CisJCQlxdWFsaWZp
ZWROYW1lID0gKFF1YWxpZmllZE5hbWUpIHF1YWxpZmllZE5hbWUuZ2V0UXVhbGlmaWVyKCk7CisJ
CQlxdWFsaWZpZWROYW1lID0gYXN0Lm5ld1F1YWxpZmllZE5hbWUoYXN0Lm5ld05hbWUocXVhbGlm
aWVkTmFtZS5nZXRRdWFsaWZpZXIoKS50b1N0cmluZygpKSwgYXN0Lm5ld1NpbXBsZU5hbWUocXVh
bGlmaWVkTmFtZS5nZXROYW1lKCkudG9TdHJpbmcoKSkpOworCQkJcXVhbGlmaWVkVHlwZSA9IGFz
dC5uZXdRdWFsaWZpZWRUeXBlKGFzdC5uZXdTaW1wbGVUeXBlKHF1YWxpZmllZE5hbWUpLCBzaW1w
bGVOYW1lKTsKKwkJCQorCQkJbWFya2VyQW5ub3RhdGlvbj0gYXN0Lm5ld01hcmtlckFubm90YXRp
b24oKTsKKwkJCW1hcmtlckFubm90YXRpb24uc2V0VHlwZU5hbWUoYXN0Lm5ld1NpbXBsZU5hbWUo
Ik5ld01hcmtlciIpKTsKKwkJCXJld3JpdGUuZ2V0TGlzdFJld3JpdGUocXVhbGlmaWVkVHlwZSwg
UXVhbGlmaWVkVHlwZS5BTk5PVEFUSU9OU19QUk9QRVJUWSkuaW5zZXJ0TGFzdChtYXJrZXJBbm5v
dGF0aW9uLCBudWxsKTsKKwkJCXJld3JpdGUucmVwbGFjZSh2YXJpYWJsZURlY2xhcmF0aW9uU3Rh
dGVtZW50LmdldFR5cGUoKSwgcXVhbGlmaWVkVHlwZSwgbnVsbCk7CisJCX0KKwkJU3RyaW5nIHBy
ZXZpZXc9IGV2YWx1YXRlUmV3cml0ZShjdSwgcmV3cml0ZSk7CisJCVN0cmluZyBjb250ZW50c21v
ZGlmaWVkID0gInBhY2thZ2UgdGVzdDAwMDI7XG4iICsKKwkJCQkgImltcG9ydCBqYXZhLmxhbmcu
YW5ub3RhdGlvbi5UYXJnZXQ7XG4iICsKKwkJCQkgInB1YmxpYyBjbGFzcyBYIHtcbiIgKworCQkJ
CSAiCXB1YmxpYyBzdGF0aWMgdm9pZCBtYWluKFN0cmluZ1tdIGFyZ3MpIHtcbiIgKworCQkJCSAi
CQlPdXRlciBvdXRlciA9IG5ldyBPdXRlcigpO1xuIiArCisJCQkJICIJCU91dGVyLkBOZXdNYXJr
ZXIgSW5uZXIgZmlyc3QgPSBvdXRlci5uZXcgSW5uZXIoKTtcbiIgKworCQkJCSAiCQlPdXRlci5J
bm5lciBzZWNvbmQgPSBvdXRlci5uZXcgSW5uZXIoKSA7XG4iICsKKwkJCQkgIgkJT3V0ZXIuSW5u
ZXIuQE1hcmtlcjEgQE5ld01hcmtlciBEZWVwZXIgZGVlcGVyID0gc2Vjb25kLm5ldyBEZWVwZXIo
KTtcbiIgKworCQkJCSAiCQlPdXRlci4gSW5uZXIuQE5ld01hcmtlciBEZWVwZXIgZGVlcGVyMiA9
ICBzZWNvbmQubmV3IERlZXBlcigpO1xuIiArCisJCQkJICIJfVxuIiArICJ9XG4iICsgImNsYXNz
IE91dGVyIHtcbiIgKworCQkJCSAiCXB1YmxpYyBjbGFzcyBJbm5lciB7XG4iICsgCisJCQkJICIJ
CXB1YmxpYyBjbGFzcyBEZWVwZXIge1xuIiArCisJCQkJICIJCX1cbiIgKyAKKwkJCQkgIgl9XG4i
ICsgCisJCQkJICJ9XG4iICsKKwkJCQkgIkBUYXJnZXQgKGphdmEubGFuZy5hbm5vdGF0aW9uLkVs
ZW1lbnRUeXBlLlRZUEVfVVNFKVxuIiArCisJCQkJICJAaW50ZXJmYWNlIE1hcmtlciB7fVxuIiAr
CisJCQkJICJAVGFyZ2V0IChqYXZhLmxhbmcuYW5ub3RhdGlvbi5FbGVtZW50VHlwZS5UWVBFX1VT
RSlcbiIgKworCQkJCSAiQGludGVyZmFjZSBNYXJrZXIxIHt9XG4iICsKKwkJCQkgIkBUYXJnZXQg
KGphdmEubGFuZy5hbm5vdGF0aW9uLkVsZW1lbnRUeXBlLlRZUEVfVVNFKVxuIiArCisJCQkJICJA
aW50ZXJmYWNlIE1hcmtlcjIge31cbiI7CisJCWFzc2VydEVxdWFsU3RyaW5nKHByZXZpZXcsIGNv
bnRlbnRzbW9kaWZpZWQpOworCX0KIH0KXCBObyBuZXdsaW5lIGF0IGVuZCBvZiBmaWxlCmRpZmYg
LS1naXQgYS9vcmcuZWNsaXBzZS5qZHQuY29yZS9kb20vb3JnL2VjbGlwc2UvamR0L2ludGVybmFs
L2NvcmUvZG9tL3Jld3JpdGUvQVNUUmV3cml0ZUFuYWx5emVyLmphdmEgYi9vcmcuZWNsaXBzZS5q
ZHQuY29yZS9kb20vb3JnL2VjbGlwc2UvamR0L2ludGVybmFsL2NvcmUvZG9tL3Jld3JpdGUvQVNU
UmV3cml0ZUFuYWx5emVyLmphdmEKaW5kZXggZmRkNDMwZC4uZmIyYzdiOCAxMDA2NDQKLS0tIGEv
b3JnLmVjbGlwc2UuamR0LmNvcmUvZG9tL29yZy9lY2xpcHNlL2pkdC9pbnRlcm5hbC9jb3JlL2Rv
bS9yZXdyaXRlL0FTVFJld3JpdGVBbmFseXplci5qYXZhCisrKyBiL29yZy5lY2xpcHNlLmpkdC5j
b3JlL2RvbS9vcmcvZWNsaXBzZS9qZHQvaW50ZXJuYWwvY29yZS9kb20vcmV3cml0ZS9BU1RSZXdy
aXRlQW5hbHl6ZXIuamF2YQpAQCAtMzk3OCw5ICszOTc4LDE0IEBACiAJCWlmICghaGFzQ2hpbGRy
ZW5DaGFuZ2VzKG5vZGUpKSB7CiAJCQlyZXR1cm4gZG9WaXNpdFVuY2hhbmdlZENoaWxkcmVuKG5v
ZGUpOwogCQl9Ci0JCXJld3JpdGVSZXF1aXJlZE5vZGUobm9kZSwgUGFja2FnZVF1YWxpZmllZFR5
cGUuUVVBTElGSUVSX1BST1BFUlRZKTsKKwkJaW50IHBvcyA9IHJld3JpdGVSZXF1aXJlZE5vZGUo
bm9kZSwgUGFja2FnZVF1YWxpZmllZFR5cGUuUVVBTElGSUVSX1BST1BFUlRZKTsKKwkJdHJ5IHsK
KwkJCXBvcyA9IGdldFNjYW5uZXIoKS5nZXRUb2tlbkVuZE9mZnNldChUZXJtaW5hbFRva2Vucy5U
b2tlbk5hbWVET1QsIHBvcyk7CisJCX0gY2F0Y2ggKENvcmVFeGNlcHRpb24gZSkgeworCQkJaGFu
ZGxlRXhjZXB0aW9uKGUpOworCQl9CiAJCWlmIChub2RlLmdldEFTVCgpLmFwaUxldmVsKCkgPj0g
QVNULkpMUzgpIHsKLQkJCXJld3JpdGVUeXBlQW5ub3RhdGlvbnMobm9kZSwgUGFja2FnZVF1YWxp
ZmllZFR5cGUuQU5OT1RBVElPTlNfUFJPUEVSVFksIG5vZGUuZ2V0U3RhcnRQb3NpdGlvbigpKTsK
KwkJCXJld3JpdGVUeXBlQW5ub3RhdGlvbnMobm9kZSwgUGFja2FnZVF1YWxpZmllZFR5cGUuQU5O
T1RBVElPTlNfUFJPUEVSVFksIHBvcyk7CiAJCX0KIAkJcmV3cml0ZVJlcXVpcmVkTm9kZShub2Rl
LCBQYWNrYWdlUXVhbGlmaWVkVHlwZS5OQU1FX1BST1BFUlRZKTsKIAkJcmV0dXJuIGZhbHNlOwpA
QCAtNDAxMyw5ICs0MDE4LDE0IEBACiAJCWlmICghaGFzQ2hpbGRyZW5DaGFuZ2VzKG5vZGUpKSB7
CiAJCQlyZXR1cm4gZG9WaXNpdFVuY2hhbmdlZENoaWxkcmVuKG5vZGUpOwogCQl9Ci0JCXJld3Jp
dGVSZXF1aXJlZE5vZGUobm9kZSwgUXVhbGlmaWVkVHlwZS5RVUFMSUZJRVJfUFJPUEVSVFkpOwor
CQlpbnQgcG9zID0gcmV3cml0ZVJlcXVpcmVkTm9kZShub2RlLCBRdWFsaWZpZWRUeXBlLlFVQUxJ
RklFUl9QUk9QRVJUWSk7CisJCXRyeSB7CisJCQlwb3MgPSBnZXRTY2FubmVyKCkuZ2V0VG9rZW5F
bmRPZmZzZXQoVGVybWluYWxUb2tlbnMuVG9rZW5OYW1lRE9ULCBwb3MpOworCQl9IGNhdGNoIChD
b3JlRXhjZXB0aW9uIGUpIHsKKwkJCWhhbmRsZUV4Y2VwdGlvbihlKTsKKwkJfQogCQlpZiAobm9k
ZS5nZXRBU1QoKS5hcGlMZXZlbCgpID49IEFTVC5KTFM4KSB7Ci0JCQlyZXdyaXRlVHlwZUFubm90
YXRpb25zKG5vZGUsIFF1YWxpZmllZFR5cGUuQU5OT1RBVElPTlNfUFJPUEVSVFksIG5vZGUuZ2V0
U3RhcnRQb3NpdGlvbigpKTsKKwkJCXJld3JpdGVUeXBlQW5ub3RhdGlvbnMobm9kZSwgUXVhbGlm
aWVkVHlwZS5BTk5PVEFUSU9OU19QUk9QRVJUWSwgcG9zKTsKIAkJfQogCQlyZXdyaXRlUmVxdWly
ZWROb2RlKG5vZGUsIFF1YWxpZmllZFR5cGUuTkFNRV9QUk9QRVJUWSk7CiAJCXJldHVybiBmYWxz
ZTs=
</data>

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>231344</attachid>
            <date>2013-05-23 02:51:00 -0400</date>
            <delta_ts>2013-05-23 02:51:18 -0400</delta_ts>
            <desc>Proposed Patch</desc>
            <filename>Fix-for-Bug-407364-18dom-ast-Incorrect-ASTRewrite-fo.patch</filename>
            <type>text/plain</type>
            <size>8040</size>
            <attacher name="Manoj Palat Away Until May 11 2015">manpalat</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3NyYy9vcmcvZWNs
aXBzZS9qZHQvY29yZS90ZXN0cy9yZXdyaXRlL2Rlc2NyaWJpbmcvQVNUUmV3cml0aW5nVHlwZUFu
bm90YXRpb25zVGVzdC5qYXZhIGIvb3JnLmVjbGlwc2UuamR0LmNvcmUudGVzdHMubW9kZWwvc3Jj
L29yZy9lY2xpcHNlL2pkdC9jb3JlL3Rlc3RzL3Jld3JpdGUvZGVzY3JpYmluZy9BU1RSZXdyaXRp
bmdUeXBlQW5ub3RhdGlvbnNUZXN0LmphdmEKaW5kZXggNTZkNzg4Ni4uY2VhOWQ1OSAxMDA2NDQK
LS0tIGEvb3JnLmVjbGlwc2UuamR0LmNvcmUudGVzdHMubW9kZWwvc3JjL29yZy9lY2xpcHNlL2pk
dC9jb3JlL3Rlc3RzL3Jld3JpdGUvZGVzY3JpYmluZy9BU1RSZXdyaXRpbmdUeXBlQW5ub3RhdGlv
bnNUZXN0LmphdmEKKysrIGIvb3JnLmVjbGlwc2UuamR0LmNvcmUudGVzdHMubW9kZWwvc3JjL29y
Zy9lY2xpcHNlL2pkdC9jb3JlL3Rlc3RzL3Jld3JpdGUvZGVzY3JpYmluZy9BU1RSZXdyaXRpbmdU
eXBlQW5ub3RhdGlvbnNUZXN0LmphdmEKQEAgLTk0Nyw3ICs5NDcsNyBAQAogCQkJCSIgCSogQHBh
cmFtIGFyZyAgXG4iICsKIAkJCQkiIAkqL1xuIiArCiAJCQkJIgl0ZXN0NDA2NDY5LmJ1Zy5ATWFy
a2VyIElPRXhjZXB0aW9uIGZvbyhcbiIgKwotCQkJCSIJCQlGaWxlTm90Rm91bmRFeGNlcHRpb24g
YXJnKVxuIiArCisJCQkJIgkJCXRlc3Q0MDY0NjkuYnVnLkZpbGVOb3RGb3VuZEV4Y2VwdGlvbiBh
cmcpXG4iICsKIAkJCQkiCQl0aHJvd3MgdGVzdDQwNjQ2OS5idWcuQE5vbk51bGwgQE1hcmtlciBF
T0ZFeGNlcHRpb24ge1xuIiArCiAJCQkJIgkJdHJ5IHtcbiIgKwogCQkJCSIJCQl0ZXN0NDA2NDY5
LmJ1Zy5ATm9uTnVsbCBJT0Vycm9yIGUgPSBuZXcgdGVzdDQwNjQ2OS5idWcuQE1hcmtlciBJT0Vy
cm9yKCk7XG4iICsKQEAgLTk3Miw0ICs5NzIsMTAzIEBACiAJCWFzc2VydEVxdWFsU3RyaW5nKHBy
ZXZpZXcsIGNvbnRlbnRzbW9kaWZpZWQpOwogCX0KIAorCS8qKgorCSAqIEFTVFJld3JpdGVyVGVz
dHMgZm9yIFF1YWxpZmllZFR5cGUKKwkgKiBAdGhyb3dzIEV4Y2VwdGlvbgorCSAqIAorCSAqIGh0
dHBzOi8vYnVncy5lY2xpcHNlLm9yZy9idWdzL3Nob3dfYnVnLmNnaT9pZD00MDczNjQKKwkgKi8K
KwlwdWJsaWMgdm9pZCB0ZXN0UXVhbGlmaWVkVHlwZUFubm90YXRpb25zKCkgdGhyb3dzIEV4Y2Vw
dGlvbiB7CisJCUlQYWNrYWdlRnJhZ21lbnQgcGFjazE9IHRoaXMuc291cmNlRm9sZGVyLmNyZWF0
ZVBhY2thZ2VGcmFnbWVudCgidGVzdDQwNzM2NC5idWciLCBmYWxzZSwgbnVsbCk7CisJCVN0cmlu
ZyBjb250ZW50cyA9ICAicGFja2FnZSB0ZXN0MDAwMjtcbiIgKworCQkJCSAiaW1wb3J0IGphdmEu
bGFuZy5hbm5vdGF0aW9uLlRhcmdldDtcbiIgKworCQkJCSAicHVibGljIGNsYXNzIFgge1xuIiAr
CisJCQkJICIJcHVibGljIHN0YXRpYyB2b2lkIG1haW4oU3RyaW5nW10gYXJncykge1xuIiArCisJ
CQkJICIJCU91dGVyIG91dGVyID0gbmV3IE91dGVyKCk7XG4iICsKKwkJCQkgIgkJT3V0ZXIuQE1h
cmtlcjEgSW5uZXIgZmlyc3QgPSBvdXRlci5uZXcgSW5uZXIoKTtcbiIgKworCQkJCSAiCQlPdXRl
ci5ATWFya2VyMiBJbm5lciBzZWNvbmQgPSBvdXRlci5uZXcgSW5uZXIoKSA7XG4iICsKKwkJCQkg
IgkJT3V0ZXIuSW5uZXIuQE1hcmtlcjEgRGVlcGVyIGRlZXBlciA9IHNlY29uZC5uZXcgRGVlcGVy
KCk7XG4iICsKKwkJCQkgIgkJT3V0ZXIuSW5uZXIuRGVlcGVyIGRlZXBlcjIgPSAgc2Vjb25kLm5l
dyBEZWVwZXIoKTtcbiIgKworCQkJCSAiCX1cbiIgKyAifVxuIiArICJjbGFzcyBPdXRlciB7XG4i
ICsKKwkJCQkgIglwdWJsaWMgY2xhc3MgSW5uZXIge1xuIiArIAorCQkJCSAiCQlwdWJsaWMgY2xh
c3MgRGVlcGVyIHtcbiIgKworCQkJCSAiCQl9XG4iICsgCisJCQkJICIJfVxuIiArIAorCQkJCSAi
fVxuIiArCisJCQkJICJAVGFyZ2V0IChqYXZhLmxhbmcuYW5ub3RhdGlvbi5FbGVtZW50VHlwZS5U
WVBFX1VTRSlcbiIgKworCQkJCSAiQGludGVyZmFjZSBNYXJrZXIge31cbiIgKworCQkJCSAiQFRh
cmdldCAoamF2YS5sYW5nLmFubm90YXRpb24uRWxlbWVudFR5cGUuVFlQRV9VU0UpXG4iICsKKwkJ
CQkgIkBpbnRlcmZhY2UgTWFya2VyMSB7fVxuIiArCisJCQkJICJAVGFyZ2V0IChqYXZhLmxhbmcu
YW5ub3RhdGlvbi5FbGVtZW50VHlwZS5UWVBFX1VTRSlcbiIgKworCQkJCSAiQGludGVyZmFjZSBN
YXJrZXIyIHt9XG4iOworCQkKKwkJU3RyaW5nQnVmZmVyIGJ1ZiA9IG5ldyBTdHJpbmdCdWZmZXIo
Y29udGVudHMpOwkJCQorCQlJQ29tcGlsYXRpb25Vbml0IGN1PSBwYWNrMS5jcmVhdGVDb21waWxh
dGlvblVuaXQoIlguamF2YSIsIGJ1Zi50b1N0cmluZygpLCBmYWxzZSwgbnVsbCk7CisJCUNvbXBp
bGF0aW9uVW5pdCBhc3RSb290PSBjcmVhdGVBU1QoY3UsIC8qIHJlc29sdmUgKi8gdHJ1ZSwgZmFs
c2UpOworCQlBU1RSZXdyaXRlIHJld3JpdGU9IEFTVFJld3JpdGUuY3JlYXRlKGFzdFJvb3QuZ2V0
QVNUKCkpOworCQlBU1QgYXN0PSBhc3RSb290LmdldEFTVCgpOworCQlUeXBlRGVjbGFyYXRpb24g
dHlwZURlY2xhcmF0aW9uPSBmaW5kVHlwZURlY2xhcmF0aW9uKGFzdFJvb3QsICJYIik7CisJCU1l
dGhvZERlY2xhcmF0aW9uIG1ldGhvZERlY2xhcmF0aW9uPSBmaW5kTWV0aG9kRGVjbGFyYXRpb24o
dHlwZURlY2xhcmF0aW9uLCAibWFpbiIpOworCQlMaXN0IHN0YXRlbWVudHMgPSBtZXRob2REZWNs
YXJhdGlvbi5nZXRCb2R5KCkuc3RhdGVtZW50cygpOworCQlpbnQgc0NvdW50ID0gMTsKKworCQl7
ICAgLy9yZXBsYWNlIGFuIGFubm90YXRpb24uCisJCQlWYXJpYWJsZURlY2xhcmF0aW9uU3RhdGVt
ZW50IHZhcmlhYmxlRGVjbGFyYXRpb25TdGF0ZW1lbnQgPSAoVmFyaWFibGVEZWNsYXJhdGlvblN0
YXRlbWVudCkgc3RhdGVtZW50cy5nZXQoc0NvdW50KyspOworCQkJUXVhbGlmaWVkVHlwZSBxdWFs
aWZpZWRUeXBlID0gKFF1YWxpZmllZFR5cGUpIHZhcmlhYmxlRGVjbGFyYXRpb25TdGF0ZW1lbnQu
Z2V0VHlwZSgpOworCQkJTWFya2VyQW5ub3RhdGlvbiBtYXJrZXJBbm5vdGF0aW9uPSBhc3QubmV3
TWFya2VyQW5ub3RhdGlvbigpOworCQkJbWFya2VyQW5ub3RhdGlvbi5zZXRUeXBlTmFtZShhc3Qu
bmV3U2ltcGxlTmFtZSgiTmV3TWFya2VyIikpOworCQkJcmV3cml0ZS5yZXBsYWNlKChBU1ROb2Rl
KSBxdWFsaWZpZWRUeXBlLmFubm90YXRpb25zKCkuZ2V0KDApLCBtYXJrZXJBbm5vdGF0aW9uLCBu
dWxsKTsKKwkJCQorCQkJLy8gcmVtb3ZlIGFuIGFubm90YXRpb24KKwkJCXZhcmlhYmxlRGVjbGFy
YXRpb25TdGF0ZW1lbnQgPSAoVmFyaWFibGVEZWNsYXJhdGlvblN0YXRlbWVudCkgc3RhdGVtZW50
cy5nZXQoc0NvdW50KyspOworCQkJcXVhbGlmaWVkVHlwZSA9IChRdWFsaWZpZWRUeXBlKSB2YXJp
YWJsZURlY2xhcmF0aW9uU3RhdGVtZW50LmdldFR5cGUoKTsKKwkJCXJld3JpdGUucmVtb3ZlKChB
U1ROb2RlKSBxdWFsaWZpZWRUeXBlLmFubm90YXRpb25zKCkuZ2V0KDApLCBudWxsKTsKKwkJCQor
CQkJLy8gaW5zZXJ0IGFuIGFubm90YXRpb24gYWZ0ZXIgYW4gZXhpc3RpbmcgYW5ub3RhdGlvbgor
CQkJdmFyaWFibGVEZWNsYXJhdGlvblN0YXRlbWVudCA9IChWYXJpYWJsZURlY2xhcmF0aW9uU3Rh
dGVtZW50KSBzdGF0ZW1lbnRzLmdldChzQ291bnQrKyk7CisJCQlxdWFsaWZpZWRUeXBlID0gKFF1
YWxpZmllZFR5cGUpIHZhcmlhYmxlRGVjbGFyYXRpb25TdGF0ZW1lbnQuZ2V0VHlwZSgpOworCQkJ
bWFya2VyQW5ub3RhdGlvbj0gYXN0Lm5ld01hcmtlckFubm90YXRpb24oKTsKKwkJCW1hcmtlckFu
bm90YXRpb24uc2V0VHlwZU5hbWUoYXN0Lm5ld1NpbXBsZU5hbWUoIk5ld01hcmtlciIpKTsKKwkJ
CXJld3JpdGUuZ2V0TGlzdFJld3JpdGUocXVhbGlmaWVkVHlwZSwgUXVhbGlmaWVkVHlwZS5BTk5P
VEFUSU9OU19QUk9QRVJUWSkuaW5zZXJ0TGFzdChtYXJrZXJBbm5vdGF0aW9uLCBudWxsKTsKKwkJ
CQorCQkJLyogaW5zZXJ0IGFuIGFubm90YXRpb24gaW4gYSB0eXBlIG5vdCBjb252ZXJ0ZWQgYXMg
UXVhbGlmaWVkVHlwZS4gVGhpcyB3b3VsZCBpbnZvbHZlCisJCQkgKiAgY3JlYXRpb24gb2YgYSBR
dWFsaWZpZWRUeXBlIGZyb20gZmllbGRzIG9mIHRoZSBleGlzdGluZyB0eXBlLgorCQkJICovCisJ
CQl2YXJpYWJsZURlY2xhcmF0aW9uU3RhdGVtZW50ID0gKFZhcmlhYmxlRGVjbGFyYXRpb25TdGF0
ZW1lbnQpIHN0YXRlbWVudHMuZ2V0KHNDb3VudCsrKTsKKwkJCVNpbXBsZVR5cGUgc2ltcGxlVHlw
ZSA9IChTaW1wbGVUeXBlKSB2YXJpYWJsZURlY2xhcmF0aW9uU3RhdGVtZW50LmdldFR5cGUoKTsK
KwkJCVF1YWxpZmllZE5hbWUgcXVhbGlmaWVkTmFtZSA9IChRdWFsaWZpZWROYW1lKSBzaW1wbGVU
eXBlLmdldE5hbWUoKTsKKwkJCVNpbXBsZU5hbWUgc2ltcGxlTmFtZSA9IGFzdC5uZXdTaW1wbGVO
YW1lKHF1YWxpZmllZE5hbWUuZ2V0TmFtZSgpLmdldElkZW50aWZpZXIoKSk7CisJCQlxdWFsaWZp
ZWROYW1lID0gKFF1YWxpZmllZE5hbWUpIHF1YWxpZmllZE5hbWUuZ2V0UXVhbGlmaWVyKCk7CisJ
CQlxdWFsaWZpZWROYW1lID0gYXN0Lm5ld1F1YWxpZmllZE5hbWUoYXN0Lm5ld05hbWUocXVhbGlm
aWVkTmFtZS5nZXRRdWFsaWZpZXIoKS50b1N0cmluZygpKSwgYXN0Lm5ld1NpbXBsZU5hbWUocXVh
bGlmaWVkTmFtZS5nZXROYW1lKCkudG9TdHJpbmcoKSkpOworCQkJcXVhbGlmaWVkVHlwZSA9IGFz
dC5uZXdRdWFsaWZpZWRUeXBlKGFzdC5uZXdTaW1wbGVUeXBlKHF1YWxpZmllZE5hbWUpLCBzaW1w
bGVOYW1lKTsKKwkJCQorCQkJbWFya2VyQW5ub3RhdGlvbj0gYXN0Lm5ld01hcmtlckFubm90YXRp
b24oKTsKKwkJCW1hcmtlckFubm90YXRpb24uc2V0VHlwZU5hbWUoYXN0Lm5ld1NpbXBsZU5hbWUo
Ik5ld01hcmtlciIpKTsKKwkJCXJld3JpdGUuZ2V0TGlzdFJld3JpdGUocXVhbGlmaWVkVHlwZSwg
UXVhbGlmaWVkVHlwZS5BTk5PVEFUSU9OU19QUk9QRVJUWSkuaW5zZXJ0TGFzdChtYXJrZXJBbm5v
dGF0aW9uLCBudWxsKTsKKwkJCXJld3JpdGUucmVwbGFjZSh2YXJpYWJsZURlY2xhcmF0aW9uU3Rh
dGVtZW50LmdldFR5cGUoKSwgcXVhbGlmaWVkVHlwZSwgbnVsbCk7CisJCX0KKwkJU3RyaW5nIHBy
ZXZpZXc9IGV2YWx1YXRlUmV3cml0ZShjdSwgcmV3cml0ZSk7CisJCVN0cmluZyBjb250ZW50c21v
ZGlmaWVkID0gInBhY2thZ2UgdGVzdDAwMDI7XG4iICsKKwkJCQkgImltcG9ydCBqYXZhLmxhbmcu
YW5ub3RhdGlvbi5UYXJnZXQ7XG4iICsKKwkJCQkgInB1YmxpYyBjbGFzcyBYIHtcbiIgKworCQkJ
CSAiCXB1YmxpYyBzdGF0aWMgdm9pZCBtYWluKFN0cmluZ1tdIGFyZ3MpIHtcbiIgKworCQkJCSAi
CQlPdXRlciBvdXRlciA9IG5ldyBPdXRlcigpO1xuIiArCisJCQkJICIJCU91dGVyLkBOZXdNYXJr
ZXIgSW5uZXIgZmlyc3QgPSBvdXRlci5uZXcgSW5uZXIoKTtcbiIgKworCQkJCSAiCQlPdXRlci5J
bm5lciBzZWNvbmQgPSBvdXRlci5uZXcgSW5uZXIoKSA7XG4iICsKKwkJCQkgIgkJT3V0ZXIuSW5u
ZXIuQE1hcmtlcjEgQE5ld01hcmtlciBEZWVwZXIgZGVlcGVyID0gc2Vjb25kLm5ldyBEZWVwZXIo
KTtcbiIgKworCQkJCSAiCQlPdXRlci4gSW5uZXIuQE5ld01hcmtlciBEZWVwZXIgZGVlcGVyMiA9
ICBzZWNvbmQubmV3IERlZXBlcigpO1xuIiArCisJCQkJICIJfVxuIiArICJ9XG4iICsgImNsYXNz
IE91dGVyIHtcbiIgKworCQkJCSAiCXB1YmxpYyBjbGFzcyBJbm5lciB7XG4iICsgCisJCQkJICIJ
CXB1YmxpYyBjbGFzcyBEZWVwZXIge1xuIiArCisJCQkJICIJCX1cbiIgKyAKKwkJCQkgIgl9XG4i
ICsgCisJCQkJICJ9XG4iICsKKwkJCQkgIkBUYXJnZXQgKGphdmEubGFuZy5hbm5vdGF0aW9uLkVs
ZW1lbnRUeXBlLlRZUEVfVVNFKVxuIiArCisJCQkJICJAaW50ZXJmYWNlIE1hcmtlciB7fVxuIiAr
CisJCQkJICJAVGFyZ2V0IChqYXZhLmxhbmcuYW5ub3RhdGlvbi5FbGVtZW50VHlwZS5UWVBFX1VT
RSlcbiIgKworCQkJCSAiQGludGVyZmFjZSBNYXJrZXIxIHt9XG4iICsKKwkJCQkgIkBUYXJnZXQg
KGphdmEubGFuZy5hbm5vdGF0aW9uLkVsZW1lbnRUeXBlLlRZUEVfVVNFKVxuIiArCisJCQkJICJA
aW50ZXJmYWNlIE1hcmtlcjIge31cbiI7CisJCWFzc2VydEVxdWFsU3RyaW5nKHByZXZpZXcsIGNv
bnRlbnRzbW9kaWZpZWQpOworCX0KIH0KXCBObyBuZXdsaW5lIGF0IGVuZCBvZiBmaWxlCmRpZmYg
LS1naXQgYS9vcmcuZWNsaXBzZS5qZHQuY29yZS9kb20vb3JnL2VjbGlwc2UvamR0L2ludGVybmFs
L2NvcmUvZG9tL3Jld3JpdGUvQVNUUmV3cml0ZUFuYWx5emVyLmphdmEgYi9vcmcuZWNsaXBzZS5q
ZHQuY29yZS9kb20vb3JnL2VjbGlwc2UvamR0L2ludGVybmFsL2NvcmUvZG9tL3Jld3JpdGUvQVNU
UmV3cml0ZUFuYWx5emVyLmphdmEKaW5kZXggZGM1NDU0Ni4uZmQzYjFiMyAxMDA2NDQKLS0tIGEv
b3JnLmVjbGlwc2UuamR0LmNvcmUvZG9tL29yZy9lY2xpcHNlL2pkdC9pbnRlcm5hbC9jb3JlL2Rv
bS9yZXdyaXRlL0FTVFJld3JpdGVBbmFseXplci5qYXZhCisrKyBiL29yZy5lY2xpcHNlLmpkdC5j
b3JlL2RvbS9vcmcvZWNsaXBzZS9qZHQvaW50ZXJuYWwvY29yZS9kb20vcmV3cml0ZS9BU1RSZXdy
aXRlQW5hbHl6ZXIuamF2YQpAQCAtMzk1Nyw5ICszOTU3LDEyIEBACiAJCWlmICghaGFzQ2hpbGRy
ZW5DaGFuZ2VzKG5vZGUpKSB7CiAJCQlyZXR1cm4gZG9WaXNpdFVuY2hhbmdlZENoaWxkcmVuKG5v
ZGUpOwogCQl9Ci0JCXJld3JpdGVSZXF1aXJlZE5vZGUobm9kZSwgUGFja2FnZVF1YWxpZmllZFR5
cGUuUVVBTElGSUVSX1BST1BFUlRZKTsKLQkJaWYgKG5vZGUuZ2V0QVNUKCkuYXBpTGV2ZWwoKSA+
PSBBU1QuSkxTOCkgewotCQkJcmV3cml0ZVR5cGVBbm5vdGF0aW9ucyhub2RlLCBQYWNrYWdlUXVh
bGlmaWVkVHlwZS5BTk5PVEFUSU9OU19QUk9QRVJUWSwgbm9kZS5nZXRTdGFydFBvc2l0aW9uKCkp
OworCQlpbnQgcG9zID0gcmV3cml0ZVJlcXVpcmVkTm9kZShub2RlLCBQYWNrYWdlUXVhbGlmaWVk
VHlwZS5RVUFMSUZJRVJfUFJPUEVSVFkpOworCQl0cnkgeworCQkJcG9zID0gZ2V0U2Nhbm5lcigp
LmdldFRva2VuRW5kT2Zmc2V0KFRlcm1pbmFsVG9rZW5zLlRva2VuTmFtZURPVCwgcG9zKTsKKwkJ
CXJld3JpdGVUeXBlQW5ub3RhdGlvbnMobm9kZSwgUGFja2FnZVF1YWxpZmllZFR5cGUuQU5OT1RB
VElPTlNfUFJPUEVSVFksIHBvcyk7CisJCX0gY2F0Y2ggKENvcmVFeGNlcHRpb24gZSkgeworCQkJ
aGFuZGxlRXhjZXB0aW9uKGUpOwogCQl9CiAJCXJld3JpdGVSZXF1aXJlZE5vZGUobm9kZSwgUGFj
a2FnZVF1YWxpZmllZFR5cGUuTkFNRV9QUk9QRVJUWSk7CiAJCXJldHVybiBmYWxzZTsKQEAgLTM5
OTIsOSArMzk5NSwxNCBAQAogCQlpZiAoIWhhc0NoaWxkcmVuQ2hhbmdlcyhub2RlKSkgewogCQkJ
cmV0dXJuIGRvVmlzaXRVbmNoYW5nZWRDaGlsZHJlbihub2RlKTsKIAkJfQotCQlyZXdyaXRlUmVx
dWlyZWROb2RlKG5vZGUsIFF1YWxpZmllZFR5cGUuUVVBTElGSUVSX1BST1BFUlRZKTsKKwkJaW50
IHBvcyA9IHJld3JpdGVSZXF1aXJlZE5vZGUobm9kZSwgUXVhbGlmaWVkVHlwZS5RVUFMSUZJRVJf
UFJPUEVSVFkpOwogCQlpZiAobm9kZS5nZXRBU1QoKS5hcGlMZXZlbCgpID49IEFTVC5KTFM4KSB7
Ci0JCQlyZXdyaXRlVHlwZUFubm90YXRpb25zKG5vZGUsIFF1YWxpZmllZFR5cGUuQU5OT1RBVElP
TlNfUFJPUEVSVFksIG5vZGUuZ2V0U3RhcnRQb3NpdGlvbigpKTsKKwkJCXRyeSB7CisJCQkJcG9z
ID0gZ2V0U2Nhbm5lcigpLmdldFRva2VuRW5kT2Zmc2V0KFRlcm1pbmFsVG9rZW5zLlRva2VuTmFt
ZURPVCwgcG9zKTsKKwkJCQlyZXdyaXRlVHlwZUFubm90YXRpb25zKG5vZGUsIFF1YWxpZmllZFR5
cGUuQU5OT1RBVElPTlNfUFJPUEVSVFksIHBvcyk7CisJCQl9IGNhdGNoIChDb3JlRXhjZXB0aW9u
IGUpIHsKKwkJCQloYW5kbGVFeGNlcHRpb24oZSk7CisJCQl9CiAJCX0KIAkJcmV3cml0ZVJlcXVp
cmVkTm9kZShub2RlLCBRdWFsaWZpZWRUeXBlLk5BTUVfUFJPUEVSVFkpOwogCQlyZXR1cm4gZmFs
c2U7
</data>

          </attachment>
      

    </bug>

</bugzilla>