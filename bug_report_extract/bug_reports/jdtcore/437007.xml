<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>437007</bug_id>
          
          <creation_ts>2014-06-09 20:49:00 -0400</creation_ts>
          <short_desc>[1.8][inference] Inferencing failing to work out type in vararg method invocation</short_desc>
          <delta_ts>2014-08-28 03:31:29 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>4.4</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Mac OS X</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>4.4.1</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Andrew Clement">aclement</reporter>
          <assigned_to name="Stephan Herrmann">stephan.herrmann</assigned_to>
          <cc>jarthana</cc>
    
    <cc>stephan.herrmann</cc>
          
          <votes>0</votes>

      

      

      <flag name="review"
          id="63114"
          type_id="1"
          status="+"
          setter="jarthana"
    />

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2414949</commentid>
    <comment_count>0</comment_count>
    <who name="Andrew Clement">aclement</who>
    <bug_when>2014-06-09 20:49:28 -0400</bug_when>
    <thetext>The following code compiles with javac:

import java.util.*;

public class ExecutorTests {
    List&lt;Runnable&gt; tasks = Arrays.asList(
            () -&gt; {
                System.out.println(&quot;task1 start&quot;);
            }
    );

    public void executeInSync(){
        tasks.stream().forEach(Runnable::run);
    }
}


but not with ECJ:

The method asList(T...) in the type Arrays is not applicable for the arguments (() -&gt; {})	ExecutorTests.java	line 4	Java Problem
The target type of this expression must be a functional interface	ExecutorTests.java	line 5	Java Problem


It can be made to compile by changing it to &quot;Arrays.&lt;Runnable&gt;asList(...&quot;

This was reported in http://stackoverflow.com/questions/24122672/ajc-wont-compile-lambda-as-an-vararg-argument originally against AspectJ but AspectJ is based on JDT and this is failing in Luna RC3 too.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2415105</commentid>
    <comment_count>1</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2014-06-10 08:59:47 -0400</bug_when>
    <thetext>There are some delicate interactions between type inference and vararg methods, so that from the top of my head I cannot reliable say if the (existing) solution should indeed by found by type inference.

I&apos;ll take a look at this for 4.4.1.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2431775</commentid>
    <comment_count>2</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2014-07-24 14:11:38 -0400</bug_when>
    <thetext>Released for 4.5 M1 via http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=415d064959a9f683a1c0ba0bfd3f74f46911b97e

Inference failed because we got the wrong result from isPertinentToApplicability(). In this call we used the wrong target type for varargs methods. Extracting the element type from the array fixes the issue.

@Jay: I had marked this bug for 4.4.1, because it was a near miss for Luna. It&apos;s not strictly a regression, but a bug in new (1.8) functionality. I&apos;ll let you decide if you want this in SR1. The fix is small, localized and hence should be safe ...</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2434423</commentid>
    <comment_count>3</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2014-07-31 16:44:42 -0400</bug_when>
    <thetext>(In reply to Stephan Herrmann from comment #2)
&gt; @Jay: I had marked this bug for 4.4.1, because it was a near miss for Luna.
&gt; It&apos;s not strictly a regression, but a bug in new (1.8) functionality. I&apos;ll
&gt; let you decide if you want this in SR1. The fix is small, localized and
&gt; hence should be safe ...

I think this is an easy win, OK?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2435028</commentid>
    <comment_count>4</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2014-08-04 02:03:39 -0400</bug_when>
    <thetext>(In reply to Stephan Herrmann from comment #2)
&gt; Released for 4.5 M1 via
&gt; http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/
&gt; ?id=415d064959a9f683a1c0ba0bfd3f74f46911b97e

+1 for back port.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2436701</commentid>
    <comment_count>5</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2014-08-07 09:29:06 -0400</bug_when>
    <thetext>Released for 4.4.1 via http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?h=R4_4_maintenance&amp;id=f7d4d8dabde7105fd4248609c651dcea219330fe</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2444686</commentid>
    <comment_count>6</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2014-08-28 03:31:29 -0400</bug_when>
    <thetext>Verified for 4.4.1 with build M20140827-0800

and

Verified for 4.5 M2 with build I20140819-2200</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>