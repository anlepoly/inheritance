<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>406627</bug_id>
          
          <creation_ts>2013-04-26 04:20:00 -0400</creation_ts>
          <short_desc>[1.8][compiler][codegen] Annotations on lambda parameters go the way of /dev/null</short_desc>
          <delta_ts>2013-04-26 05:41:43 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>4.3</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows 7</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>BETA J8</target_milestone>
          
          <blocked>400875</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Srikanth Sankaran">srikanth_sankaran</reporter>
          <assigned_to name="Srikanth Sankaran">srikanth_sankaran</assigned_to>
          <cc>jesper</cc>
    
    <cc>markus_keller</cc>
    
    <cc>stephan.herrmann</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2248837</commentid>
    <comment_count>0</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2013-04-26 04:20:47 -0400</bug_when>
    <thetext>BETA_JAVA8:

Given the program below, annotations on lambda parameters do not
show up in the class file, despite the retention being runtime.
Interestingly JDK 8b81 also has the same problem.


// ----
import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

interface I {
	void doit (Object o, Object p);
}

public class X {
	I i = (@Annotation Object o, @Annotation Object p) -&gt; {
		
	};
	void foo(@Annotation Object o, @Annotation Object p) {
        }
}

@Target(ElementType.PARAMETER)
@Retention(RetentionPolicy.RUNTIME)
@interface Annotation {
	
}

// ---

Problem is in org.eclipse.jdt.internal.compiler.ClassFile.generateMethodInfoAttributes(MethodBinding) - there is an expectation of AMD, which needs to be reconciled.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2248851</commentid>
    <comment_count>1</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2013-04-26 04:44:45 -0400</bug_when>
    <thetext>Stephan, how useful is it to emit these into the class file ? Given lambdas
cannot be directly called and given they are anonymous from tools pov, does
it make sense to emit these at all ? 

Fix could be trivial though,</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2248862</commentid>
    <comment_count>2</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2013-04-26 05:15:48 -0400</bug_when>
    <thetext>(In reply to comment #1)

&gt; Fix could be trivial though,

Did I say that ? :)

Not only does javac not generate the annotations, javap also does not
read them even when present. Eclipse disassembler crashes with certain
input class files. On top of implementation subltleties around synthetic
parameters for captured locals ahead of real parameters ...</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2248878</commentid>
    <comment_count>3</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2013-04-26 05:41:43 -0400</bug_when>
    <thetext>Fix and tests released here: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?h=BETA_JAVA8&amp;id=64ee3f57d71ba4f4e5fa8224c04a06b8409e61e3


Raised https://bugs.eclipse.org/bugs/show_bug.cgi?id=406636 for
the disassembler problem.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>