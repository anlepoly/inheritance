<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>427962</bug_id>
          
          <creation_ts>2014-02-12 03:08:00 -0500</creation_ts>
          <short_desc>[1.8][compiler] Stream#toArray(String[]::new) not inferred without help</short_desc>
          <delta_ts>2014-02-21 06:44:04 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>4.4</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows 8</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>BETA J8</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Timo Kinnunen">timo.kinnunen</reporter>
          <assigned_to name="Srikanth Sankaran">srikanth_sankaran</assigned_to>
          <cc>jarthana</cc>
    
    <cc>srikanth_sankaran</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2361974</commentid>
    <comment_count>0</comment_count>
    <who name="Timo Kinnunen">timo.kinnunen</who>
    <bug_when>2014-02-12 03:08:13 -0500</bug_when>
    <thetext>This example compiles correctly with javac but ECJ gives 4 errors:

public class Excercise {
  static &lt;A, B&gt; Stream&lt;B&gt; objmap(Function&lt;A, B&gt; p1, A[] p2) {return Stream.of(p2).map(p1);}
  static &lt;B&gt; Stream&lt;B&gt; intmap(IntFunction&lt;B&gt; p1, int[] p2) {return IntStream.of(p2).mapToObj(p1);}

  public static void main(String[] args) {
    Integer[] p12 = {1, 2, 3};
    int[] p22 = {1, 2, 3};
    //works
    String[] a11 = objmap(String::valueOf, p12).&lt;String&gt; toArray(String[]::new);
    String[] a21 = intmap(String::valueOf, p22).&lt;String&gt; toArray(String[]::new);
    //does not work
    String[] a12 = objmap(String::valueOf, p12).toArray(String[]::new);
    String[] a22 = intmap(String::valueOf, p22).toArray(String[]::new);
  }
}

The errors I get are:
Description	Resource	Location	Path	Type
The method toArray(IntFunction&lt;A[]&gt;) in the type Stream&lt;String&gt; is not applicable for the arguments (String[]::new)	Excercise.java	line 21	/EclipseBugsLive/src/homework	Java Problem
Constructed array String[] cannot be assigned to A[] as required in the interface descriptor  	Excercise.java	line 21	/EclipseBugsLive/src/homework	Java Problem
The method toArray(IntFunction&lt;A[]&gt;) in the type Stream&lt;String&gt; is not applicable for the arguments (String[]::new)	Excercise.java	line 20	/EclipseBugsLive/src/homework	Java Problem
Constructed array String[] cannot be assigned to A[] as required in the interface descriptor  	Excercise.java	line 20	/EclipseBugsLive/src/homework	Java Problem</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2361994</commentid>
    <comment_count>1</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2014-02-12 03:45:23 -0500</bug_when>
    <thetext>Thanks, a quick look tells me that that we don&apos;t recognize the array
constructor reference as an exact method reference, which we should. 
If this is all there is to the problem (likely) fix will be simple.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2362026</commentid>
    <comment_count>2</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2014-02-12 04:28:54 -0500</bug_when>
    <thetext>(In reply to Srikanth Sankaran from comment #1)
&gt; Thanks, a quick look tells me that that we don&apos;t recognize the array
&gt; constructor reference as an exact method reference, which we should. 

Nope, we do recognize them as exact method references. Problem comes in
the fact the binding for the exact method which is necessarily synthetic
mention jlO as the declaring class. There is no String[] class to be the
declaring class and for want of a better choice, I had chosen to claim
jlO as the declaring class.

This was making the inference engine apply wrong constraints.

Fix and test released here: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?h=BETA_JAVA8&amp;id=a635e0ddaa17829d90f6d6f2096ec371117367d6</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2366682</commentid>
    <comment_count>3</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2014-02-21 06:44:04 -0500</bug_when>
    <thetext>Verified for Java 8 RC1 using Kepler SR2 +  
Eclipse Java Development Tools Patch for Java 8 Support (BETA)   
1.0.0.v20140220-2054</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>