<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>396000</bug_id>
          
          <creation_ts>2012-12-06 18:05:00 -0500</creation_ts>
          <short_desc>Annotation processing got disabled, since it requires a 1.6 compliant JVM\n</short_desc>
          <delta_ts>2013-03-12 04:52:34 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>4.2</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>4.3 M5</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ludmila Shikhvarg">ludmila.shikhvarg</reporter>
          <assigned_to name="Jay Arthanareeswaran">jarthana</assigned_to>
          <cc>jarthana</cc>
    
    <cc>manpalat</cc>
    
    <cc>Olivier_Thomann</cc>
    
    <cc>stephan.herrmann</cc>
    
    <cc>szymon.ptaszkiewicz</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2191653</commentid>
    <comment_count>0</comment_count>
    <who name="Ludmila Shikhvarg">ludmila.shikhvarg</who>
    <bug_when>2012-12-06 18:05:59 -0500</bug_when>
    <thetext>Version: 4.2.0  Build id: I20120608-1400

After the changes in JDK8 b65 to use a new version (52.0) class file format, 6 tests are started to fail in org.eclipse.jdt.core.tests.compiler.regression package:
test0308_warn_options - 1.5
test0309_warn_options - 1.5
test0308_warn_options - 1.6
test0309_warn_options - 1.6
test0308_warn_options - 1.7
test0309_warn_options - 1.7

----------- Expected ------------

------------ but was ------------
Annotation processing got disabled, since it requires a 1.6 compliant JVM\n

--------- Difference is ----------
expected:&lt;[]&gt; but was:&lt;[Annotation processing got disabled, since it requires a 1.6 compliant JVM\n
]&gt;
at org.eclipse.jdt.core.tests.junit.extension.TestCase.assertStringEquals(TestCase.java:230)
at org.eclipse.jdt.core.tests.junit.extension.TestCase.assertEquals(TestCase.java:206)
at org.eclipse.jdt.core.tests.compiler.regression.BatchCompilerTest.runTest(BatchCompilerTest.java:630)
at org.eclipse.jdt.core.tests.compiler.regression.BatchCompilerTest.runConformTest(BatchCompilerTest.java:430)
at org.eclipse.jdt.core.tests.compiler.regression.BatchCompilerTest.test0308_warn_options(BatchCompilerTest.java:12308)
at org.eclipse.jdt.core.tests.util.CompilerTestSetup.run(CompilerTestSetup.java:55)
at org.eclipse.test.EclipseTestRunner.run(EclipseTestRunner.java:501)
at org.eclipse.test.EclipseTestRunner.run(EclipseTestRunner.java:259)
at org.eclipse.test.CoreTestApplication.runTests(CoreTestApplication.java:36)
at org.eclipse.test.CoreTestApplication.run(CoreTestApplication.java:32)
at org.eclipse.equinox.internal.app.EclipseAppContainer.callMethodWithException(EclipseAppContainer.java:587)
at org.eclipse.equinox.internal.app.EclipseAppHandle.run(EclipseAppHandle.java:198)
at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:110)
at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:79)
at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:353)
at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:180)
at org.eclipse.equinox.launcher.Main.invokeFramework(Main.java:629)
at org.eclipse.equinox.launcher.Main.basicRun(Main.java:584)
at org.eclipse.equinox.launcher.Main.run(Main.java:1438)
at org.eclipse.equinox.launcher.Main.main(Main.java:1414)
at org.eclipse.core.launcher.Main.main(Main.java:34)

Reproducible: Always

Steps to Reproduce:
Use eclipse-Automated-Tests-4.2 to run automated tests with jdk8.
1. Install jdk8 b65 from http://jdk8.java.net/download.html
2. Run jdtcorecompiler tests</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2192438</commentid>
    <comment_count>1</comment_count>
    <who name="Szymon Ptaszkiewicz">szymon.ptaszkiewicz</who>
    <bug_when>2012-12-10 08:53:25 -0500</bug_when>
    <thetext>Moving to JDT/Core for comment.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2192445</commentid>
    <comment_count>2</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2012-12-10 09:03:15 -0500</bug_when>
    <thetext>Stephan, I don&apos;t have access to post b64 JDK versions. Do you see this with b65 or later?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2192778</commentid>
    <comment_count>3</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2012-12-11 00:46:47 -0500</bug_when>
    <thetext>(In reply to comment #2)
&gt; Stephan, I don&apos;t have access to post b64 JDK versions. Do you see this with
&gt; b65 or later?

Actually, never mind. I can reproduce it with HEAD and b65 JDK.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2192791</commentid>
    <comment_count>4</comment_count>
      <attachid>224549</attachid>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2012-12-11 01:49:56 -0500</bug_when>
    <thetext>Created attachment 224549
Proposed fix

This should do.

Olivier, do you think anything else is required for the batch compiler?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2193134</commentid>
    <comment_count>5</comment_count>
    <who name="Olivier Thomann">Olivier_Thomann</who>
    <bug_when>2012-12-11 12:01:10 -0500</bug_when>
    <thetext>(In reply to comment #4)
&gt; Created attachment 224549 [details] [diff]
&gt; Proposed fix
&gt; 
&gt; This should do.
&gt; 
&gt; Olivier, do you think anything else is required for the batch compiler?
No, I think this should be good enough. In the code you modify, I would actually replace the 52, 51, 50, ... with the constants from ClassFileConstants.
Something like this:

private boolean checkVMVersion(long minimalSupportedVersion) {
	// the format of this property is supposed to be xx.x where x are digits.
	String classFileVersion = System.getProperty(&quot;java.class.version&quot;); //$NON-NLS-1$
	if (classFileVersion == null) {
		// by default we don&apos;t support a class file version we cannot recognize
		return false;
	}
	int index = classFileVersion.indexOf(&apos;.&apos;);
	if (index == -1) {
		// by default we don&apos;t support a class file version we cannot recognize
		return false;
	}
	int majorVersion;
	try {
		majorVersion = Integer.parseInt(classFileVersion.substring(0, index));
	} catch (NumberFormatException e) {
		// by default we don&apos;t support a class file version we cannot recognize
		return false;
	}
	switch(majorVersion) {
		case ClassFileConstants.MAJOR_VERSION_1_1 : // 1.0 and 1.1
			return ClassFileConstants.JDK1_1 &gt;= minimalSupportedVersion;
		case ClassFileConstants.MAJOR_VERSION_1_2 : // 1.2
			return ClassFileConstants.JDK1_2 &gt;= minimalSupportedVersion;
		case ClassFileConstants.MAJOR_VERSION_1_3 : // 1.3
			return ClassFileConstants.JDK1_3 &gt;= minimalSupportedVersion;
		case ClassFileConstants.MAJOR_VERSION_1_4 : // 1.4
			return ClassFileConstants.JDK1_4 &gt;= minimalSupportedVersion;
		case ClassFileConstants.MAJOR_VERSION_1_5 : // 1.5
			return ClassFileConstants.JDK1_5 &gt;= minimalSupportedVersion;
		case ClassFileConstants.MAJOR_VERSION_1_6 : // 1.6
			return ClassFileConstants.JDK1_6 &gt;= minimalSupportedVersion;
		case ClassFileConstants.MAJOR_VERSION_1_7 : // 1.7
			return ClassFileConstants.JDK1_7 &gt;= minimalSupportedVersion;
		case ClassFileConstants.MAJOR_VERSION_1_8 :
			return ClassFileConstants.JDK1_8 &gt;= minimalSupportedVersion;
	}
	// unknown version
	return false;
}</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2193402</commentid>
    <comment_count>6</comment_count>
      <attachid>224610</attachid>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2012-12-11 23:49:45 -0500</bug_when>
    <thetext>Created attachment 224610
Patch to use constants instead of literals

All tests pass. Will wait till M4 is out before releasing.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2197930</commentid>
    <comment_count>7</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-01-01 00:30:19 -0500</bug_when>
    <thetext>Released the fix via commit:

http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=5a4b4a5bb82958c7c1b641811ee8d4c999d39c4e</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2229348</commentid>
    <comment_count>8</comment_count>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2013-03-12 04:44:30 -0400</bug_when>
    <thetext>Verified for 4.3 M6 build id: I20130310-2000</thetext>
  </long_desc>
      
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>224549</attachid>
            <date>2012-12-11 01:49:00 -0500</date>
            <delta_ts>2012-12-11 23:49:45 -0500</delta_ts>
            <desc>Proposed fix</desc>
            <filename>bug396000.txt</filename>
            <type>text/plain</type>
            <size>725</size>
            <attacher name="Jay Arthanareeswaran">jarthana</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlL2JhdGNoL29yZy9lY2xpcHNlL2pkdC9p
bnRlcm5hbC9jb21waWxlci9iYXRjaC9NYWluLmphdmEgYi9vcmcuZWNsaXBzZS5qZHQuY29yZS9i
YXRjaC9vcmcvZWNsaXBzZS9qZHQvaW50ZXJuYWwvY29tcGlsZXIvYmF0Y2gvTWFpbi5qYXZhCmlu
ZGV4IDdiMThjZjUuLjg1ZDFkMjIgMTAwNjQ0Ci0tLSBhL29yZy5lY2xpcHNlLmpkdC5jb3JlL2Jh
dGNoL29yZy9lY2xpcHNlL2pkdC9pbnRlcm5hbC9jb21waWxlci9iYXRjaC9NYWluLmphdmEKKysr
IGIvb3JnLmVjbGlwc2UuamR0LmNvcmUvYmF0Y2gvb3JnL2VjbGlwc2UvamR0L2ludGVybmFsL2Nv
bXBpbGVyL2JhdGNoL01haW4uamF2YQpAQCAtMTY1Miw2ICsxNjUyLDggQEAgcHJpdmF0ZSBib29s
ZWFuIGNoZWNrVk1WZXJzaW9uKGxvbmcgbWluaW1hbFN1cHBvcnRlZFZlcnNpb24pIHsKIAkJCXJl
dHVybiBDbGFzc0ZpbGVDb25zdGFudHMuSkRLMV82ID49IG1pbmltYWxTdXBwb3J0ZWRWZXJzaW9u
OwogCQljYXNlIDUxIDogLy8gMS43CiAJCQlyZXR1cm4gQ2xhc3NGaWxlQ29uc3RhbnRzLkpESzFf
NyA+PSBtaW5pbWFsU3VwcG9ydGVkVmVyc2lvbjsKKwkJY2FzZSA1MjogLy8gMS44CisJCQlyZXR1
cm4gQ2xhc3NGaWxlQ29uc3RhbnRzLkpESzFfOCA+PSBtaW5pbWFsU3VwcG9ydGVkVmVyc2lvbjsK
IAl9CiAJLy8gdW5rbm93biB2ZXJzaW9uCiAJcmV0dXJuIGZhbHNlOwo=
</data>

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>224610</attachid>
            <date>2012-12-11 23:49:00 -0500</date>
            <delta_ts>2012-12-11 23:49:45 -0500</delta_ts>
            <desc>Patch to use constants instead of literals</desc>
            <filename>Fix-for-bug-396000.patch</filename>
            <type>text/plain</type>
            <size>1549</size>
            <attacher name="Jay Arthanareeswaran">jarthana</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlL2JhdGNoL29yZy9lY2xpcHNlL2pkdC9p
bnRlcm5hbC9jb21waWxlci9iYXRjaC9NYWluLmphdmEgYi9vcmcuZWNsaXBzZS5qZHQuY29yZS9i
YXRjaC9vcmcvZWNsaXBzZS9qZHQvaW50ZXJuYWwvY29tcGlsZXIvYmF0Y2gvTWFpbi5qYXZhCmlu
ZGV4IDdiMThjZjUuLmJjMmZjNTUgMTAwNjQ0Ci0tLSBhL29yZy5lY2xpcHNlLmpkdC5jb3JlL2Jh
dGNoL29yZy9lY2xpcHNlL2pkdC9pbnRlcm5hbC9jb21waWxlci9iYXRjaC9NYWluLmphdmEKKysr
IGIvb3JnLmVjbGlwc2UuamR0LmNvcmUvYmF0Y2gvb3JnL2VjbGlwc2UvamR0L2ludGVybmFsL2Nv
bXBpbGVyL2JhdGNoL01haW4uamF2YQpAQCAtMTYzOSwxOCArMTYzOSwyMCBAQAogCX0KIAlzd2l0
Y2gobWFqb3JWZXJzaW9uKSB7Ci0JCWNhc2UgNDUgOiAvLyAxLjAgYW5kIDEuMQorCQljYXNlIENs
YXNzRmlsZUNvbnN0YW50cy5NQUpPUl9WRVJTSU9OXzFfMSA6IC8vIDEuMCBhbmQgMS4xCiAJCQly
ZXR1cm4gQ2xhc3NGaWxlQ29uc3RhbnRzLkpESzFfMSA+PSBtaW5pbWFsU3VwcG9ydGVkVmVyc2lv
bjsKLQkJY2FzZSA0NiA6IC8vIDEuMgorCQljYXNlIENsYXNzRmlsZUNvbnN0YW50cy5NQUpPUl9W
RVJTSU9OXzFfMiA6IC8vIDEuMgogCQkJcmV0dXJuIENsYXNzRmlsZUNvbnN0YW50cy5KREsxXzIg
Pj0gbWluaW1hbFN1cHBvcnRlZFZlcnNpb247Ci0JCWNhc2UgNDcgOiAvLyAxLjMKKwkJY2FzZSBD
bGFzc0ZpbGVDb25zdGFudHMuTUFKT1JfVkVSU0lPTl8xXzMgOiAvLyAxLjMKIAkJCXJldHVybiBD
bGFzc0ZpbGVDb25zdGFudHMuSkRLMV8zID49IG1pbmltYWxTdXBwb3J0ZWRWZXJzaW9uOwotCQlj
YXNlIDQ4IDogLy8gMS40CisJCWNhc2UgQ2xhc3NGaWxlQ29uc3RhbnRzLk1BSk9SX1ZFUlNJT05f
MV80IDogLy8gMS40CiAJCQlyZXR1cm4gQ2xhc3NGaWxlQ29uc3RhbnRzLkpESzFfNCA+PSBtaW5p
bWFsU3VwcG9ydGVkVmVyc2lvbjsKLQkJY2FzZSA0OSA6IC8vIDEuNQorCQljYXNlIENsYXNzRmls
ZUNvbnN0YW50cy5NQUpPUl9WRVJTSU9OXzFfNSA6IC8vIDEuNQogCQkJcmV0dXJuIENsYXNzRmls
ZUNvbnN0YW50cy5KREsxXzUgPj0gbWluaW1hbFN1cHBvcnRlZFZlcnNpb247Ci0JCWNhc2UgNTAg
OiAvLyAxLjYKKwkJY2FzZSBDbGFzc0ZpbGVDb25zdGFudHMuTUFKT1JfVkVSU0lPTl8xXzYgOiAv
LyAxLjYKIAkJCXJldHVybiBDbGFzc0ZpbGVDb25zdGFudHMuSkRLMV82ID49IG1pbmltYWxTdXBw
b3J0ZWRWZXJzaW9uOwotCQljYXNlIDUxIDogLy8gMS43CisJCWNhc2UgQ2xhc3NGaWxlQ29uc3Rh
bnRzLk1BSk9SX1ZFUlNJT05fMV83IDogLy8gMS43CiAJCQlyZXR1cm4gQ2xhc3NGaWxlQ29uc3Rh
bnRzLkpESzFfNyA+PSBtaW5pbWFsU3VwcG9ydGVkVmVyc2lvbjsKKwkJY2FzZSBDbGFzc0ZpbGVD
b25zdGFudHMuTUFKT1JfVkVSU0lPTl8xXzg6IC8vIDEuOAorCQkJcmV0dXJuIENsYXNzRmlsZUNv
bnN0YW50cy5KREsxXzggPj0gbWluaW1hbFN1cHBvcnRlZFZlcnNpb247CiAJfQogCS8vIHVua25v
d24gdmVyc2lvbg==
</data>

          </attachment>
      

    </bug>

</bugzilla>