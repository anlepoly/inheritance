<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>466279</bug_id>
          
          <creation_ts>2015-05-04 06:04:00 -0400</creation_ts>
          <short_desc>[hovering] IAE on hover when annotation-based null analysis is enabled</short_desc>
          <delta_ts>2015-05-07 01:13:12 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>4.5</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          <see_also>https://git.eclipse.org/r/47106</see_also>
    
    <see_also>https://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=655943c889f2cba7e4f59de355096e0f7bdd6ef9</see_also>
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>4.5 RC1</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Noopur Gupta">noopur_gupta</reporter>
          <assigned_to name="Stephan Herrmann">stephan.herrmann</assigned_to>
          <cc>markus_keller</cc>
    
    <cc>saammana</cc>
    
    <cc>stephan.herrmann</cc>
          
          <votes>0</votes>

      

      

      <flag name="review"
          id="64619"
          type_id="1"
          status="+"
          setter="saammana"
    />

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2555923</commentid>
    <comment_count>0</comment_count>
    <who name="Noopur Gupta">noopur_gupta</who>
    <bug_when>2015-05-04 06:04:48 -0400</bug_when>
    <thetext>Eclipse 4.5 M7 - I20150430-1445

- Create a Java 8 project, open java.util.Map and got to the method #get.
- Hover on the return type &quot;V&quot; - we can see the Javadoc.
- Now, enable annotation-based null analysis for the project.
- Hover on the return type &quot;V&quot; - we get the following exception:

Unexpected runtime error while computing a text hover

java.lang.IllegalArgumentException: &lt;V&gt; [in Map [in Map.class [in java.util [in C:\Eclipse\JREs\jdk-8u60-ea-bin-b03-windows-x64-17_feb_2015\jdk8_60\jdk1.8.0_60\jre\lib\rt.jar]]]] has an unexpected type
	at org.eclipse.jdt.core.dom.CompilationUnitResolver.resolve(CompilationUnitResolver.java:765)
	at org.eclipse.jdt.core.dom.ASTParser.createBindings(ASTParser.java:1057)
	at org.eclipse.jdt.internal.ui.text.java.hover.JavadocHover.getHoverBinding(JavadocHover.java:814)
	at org.eclipse.jdt.internal.ui.text.java.hover.JavadocHover.getInfoText(JavadocHover.java:768)
	at org.eclipse.jdt.internal.ui.text.java.hover.JavadocHover.getHoverInfo(JavadocHover.java:716)
	at org.eclipse.jdt.internal.ui.text.java.hover.JavadocHover.internalGetHoverInfo(JavadocHover.java:639)
	at org.eclipse.jdt.internal.ui.text.java.hover.JavadocHover.getHoverInfo2(JavadocHover.java:631)
	at org.eclipse.jdt.internal.ui.text.java.hover.BestMatchHover.getHoverInfo2(BestMatchHover.java:163)
	at org.eclipse.jdt.internal.ui.text.java.hover.BestMatchHover.getHoverInfo2(BestMatchHover.java:129)
	at org.eclipse.jdt.internal.ui.text.java.hover.JavaEditorTextHoverProxy.getHoverInfo2(JavaEditorTextHoverProxy.java:85)
	at org.eclipse.jface.text.TextViewerHoverManager$4.run(TextViewerHoverManager.java:166)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2556556</commentid>
    <comment_count>1</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2015-05-04 17:08:13 -0400</bug_when>
    <thetext>Reproduced as a bug in JDT/Core:

ASTParser.createBindings(IJavaElement[], IProgressMonitor) cannot handle an element of type TypeParameter.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2556579</commentid>
    <comment_count>2</comment_count>
    <who name="Eclipse Genie">genie</who>
    <bug_when>2015-05-04 18:45:16 -0400</bug_when>
    <thetext>New Gerrit change created: https://git.eclipse.org/r/47106</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2556589</commentid>
    <comment_count>3</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2015-05-04 19:53:20 -0400</bug_when>
    <thetext>Test failure in gerrit/hudson #214 only indicates lack of test isolation of one of the existing tests - not removing a created folder.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2558525</commentid>
    <comment_count>4</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2015-05-05 17:41:22 -0400</bug_when>
    <thetext>Test issue (comment 3) has been fixed, hudson gave +1.

Sasi, at your convenience, can you please check the patch and give +1 for inclusion in RC1? TIA.

Motivation for inclusion in RC1:
- new implementation from bug 403917 (JDT/UI) is inferior (in this particular situation) to old implementation because it hits an incompleteness in JDT/Core


Problem:
- ASTParser.createBindings(..) could not handle a TypeParameter (Java element), throwing IAE in CompilationUnitResolver.

Solution:
- In CompilationUnitResolver.resolve(..), when we want to retrieve the element&apos;s key, also expect TypeParameter
- Add new method getKey(boolean) to TypeParameter. The key is computed in direct correspondence to TypeVariableBinding.computeUniqueKey(boolean).

I&apos;ve tested that this also resolves the UI issue (text hover).
That&apos;s all :)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2558626</commentid>
    <comment_count>5</comment_count>
    <who name="Sasikanth Bharadwaj">saammana</who>
    <bug_when>2015-05-06 03:14:58 -0400</bug_when>
    <thetext>(In reply to comment #4)
&gt; 
&gt; Sasi, at your convenience, can you please check the patch and give +1 for
&gt; inclusion in RC1? TIA.
&gt; 
+1 for RC1</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2558628</commentid>
    <comment_count>6</comment_count>
    <who name="Eclipse Genie">genie</who>
    <bug_when>2015-05-06 03:18:08 -0400</bug_when>
    <thetext>Gerrit change https://git.eclipse.org/r/47106 was merged to [master].
Commit: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=655943c889f2cba7e4f59de355096e0f7bdd6ef9</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2558629</commentid>
    <comment_count>7</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2015-05-06 03:18:57 -0400</bug_when>
    <thetext>Thanks, released for 4.5 RC1</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2558978</commentid>
    <comment_count>8</comment_count>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2015-05-06 10:11:52 -0400</bug_when>
    <thetext>Sasi, please set the review+ flag. See https://www.eclipse.org/eclipse/development/plans/freeze_plan_4_5.php#FixPassAfterRC0</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>