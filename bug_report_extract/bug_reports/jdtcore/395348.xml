<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>395348</bug_id>
          
          <creation_ts>2012-11-28 23:50:00 -0500</creation_ts>
          <short_desc>[search] NPE while searching for declarations of a generic function inside an anonymous class (was originally: Rename method does not detect renaming of binary method in anonymous class)</short_desc>
          <delta_ts>2014-01-30 05:58:31 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>4.2.1</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>4.3.2</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Milos Gligoric">milos.gligoric</reporter>
          <assigned_to name="Manoj Palat Away Until May 11 2015">manpalat</assigned_to>
          <cc>anchakrk</cc>
    
    <cc>daniel_megert</cc>
    
    <cc>deepakazad</cc>
    
    <cc>jarthana</cc>
    
    <cc>marcel.bruch</cc>
    
    <cc>srikanth_sankaran</cc>
          
          <votes>0</votes>

      

      

      <flag name="pmc_approved"
          id="59564"
          type_id="2"
          status="+"
          setter="daniel_megert"
    />
    <flag name="review"
          id="59563"
          type_id="1"
          status="+"
          setter="srikanth_sankaran"
    />

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2188818</commentid>
    <comment_count>0</comment_count>
    <who name="Milos Gligoric">milos.gligoric</who>
    <bug_when>2012-11-28 23:50:35 -0500</bug_when>
    <thetext>Steps to reproduce:
1. Invoke &quot;Rename&quot; on &quot;compare&quot; in code below
2. The resulting code does not compile (&quot;The type new Comparator&lt;C2&gt;(){} must implement the inherited abstract method Comparator&lt;C2&gt;.compare(C2, C2)&quot;)

class RenameMethodBug2 {
    static void f() {
        new Comparator&lt;C2&gt;() { // &lt;&lt;&lt; This type parameter is necessary
            // Invoke &quot;Rename&quot; on &quot;compare&quot;
            public int compare(C2 o1, C2 o2) {
                return 0;
            }
        };
    }
}

class C2 {
}

(Thanks to Yilong Li for helping with the bug report.)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2189665</commentid>
    <comment_count>1</comment_count>
    <who name="Deepak Azad">deepakazad</who>
    <bug_when>2012-11-30 23:53:37 -0500</bug_when>
    <thetext>Milos, can you please include the Eclipse version you used? Also how is Rename invoked, via Refactor menu or via Ctrl+1?

Rename in file
-&gt; Rename happens and results in a compile error =&gt; this is OK, since we assume the user knows what he is doing. 

Rename in Workspace
-&gt; I20120919-0330 and master
The rename does not succeed and the user does not get any message why this is so.

M20120208-0800
User gets the correct message - &quot;Binary references have been found... &quot;

Something broke somewhere.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2189666</commentid>
    <comment_count>2</comment_count>
    <who name="Deepak Azad">deepakazad</who>
    <bug_when>2012-12-01 00:21:26 -0500</bug_when>
    <thetext>Milos, I assume you are talking about &apos;Rename in file&apos; and NOT &apos;Rename in Workspace&apos; (Please correct me if I am wrong). I do not think we will change anything there.

(In reply to comment #1)
&gt; Something broke somewhere.

There is an exception in the error log. Also tested with I20121127-0800. Moving to JDT core.

java.lang.NullPointerException
	at org.eclipse.jdt.core.compiler.CharOperation.indexOf(CharOperation.java:2092)
	at org.eclipse.jdt.core.compiler.CharOperation.indexOf(CharOperation.java:2058)
	at org.eclipse.jdt.internal.core.search.matching.MatchLocator.getMethodBinding(MatchLocator.java:913)
	at org.eclipse.jdt.internal.core.search.matching.MethodLocator.newDeclarationMatch(MethodLocator.java:561)
	at org.eclipse.jdt.internal.core.search.matching.MatchLocator.reportMatching(MatchLocator.java:2214)
	at org.eclipse.jdt.internal.core.search.matching.MatchLocator.reportMatching(MatchLocator.java:2763)
	at org.eclipse.jdt.internal.core.search.matching.MatchLocator.reportMatching(MatchLocator.java:2490)
	at org.eclipse.jdt.internal.core.search.matching.MatchLocator.process(MatchLocator.java:1733)
	at org.eclipse.jdt.internal.core.search.matching.MatchLocator.locateMatches(MatchLocator.java:1143)
	at org.eclipse.jdt.internal.core.search.matching.MatchLocator.locateMatches(MatchLocator.java:1184)
	at org.eclipse.jdt.internal.core.search.matching.MatchLocator.locateMatches(MatchLocator.java:1316)
	at org.eclipse.jdt.internal.core.search.JavaSearchParticipant.locateMatches(JavaSearchParticipant.java:95)
	at org.eclipse.jdt.internal.core.search.BasicSearchEngine.findMatches(BasicSearchEngine.java:231)
	at org.eclipse.jdt.internal.core.search.BasicSearchEngine.search(BasicSearchEngine.java:515)
	at org.eclipse.jdt.core.search.SearchEngine.search(SearchEngine.java:584)
	at org.eclipse.jdt.internal.corext.refactoring.rename.RippleMethodFinder2.findAllDeclarations(RippleMethodFinder2.java:356)
	at org.eclipse.jdt.internal.corext.refactoring.rename.RippleMethodFinder2.findAllRippleMethods(RippleMethodFinder2.java:187)
	at org.eclipse.jdt.internal.corext.refactoring.rename.RippleMethodFinder2.getAllRippleMethods(RippleMethodFinder2.java:168)
	at org.eclipse.jdt.internal.corext.refactoring.rename.RippleMethodFinder2.getRelatedMethods(RippleMethodFinder2.java:161)
	at org.eclipse.jdt.internal.corext.refactoring.rename.RenameMethodProcessor.initializeMethodsToRename(RenameMethodProcessor.java:244)
	at org.eclipse.jdt.internal.corext.refactoring.rename.RenameMethodProcessor.doCheckFinalConditions(RenameMethodProcessor.java:370)
	at org.eclipse.jdt.internal.corext.refactoring.rename.RenameVirtualMethodProcessor.doCheckFinalConditions(RenameVirtualMethodProcessor.java:146)
	at org.eclipse.jdt.internal.corext.refactoring.rename.JavaRenameProcessor.checkFinalConditions(JavaRenameProcessor.java:48)
	at org.eclipse.ltk.core.refactoring.participants.ProcessorBasedRefactoring.checkFinalConditions(ProcessorBasedRefactoring.java:224)
	at org.eclipse.ltk.core.refactoring.Refactoring.checkAllConditions(Refactoring.java:162)
	at org.eclipse.jdt.internal.ui.refactoring.RefactoringExecutionHelper$Operation.run(RefactoringExecutionHelper.java:80)
	at org.eclipse.jdt.internal.core.BatchOperation.executeOperation(BatchOperation.java:39)
	at org.eclipse.jdt.internal.core.JavaModelOperation.run(JavaModelOperation.java:728)
	at org.eclipse.core.internal.resources.Workspace.run(Workspace.java:2347)
	at org.eclipse.jdt.core.JavaCore.run(JavaCore.java:5251)
	at org.eclipse.jdt.internal.ui.actions.WorkbenchRunnableAdapter.run(WorkbenchRunnableAdapter.java:106)
	at org.eclipse.jface.operation.ModalContext$ModalContextThread.run(ModalContext.java:121)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2189746</commentid>
    <comment_count>3</comment_count>
    <who name="Milos Gligoric">milos.gligoric</who>
    <bug_when>2012-12-02 12:24:13 -0500</bug_when>
    <thetext>Deepak, thanks for considering the bug report.

Eclipse:
Eclipse Java EE IDE for Web Developers.
Version: Juno Service Release 1
Build id: 20120920-0800

Rename is invoked via refactoring menu.

As you said it is &apos;Rename in file&apos;.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2189812</commentid>
    <comment_count>4</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2012-12-03 01:11:44 -0500</bug_when>
    <thetext>Srikanth, can you please take a look at this? 

The exception occurs in the new method (MatchLocator.getMethodBinding) added as part of fix to bug 123836.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2314628</commentid>
    <comment_count>5</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2013-10-05 04:19:11 -0400</bug_when>
    <thetext>*** Bug 418726 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2314630</commentid>
    <comment_count>6</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2013-10-05 04:23:40 -0400</bug_when>
    <thetext>Manoj, let us try and get this in for M3. I think PatternLocator.qualifiedPattern
is returning null. At the very least we could defensively avoid NPE, if reproduction seems complicated.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2315002</commentid>
    <comment_count>7</comment_count>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2013-10-07 08:15:07 -0400</bug_when>
    <thetext>(In reply to Srikanth Sankaran from comment #6)
&gt; Manoj, let us try and get this in for M3. I think
&gt; PatternLocator.qualifiedPattern
&gt; is returning null. At the very least we could defensively avoid NPE, if
&gt; reproduction seems complicated.

NPE check released via http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=8761bc78bc4b10c860ffd0abaa11fe6e4409f4a7

- This should goto BETA_JAVA8 as well.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2315634</commentid>
    <comment_count>8</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2013-10-08 10:37:09 -0400</bug_when>
    <thetext>Patch looks good, thanks Manoj</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2315635</commentid>
    <comment_count>9</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2013-10-08 10:38:52 -0400</bug_when>
    <thetext>Jay/Dani, this should also go into 4.3.2 ? This is reported from multiple
places.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2315639</commentid>
    <comment_count>10</comment_count>
    <who name="Dani Megert">daniel_megert</who>
    <bug_when>2013-10-08 10:45:35 -0400</bug_when>
    <thetext>.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2315948</commentid>
    <comment_count>11</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2013-10-08 23:10:43 -0400</bug_when>
    <thetext>An automated junit test is a must for every fix that goes in. The only exceptions
are (a) certain concurrency bugs are so difficult to model in tests (b) The
reporter didn&apos;t provide enough information to reproduce, but the fix can be
ascertained to be is obvious and safe from source code inspection.

I may have misunderstood the present bug to fall under (b) and recommended
release without a test. If this is strictly not the case, please follow up
with a junit in due course. The fix in this case is obvious and safe. 

We don&apos;t want to be slaves to processes: If the situation warrants/demands
it sometimes it is OK to release a safe fix, leave the bug open and then
follow up with a junit test case in due course before resolving.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2347038</commentid>
    <comment_count>12</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2014-01-08 11:09:29 -0500</bug_when>
    <thetext>Manoj, this can be back ported for 4.3.2 now. Also, it would be nice to have a unit test case if that&apos;s possible.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2349009</commentid>
    <comment_count>13</comment_count>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2014-01-13 10:25:22 -0500</bug_when>
    <thetext>(In reply to Jayaprakash Arthanareeswaran from comment #12)
&gt; Manoj, this can be back ported for 4.3.2 now. Also, it would be nice to have
&gt; a unit test case if that&apos;s possible.

Unit Test case committed to master via: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=b4ab954cec12e7bc70d14dd4ef62af5fd75c7e2e

These commits have been cherry picked to 4.3.2</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2349775</commentid>
    <comment_count>14</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2014-01-15 01:03:05 -0500</bug_when>
    <thetext>(In reply to Manoj Palat from comment #13)
&gt; These commits have been cherry picked to 4.3.2

Looks like you forgot to push. I have done it now:

http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?h=R4_3_maintenance&amp;id=dd2eaa7b62bc9af88522aa48afde38f148f9c7c1</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2349811</commentid>
    <comment_count>15</comment_count>
    <who name="Dani Megert">daniel_megert</who>
    <bug_when>2014-01-15 03:27:09 -0500</bug_when>
    <thetext>(In reply to Jayaprakash Arthanareeswaran from comment #14)
&gt; (In reply to Manoj Palat from comment #13)
&gt; &gt; These commits have been cherry picked to 4.3.2
&gt; 
&gt; Looks like you forgot to push. I have done it now:
&gt; 
&gt; http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/
&gt; ?h=R4_3_maintenance&amp;id=dd2eaa7b62bc9af88522aa48afde38f148f9c7c1

Just for the records: the fix was also backported with
http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?h=R4_3_maintenance&amp;id=92234db13858bde022f231d8defd53801b53f004</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2356509</commentid>
    <comment_count>16</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2014-01-30 05:58:31 -0500</bug_when>
    <thetext>Verified for 4.3.2 with build M20140129-0800.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>