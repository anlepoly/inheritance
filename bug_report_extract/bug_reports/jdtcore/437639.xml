<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>437639</bug_id>
          
          <creation_ts>2014-06-18 02:20:00 -0400</creation_ts>
          <short_desc>[formatter] ArrayIndexOutOfBoundsException while formatting source code</short_desc>
          <delta_ts>2014-08-06 00:02:09 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>4.4</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows 7</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>4.5 M1</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Mahesh sl">maheshlangote</reporter>
          <assigned_to name="Manoj Palat Away Until May 11 2015">manpalat</assigned_to>
          <cc>jarthana</cc>
    
    <cc>manpalat</cc>
    
    <cc>shankhba</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2417903</commentid>
    <comment_count>0</comment_count>
    <who name="Mahesh sl">maheshlangote</who>
    <bug_when>2014-06-18 02:20:21 -0400</bug_when>
    <thetext>While formatting the source code it gives following exception -

java.lang.ArrayIndexOutOfBoundsException: -1
	at org.eclipse.jdt.internal.formatter.Scribe.getNewLineString(Scribe.java:1137)
	at org.eclipse.jdt.internal.formatter.Scribe.getEmptyLines(Scribe.java:1062)
	at org.eclipse.jdt.internal.formatter.Scribe.printEmptyLines(Scribe.java:3050)
	at org.eclipse.jdt.internal.formatter.Scribe.preserveEmptyLines(Scribe.java:1584)
	at org.eclipse.jdt.internal.formatter.Scribe.printComment(Scribe.java:2584)
	at org.eclipse.jdt.internal.formatter.Scribe.printComment(Scribe.java:2414)
	at org.eclipse.jdt.internal.formatter.CodeFormatterVisitor.format(CodeFormatterVisitor.java:714)
	at org.eclipse.jdt.internal.formatter.CodeFormatterVisitor.visit(CodeFormatterVisitor.java:3294)


With analysis I found out the root cause to be commented import statement as shown below -
import org.hibernate.validator.HibernateValidator;
import org.hibernate.validator.HibernateValidatorConfiguration;

//import javax.validation.*;
import javax.validation.Configuration;</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2417904</commentid>
    <comment_count>1</comment_count>
    <who name="Mahesh sl">maheshlangote</who>
    <bug_when>2014-06-18 02:27:09 -0400</bug_when>
    <thetext>With analysis I found out the root cause to be commented import statemente and space above it, as shown below -
import org.hibernate.validator.HibernateValidator;
import org.hibernate.validator.HibernateValidatorConfiguration;

//import javax.validation.*;
import javax.validation.Configuration;</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2418126</commentid>
    <comment_count>2</comment_count>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2014-06-18 10:40:38 -0400</bug_when>
    <thetext>(In reply to Mahesh sl from comment #1)
&gt; With analysis I found out the root cause to be commented import statemente
&gt; and space above it, as shown below -

Can you attach a small reproducible test case?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2418320</commentid>
    <comment_count>3</comment_count>
      <attachid>244348</attachid>
    <who name="Mahesh sl">maheshlangote</who>
    <bug_when>2014-06-19 03:28:03 -0400</bug_when>
    <thetext>Created attachment 244348
Test Class</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2418321</commentid>
    <comment_count>4</comment_count>
    <who name="Mahesh sl">maheshlangote</who>
    <bug_when>2014-06-19 03:29:22 -0400</bug_when>
    <thetext>Also need to change the formatter -
Set &quot;Blank Lines&quot; &quot;between import groups&quot; to 0(zero)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2427791</commentid>
    <comment_count>5</comment_count>
      <attachid>245064</attachid>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2014-07-15 06:48:50 -0400</bug_when>
    <thetext>Created attachment 245064
Proposed Patch

would wait for a day before committing for review comments, if any.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2428592</commentid>
    <comment_count>6</comment_count>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2014-07-17 00:55:55 -0400</bug_when>
    <thetext>Fixed via commit http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=4819fad32c78bae1ce1ee5d132562a40aee0fa3e</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2435569</commentid>
    <comment_count>7</comment_count>
    <who name="shankha banerjee">shankhba</who>
    <bug_when>2014-08-05 05:34:24 -0400</bug_when>
    <thetext>Verified for 4.5 M1 using I20140804-2000 build.</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="0"
              isprivate="0"
          >
            <attachid>244348</attachid>
            <date>2014-06-19 03:28:00 -0400</date>
            <delta_ts>2014-06-19 03:28:03 -0400</delta_ts>
            <desc>Test Class</desc>
            <filename>Test.java</filename>
            <type>application/octet-stream</type>
            <size>405</size>
            <attacher name="Mahesh sl">maheshlangote</attacher>
            
              <data encoding="base64">cGFja2FnZSBjb20udGVzdDsNCg0KaW1wb3J0IGphdmEubWF0aC5CaWdEZWNpbWFsOw0KaW1wb3J0
IGphdmEubWF0aC5CaWdJbnRlZ2VyOw0KaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7DQoNCg0K
Ly9pbXBvcnQgamF2YS51dGlsLkFycmF5czsNCmltcG9ydCBqYXZhLnV0aWwuRGF0ZTsNCmltcG9y
dCBqYXZhLnV0aWwuTGlzdDsNCg0KcHVibGljIGNsYXNzIFRlc3Qgew0KDQoJcHVibGljIHN0YXRp
YyB2b2lkIG1haW4oU3RyaW5nW10gYXJncykgew0KCQlCaWdEZWNpbWFsIGJpZyA9IG5ldyBCaWdE
ZWNpbWFsKDEpOw0KCQlCaWdJbnRlZ2VyIGJpZ0kgPSAJbmV3IEJpZ0ludGVnZXIoIjEiKTsNCgkJ
RGF0ZSBkID0gbmV3IERhdGUoKTsNCgkJTGlzdCBsaXN0ID0gbmV3IEFycmF5TGlzdDw+KCk7DQoJ
fQ0KfQ0K
</data>

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>245064</attachid>
            <date>2014-07-15 06:48:00 -0400</date>
            <delta_ts>2014-07-15 06:48:50 -0400</delta_ts>
            <desc>Proposed Patch</desc>
            <filename>Fix-for-Bug-437639-formatter-ArrayIndexOutOfBoundsEx.patch</filename>
            <type>text/plain</type>
            <size>3274</size>
            <attacher name="Manoj Palat Away Until May 11 2015">manpalat</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3NyYy9vcmcvZWNs
aXBzZS9qZHQvY29yZS90ZXN0cy9mb3JtYXR0ZXIvRm9ybWF0dGVyQnVnc1Rlc3RzLmphdmEgYi9v
cmcuZWNsaXBzZS5qZHQuY29yZS50ZXN0cy5tb2RlbC9zcmMvb3JnL2VjbGlwc2UvamR0L2NvcmUv
dGVzdHMvZm9ybWF0dGVyL0Zvcm1hdHRlckJ1Z3NUZXN0cy5qYXZhCmluZGV4IGY1MDMxZWYuLmJl
ZTc0OGQgMTAwNjQ0Ci0tLSBhL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3NyYy9v
cmcvZWNsaXBzZS9qZHQvY29yZS90ZXN0cy9mb3JtYXR0ZXIvRm9ybWF0dGVyQnVnc1Rlc3RzLmph
dmEKKysrIGIvb3JnLmVjbGlwc2UuamR0LmNvcmUudGVzdHMubW9kZWwvc3JjL29yZy9lY2xpcHNl
L2pkdC9jb3JlL3Rlc3RzL2Zvcm1hdHRlci9Gb3JtYXR0ZXJCdWdzVGVzdHMuamF2YQpAQCAtMTA0
NjMsNCArMTA0NjMsNTUgQEAKIAkJIn1cbiIKICAgICApOwogfQorLyoqCisgKiBAYnVnIDQzNzYz
OTogW2Zvcm1hdHRlcl0gQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uIHdoaWxlIGZvcm1h
dHRpbmcgc291cmNlIGNvZGUKKyAqIEB0ZXN0IHRlc3QgdGhhdCB0aGUgQUlPT0IgaXMgbm90IGdl
bmVyYXRlZCAKKyAqIEBzZWUgImh0dHBzOi8vYnVncy5lY2xpcHNlLm9yZy9idWdzL3Nob3dfYnVn
LmNnaT9pZD00Mzc2MzkiCisgKi8KK3B1YmxpYyB2b2lkIHRlc3RCdWc0Mzc2MzkoKSB0aHJvd3Mg
RXhjZXB0aW9uIHsKKwl0aGlzLmZvcm1hdHRlclByZWZzLmJsYW5rX2xpbmVzX2JldHdlZW5faW1w
b3J0X2dyb3VwcyA9IDA7CisJU3RyaW5nIHNvdXJjZSA9CisJCSJwYWNrYWdlIGNvbS50ZXN0O1xu
IiArCisJCSJcbiIgKworCQkiaW1wb3J0IGphdmEubWF0aC5CaWdEZWNpbWFsO1xuIiArCisJCSJp
bXBvcnQgamF2YS5tYXRoLkJpZ0ludGVnZXI7XG4iICsKKwkJImltcG9ydCBqYXZhLnV0aWwuQXJy
YXlMaXN0O1xuIiArCisJCSJcbiIgKworCQkiXG4iICsKKwkJIlxuIiArCisJCSIvL2ltcG9ydCBq
YXZhLnV0aWwuQXJyYXlzO1xuIiArCisJCSJpbXBvcnQgamF2YS51dGlsLkRhdGU7XG4iICsKKwkJ
ImltcG9ydCBqYXZhLnV0aWwuTGlzdDtcbiIgKworCQkiXG4iICsKKwkJInB1YmxpYyBjbGFzcyBU
ZXN0IHtcbiIgKworCQkiXG4iICsKKwkJIglwdWJsaWMgc3RhdGljIHZvaWQgbWFpbihTdHJpbmdb
XSBhcmdzKSB7XG4iICsKKwkJIgkJQmlnRGVjaW1hbCBiaWcgPSBuZXcgQmlnRGVjaW1hbCgxKTtc
biIgKworCQkiCQlCaWdJbnRlZ2VyIGJpZ0kgPSAJbmV3IEJpZ0ludGVnZXIoXCIxXCIpO1xuIiAr
CisJCSIJCURhdGUgZCA9IG5ldyBEYXRlKCk7XG4iICsKKwkJIgkJTGlzdCBsaXN0ID0gbmV3IEFy
cmF5TGlzdDw+KCk7XG4iICsKKwkJIgl9XG4iICsKKwkJIn1cbiIKKwkJOworCWZvcm1hdFNvdXJj
ZShzb3VyY2UsCisJCSJwYWNrYWdlIGNvbS50ZXN0O1xuIiArCisJCSJcbiIgKworCQkiaW1wb3J0
IGphdmEubWF0aC5CaWdEZWNpbWFsO1xuIiArCisJCSJpbXBvcnQgamF2YS5tYXRoLkJpZ0ludGVn
ZXI7XG4iICsKKwkJImltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0O1xuIiArCisJCSIvL2ltcG9y
dCBqYXZhLnV0aWwuQXJyYXlzO1xuIiArCisJCSJpbXBvcnQgamF2YS51dGlsLkRhdGU7XG4iICsK
KwkJImltcG9ydCBqYXZhLnV0aWwuTGlzdDtcbiIgKworCQkiXG4iICsKKwkJInB1YmxpYyBjbGFz
cyBUZXN0IHtcbiIgKworCQkiXG4iICsKKwkJIglwdWJsaWMgc3RhdGljIHZvaWQgbWFpbihTdHJp
bmdbXSBhcmdzKSB7XG4iICsKKwkJIgkJQmlnRGVjaW1hbCBiaWcgPSBuZXcgQmlnRGVjaW1hbCgx
KTtcbiIgKworCQkiCQlCaWdJbnRlZ2VyIGJpZ0kgPSAJbmV3IEJpZ0ludGVnZXIoXCIxXCIpO1xu
IiArCisJCSIJCURhdGUgZCA9IG5ldyBEYXRlKCk7XG4iICsKKwkJIgkJTGlzdCBsaXN0ID0gbmV3
IEFycmF5TGlzdDw+KCk7XG4iICsKKwkJIgl9XG4iICsKKwkJIn1cbiIKKyAgICApOworfQogfQpk
aWZmIC0tZ2l0IGEvb3JnLmVjbGlwc2UuamR0LmNvcmUvZm9ybWF0dGVyL29yZy9lY2xpcHNlL2pk
dC9pbnRlcm5hbC9mb3JtYXR0ZXIvU2NyaWJlLmphdmEgYi9vcmcuZWNsaXBzZS5qZHQuY29yZS9m
b3JtYXR0ZXIvb3JnL2VjbGlwc2UvamR0L2ludGVybmFsL2Zvcm1hdHRlci9TY3JpYmUuamF2YQpp
bmRleCBjOTVlMGRhLi4zOWFmMzVjIDEwMDY0NAotLS0gYS9vcmcuZWNsaXBzZS5qZHQuY29yZS9m
b3JtYXR0ZXIvb3JnL2VjbGlwc2UvamR0L2ludGVybmFsL2Zvcm1hdHRlci9TY3JpYmUuamF2YQor
KysgYi9vcmcuZWNsaXBzZS5qZHQuY29yZS9mb3JtYXR0ZXIvb3JnL2VjbGlwc2UvamR0L2ludGVy
bmFsL2Zvcm1hdHRlci9TY3JpYmUuamF2YQpAQCAtMTEzOCwxNCArMTEzOCwxNyBAQAogCQlpZiAo
bGluZXNDb3VudCA+IGxlbmd0aCkgewogCQkJU3lzdGVtLmFycmF5Y29weSh0aGlzLm5ld0VtcHR5
TGluZXMsIDAsIHRoaXMubmV3RW1wdHlMaW5lcyA9IG5ldyBTdHJpbmdbbGluZXNDb3VudCsxMF0s
IDAsIGxlbmd0aCk7CiAJCX0KLQkJU3RyaW5nIG5ld0xpbmVTdHJpbmcgPSB0aGlzLm5ld0VtcHR5
TGluZXNbbGluZXNDb3VudC0xXTsKLQkJaWYgKG5ld0xpbmVTdHJpbmcgPT0gbnVsbCkgewotCQkJ
dGhpcy50ZW1wQnVmZmVyLnNldExlbmd0aCgwKTsKLQkJCWZvciAoaW50IGo9MDsgajxsaW5lc0Nv
dW50OyBqKyspIHsKLQkJCQl0aGlzLnRlbXBCdWZmZXIuYXBwZW5kKHRoaXMubGluZVNlcGFyYXRv
cik7CisJCVN0cmluZyBuZXdMaW5lU3RyaW5nID0gVXRpbC5FTVBUWV9TVFJJTkc7CisJCWlmIChs
aW5lc0NvdW50ID4gMCkgeworCQkJbmV3TGluZVN0cmluZyA9IHRoaXMubmV3RW1wdHlMaW5lc1ts
aW5lc0NvdW50LTFdOworCQkJaWYgKG5ld0xpbmVTdHJpbmcgPT0gbnVsbCkgeworCQkJCXRoaXMu
dGVtcEJ1ZmZlci5zZXRMZW5ndGgoMCk7CisJCQkJZm9yIChpbnQgaj0wOyBqPGxpbmVzQ291bnQ7
IGorKykgeworCQkJCQl0aGlzLnRlbXBCdWZmZXIuYXBwZW5kKHRoaXMubGluZVNlcGFyYXRvcik7
CisJCQkJfQorCQkJCW5ld0xpbmVTdHJpbmcgPSB0aGlzLnRlbXBCdWZmZXIudG9TdHJpbmcoKTsK
KwkJCQl0aGlzLm5ld0VtcHR5TGluZXNbbGluZXNDb3VudC0xXSA9IG5ld0xpbmVTdHJpbmc7CiAJ
CQl9Ci0JCQluZXdMaW5lU3RyaW5nID0gdGhpcy50ZW1wQnVmZmVyLnRvU3RyaW5nKCk7Ci0JCQl0
aGlzLm5ld0VtcHR5TGluZXNbbGluZXNDb3VudC0xXSA9IG5ld0xpbmVTdHJpbmc7CiAJCX0KIAkJ
cmV0dXJuIG5ld0xpbmVTdHJpbmc7CiAJfQ==
</data>

          </attachment>
      

    </bug>

</bugzilla>