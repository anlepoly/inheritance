<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>439936</bug_id>
          
          <creation_ts>2014-07-19 06:00:00 -0400</creation_ts>
          <short_desc>[model] testRemoveExternalProject Failure</short_desc>
          <delta_ts>2014-08-05 07:41:11 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>4.4</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc>http://download.eclipse.org/eclipse/downloads/drops4/N20140718-2000/testResults.php</bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>4.5 M1</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="shankha banerjee">shankhba</reporter>
          <assigned_to name="Jay Arthanareeswaran">jarthana</assigned_to>
          <cc>jarthana</cc>
    
    <cc>markus_keller</cc>
    
    <cc>shankhba</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2429470</commentid>
    <comment_count>0</comment_count>
    <who name="shankha banerjee">shankhba</who>
    <bug_when>2014-07-19 06:00:15 -0400</bug_when>
    <thetext>Build ID: N20140718-2000

The test testRemoveExternalProject Failed.

junit.framework.AssertionFailedError: Should receive change
at org.eclipse.jdt.core.tests.model.TypeHierarchyNotificationTests.testRemoveExternalProject(TypeHierarchyNotificationTests.java:1110)
at org.eclipse.jdt.core.tests.model.SuiteOfTestCases$Suite.runTest(SuiteOfTestCases.java:104)
at org.eclipse.jdt.core.tests.model.SuiteOfTestCases$Suite.superRun(SuiteOfTestCases.java:88)
at org.eclipse.jdt.core.tests.model.SuiteOfTestCases$1.protect(SuiteOfTestCases.java:76)
at org.eclipse.jdt.core.tests.model.SuiteOfTestCases$Suite.run(SuiteOfTestCases.java:85)
at org.eclipse.test.EclipseTestRunner.run(EclipseTestRunner.java:657)
at org.eclipse.test.EclipseTestRunner.run(EclipseTestRunner.java:310)
at org.eclipse.test.CoreTestApplication.runTests(CoreTestApplication.java:36)
at org.eclipse.test.CoreTestApplication.run(CoreTestApplication.java:32)
at org.eclipse.equinox.internal.app.EclipseAppContainer.callMethodWithException(EclipseAppContainer.java:587)
at org.eclipse.equinox.internal.app.EclipseAppHandle.run(EclipseAppHandle.java:198)
at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:134)
at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:104)
at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:382)
at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:236)
at org.eclipse.equinox.launcher.Main.invokeFramework(Main.java:648)
at org.eclipse.equinox.launcher.Main.basicRun(Main.java:603)
at org.eclipse.equinox.launcher.Main.run(Main.java:1465)
at org.eclipse.equinox.launcher.Main.main(Main.java:1438)
at org.eclipse.core.launcher.Main.main(Main.java:34)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2429582</commentid>
    <comment_count>1</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2014-07-20 23:42:05 -0400</bug_when>
    <thetext>I can reproduce, but only when the whole model test suite is run.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2429628</commentid>
    <comment_count>2</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2014-07-21 04:07:20 -0400</bug_when>
    <thetext>The following commit seems to have exposed some problem with the test case:

http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=e50fba8828c054207eb4f1a56a83880c9a1ebbc8

That said, at a quick glance, the type hierarchy seem to be missing the subtypes. The following is what it has when it passes (when individually run), but in the failing case, the subtypes section is empty.

Focus: X [in X.java [in p [in src [in TypeHierarchyNotification]]]]
Super types:
  B [in B.java [in b [in src [in TypeHierarchyNotification]]]]
    A [in A.java [in a [in src [in TypeHierarchyNotification]]]]
      Object [in Object.class [in java.lang [in C:\work\JDT\workspaces\jclMin1.5.jar]]]
  I1 [in I1.java [in i [in src [in TypeHierarchyNotification]]]]
Sub types:
  C [in C.java [in c [in src [in TypeHierarchyNotification]]]]
    D [in D.java [in d [in src [in TypeHierarchyNotification]]]]
  E [in E.java [in e [in src [in TypeHierarchyNotification]]]]
  Y [in Y.java [in p [in &lt;project root&gt; [in External]]]]</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2429699</commentid>
    <comment_count>3</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2014-07-21 06:43:09 -0400</bug_when>
    <thetext>The issue is the new test added as part of bug 436139 is affecting the failing test case. The test testBug436139 creates working copies without discarding and unfortunately the working copy has the same name as the affected test and hence the type hierarchy is messed up.

Fixed the test with this commit:

http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=275c7fa08c685a8339a1fd3b12a3792b07804a41</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2429894</commentid>
    <comment_count>4</comment_count>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2014-07-21 12:57:31 -0400</bug_when>
    <thetext>A better solution is to store the working copies in AbstractJavaModelTests#workingCopies, so that they can automatically (and safely) be discarded in the tearDown(). The solution from comment 3 would have required a null check in the finally to avoid hiding more interesting exceptions.

Fixed testBug436139 and testBug436155 with http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=a13ea647a4f4bc5437bbde0cf7788256ede6cc96</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2435634</commentid>
    <comment_count>5</comment_count>
    <who name="shankha banerjee">shankhba</who>
    <bug_when>2014-08-05 07:41:11 -0400</bug_when>
    <thetext>Verified for 4.5 M1 using I20140804-2000 build.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>