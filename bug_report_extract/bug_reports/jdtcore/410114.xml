<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>410114</bug_id>
          
          <creation_ts>2013-06-06 13:52:00 -0400</creation_ts>
          <short_desc>[1.8] CCE when trying to parse method reference expression with inappropriate type arguments</short_desc>
          <delta_ts>2013-07-08 11:27:09 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>4.3</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows 7</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>BETA J8</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Markus Keller">markus_keller</reporter>
          <assigned_to name="Jay Arthanareeswaran">jarthana</assigned_to>
          <cc>jarthana</cc>
    
    <cc>manpalat</cc>
    
    <cc>srikanth_sankaran</cc>
          
          <votes>0</votes>

      

      

      <flag name="review"
          id="58804"
          type_id="1"
          status="+"
          setter="srikanth_sankaran"
    />

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2269419</commentid>
    <comment_count>0</comment_count>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2013-06-06 13:52:36 -0400</bug_when>
    <thetext>BETA_JAVA8

CCE when trying to parse method reference expression with inappropriate type arguments:

//---------------------
package jsr335;

import java.io.Serializable;
import java.util.concurrent.Callable;

public class MethodReference {
    class Inner&lt;E&gt; {

    }

    void foo() {
        Callable&lt;Inner&lt;String&gt;&gt; fi = MethodReference.Inner::&lt;Serializable&gt; new;
    }
}
//---------------------

Note that the example doesn&apos;t make sense, and I didn&apos;t try to make it &quot;right&quot;. Similar exceptions happen when I remove the &lt;Serializable&gt; or add type arguments after MethodReference.Inner.


java.lang.ClassCastException: org.eclipse.jdt.internal.compiler.lookup.RawTypeBinding cannot be cast to org.eclipse.jdt.internal.compiler.lookup.NestedTypeBinding
	at org.eclipse.jdt.internal.compiler.ast.ReferenceExpression.generateCode(ReferenceExpression.java:119)
	at org.eclipse.jdt.internal.compiler.ast.LocalDeclaration.generateCode(LocalDeclaration.java:143)
	at org.eclipse.jdt.internal.compiler.ast.AbstractMethodDeclaration.generateCode(AbstractMethodDeclaration.java:304)
	at org.eclipse.jdt.internal.compiler.ast.AbstractMethodDeclaration.generateCode(AbstractMethodDeclaration.java:249)
	at org.eclipse.jdt.internal.compiler.ast.TypeDeclaration.generateCode(TypeDeclaration.java:566)
	at org.eclipse.jdt.internal.compiler.ast.TypeDeclaration.generateCode(TypeDeclaration.java:635)
	at org.eclipse.jdt.internal.compiler.ast.CompilationUnitDeclaration.generateCode(CompilationUnitDeclaration.java:367)
	at org.eclipse.jdt.core.dom.CompilationUnitResolver.resolve(CompilationUnitResolver.java:1213)
	at org.eclipse.jdt.core.dom.CompilationUnitResolver.resolve(CompilationUnitResolver.java:692)
	at org.eclipse.jdt.core.dom.ASTParser.internalCreateAST(ASTParser.java:1186)
	at org.eclipse.jdt.core.dom.ASTParser.createAST(ASTParser.java:812)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2269609</commentid>
    <comment_count>1</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2013-06-07 00:51:58 -0400</bug_when>
    <thetext>I&apos;ll grab this one as it is my code that is faulty.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2280498</commentid>
    <comment_count>2</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2013-07-04 02:00:42 -0400</bug_when>
    <thetext>See also https://bugs.eclipse.org/bugs/show_bug.cgi?id=412257</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2280525</commentid>
    <comment_count>3</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-07-04 03:50:40 -0400</bug_when>
    <thetext>*** Bug 412257 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2281482</commentid>
    <comment_count>4</comment_count>
      <attachid>233193</attachid>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-07-08 02:09:53 -0400</bug_when>
    <thetext>Created attachment 233193
Proposed fix + Test</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2281489</commentid>
    <comment_count>5</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2013-07-08 02:57:51 -0400</bug_when>
    <thetext>(In reply to comment #4)
&gt; Created attachment 233193 [details]
&gt; Proposed fix + Test

Patch looks good. Two changes requested:

(1) I think we should have a conform test that shows that
emitted code is correct and its behavior matches RI.

(2) Add a test from the duplicate.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2281724</commentid>
    <comment_count>6</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-07-08 11:27:09 -0400</bug_when>
    <thetext>(In reply to comment #5)
&gt; (In reply to comment #4)
&gt; &gt; Created attachment 233193 [details]
&gt; &gt; Proposed fix + Test
&gt; 
&gt; Patch looks good. Two changes requested:

Corrected and released the fix here:

http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?h=BETA_JAVA8&amp;id=39cfeabaf2630f8aaf01c3058d94b243711e01e5</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>233193</attachid>
            <date>2013-07-08 02:09:00 -0400</date>
            <delta_ts>2013-07-08 02:09:53 -0400</delta_ts>
            <desc>Proposed fix + Test</desc>
            <filename>Fix-for-bug-410114.patch</filename>
            <type>text/plain</type>
            <size>3316</size>
            <attacher name="Jay Arthanareeswaran">jarthana</attacher>
            
              <data encoding="base64">IyMjIEVjbGlwc2UgV29ya3NwYWNlIFBhdGNoIDEuMAojUCBvcmcuZWNsaXBzZS5qZHQuY29yZS50
ZXN0cy5jb21waWxlcgpkaWZmIC0tZ2l0IHNyYy9vcmcvZWNsaXBzZS9qZHQvY29yZS90ZXN0cy9j
b21waWxlci9yZWdyZXNzaW9uL05lZ2F0aXZlTGFtYmRhRXhwcmVzc2lvbnNUZXN0LmphdmEgc3Jj
L29yZy9lY2xpcHNlL2pkdC9jb3JlL3Rlc3RzL2NvbXBpbGVyL3JlZ3Jlc3Npb24vTmVnYXRpdmVM
YW1iZGFFeHByZXNzaW9uc1Rlc3QuamF2YQppbmRleCAwYjAwZjYyLi4yMThjYWY0IDEwMDY0NAot
LS0gc3JjL29yZy9lY2xpcHNlL2pkdC9jb3JlL3Rlc3RzL2NvbXBpbGVyL3JlZ3Jlc3Npb24vTmVn
YXRpdmVMYW1iZGFFeHByZXNzaW9uc1Rlc3QuamF2YQorKysgc3JjL29yZy9lY2xpcHNlL2pkdC9j
b3JlL3Rlc3RzL2NvbXBpbGVyL3JlZ3Jlc3Npb24vTmVnYXRpdmVMYW1iZGFFeHByZXNzaW9uc1Rl
c3QuamF2YQpAQCAtMjIsNCArMjIsNSBAQAogcGFja2FnZSBvcmcuZWNsaXBzZS5qZHQuY29yZS50
ZXN0cy5jb21waWxlci5yZWdyZXNzaW9uOwogCitpbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsK
IGltcG9ydCBqYXZhLnV0aWwuTWFwOwogCkBAIC02NjYzLDQgKzY2NjQsMzIgQEAKIAkpOwogfQor
Ly8gaHR0cHM6Ly9idWdzLmVjbGlwc2Uub3JnL2J1Z3Mvc2hvd19idWcuY2dpP2lkPTQxMDExNCwg
WzEuOF0gQ0NFIHdoZW4gdHJ5aW5nIHRvIHBhcnNlIG1ldGhvZCByZWZlcmVuY2UgZXhwcmVzc2lv
biB3aXRoIGluYXBwcm9wcmlhdGUgdHlwZSBhcmd1bWVudHMKK3B1YmxpYyB2b2lkIHRlc3Q0MTAx
MTQoKSB0aHJvd3MgSU9FeGNlcHRpb24geworCVN0cmluZyBzb3VyY2UgPSAiaW50ZXJmYWNlIEkg
e1xuIiArCisJCQkJCSIgICAgdm9pZCBmb28oWTxTdHJpbmc+IHkpO1xuIiArCisJCQkJCSJ9XG4i
ICsKKwkJCQkJInB1YmxpYyBjbGFzcyBZPFQ+IHtcbiIgKworCQkJCQkiICAgIGNsYXNzIFo8Sz4g
e1xuIiArCisJCQkJCSIgICAgICAgIFooWTxTdHJpbmc+IHkpIHtcbiIgKworCQkJCQkiICAgICAg
ICAgICAgU3lzdGVtLm91dC5wcmludGxuKFwiWTxUPi5aPEs+OjogbmV3XCIpO1xuIiArCisJCQkJ
CSIgICAgICAgIH1cbiIgKworCQkJCQkiICAgICAgICB2b2lkIGJhcigpIHtcbiIgKworCQkJCQki
ICAgICAgICAgICAgSSBpID0gWTxTdHJpbmc+Llo8SW50ZWdlcj46OjxTdHJpbmc+IG5ldztcbiIg
KworCQkJCQkiICAgICAgICAgICAgaS5mb28obmV3IFk8U3RyaW5nPigpKTtcbiIgKworCQkJCQki
ICAgICAgICAgICAgaSA9IFk8U3RyaW5nPi5aPEludGVnZXI+OjogbmV3O1xuIiArCisJCQkJCSIg
ICAgICAgICAgICBpLmZvbyhuZXcgWTxTdHJpbmc+KCkpO1xuIiArCisJCQkJCSIgICAgICAgIH1c
biIgKworCQkJCQkiICAgIH1cbiIgKworCQkJCQkifVxuIjsKKwl0aGlzLnJ1bk5lZ2F0aXZlVGVz
dCgKKwkJCW5ldyBTdHJpbmdbXXsiWS5qYXZhIiwKKwkJCQkJCXNvdXJjZX0sCisJCQkJCQkiLS0t
LS0tLS0tLVxuIiArIAorCQkJCQkJIjEuIFdBUk5JTkcgaW4gWS5qYXZhIChhdCBsaW5lIDEwKVxu
IiArIAorCQkJCQkJIglJIGkgPSBZPFN0cmluZz4uWjxJbnRlZ2VyPjo6PFN0cmluZz4gbmV3O1xu
IiArIAorCQkJCQkJIgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF5eXl5eXlxuIiArIAor
CQkJCQkJIlVudXNlZCB0eXBlIGFyZ3VtZW50cyBmb3IgdGhlIG5vbiBnZW5lcmljIGNvbnN0cnVj
dG9yIFk8U3RyaW5nPi5aPEludGVnZXI+KFk8U3RyaW5nPikgb2YgdHlwZSBZPFN0cmluZz4uWjxJ
bnRlZ2VyPjsgaXQgc2hvdWxkIG5vdCBiZSBwYXJhbWV0ZXJpemVkIHdpdGggYXJndW1lbnRzIDxT
dHJpbmc+XG4iICsgCisJCQkJCQkiLS0tLS0tLS0tLVxuIik7Cit9CiBwdWJsaWMgc3RhdGljIENs
YXNzIHRlc3RDbGFzcygpIHsKIAlyZXR1cm4gTmVnYXRpdmVMYW1iZGFFeHByZXNzaW9uc1Rlc3Qu
Y2xhc3M7CiNQIG9yZy5lY2xpcHNlLmpkdC5jb3JlCmRpZmYgLS1naXQgY29tcGlsZXIvb3JnL2Vj
bGlwc2UvamR0L2ludGVybmFsL2NvbXBpbGVyL2FzdC9SZWZlcmVuY2VFeHByZXNzaW9uLmphdmEg
Y29tcGlsZXIvb3JnL2VjbGlwc2UvamR0L2ludGVybmFsL2NvbXBpbGVyL2FzdC9SZWZlcmVuY2VF
eHByZXNzaW9uLmphdmEKaW5kZXggZWU0NjFlNi4uMWZkYWUwNyAxMDA2NDQKLS0tIGNvbXBpbGVy
L29yZy9lY2xpcHNlL2pkdC9pbnRlcm5hbC9jb21waWxlci9hc3QvUmVmZXJlbmNlRXhwcmVzc2lv
bi5qYXZhCisrKyBjb21waWxlci9vcmcvZWNsaXBzZS9qZHQvaW50ZXJuYWwvY29tcGlsZXIvYXN0
L1JlZmVyZW5jZUV4cHJlc3Npb24uamF2YQpAQCAtNDEsNCArNDEsNSBAQAogaW1wb3J0IG9yZy5l
Y2xpcHNlLmpkdC5pbnRlcm5hbC5jb21waWxlci5sb29rdXAuTWV0aG9kQmluZGluZzsKIGltcG9y
dCBvcmcuZWNsaXBzZS5qZHQuaW50ZXJuYWwuY29tcGlsZXIubG9va3VwLk5lc3RlZFR5cGVCaW5k
aW5nOworaW1wb3J0IG9yZy5lY2xpcHNlLmpkdC5pbnRlcm5hbC5jb21waWxlci5sb29rdXAuUGFy
YW1ldGVyaXplZFR5cGVCaW5kaW5nOwogaW1wb3J0IG9yZy5lY2xpcHNlLmpkdC5pbnRlcm5hbC5j
b21waWxlci5sb29rdXAuUG9seVR5cGVCaW5kaW5nOwogaW1wb3J0IG9yZy5lY2xpcHNlLmpkdC5p
bnRlcm5hbC5jb21waWxlci5sb29rdXAuUHJvYmxlbVJlYXNvbnM7CkBAIC0xMTcsNSArMTE4LDEw
IEBACiAJCQkJUmVmZXJlbmNlQmluZGluZ1tdIGVuY2xvc2luZ0luc3RhbmNlcyA9IEJpbmRpbmcu
VU5JTklUSUFMSVpFRF9SRUZFUkVOQ0VfVFlQRVM7CiAJCQkJaWYgKHRoaXMucmVjZWl2ZXJUeXBl
LmlzTmVzdGVkVHlwZSgpKSB7Ci0JCQkJCU5lc3RlZFR5cGVCaW5kaW5nIG5lc3RlZFR5cGUgPSAo
TmVzdGVkVHlwZUJpbmRpbmcpIHRoaXMucmVjZWl2ZXJUeXBlOworCQkJCQlOZXN0ZWRUeXBlQmlu
ZGluZyBuZXN0ZWRUeXBlID0gbnVsbDsKKwkJCQkJaWYgKHRoaXMucmVjZWl2ZXJUeXBlIGluc3Rh
bmNlb2YgUGFyYW1ldGVyaXplZFR5cGVCaW5kaW5nKSB7CisJCQkJCQluZXN0ZWRUeXBlID0gKE5l
c3RlZFR5cGVCaW5kaW5nKSgoUGFyYW1ldGVyaXplZFR5cGVCaW5kaW5nKSB0aGlzLnJlY2VpdmVy
VHlwZSkuZ2VuZXJpY1R5cGUoKTsKKwkJCQkJfSBlbHNlIHsKKwkJCQkJCW5lc3RlZFR5cGUgPSAo
TmVzdGVkVHlwZUJpbmRpbmcpIHRoaXMucmVjZWl2ZXJUeXBlOworCQkJCQl9CiAJCQkJCWlmICgo
ZW5jbG9zaW5nSW5zdGFuY2VzID0gbmVzdGVkVHlwZS5zeW50aGV0aWNFbmNsb3NpbmdJbnN0YW5j
ZVR5cGVzKCkpICE9IG51bGwpIHsKIAkJCQkJCWludCBsZW5ndGggPSBlbmNsb3NpbmdJbnN0YW5j
ZXMubGVuZ3RoOw==
</data>

          </attachment>
      

    </bug>

</bugzilla>