<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>341499</bug_id>
          
          <creation_ts>2011-03-31 11:05:00 -0400</creation_ts>
          <short_desc>[compiler][null] allocate extra bits in all methods of UnconditionalFlowInfo</short_desc>
          <delta_ts>2011-04-25 06:23:30 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>3.7</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>3.7 M7</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Stephan Herrmann">stephan.herrmann</reporter>
          <assigned_to name="Stephan Herrmann">stephan.herrmann</assigned_to>
          <cc>amj87.iitr</cc>
    
    <cc>Olivier_Thomann</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>1906607</commentid>
    <comment_count>0</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2011-03-31 11:05:11 -0400</bug_when>
    <thetext>The patch in bug 247564 contains a few fixes that are actually independent
of the issue of field references: currently some methods in 
UnconditionalFlowInfo fail to allocate the extra bits used for handling more
than 64 locals, namely:
  markAsDefinitelyNonNull
  markAsDefinitelyNull
  markAsDefinitelyUnknown

IMO these fixes should be released for 3.7.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1908409</commentid>
    <comment_count>1</comment_count>
    <who name="Olivier Thomann">Olivier_Thomann</who>
    <bug_when>2011-04-04 13:51:36 -0400</bug_when>
    <thetext>This makes sense.
Stephan, could you please prepare a patch for this ?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1909119</commentid>
    <comment_count>2</comment_count>
      <attachid>192598</attachid>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2011-04-05 16:31:11 -0400</bug_when>
    <thetext>Created attachment 192598
proposed patch

This is the part of the patch from bug 247564 that will make the
markAsDefinitely* methods safe wrt array allocation.

While trying to create tests for this I found that in the current
implementation the new blocks seem to be unreachable because for locals
assignment will always(?) be marked before null status. This is similar to
our findings in bug 333089 comment 10. As argued there this is, however,
a fragile contract. Additionally, null analysis for either fields (bug 247564)
or parameters (using annotations - bug 186342) will trigger the new sections.

So, although I cannot demonstrate that things are currently broken, I&apos;d still
like to release the patch now, OK?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1909259</commentid>
    <comment_count>3</comment_count>
    <who name="Ayushman Jain">amj87.iitr</who>
    <bug_when>2011-04-06 02:16:56 -0400</bug_when>
    <thetext>(In reply to comment #2)
&gt; So, although I cannot demonstrate that things are currently broken, I&apos;d still
&gt; like to release the patch now, OK?

If by this you mean you cannot extract a test case to demo that something got fixed with the patch, I guess its ok because the testing for fields done for bug 247564 will also be a test for this fix. So you can go ahead and release this.
Just to double check, is there any additional change apart from the ones already in patch for bug 247564?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1910061</commentid>
    <comment_count>4</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2011-04-07 06:12:46 -0400</bug_when>
    <thetext>(In reply to comment #3)
&gt; If by this you mean you cannot extract a test case to demo that something got
&gt; fixed with the patch, I guess its ok because the testing for fields done for
&gt; bug 247564 will also be a test for this fix.

Yes. Also one of the tests for null annotations now goes into that realm:
 http://dev.eclipse.org/viewcvs/viewvc.cgi/trunk/testplugins/org.eclipse.objectteams.jdt.nullity.tests/src/org/eclipse/objectteams/jdt/nullity/tests/NullAnnotationTest.java?root=TOOLS_OBJECTTEAMS&amp;revision=1421&amp;view=markup#l144
see test_nonnull_parameter_003(). This test throws NPE without the patch
and passes with it.

&gt; Just to double check, is there any additional change apart from the ones
&gt; already in patch for bug 247564?

No additional changes.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1910073</commentid>
    <comment_count>5</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2011-04-07 06:25:08 -0400</bug_when>
    <thetext>Released to HEAD for 3.7M7
Also released to BETA_JAVA7.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1918320</commentid>
    <comment_count>6</comment_count>
    <who name="Ayushman Jain">amj87.iitr</who>
    <bug_when>2011-04-25 06:23:30 -0400</bug_when>
    <thetext>Verified for 3.7M7 using code inspection</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>192598</attachid>
            <date>2011-04-05 16:31:00 -0400</date>
            <delta_ts>2011-04-05 16:31:11 -0400</delta_ts>
            <desc>proposed patch</desc>
            <filename>Bug_341499.patch</filename>
            <type>text/plain</type>
            <size>3448</size>
            <attacher name="Stephan Herrmann">stephan.herrmann</attacher>
            
              <data encoding="base64">IyMjIEVjbGlwc2UgV29ya3NwYWNlIFBhdGNoIDEuMAojUCBvcmcuZWNsaXBzZS5qZHQuY29yZQpJ
bmRleDogY29tcGlsZXIvb3JnL2VjbGlwc2UvamR0L2ludGVybmFsL2NvbXBpbGVyL2Zsb3cvVW5j
b25kaXRpb25hbEZsb3dJbmZvLmphdmEKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpSQ1MgZmlsZTogL2N2c3Jvb3QvZWNs
aXBzZS9vcmcuZWNsaXBzZS5qZHQuY29yZS9jb21waWxlci9vcmcvZWNsaXBzZS9qZHQvaW50ZXJu
YWwvY29tcGlsZXIvZmxvdy9VbmNvbmRpdGlvbmFsRmxvd0luZm8uamF2YSx2CnJldHJpZXZpbmcg
cmV2aXNpb24gMS43MwpkaWZmIC11IC1yMS43MyBVbmNvbmRpdGlvbmFsRmxvd0luZm8uamF2YQot
LS0gY29tcGlsZXIvb3JnL2VjbGlwc2UvamR0L2ludGVybmFsL2NvbXBpbGVyL2Zsb3cvVW5jb25k
aXRpb25hbEZsb3dJbmZvLmphdmEJNCBNYXIgMjAxMSAxMjo0MToyMSAtMDAwMAkxLjczCisrKyBj
b21waWxlci9vcmcvZWNsaXBzZS9qZHQvaW50ZXJuYWwvY29tcGlsZXIvZmxvdy9VbmNvbmRpdGlv
bmFsRmxvd0luZm8uamF2YQk1IEFwciAyMDExIDIwOjEzOjAzIC0wMDAwCkBAIC0xMjU4LDggKzEy
NTgsMjUgQEAKICAgICAJfQogICAgIAllbHNlIHsKICAgICAJCS8vIHVzZSBleHRyYSB2ZWN0b3IK
LSAgICAJCWludCB2ZWN0b3JJbmRleCA7Ci0gICAgCQl0aGlzLmV4dHJhWzJdW3ZlY3RvckluZGV4
ID0gKHBvc2l0aW9uIC8gQml0Q2FjaGVTaXplKSAtIDFdCisgICAgCQlpbnQgdmVjdG9ySW5kZXgg
PSAocG9zaXRpb24gLyBCaXRDYWNoZVNpemUpIC0gMTsKKyAgICAJCWlmICh0aGlzLmV4dHJhID09
IG51bGwpIHsKKyAgICAJCQlpbnQgbGVuZ3RoID0gdmVjdG9ySW5kZXggKyAxOworICAgIAkJCXRo
aXMuZXh0cmEgPSBuZXcgbG9uZ1tleHRyYUxlbmd0aF1bXTsKKyAgICAJCQlmb3IgKGludCBqID0g
MDsgaiA8IGV4dHJhTGVuZ3RoOyBqKyspIHsKKyAgICAJCQkJdGhpcy5leHRyYVtqXSA9IG5ldyBs
b25nW2xlbmd0aF07CisgICAgCQkJfQorICAgIAkJfQorICAgIAkJZWxzZSB7CisgICAgCQkJaW50
IG9sZExlbmd0aDsgLy8gbWlnaHQgbmVlZCB0byBncm93IHRoZSBhcnJheXMKKyAgICAJCQlpZiAo
dmVjdG9ySW5kZXggPj0gKG9sZExlbmd0aCA9IHRoaXMuZXh0cmFbMF0ubGVuZ3RoKSkgeworICAg
IAkJCQlmb3IgKGludCBqID0gMDsgaiA8IGV4dHJhTGVuZ3RoOyBqKyspIHsKKyAgICAJCQkJCVN5
c3RlbS5hcnJheWNvcHkodGhpcy5leHRyYVtqXSwgMCwKKyAgICAJCQkJCQkodGhpcy5leHRyYVtq
XSA9IG5ldyBsb25nW3ZlY3RvckluZGV4ICsgMV0pLCAwLAorICAgIAkJCQkJCW9sZExlbmd0aCk7
CisgICAgCQkJCX0KKyAgICAJCQl9CisgICAgCQl9CisgICAgCQl0aGlzLmV4dHJhWzJdW3ZlY3Rv
ckluZGV4XQogICAgIAkJICAgIHw9IChtYXNrID0gMUwgPDwgKHBvc2l0aW9uICUgQml0Q2FjaGVT
aXplKSk7CiAgICAgCQl0aGlzLmV4dHJhWzRdW3ZlY3RvckluZGV4XSB8PSBtYXNrOwogICAgIAkJ
dGhpcy5leHRyYVszXVt2ZWN0b3JJbmRleF0gJj0gKG1hc2sgPSB+bWFzayk7CkBAIC0xMjk1LDgg
KzEzMTIsMjUgQEAKICAgICAJfQogICAgIAllbHNlIHsKICAgICAJCS8vIHVzZSBleHRyYSB2ZWN0
b3IKLSAgICAJCWludCB2ZWN0b3JJbmRleCA7Ci0gICAgCQl0aGlzLmV4dHJhWzJdW3ZlY3Rvcklu
ZGV4ID0gKHBvc2l0aW9uIC8gQml0Q2FjaGVTaXplKSAtIDFdCisgICAgCQlpbnQgdmVjdG9ySW5k
ZXggPSAocG9zaXRpb24gLyBCaXRDYWNoZVNpemUpIC0gMTsKKyAgICAJCWlmICh0aGlzLmV4dHJh
ID09IG51bGwpIHsKKyAgICAJCQlpbnQgbGVuZ3RoID0gdmVjdG9ySW5kZXggKyAxOworICAgIAkJ
CXRoaXMuZXh0cmEgPSBuZXcgbG9uZ1tleHRyYUxlbmd0aF1bXTsKKyAgICAJCQlmb3IgKGludCBq
ID0gMDsgaiA8IGV4dHJhTGVuZ3RoOyBqKyspIHsKKyAgICAJCQkJdGhpcy5leHRyYVtqXSA9IG5l
dyBsb25nW2xlbmd0aF07CisgICAgCQkJfQorICAgIAkJfQorICAgIAkJZWxzZSB7CisgICAgCQkJ
aW50IG9sZExlbmd0aDsgLy8gbWlnaHQgbmVlZCB0byBncm93IHRoZSBhcnJheXMKKyAgICAJCQlp
ZiAodmVjdG9ySW5kZXggPj0gKG9sZExlbmd0aCA9IHRoaXMuZXh0cmFbMF0ubGVuZ3RoKSkgewor
ICAgIAkJCQlmb3IgKGludCBqID0gMDsgaiA8IGV4dHJhTGVuZ3RoOyBqKyspIHsKKyAgICAJCQkJ
CVN5c3RlbS5hcnJheWNvcHkodGhpcy5leHRyYVtqXSwgMCwKKyAgICAJCQkJCQkodGhpcy5leHRy
YVtqXSA9IG5ldyBsb25nW3ZlY3RvckluZGV4ICsgMV0pLCAwLAorICAgIAkJCQkJCW9sZExlbmd0
aCk7CisgICAgCQkJCX0KKyAgICAJCQl9CisgICAgCQl9CisgICAgCQl0aGlzLmV4dHJhWzJdW3Zl
Y3RvckluZGV4XQogICAgIAkJICAgIHw9IChtYXNrID0gMUwgPDwgKHBvc2l0aW9uICUgQml0Q2Fj
aGVTaXplKSk7CiAgICAgCQl0aGlzLmV4dHJhWzNdW3ZlY3RvckluZGV4XSB8PSBtYXNrOwogICAg
IAkJdGhpcy5leHRyYVs0XVt2ZWN0b3JJbmRleF0gJj0gKG1hc2sgPSB+bWFzayk7CkBAIC0xMzM5
LDggKzEzNzMsMjUgQEAKIAkJfQogCQllbHNlIHsKIAkJCS8vIHVzZSBleHRyYSB2ZWN0b3IKLQkJ
CWludCB2ZWN0b3JJbmRleCA7Ci0JCQl0aGlzLmV4dHJhWzJdW3ZlY3RvckluZGV4ID0gKHBvc2l0
aW9uIC8gQml0Q2FjaGVTaXplKSAtIDFdCisJCQlpbnQgdmVjdG9ySW5kZXggPSAocG9zaXRpb24g
LyBCaXRDYWNoZVNpemUpIC0gMTsKKwkJCWlmICh0aGlzLmV4dHJhID09IG51bGwpIHsKKwkJCQlp
bnQgbGVuZ3RoID0gdmVjdG9ySW5kZXggKyAxOworCQkJCXRoaXMuZXh0cmEgPSBuZXcgbG9uZ1tl
eHRyYUxlbmd0aF1bXTsKKwkJCQlmb3IgKGludCBqID0gMDsgaiA8IGV4dHJhTGVuZ3RoOyBqKysp
IHsKKwkJCQkJdGhpcy5leHRyYVtqXSA9IG5ldyBsb25nW2xlbmd0aF07CisJCQkJfQorCQkJfQor
CQkJZWxzZSB7CisJCQkJaW50IG9sZExlbmd0aDsgLy8gbWlnaHQgbmVlZCB0byBncm93IHRoZSBh
cnJheXMKKwkJCQlpZiAodmVjdG9ySW5kZXggPj0gKG9sZExlbmd0aCA9IHRoaXMuZXh0cmFbMF0u
bGVuZ3RoKSkgeworCQkJCQlmb3IgKGludCBqID0gMDsgaiA8IGV4dHJhTGVuZ3RoOyBqKyspIHsK
KwkJCQkJCVN5c3RlbS5hcnJheWNvcHkodGhpcy5leHRyYVtqXSwgMCwKKwkJCQkJCQkodGhpcy5l
eHRyYVtqXSA9IG5ldyBsb25nW3ZlY3RvckluZGV4ICsgMV0pLCAwLAorCQkJCQkJCW9sZExlbmd0
aCk7CisJCQkJCX0KKwkJCQl9CisJCQl9CisJCQl0aGlzLmV4dHJhWzJdW3ZlY3RvckluZGV4XQog
CQkJICAgIHw9IChtYXNrID0gMUwgPDwgKHBvc2l0aW9uICUgQml0Q2FjaGVTaXplKSk7CiAJCQl0
aGlzLmV4dHJhWzVdW3ZlY3RvckluZGV4XSB8PSBtYXNrOwogCQkJdGhpcy5leHRyYVszXVt2ZWN0
b3JJbmRleF0gJj0gKG1hc2sgPSB+bWFzayk7Cg==
</data>

          </attachment>
      

    </bug>

</bugzilla>