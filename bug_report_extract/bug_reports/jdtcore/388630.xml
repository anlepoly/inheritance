<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>388630</bug_id>
          
          <creation_ts>2012-09-02 15:44:00 -0400</creation_ts>
          <short_desc>@NonNull diagnostics at line 0</short_desc>
          <delta_ts>2012-09-17 10:48:38 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>3.8</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows Vista</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>4.3 M2</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ed Willink">ed</reporter>
          <assigned_to name="Stephan Herrmann">stephan.herrmann</assigned_to>
          <cc>srikanth_sankaran</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2155272</commentid>
    <comment_count>0</comment_count>
    <who name="Ed Willink">ed</who>
    <bug_when>2012-09-02 15:44:02 -0400</bug_when>
    <thetext>In the org.eclipse.ocl GIT the

examples\org.eclipse.ocl.examples.xtext.base\src\org\eclipse\ocl\examples\xtext\base\cs2pivot\BasePostOrderVisitor.java

file reports two messages such as

Null type safety: The expression of type CS2PivotConversion needs unchecked conversion to conform to &apos;@NonNull CS2PivotConversion&apos;

at line 1, column 1 to 1 rather tjan wherever a true problem might exist.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2155335</commentid>
    <comment_count>1</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2012-09-02 23:37:18 -0400</bug_when>
    <thetext>Stephan, Thanks for following up.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2155553</commentid>
    <comment_count>2</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2012-09-03 19:00:53 -0400</bug_when>
    <thetext>Thanks for the report, here&apos;s a minimal test case:

import org.eclipse.jdt.annotation.NonNull;
public class C0 {
	C0 (@NonNull Object o) { }
	void test() { }
}

public class X {
	void foo() {
		new C0(&quot;&quot;) { }.test();
	}
}

The error occurs at the synthetic constructor of the anonymous class in foo().
It is caused by the lack of null annotations in this ctor which means that the super call thinks it&apos;s passing unannotated to @NonNull. The bad location is caused by synthetic AST that doesn&apos;t have any source locations.

It seems we have to repeat null annotations in the signature of this synthetic constructor.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2155560</commentid>
    <comment_count>3</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2012-09-03 19:48:09 -0400</bug_when>
    <thetext>I have a simple patch in testing.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2155583</commentid>
    <comment_count>4</comment_count>
    <who name="Ed Willink">ed</who>
    <bug_when>2012-09-04 01:20:19 -0400</bug_when>
    <thetext>Thanks, and the simple workaround is to convert the Anonymous class to a nested class where the warnings can be fixed.

Howeverm, if you use the convert anonymous class to nested refactoring on my original class, you find it does a shocking job.

a) the template lower bound on nthe first parameter is omitted.
b) the second template parameter is omitted.

there are three @NonNull warnings; two from the synthesis as identified and ...

(In reply to comment #2)
&gt; It seems we have to repeat null annotations in the signature of this
&gt; synthetic constructor.

You also need to provide @NonNull annotations on the synthetic fields.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2157068</commentid>
    <comment_count>5</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2012-09-06 15:35:53 -0400</bug_when>
    <thetext>Fix has been released for 4.3 M2 via commit 92e572400d76e87cd8a411b61ccd6995a99fb8ae

If you feel that the refactoring needs fixing please file a bug against JDT/UI.
thanks.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2160757</commentid>
    <comment_count>6</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2012-09-17 10:48:38 -0400</bug_when>
    <thetext>Verified for 4.3 M2 using Build id: I20120916-2000</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>