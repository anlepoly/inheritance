<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>394718</bug_id>
          
          <creation_ts>2012-11-20 18:43:00 -0500</creation_ts>
          <short_desc>VerifyError: Inconsistent stackmap frames</short_desc>
          <delta_ts>2013-01-10 05:10:04 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>3.8.1</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows 7</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>3.8.2</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Daniel Mould">skyewire</reporter>
          <assigned_to name="Jay Arthanareeswaran">jarthana</assigned_to>
          <cc>jarthana</cc>
    
    <cc>manpalat</cc>
    
    <cc>Olivier_Thomann</cc>
    
    <cc>srikanth_sankaran</cc>
    
    <cc>stephan.herrmann</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2185872</commentid>
    <comment_count>0</comment_count>
      <attachid>223777</attachid>
    <who name="Daniel Mould">skyewire</who>
    <bug_when>2012-11-20 18:43:25 -0500</bug_when>
    <thetext>Created attachment 223777
Sample program to reproduce VerifyError

If the attached program is compiled with Eclipse, running it results in the following error:

Exception in thread &quot;main&quot; java.lang.VerifyError: Inconsistent stackmap frames at branch target 46 in method VerifyErrorTest.test()Ljava/lang/Boolean; at offset 2

I originally encountered the problem in some fairly complicated production code, and managed to narrow the problem down to the simple test case that is attached. Additional information:

- The program runs fine if compiled with Oracle&apos;s javac.
- The program runs fine if the return type of the method is changed from &quot;Boolean&quot; to &quot;boolean&quot;.

Environment:

OS: Windows 7 64-bit
Java: Oracle Java 1.7.0_09 32-bit
Eclipse version: Juno SR1
JDT version: 3.8.1.v20120814-104540-8-8nFqpFNOfwKDRVz-tXOcL5d_83</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2185891</commentid>
    <comment_count>1</comment_count>
    <who name="Olivier Thomann">Olivier_Thomann</who>
    <bug_when>2012-11-20 20:37:46 -0500</bug_when>
    <thetext>The problem seems to come from the fact that the return false; statements shares the subroutines when there is an additional variable used to store the boxing value.
I believe in this case, we don&apos;t want to share the subroutines. Doing so fixes this issue.
Srikanth, there might be a clever way to do it, but I don&apos;t think this is worth the effort.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2185893</commentid>
    <comment_count>2</comment_count>
      <attachid>223779</attachid>
    <who name="Olivier Thomann">Olivier_Thomann</who>
    <bug_when>2012-11-20 20:44:16 -0500</bug_when>
    <thetext>Created attachment 223779
Proposed fix</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2185894</commentid>
    <comment_count>3</comment_count>
      <attachid>223780</attachid>
    <who name="Olivier Thomann">Olivier_Thomann</who>
    <bug_when>2012-11-20 20:44:29 -0500</bug_when>
    <thetext>Created attachment 223780
Regression test</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2185895</commentid>
    <comment_count>4</comment_count>
    <who name="Olivier Thomann">Olivier_Thomann</who>
    <bug_when>2012-11-20 20:45:02 -0500</bug_when>
    <thetext>Srikanth, if you approve the fix, I think it is a good candidate for backporting.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2185920</commentid>
    <comment_count>5</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2012-11-21 01:41:12 -0500</bug_when>
    <thetext>The fix looks non-controversial to me. Jay, please take it forward please,TIA.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2186092</commentid>
    <comment_count>6</comment_count>
    <who name="Olivier Thomann">Olivier_Thomann</who>
    <bug_when>2012-11-21 07:41:51 -0500</bug_when>
    <thetext>Daniel, thanks for the test case. It was very helpful to fix it. Once this is realeased, could you please give it a try on your more complex code?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2186371</commentid>
    <comment_count>7</comment_count>
    <who name="Daniel Mould">skyewire</who>
    <bug_when>2012-11-21 14:55:52 -0500</bug_when>
    <thetext>(In reply to comment #6)
&gt; Daniel, thanks for the test case. It was very helpful to fix it. Once this
&gt; is realeased, could you please give it a try on your more complex code?

Hi Olivier, sure, will do.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2186720</commentid>
    <comment_count>8</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2012-11-22 11:20:45 -0500</bug_when>
    <thetext>All tests pass. Released in master and R3_8_maintenance.

Thanks for the patch, Olivier!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2192881</commentid>
    <comment_count>9</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2012-12-11 05:05:41 -0500</bug_when>
    <thetext>Verified for 4.3 M4 using build I20121210-2000.

Leaving bug status at resolved for verification against 3.8.2.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2201043</commentid>
    <comment_count>10</comment_count>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2013-01-10 04:44:26 -0500</bug_when>
    <thetext>Verified for 4.2.2 M20130109-1200</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="0"
              isprivate="0"
          >
            <attachid>223777</attachid>
            <date>2012-11-20 18:43:00 -0500</date>
            <delta_ts>2012-11-20 18:43:25 -0500</delta_ts>
            <desc>Sample program to reproduce VerifyError</desc>
            <filename>file_394718.txt</filename>
            <type>text/plain</type>
            <size>505</size>
            <attacher name="Daniel Mould">skyewire</attacher>
            
              <data encoding="base64">cHVibGljIGNsYXNzIFZlcmlmeUVycm9yVGVzdA0Kew0KCXB1YmxpYyBzdGF0aWMgQm9vbGVhbiB0
ZXN0KCkgdGhyb3dzIEV4Y2VwdGlvbg0KCXsNCgkJdHJ5DQoJCXsNCgkJCWZvciAoaW50IGkgPSAw
OyBpIDwgMTsgaSsrKQ0KCQkJew0KCQkJCWxvbmcgc3RhdHVzID0gU3lzdGVtLmN1cnJlbnRUaW1l
TWlsbGlzKCk7DQoJCQkJaWYgKHN0YXR1cyA8IDApDQoJCQkJCXJldHVybiBmYWxzZTsNCgkJCQlp
ZiAoc3RhdHVzID09IDEpDQoJCQkJCXJldHVybiBmYWxzZTsNCgkJCX0NCgkJCQ0KCQkJcmV0dXJu
IGZhbHNlOw0KCQl9DQoJCWZpbmFsbHkNCgkJew0KCQkJU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlz
KCk7DQoJCX0NCgl9DQoJDQoJcHVibGljIHN0YXRpYyB2b2lkIG1haW4oU3RyaW5nW10gYXJncykg
dGhyb3dzIEV4Y2VwdGlvbg0KCXsNCgkJU3lzdGVtLm91dC5wcmludGxuKCJTdGFydGluZyIpOw0K
CQl0ZXN0KCk7DQoJCVN5c3RlbS5vdXQucHJpbnRsbigiRG9uZSIpOw0KCX0NCn0NCg==
</data>

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>223779</attachid>
            <date>2012-11-20 20:44:00 -0500</date>
            <delta_ts>2012-11-20 20:44:16 -0500</delta_ts>
            <desc>Proposed fix</desc>
            <filename>patch_394718.txt</filename>
            <type>text/plain</type>
            <size>691</size>
            <attacher name="Olivier Thomann">Olivier_Thomann</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlL2NvbXBpbGVyL29yZy9lY2xpcHNlL2pk
dC9pbnRlcm5hbC9jb21waWxlci9hc3QvRXhwcmVzc2lvbi5qYXZhIGIvb3JnLmVjbGlwc2UuamR0
LmNvcmUvY29tcGlsZXIvb3JnL2VjbGlwc2UvamR0L2ludGVybmFsL2NvbXBpbGVyL2FzdC9FeHBy
ZXNzaW9uLmphdmEKaW5kZXggNDFmM2I5Zi4uYWI5YTMwNiAxMDA2NDQKLS0tIGEvb3JnLmVjbGlw
c2UuamR0LmNvcmUvY29tcGlsZXIvb3JnL2VjbGlwc2UvamR0L2ludGVybmFsL2NvbXBpbGVyL2Fz
dC9FeHByZXNzaW9uLmphdmEKKysrIGIvb3JnLmVjbGlwc2UuamR0LmNvcmUvY29tcGlsZXIvb3Jn
L2VjbGlwc2UvamR0L2ludGVybmFsL2NvbXBpbGVyL2FzdC9FeHByZXNzaW9uLmphdmEKQEAgLTEw
NTIsOCArMTA1Miw5IEBACiAgKiBvciA8Y29kZT5udWxsPC9udWxsPiBpZiBub3QgcmV1c2FibGUK
ICAqLwogcHVibGljIE9iamVjdCByZXVzYWJsZUpTUlRhcmdldCgpIHsKLQlpZiAodGhpcy5jb25z
dGFudCAhPSBDb25zdGFudC5Ob3RBQ29uc3RhbnQpCisJaWYgKHRoaXMuY29uc3RhbnQgIT0gQ29u
c3RhbnQuTm90QUNvbnN0YW50ICYmICh0aGlzLmltcGxpY2l0Q29udmVyc2lvbiAmIFR5cGVJZHMu
Qk9YSU5HKSA9PSAwKSB7CiAJCXJldHVybiB0aGlzLmNvbnN0YW50OworCX0KIAlyZXR1cm4gbnVs
bDsKIH0KIA==
</data>

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>223780</attachid>
            <date>2012-11-20 20:44:00 -0500</date>
            <delta_ts>2012-11-20 20:44:29 -0500</delta_ts>
            <desc>Regression test</desc>
            <filename>patch_394718_tests.txt</filename>
            <type>text/plain</type>
            <size>1988</size>
            <attacher name="Olivier Thomann">Olivier_Thomann</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLmNvbXBpbGVyL3NyYy9vcmcv
ZWNsaXBzZS9qZHQvY29yZS90ZXN0cy9jb21waWxlci9yZWdyZXNzaW9uL1N0YWNrTWFwQXR0cmli
dXRlVGVzdC5qYXZhIGIvb3JnLmVjbGlwc2UuamR0LmNvcmUudGVzdHMuY29tcGlsZXIvc3JjL29y
Zy9lY2xpcHNlL2pkdC9jb3JlL3Rlc3RzL2NvbXBpbGVyL3JlZ3Jlc3Npb24vU3RhY2tNYXBBdHRy
aWJ1dGVUZXN0LmphdmEKaW5kZXggNWUzN2I2Zi4uM2FkNmE0MiAxMDA2NDQKLS0tIGEvb3JnLmVj
bGlwc2UuamR0LmNvcmUudGVzdHMuY29tcGlsZXIvc3JjL29yZy9lY2xpcHNlL2pkdC9jb3JlL3Rl
c3RzL2NvbXBpbGVyL3JlZ3Jlc3Npb24vU3RhY2tNYXBBdHRyaWJ1dGVUZXN0LmphdmEKKysrIGIv
b3JnLmVjbGlwc2UuamR0LmNvcmUudGVzdHMuY29tcGlsZXIvc3JjL29yZy9lY2xpcHNlL2pkdC9j
b3JlL3Rlc3RzL2NvbXBpbGVyL3JlZ3Jlc3Npb24vU3RhY2tNYXBBdHRyaWJ1dGVUZXN0LmphdmEK
QEAgLTM0LDcgKzM0LDcgQEAKIAkvLyBBbGwgc3BlY2lmaWVkIHRlc3RzIHdoaWNoIGRvZXMgbm90
IGJlbG9uZyB0byB0aGUgY2xhc3MgYXJlIHNraXBwZWQuLi4KIAlzdGF0aWMgewogLy8JCVRFU1RT
X1BSRUZJWCA9ICJ0ZXN0QnVnOTU1MjEiOwotLy8JCVRFU1RTX05BTUVTID0gbmV3IFN0cmluZ1td
IHsgInRlc3RCdWczODAzMTMiIH07CisvLwkJVEVTVFNfTkFNRVMgPSBuZXcgU3RyaW5nW10geyAi
dGVzdDM5NDcxOCIgfTsKIC8vCQlURVNUU19OVU1CRVJTID0gbmV3IGludFtdIHsgNTMgfTsKIC8v
CQlURVNUU19SQU5HRSA9IG5ldyBpbnRbXSB7IDIzIC0xLH07CiAJfQpAQCAtODE2MSw0ICs4MTYx
LDQyIEBACiAJCQlhc3NlcnRFcXVhbHMoIldyb25nIGNvbnRlbnRzIiwgZXhwZWN0ZWRPdXRwdXQs
IGFjdHVhbE91dHB1dCk7CiAJCX0KIAl9CisJLy8gZnJvbSBodHRwczovL2J1Z3MuZWNsaXBzZS5v
cmcvYnVncy9zaG93X2J1Zy5jZ2k/aWQ9Mzk0NzE4CisJcHVibGljIHZvaWQgdGVzdDM5NDcxOCgp
IHRocm93cyBFeGNlcHRpb24geworCQl0aGlzLnJ1bkNvbmZvcm1UZXN0KAorCQkJbmV3IFN0cmlu
Z1tdIHsKKwkJCQkJIlguamF2YSIsCisJCQkJCSJwdWJsaWMgY2xhc3MgWFxuIiArIAorCQkJCQki
e1xuIiArIAorCQkJCQkiCXB1YmxpYyBzdGF0aWMgQm9vbGVhbiB0ZXN0KCkgdGhyb3dzIEV4Y2Vw
dGlvblxuIiArIAorCQkJCQkiCXtcbiIgKyAKKwkJCQkJIgkJdHJ5XG4iICsgCisJCQkJCSIJCXtc
biIgKyAKKwkJCQkJIgkJCWZvciAoaW50IGkgPSAwOyBpIDwgMTsgaSsrKVxuIiArIAorCQkJCQki
CQkJe1xuIiArIAorCQkJCQkiCQkJCWxvbmcgc3RhdHVzID0gU3lzdGVtLmN1cnJlbnRUaW1lTWls
bGlzKCk7XG4iICsgCisJCQkJCSIJCQkJaWYgKHN0YXR1cyA8IDApXG4iICsgCisJCQkJCSIJCQkJ
CXJldHVybiBmYWxzZTtcbiIgKyAKKwkJCQkJIgkJCQlpZiAoc3RhdHVzID09IDEpXG4iICsgCisJ
CQkJCSIJCQkJCXJldHVybiBmYWxzZTtcbiIgKyAKKwkJCQkJIgkJCX1cbiIgKyAKKwkJCQkJIgkJ
CVxuIiArIAorCQkJCQkiCQkJcmV0dXJuIGZhbHNlO1xuIiArIAorCQkJCQkiCQl9XG4iICsgCisJ
CQkJCSIJCWZpbmFsbHlcbiIgKyAKKwkJCQkJIgkJe1xuIiArIAorCQkJCQkiCQkJU3lzdGVtLmN1
cnJlbnRUaW1lTWlsbGlzKCk7XG4iICsgCisJCQkJCSIJCX1cbiIgKyAKKwkJCQkJIgl9XG4iICsg
CisJCQkJCSIJXG4iICsgCisJCQkJCSIJcHVibGljIHN0YXRpYyB2b2lkIG1haW4oU3RyaW5nW10g
YXJncykgdGhyb3dzIEV4Y2VwdGlvblxuIiArIAorCQkJCQkiCXtcbiIgKyAKKwkJCQkJIgkJU3lz
dGVtLm91dC5wcmludChcIlN0YXJ0aW5nXCIpO1xuIiArIAorCQkJCQkiCQl0ZXN0KCk7XG4iICsg
CisJCQkJCSIJCVN5c3RlbS5vdXQucHJpbnRsbihcIkRvbmVcIik7XG4iICsgCisJCQkJCSIJfVxu
IiArIAorCQkJCQkifSIKKwkJCX0sCisJCQkiU3RhcnRpbmdEb25lIik7CisJfQkKIH0=
</data>

          </attachment>
      

    </bug>

</bugzilla>