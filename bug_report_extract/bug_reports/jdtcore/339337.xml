<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>339337</bug_id>
          
          <creation_ts>2011-03-09 06:41:00 -0500</creation_ts>
          <short_desc>isLocal() in IType returns true for anonymous types</short_desc>
          <delta_ts>2011-04-26 10:04:57 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>3.7</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>3.7 M7</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Andreas Thies">andreas.thies</reporter>
          <assigned_to name="Jay Arthanareeswaran">jarthana</assigned_to>
          <cc>amj87.iitr</cc>
    
    <cc>markus_keller</cc>
    
    <cc>Olivier_Thomann</cc>
          
          <votes>0</votes>

      

      

      <flag name="review"
          id="39890"
          type_id="1"
          status="+"
          setter="markus_keller"
    />

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>1895611</commentid>
    <comment_count>0</comment_count>
    <who name="Andreas Thies">andreas.thies</who>
    <bug_when>2011-03-09 06:41:03 -0500</bug_when>
    <thetext>Build Identifier: M20100909-0800

The Java Language Specification states that &quot;A local class is a nested class (...) that is not a member of any class and that has a name.&quot; (14.3)

Therefore IType.isLocal() should always return false for anonymous classes (because they do not have a name). But in fact, it might happen, that IType.isLocal() returns true for anonymous types.

Reproducible: Always

Steps to Reproduce:
1. Generate a Java project named &quot;TestProject&quot; and a Java package named testpackage and a java class file containing the following class
&quot;class A {static void m() {Object o = new Object(){};}}&quot;

2. Run the following code within an Eclipse plugin
IType type = (IType) JavaCore.create(&quot;=TestProject/&lt;testpackage{A.java[A~m[&quot;);
Assert.assertTrue(type.exists());        // green
Assert.assertTrue(type.isAnonymous());   // green
Assert.assertFalse(type.isLocal());      // fail</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1896281</commentid>
    <comment_count>1</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2011-03-10 00:46:54 -0500</bug_when>
    <thetext>Interestingly, IType#isLocal() returns true for the given test only in the case of source types. Looks like the binary types already handle this case well - look at ClassFileReader#isLocal()</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1896423</commentid>
    <comment_count>2</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2011-03-10 06:20:29 -0500</bug_when>
    <thetext>A fix here will break the fix made to bug #85298. Now I am beginning to wonder about the relevance between IType#isLocal and JLS 14.3. 

Markus/Olivier what do you think?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1896573</commentid>
    <comment_count>3</comment_count>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2011-03-10 09:47:56 -0500</bug_when>
    <thetext>I agree that we&apos;re not consistent with the JLS here, but it&apos;s too late for a breaking API change like this. The only thing we can do is document the mismatch.

The prime definition of JDT&apos;s view of the Java type system is in ITypeBinding. There, isLocal() is explicitly specified like this:

 * A local class is any nested class or enum type not declared as a member
 * of another class or interface. A local class is a subspecies of nested
 * type, and mutually exclusive with member types. Note that anonymous
 * classes are a subspecies of local classes.

Since we can&apos;t just change ITypeBinding#isLocal() now and since ITypeBinding and IType should stay in sync, nothing should be changed in code.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1896582</commentid>
    <comment_count>4</comment_count>
    <who name="Olivier Thomann">Olivier_Thomann</who>
    <bug_when>2011-03-10 09:53:27 -0500</bug_when>
    <thetext>(In reply to comment #3)
&gt; Since we can&apos;t just change ITypeBinding#isLocal() now and since ITypeBinding
&gt; and IType should stay in sync, nothing should be changed in code.
I agree. The only thing we can do is improve the doc to make it clear what isLocal() is returning for anonymous class.
So Jay, please propose an improvement for the javadoc of the method:
org.eclipse.jdt.core.IType#isLocal(). This is the best we can do.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1896589</commentid>
    <comment_count>5</comment_count>
    <who name="Andreas Thies">andreas.thies</who>
    <bug_when>2011-03-10 10:01:39 -0500</bug_when>
    <thetext>(In reply to comment #3)
&gt; The only thing we can do is document the mismatch.

From a client&apos;s perspective that would be enough. A workaround is pretty simple (just check IType#isAnonymous); the only damage for me resulted from the unexpected behavior.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1896758</commentid>
    <comment_count>6</comment_count>
      <attachid>190889</attachid>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2011-03-10 13:03:46 -0500</bug_when>
    <thetext>Created attachment 190889
Proposed patch

Patch with updated javadoc for IType#isLocal()</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1896782</commentid>
    <comment_count>7</comment_count>
    <who name="Olivier Thomann">Olivier_Thomann</who>
    <bug_when>2011-03-10 13:30:04 -0500</bug_when>
    <thetext>Looks good enough to me.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1897276</commentid>
    <comment_count>8</comment_count>
      <attachid>190889</attachid>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2011-03-11 06:24:57 -0500</bug_when>
    <thetext>Comment on attachment 190889
Proposed patch

(In reply to comment #6)
&gt; Created attachment 190889 [details] [diff]

The note is unclear. &quot;As per ...&quot; sounds like we follow the spec. But since we don&apos;t, this should be stated explicitly (&quot;Note: This deviates from JLS3 14.3...&quot;). Furthermore, it&apos;s confusing that you use differing terms &quot;anonymous type&quot; and &quot;anonymous inner classes&quot; for the same thing.

And please also update ITypeBinding#isLocal().</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1898072</commentid>
    <comment_count>9</comment_count>
      <attachid>191080</attachid>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2011-03-14 01:41:19 -0400</bug_when>
    <thetext>Created attachment 191080
Updated patch

Javadoc updated as according to Markus&apos; comments.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1898456</commentid>
    <comment_count>10</comment_count>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2011-03-14 12:31:51 -0400</bug_when>
    <thetext>Perfect, thx.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1899695</commentid>
    <comment_count>11</comment_count>
    <who name="Olivier Thomann">Olivier_Thomann</who>
    <bug_when>2011-03-16 09:57:44 -0400</bug_when>
    <thetext>Closing since this has been released.
Released for 3.7M7.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1919008</commentid>
    <comment_count>12</comment_count>
    <who name="Olivier Thomann">Olivier_Thomann</who>
    <bug_when>2011-04-26 10:04:57 -0400</bug_when>
    <thetext>Verified.</thetext>
  </long_desc>
      
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>190889</attachid>
            <date>2011-03-10 13:03:00 -0500</date>
            <delta_ts>2011-03-14 01:41:19 -0400</delta_ts>
            <desc>Proposed patch</desc>
            <filename>bug_339337.txt</filename>
            <type>text/plain</type>
            <size>1214</size>
            <attacher name="Jay Arthanareeswaran">jarthana</attacher>
            
              <data encoding="base64">IyMjIEVjbGlwc2UgV29ya3NwYWNlIFBhdGNoIDEuMA0KI1Agb3JnLmVjbGlwc2UuamR0LmNvcmUN
CkluZGV4OiBtb2RlbC9vcmcvZWNsaXBzZS9qZHQvY29yZS9JVHlwZS5qYXZhDQo9PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
DQpSQ1MgZmlsZTogL2N2c3Jvb3QvZWNsaXBzZS9vcmcuZWNsaXBzZS5qZHQuY29yZS9tb2RlbC9v
cmcvZWNsaXBzZS9qZHQvY29yZS9JVHlwZS5qYXZhLHYNCnJldHJpZXZpbmcgcmV2aXNpb24gMS43
MQ0KZGlmZiAtdSAtcjEuNzEgSVR5cGUuamF2YQ0KLS0tIG1vZGVsL29yZy9lY2xpcHNlL2pkdC9j
b3JlL0lUeXBlLmphdmEJMTcgRGVjIDIwMTAgMTQ6MTA6NTcgLTAwMDAJMS43MQ0KKysrIG1vZGVs
L29yZy9lY2xpcHNlL2pkdC9jb3JlL0lUeXBlLmphdmEJMTAgTWFyIDIwMTEgMTc6NDU6MTUgLTAw
MDANCkBAIC05MDYsMTEgKzkwNiwxNyBAQA0KIAlib29sZWFuIGlzQW5ub3RhdGlvbigpIHRocm93
cyBKYXZhTW9kZWxFeGNlcHRpb247DQogDQogCS8qKg0KLQkgKiBSZXR1cm5zIHdoZXRoZXIgdGhp
cyB0eXBlIHJlcHJlc2VudHMgYSBsb2NhbCB0eXBlLg0KKwkgKiBSZXR1cm5zIHdoZXRoZXIgdGhp
cyB0eXBlIHJlcHJlc2VudHMgYSBsb2NhbCB0eXBlLiBGb3IgYW4gYW5vbnltb3VzIHR5cGUsIA0K
KwkgKiB0aGlzIG1ldGhvZCByZXR1cm5zIHRydWUuDQorCSAqIDxwPg0KKwkgKiBOT1RFOiBBcyBw
ZXIgSkxTMyAxNC4zLCBhbm9ueW1vdXMgaW5uZXIgY2xhc3NlcyBhcmUgbm90IGNvbnNpZGVyZWQg
bG9jYWwgDQorCSAqIHR5cGVzIHNpbmNlIHRoZXkgZG8gbm90IGhhdmUgYSBuYW1lLg0KKwkgKiA8
L3A+DQogCSAqDQogCSAqIEBleGNlcHRpb24gSmF2YU1vZGVsRXhjZXB0aW9uIGlmIHRoaXMgZWxl
bWVudCBkb2VzIG5vdCBleGlzdCBvciBpZiBhbg0KIAkgKgkJZXhjZXB0aW9uIG9jY3VycyB3aGls
ZSBhY2Nlc3NpbmcgaXRzIGNvcnJlc3BvbmRpbmcgcmVzb3VyY2UuDQogCSAqIEByZXR1cm4gdHJ1
ZSBpZiB0aGlzIHR5cGUgcmVwcmVzZW50cyBhIGxvY2FsIHR5cGUsIGZhbHNlIG90aGVyd2lzZQ0K
KwkgKiBAc2VlIG9yZy5lY2xpcHNlLmpkdC5jb3JlLmRvbS5JVHlwZUJpbmRpbmcjaXNMb2NhbCgp
DQogCSAqIEBzaW5jZSAyLjANCiAJICovDQogCWJvb2xlYW4gaXNMb2NhbCgpIHRocm93cyBKYXZh
TW9kZWxFeGNlcHRpb247DQo=
</data>
<flag name="review"
          id="39798"
          type_id="6"
          status="-"
          setter="markus_keller"
    />
          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>191080</attachid>
            <date>2011-03-14 01:41:00 -0400</date>
            <delta_ts>2011-03-14 01:41:19 -0400</delta_ts>
            <desc>Updated patch</desc>
            <filename>bug_339337.txt</filename>
            <type>text/plain</type>
            <size>2538</size>
            <attacher name="Jay Arthanareeswaran">jarthana</attacher>
            
              <data encoding="base64">IyMjIEVjbGlwc2UgV29ya3NwYWNlIFBhdGNoIDEuMA0KI1Agb3JnLmVjbGlwc2UuamR0LmNvcmUN
CkluZGV4OiBkb20vb3JnL2VjbGlwc2UvamR0L2NvcmUvZG9tL0lUeXBlQmluZGluZy5qYXZhDQo9
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09DQpSQ1MgZmlsZTogL2N2c3Jvb3QvZWNsaXBzZS9vcmcuZWNsaXBzZS5qZHQuY29y
ZS9kb20vb3JnL2VjbGlwc2UvamR0L2NvcmUvZG9tL0lUeXBlQmluZGluZy5qYXZhLHYNCnJldHJp
ZXZpbmcgcmV2aXNpb24gMS43NA0KZGlmZiAtdSAtcjEuNzQgSVR5cGVCaW5kaW5nLmphdmENCi0t
LSBkb20vb3JnL2VjbGlwc2UvamR0L2NvcmUvZG9tL0lUeXBlQmluZGluZy5qYXZhCTcgTWFyIDIw
MDkgMDA6NTk6MDEgLTAwMDAJMS43NA0KKysrIGRvbS9vcmcvZWNsaXBzZS9qZHQvY29yZS9kb20v
SVR5cGVCaW5kaW5nLmphdmEJMTQgTWFyIDIwMTEgMDU6Mzg6MjYgLTAwMDANCkBAIC03NTEsMTEg
Kzc1MSwxNCBAQA0KIAkgKiA8cD4NCiAJICogQSBsb2NhbCBjbGFzcyBpcyBhbnkgbmVzdGVkIGNs
YXNzIG9yIGVudW0gdHlwZSBub3QgZGVjbGFyZWQgYXMgYSBtZW1iZXINCiAJICogb2YgYW5vdGhl
ciBjbGFzcyBvciBpbnRlcmZhY2UuIEEgbG9jYWwgY2xhc3MgaXMgYSBzdWJzcGVjaWVzIG9mIG5l
c3RlZA0KLQkgKiB0eXBlLCBhbmQgbXV0dWFsbHkgZXhjbHVzaXZlIHdpdGggbWVtYmVyIHR5cGVz
LiBOb3RlIHRoYXQgYW5vbnltb3VzDQotCSAqIGNsYXNzZXMgYXJlIGEgc3Vic3BlY2llcyBvZiBs
b2NhbCBjbGFzc2VzLg0KKwkgKiB0eXBlLCBhbmQgbXV0dWFsbHkgZXhjbHVzaXZlIHdpdGggbWVt
YmVyIHR5cGVzLiBGb3IgYW5vbnltb3VzDQorCSAqIGNsYXNzZXMsIHdoaWNoIGFyZSBjb25zaWRl
cmVkIGEgc3Vic3BlY2llcyBvZiBsb2NhbCBjbGFzc2VzLCB0aGlzIG1ldGhvZA0KKwkgKiByZXR1
cm5zIHRydWUuIA0KIAkgKiA8L3A+DQogCSAqIDxwPg0KLQkgKiBBbHNvIG5vdGUgdGhhdCBpbnRl
cmZhY2VzIGFuZCBhbm5vdGF0aW9uIHR5cGVzIGNhbm5vdCBiZSBsb2NhbC4NCisJICogTm90ZTog
VGhpcyBkZXZpYXRlcyBmcm9tIEpMUzMgMTQuMywgd2hpY2ggc3RhdGVzIHRoYXQgYW5vbnltb3Vz
IHR5cGVzIGFyZSANCisJICogbm90IGxvY2FsIHR5cGVzIHNpbmNlIHRoZXkgZG8gbm90IGhhdmUg
YSBuYW1lLiBBbHNvIG5vdGUgdGhhdCBpbnRlcmZhY2VzIA0KKwkgKiBhbmQgYW5ub3RhdGlvbiB0
eXBlcyBjYW5ub3QgYmUgbG9jYWwuDQogCSAqIDwvcD4NCiAJICoNCiAJICogQHJldHVybiA8Y29k
ZT50cnVlPC9jb2RlPiBpZiB0aGlzIHR5cGUgYmluZGluZyBpcyBmb3IgYSBsb2NhbCBjbGFzcyBv
cg0KSW5kZXg6IG1vZGVsL29yZy9lY2xpcHNlL2pkdC9jb3JlL0lUeXBlLmphdmENCj09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT0NClJDUyBmaWxlOiAvY3Zzcm9vdC9lY2xpcHNlL29yZy5lY2xpcHNlLmpkdC5jb3JlL21vZGVs
L29yZy9lY2xpcHNlL2pkdC9jb3JlL0lUeXBlLmphdmEsdg0KcmV0cmlldmluZyByZXZpc2lvbiAx
LjcxDQpkaWZmIC11IC1yMS43MSBJVHlwZS5qYXZhDQotLS0gbW9kZWwvb3JnL2VjbGlwc2UvamR0
L2NvcmUvSVR5cGUuamF2YQkxNyBEZWMgMjAxMCAxNDoxMDo1NyAtMDAwMAkxLjcxDQorKysgbW9k
ZWwvb3JnL2VjbGlwc2UvamR0L2NvcmUvSVR5cGUuamF2YQkxNCBNYXIgMjAxMSAwNTozODoyNiAt
MDAwMA0KQEAgLTkwNiwxMSArOTA2LDE3IEBADQogCWJvb2xlYW4gaXNBbm5vdGF0aW9uKCkgdGhy
b3dzIEphdmFNb2RlbEV4Y2VwdGlvbjsNCiANCiAJLyoqDQotCSAqIFJldHVybnMgd2hldGhlciB0
aGlzIHR5cGUgcmVwcmVzZW50cyBhIGxvY2FsIHR5cGUuDQorCSAqIFJldHVybnMgd2hldGhlciB0
aGlzIHR5cGUgcmVwcmVzZW50cyBhIGxvY2FsIHR5cGUuIEZvciBhbiBhbm9ueW1vdXMgdHlwZSwg
DQorCSAqIHRoaXMgbWV0aG9kIHJldHVybnMgdHJ1ZS4NCisJICogPHA+DQorCSAqIE5vdGU6IFRo
aXMgZGV2aWF0ZXMgZnJvbSBKTFMzIDE0LjMsIHdoaWNoIHN0YXRlcyB0aGF0IGFub255bW91cyB0
eXBlcyBhcmUgDQorCSAqIG5vdCBsb2NhbCB0eXBlcyBzaW5jZSB0aGV5IGRvIG5vdCBoYXZlIGEg
bmFtZS4NCisJICogPC9wPg0KIAkgKg0KIAkgKiBAZXhjZXB0aW9uIEphdmFNb2RlbEV4Y2VwdGlv
biBpZiB0aGlzIGVsZW1lbnQgZG9lcyBub3QgZXhpc3Qgb3IgaWYgYW4NCiAJICoJCWV4Y2VwdGlv
biBvY2N1cnMgd2hpbGUgYWNjZXNzaW5nIGl0cyBjb3JyZXNwb25kaW5nIHJlc291cmNlLg0KIAkg
KiBAcmV0dXJuIHRydWUgaWYgdGhpcyB0eXBlIHJlcHJlc2VudHMgYSBsb2NhbCB0eXBlLCBmYWxz
ZSBvdGhlcndpc2UNCisJICogQHNlZSBvcmcuZWNsaXBzZS5qZHQuY29yZS5kb20uSVR5cGVCaW5k
aW5nI2lzTG9jYWwoKQ0KIAkgKiBAc2luY2UgMi4wDQogCSAqLw0KIAlib29sZWFuIGlzTG9jYWwo
KSB0aHJvd3MgSmF2YU1vZGVsRXhjZXB0aW9uOw0K
</data>

          </attachment>
      

    </bug>

</bugzilla>