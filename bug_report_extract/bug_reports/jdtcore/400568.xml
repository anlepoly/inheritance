<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>400568</bug_id>
          
          <creation_ts>2013-02-12 08:44:00 -0500</creation_ts>
          <short_desc>[1.8][ast rewrite] AST Rewrite support for Array creation nodes</short_desc>
          <delta_ts>2013-04-14 20:22:50 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>3.8</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows 7</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>BETA J8</target_milestone>
          
          <blocked>398940</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Jay Arthanareeswaran">jarthana</reporter>
          <assigned_to name="Jay Arthanareeswaran">jarthana</assigned_to>
          <cc>manju656</cc>
    
    <cc>markus_keller</cc>
    
    <cc>srikanth_sankaran</cc>
          
          <votes>0</votes>

      

      

      <flag name="review"
          id="55960"
          type_id="1"
          status="+"
          setter="markus_keller"
    />

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2215380</commentid>
    <comment_count>0</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-02-12 08:44:56 -0500</bug_when>
    <thetext>Bug 391894 added support for type annotations Array creation nodes. This bug will be used to add the rewrite support for array creation with type annotations.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2219745</commentid>
    <comment_count>1</comment_count>
      <attachid>227381</attachid>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-02-21 00:27:43 -0500</bug_when>
    <thetext>Created attachment 227381
Unit test and WIP fix

Patch includes a test and non-functional fix. Continuing the work.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2220608</commentid>
    <comment_count>2</comment_count>
      <attachid>227431</attachid>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-02-21 23:31:57 -0500</bug_when>
    <thetext>Created attachment 227431
Updated patch

A better patch, but still has flaws/bugs.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2225498</commentid>
    <comment_count>3</comment_count>
      <attachid>227872</attachid>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-03-04 07:11:52 -0500</bug_when>
    <thetext>Created attachment 227872
Updated patch

An improved patch but still has problems for overlapping text edits - i.e when there are changes both to annotations and dimension expression. The overlapping children was pointed out by Markus in bug 391894, comment #4.

Markus, I can&apos;t find any precedence to this. Do you know if there is any and any usual way we handle things in such cases?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2225750</commentid>
    <comment_count>4</comment_count>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2013-03-04 11:45:39 -0500</bug_when>
    <thetext>No, AFAIK, this is the only case where nodes are not properly nested. I don&apos;t have a silver bullet, and I don&apos;t know exactly what goes wrong here.

I also don&apos;t know if we have old tests that do something similar to what you want to do in the new test. There&apos;s ASTRewritingExpressionsTest#testArrayCreation(), but I don&apos;t know how much it really tests. There are very few places in JDT UI that deal with ArrayCreation nodes.

The general strategy I&apos;d recommend is to traverse nodes from left to right in the document, no matter where they are in the AST. In a first step, I would also try to remove everything that deals with whitespace handling (especially about removing text). The potential for trouble in that area is quite high if we have to deal with improperly nested nodes.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2225777</commentid>
    <comment_count>5</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-03-04 12:29:07 -0500</bug_when>
    <thetext>Thanks for the tips, Markus. I found the problem to be elsewhere. The overlap was actually because I was allowing annotations being processed via TYPE_PROPERTY already, which shouldn&apos;t be allowed for an array creation node.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2225792</commentid>
    <comment_count>6</comment_count>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2013-03-04 13:04:46 -0500</bug_when>
    <thetext>It would be better if we could avoid special processing of ArrayType nodes depending on whether they&apos;re in an ArrayCreation or not. But if that doesn&apos;t work or is too cumbersome, then we can also live with the special case.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2226640</commentid>
    <comment_count>7</comment_count>
      <attachid>227981</attachid>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-03-06 05:04:29 -0500</bug_when>
    <thetext>Created attachment 227981
Patch for review

Final patch with regression tests.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2226655</commentid>
    <comment_count>8</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-03-06 05:38:44 -0500</bug_when>
    <thetext>(In reply to comment #7)
&gt; Final patch with regression tests.

A note about the change in ASTConverter: The null check is required since the annotationsOnDimensions array contains null for dimensions without any annotations. I am not sure if that is the expected behavior.

For e.g. the following cases produce such result:

int [] i @Annot [][] = null;
int [][] = new int @Annot [] [];

Srikanth, can you confirm if the null element is as expected?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2226716</commentid>
    <comment_count>9</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2013-03-06 08:36:37 -0500</bug_when>
    <thetext>(In reply to comment #8)

&gt; Srikanth, can you confirm if the null element is as expected?

Yes, there is no value in creating empty arrays when annotations are
not present. We could create static empty arrays and store those, but
the approach taken is the approach taken and I would leave it as is
unless there are some real issues.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2227646</commentid>
    <comment_count>10</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-03-07 13:57:12 -0500</bug_when>
    <thetext>(In reply to comment #9)
&gt; Yes, there is no value in creating empty arrays when annotations are
&gt; not present.

Thanks for confirming. The last patch covers this already.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2227658</commentid>
    <comment_count>11</comment_count>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2013-03-07 14:10:19 -0500</bug_when>
    <thetext>I didn&apos;t review the patch in detail, but it looks good over all, and the tests also look good (except for the wrong comments //Get while statement block).

The fix in the ASTConverter came just in time (already wanted to file a bug;-).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2227800</commentid>
    <comment_count>12</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2013-03-07 18:39:56 -0500</bug_when>
    <thetext>Jay, please proceed to release. TIA.

Manoj, please review post release and raise bugs for any issues found.

Jay &amp; Manoj, in future, for ASTrewrite work, please buddy up and always 
review each other&apos;s patch before requesting Markus for a final review - 
this will result in better utilization of an expert resource from outside 
the core project.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2227925</commentid>
    <comment_count>13</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2013-03-08 05:22:00 -0500</bug_when>
    <thetext>All tests pass and released in BETA_JAVA8.

http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?h=BETA_JAVA8&amp;id=8c67d56825136ce0d7026162576ad6997e930bdc</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2243446</commentid>
    <comment_count>14</comment_count>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2013-04-14 20:22:50 -0400</bug_when>
    <thetext>The changes in ASTRewriteFlattener turned out to be bad. They caused about a dozen test failures in JDT UI tests (I think Manju found this first -- thanks).

Fixed with http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=ASTRewriteFlattener

Jay, please have another look at these changes. I actually went back to the code before comment 13 and added the annotation handling there.

Lesson learned: Green tests are not enough. We also need a test that actually runs the code. For ASTRewriteFlattener, that means a test needs to create AST nodes manually.</thetext>
  </long_desc>
      
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>227381</attachid>
            <date>2013-02-21 00:27:00 -0500</date>
            <delta_ts>2013-02-21 23:31:57 -0500</delta_ts>
            <desc>Unit test and WIP fix</desc>
            <filename>Fix-for-400568.patch</filename>
            <type>text/plain</type>
            <size>14491</size>
            <attacher name="Jay Arthanareeswaran">jarthana</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3NyYy9vcmcvZWNs
aXBzZS9qZHQvY29yZS90ZXN0cy9yZXdyaXRlL2Rlc2NyaWJpbmcvQVNUUmV3cml0aW5nU3RhdGVt
ZW50c1Rlc3QuamF2YSBiL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3NyYy9vcmcv
ZWNsaXBzZS9qZHQvY29yZS90ZXN0cy9yZXdyaXRlL2Rlc2NyaWJpbmcvQVNUUmV3cml0aW5nU3Rh
dGVtZW50c1Rlc3QuamF2YQppbmRleCA4MzdjYjQ1Li45MTdhY2NiIDEwMDY0NAotLS0gYS9vcmcu
ZWNsaXBzZS5qZHQuY29yZS50ZXN0cy5tb2RlbC9zcmMvb3JnL2VjbGlwc2UvamR0L2NvcmUvdGVz
dHMvcmV3cml0ZS9kZXNjcmliaW5nL0FTVFJld3JpdGluZ1N0YXRlbWVudHNUZXN0LmphdmEKKysr
IGIvb3JnLmVjbGlwc2UuamR0LmNvcmUudGVzdHMubW9kZWwvc3JjL29yZy9lY2xpcHNlL2pkdC9j
b3JlL3Rlc3RzL3Jld3JpdGUvZGVzY3JpYmluZy9BU1RSZXdyaXRpbmdTdGF0ZW1lbnRzVGVzdC5q
YXZhCkBAIC01ODQxLDQgKzU4NDEsOTEgQEAKIAkJfQogCX0KKwlwdWJsaWMgdm9pZCB0ZXN0QnVn
NDAwNTY4X3NpbmNlXzgoKSB0aHJvd3MgRXhjZXB0aW9uIHsKKwkJSVBhY2thZ2VGcmFnbWVudCBw
YWNrMT0gdGhpcy5zb3VyY2VGb2xkZXIuY3JlYXRlUGFja2FnZUZyYWdtZW50KCJ0ZXN0MSIsIGZh
bHNlLCBudWxsKTsKKwkJU3RyaW5nQnVmZmVyIGJ1Zj0gbmV3IFN0cmluZ0J1ZmZlcigpOworCQli
dWYuYXBwZW5kKCJwYWNrYWdlIHRlc3QxO1xuIik7CisJCWJ1Zi5hcHBlbmQoImltcG9ydCBqYXZh
LmxhbmcuYW5ub3RhdGlvbi5FbGVtZW50VHlwZTtcbiIpOworCQlidWYuYXBwZW5kKCJwdWJsaWMg
Y2xhc3MgRSB7XG4iKTsKKwkJYnVmLmFwcGVuZCgiICAgIHB1YmxpYyB2b2lkIGZvbygpIHtcbiIp
OworCQlidWYuYXBwZW5kKCIgICAgCWludCBbXSBpIEBBbm5vdDEgQEFubm90MiBbXSBAQW5ub3Qx
IEBBbm5vdDMgW10gPSBuZXcgaW50IEBBbm5vdDEgQEFubm90MiBbMl0gQEFubm90MiBAQW5ub3Qz
IFtzaXplKCldIEBBbm5vdDEgQEFubm90MyBbXTtcbiIpOworCQlidWYuYXBwZW5kKCIgICAgCS8v
aW50IFtdW11bXSBqID0gbmV3IEBBbm5vdDEgQEFubm90MiBbMl0gQEFubm90MiBAQW5ub3QzIFtz
aXplKCldIEBBbm5vdDEgQEFubm90MyBbXSwJayA9IG5ldyBAQW5ub3QxIEBBbm5vdDIgWzJdIEBB
bm5vdDIgQEFubm90MyBbc2l6ZSgpXSBAQW5ub3QxIEBBbm5vdDMgW10gXG4iKTsKKwkJYnVmLmFw
cGVuZCgiICAgIH1cbiIpOworCQlidWYuYXBwZW5kKCIgICAgcHVibGljIGludCBzaXplKCkgeyBy
ZXR1cm4gMjsgfVxuIik7CisJCWJ1Zi5hcHBlbmQoIn1cbiIpOworCQlidWYuYXBwZW5kKCJAamF2
YS5sYW5nLmFubm90YXRpb24uVGFyZ2V0KHZhbHVlPSB7RWxlbWVudFR5cGUuVFlQRV9VU0V9KVxu
Iik7CisJCWJ1Zi5hcHBlbmQoIkBpbnRlcmZhY2UgQW5ub3QxIHt9XG4iKTsKKwkJYnVmLmFwcGVu
ZCgiQGphdmEubGFuZy5hbm5vdGF0aW9uLlRhcmdldCh2YWx1ZT0ge0VsZW1lbnRUeXBlLlRZUEVf
VVNFfSlcbiIpOworCQlidWYuYXBwZW5kKCJAaW50ZXJmYWNlIEFubm90MiB7fVxuIik7CisJCWJ1
Zi5hcHBlbmQoIkBqYXZhLmxhbmcuYW5ub3RhdGlvbi5UYXJnZXQodmFsdWU9IHtFbGVtZW50VHlw
ZS5UWVBFX1VTRX0pXG4iKTsKKwkJYnVmLmFwcGVuZCgiQGludGVyZmFjZSBBbm5vdDIge31cbiIp
OworCQlTeXN0ZW0ub3V0LnByaW50bG4oYnVmKTsKKwkJSUNvbXBpbGF0aW9uVW5pdCBjdT0gcGFj
azEuY3JlYXRlQ29tcGlsYXRpb25Vbml0KCJFLmphdmEiLCBidWYudG9TdHJpbmcoKSwgZmFsc2Us
IG51bGwpOworCisJCUNvbXBpbGF0aW9uVW5pdCBhc3RSb290PSBjcmVhdGVBU1QoY3UpOworCQlB
U1QgYXN0PSBhc3RSb290LmdldEFTVCgpOworCQlBU1RSZXdyaXRlIHJld3JpdGU9IEFTVFJld3Jp
dGUuY3JlYXRlKGFzdFJvb3QuZ2V0QVNUKCkpOworCisJCS8vIEdldCB3aGlsZSBzdGF0ZW1lbnQg
YmxvY2sKKwkJVHlwZURlY2xhcmF0aW9uIHR5cGVEZWNsID0gKFR5cGVEZWNsYXJhdGlvbikgYXN0
Um9vdC50eXBlcygpLmdldCgwKTsKKwkJTWV0aG9kRGVjbGFyYXRpb24gbWV0aG9kRGVjbD0gdHlw
ZURlY2wuZ2V0TWV0aG9kcygpWzBdOworCQlCbG9jayBibG9jaz0gbWV0aG9kRGVjbC5nZXRCb2R5
KCk7CisJCUxpc3Qgc3RhdGVtZW50cz0gYmxvY2suc3RhdGVtZW50cygpOworCisJCVZhcmlhYmxl
RGVjbGFyYXRpb25TdGF0ZW1lbnQgc3RhdGVtZW50ID0gKFZhcmlhYmxlRGVjbGFyYXRpb25TdGF0
ZW1lbnQpIHN0YXRlbWVudHMuZ2V0KDApOworCQlMaXN0IGZyYWdtZW50cyA9IHN0YXRlbWVudC5m
cmFnbWVudHMoKTsKKwkJYXNzZXJ0RXF1YWxzKCJJbmNvcnJlY3Qgbm8gb2YgZnJhZ21lbnRzIiwg
MSwgZnJhZ21lbnRzLnNpemUoKSk7CisJCVZhcmlhYmxlRGVjbGFyYXRpb25GcmFnbWVudCBmcmFn
bWVudCA9IChWYXJpYWJsZURlY2xhcmF0aW9uRnJhZ21lbnQpIGZyYWdtZW50cy5nZXQoMCk7CisJ
CVR5cGUgdHlwZSA9IHN0YXRlbWVudC5nZXRUeXBlKCk7CisKKwkJeworCQkJLy8gQWRkIG5ldyBk
aW1lbnNpb24KKwkJCWFzc2VydEVxdWFscygiSW5jb3JyZWN0IHR5cGUiLCBBU1ROb2RlLkFSUkFZ
X1RZUEUsIHR5cGUuZ2V0Tm9kZVR5cGUoKSk7CisJCQlBcnJheUNyZWF0aW9uIGNyZWF0aW9uID0g
KEFycmF5Q3JlYXRpb24pIGZyYWdtZW50LmdldEluaXRpYWxpemVyKCk7CisKKwkJCUxpc3RSZXdy
aXRlIGxpc3RSZXdyaXRlPSByZXdyaXRlLmdldExpc3RSZXdyaXRlKGZyYWdtZW50LCBWYXJpYWJs
ZURlY2xhcmF0aW9uRnJhZ21lbnQuRVhUUkFfRElNRU5TSU9OX0lORk9TX1BST1BFUlRZKTsKKwkJ
CUV4dHJhRGltZW5zaW9uIGRpbT0gYXN0Lm5ld0V4dHJhRGltZW5zaW9uKCk7CisJCQlNYXJrZXJB
bm5vdGF0aW9uIG1hcmtlckFubm90YXRpb247CisJCQlsaXN0UmV3cml0ZS5pbnNlcnRBdChkaW0s
IDAsIG51bGwpOworCisJCQlBcnJheVR5cGUgY3JlYXRpb25UeXBlID0gY3JlYXRpb24uZ2V0VHlw
ZSgpOworCQkJQXJyYXlUeXBlIG5ld0FycmF5VHlwZSA9IGFzdC5uZXdBcnJheVR5cGUoKEFycmF5
VHlwZSkgQVNUTm9kZS5jb3B5U3VidHJlZShhc3QsIGNyZWF0aW9uVHlwZSkpOworCQkJbmV3QXJy
YXlUeXBlID0gYXN0Lm5ld0FycmF5VHlwZShuZXdBcnJheVR5cGUpOworCQkJcmV3cml0ZS5zZXQo
Y3JlYXRpb24sIEFycmF5Q3JlYXRpb24uVFlQRV9QUk9QRVJUWSwgbmV3QXJyYXlUeXBlLCBudWxs
KTsKKworCQkJbGlzdFJld3JpdGU9IHJld3JpdGUuZ2V0TGlzdFJld3JpdGUobmV3QXJyYXlUeXBl
LCBBcnJheVR5cGUuQU5OT1RBVElPTlNfUFJPUEVSVFkpOworCQkJbWFya2VyQW5ub3RhdGlvbj0g
YXN0Lm5ld01hcmtlckFubm90YXRpb24oKTsKKwkJCW1hcmtlckFubm90YXRpb24uc2V0VHlwZU5h
bWUoYXN0Lm5ld1NpbXBsZU5hbWUoIkFubm90MyIpKTsKKwkJCWxpc3RSZXdyaXRlLmluc2VydEF0
KG1hcmtlckFubm90YXRpb24sIDAsIG51bGwpOworCQkJbmV3QXJyYXlUeXBlLmFubm90YXRpb25z
KCkuYWRkKG1hcmtlckFubm90YXRpb24pOworCQkJbWFya2VyQW5ub3RhdGlvbj0gYXN0Lm5ld01h
cmtlckFubm90YXRpb24oKTsKKwkJCW1hcmtlckFubm90YXRpb24uc2V0VHlwZU5hbWUoYXN0Lm5l
d1NpbXBsZU5hbWUoIkFubm90MiIpKTsKKwkJCWxpc3RSZXdyaXRlLmluc2VydEF0KG1hcmtlckFu
bm90YXRpb24sIDEsIG51bGwpOworCQkJbWFya2VyQW5ub3RhdGlvbj0gYXN0Lm5ld01hcmtlckFu
bm90YXRpb24oKTsKKwkJCW1hcmtlckFubm90YXRpb24uc2V0VHlwZU5hbWUoYXN0Lm5ld1NpbXBs
ZU5hbWUoIkFubm90MSIpKTsKKwkJCWxpc3RSZXdyaXRlLmluc2VydEF0KG1hcmtlckFubm90YXRp
b24sIDIsIG51bGwpOworCQl9CisJCQorCQkvLyBHZXQgbmV3IGNvZGUKKwkJU3RyaW5nIHByZXZp
ZXc9IGV2YWx1YXRlUmV3cml0ZShjdSwgcmV3cml0ZSk7CisKKwkJYnVmPSBuZXcgU3RyaW5nQnVm
ZmVyKCk7CisJCWJ1Zi5hcHBlbmQoInBhY2thZ2UgdGVzdDE7XG4iKTsKKwkJYnVmLmFwcGVuZCgi
aW1wb3J0IGphdmEubGFuZy5hbm5vdGF0aW9uLkVsZW1lbnRUeXBlO1xuIik7CisJCWJ1Zi5hcHBl
bmQoInB1YmxpYyBjbGFzcyBFIHtcbiIpOworCQlidWYuYXBwZW5kKCIgICAgcHVibGljIHZvaWQg
Zm9vKCkge1xuIik7CisJCWJ1Zi5hcHBlbmQoIiAgICAJaW50IFtdIGkgW10gQEFubm90MSBAQW5u
b3QyIFtdIEBBbm5vdDEgQEFubm90MyBbXSA9IG5ldyBpbnQgQEFubm90MSBAQW5ub3QyIFsyXSBA
QW5ub3QyIEBBbm5vdDMgW3NpemUoKV0gQEFubm90MSBAQW5ub3QzIFtdW11bXTtcbiIpOworCQli
dWYuYXBwZW5kKCIgICAgCS8vaW50IFtdW11bXSBqID0gbmV3IEBBbm5vdDEgQEFubm90MiBbMl0g
QEFubm90MiBAQW5ub3QzIFtzaXplKCldIEBBbm5vdDEgQEFubm90MyBbXSwJayA9IG5ldyBAQW5u
b3QxIEBBbm5vdDIgWzJdIEBBbm5vdDIgQEFubm90MyBbc2l6ZSgpXSBAQW5ub3QxIEBBbm5vdDMg
W10gXG4iKTsKKwkJYnVmLmFwcGVuZCgiICAgIH1cbiIpOworCQlidWYuYXBwZW5kKCIgICAgcHVi
bGljIGludCBzaXplKCkgeyByZXR1cm4gMjsgfVxuIik7CisJCWJ1Zi5hcHBlbmQoIn1cbiIpOwor
CQlidWYuYXBwZW5kKCJAamF2YS5sYW5nLmFubm90YXRpb24uVGFyZ2V0KHZhbHVlPSB7RWxlbWVu
dFR5cGUuVFlQRV9VU0V9KVxuIik7CisJCWJ1Zi5hcHBlbmQoIkBpbnRlcmZhY2UgQW5ub3QxIHt9
XG4iKTsKKwkJYnVmLmFwcGVuZCgiQGphdmEubGFuZy5hbm5vdGF0aW9uLlRhcmdldCh2YWx1ZT0g
e0VsZW1lbnRUeXBlLlRZUEVfVVNFfSlcbiIpOworCQlidWYuYXBwZW5kKCJAaW50ZXJmYWNlIEFu
bm90MiB7fVxuIik7CisJCWJ1Zi5hcHBlbmQoIkBqYXZhLmxhbmcuYW5ub3RhdGlvbi5UYXJnZXQo
dmFsdWU9IHtFbGVtZW50VHlwZS5UWVBFX1VTRX0pXG4iKTsKKwkJYnVmLmFwcGVuZCgiQGludGVy
ZmFjZSBBbm5vdDIge31cbiIpOworCQlhc3NlcnRFcXVhbFN0cmluZyhwcmV2aWV3LCBidWYudG9T
dHJpbmcoKSk7CisJCQorCX0KIH0KIApkaWZmIC0tZ2l0IGEvb3JnLmVjbGlwc2UuamR0LmNvcmUv
ZG9tL29yZy9lY2xpcHNlL2pkdC9pbnRlcm5hbC9jb3JlL2RvbS9yZXdyaXRlL0FTVFJld3JpdGVB
bmFseXplci5qYXZhIGIvb3JnLmVjbGlwc2UuamR0LmNvcmUvZG9tL29yZy9lY2xpcHNlL2pkdC9p
bnRlcm5hbC9jb3JlL2RvbS9yZXdyaXRlL0FTVFJld3JpdGVBbmFseXplci5qYXZhCmluZGV4IGY3
OWM2ZGQuLmVkOWU4NTEgMTAwNjQ0Ci0tLSBhL29yZy5lY2xpcHNlLmpkdC5jb3JlL2RvbS9vcmcv
ZWNsaXBzZS9qZHQvaW50ZXJuYWwvY29yZS9kb20vcmV3cml0ZS9BU1RSZXdyaXRlQW5hbHl6ZXIu
amF2YQorKysgYi9vcmcuZWNsaXBzZS5qZHQuY29yZS9kb20vb3JnL2VjbGlwc2UvamR0L2ludGVy
bmFsL2NvcmUvZG9tL3Jld3JpdGUvQVNUUmV3cml0ZUFuYWx5emVyLmphdmEKQEAgLTE5NjYsNCAr
MTk2NiwzNCBAQAogCX0KIAorCXByaXZhdGUgaW50IHJld3JpdGVEaW1lbnNpb25XaXRoRXhwcmVz
c2lvbnMoaW50IG9mZnNldCwgUmV3cml0ZUV2ZW50IGV2ZW50LCBUZXh0RWRpdEdyb3VwIGVkaXRH
cm91cCkgdGhyb3dzIENvcmVFeGNlcHRpb24geworCQlpbnQgY2hhbmdlS2luZD0gZXZlbnQuZ2V0
Q2hhbmdlS2luZCgpOworCQlpbnQgcG9zOworCQlpZiAoY2hhbmdlS2luZCA9PSBSZXdyaXRlRXZl
bnQuSU5TRVJURUQpIHsgLy8gaW5zZXJ0IG5ldyBkaW1lbnNpb24KKwkJCWVkaXRHcm91cD0gZ2V0
RWRpdEdyb3VwKGV2ZW50KTsKKwkJCWRvVGV4dEluc2VydChvZmZzZXQsICJbIiwgZWRpdEdyb3Vw
KTsgLy8kTk9OLU5MUy0xJAorCQkJZG9UZXh0SW5zZXJ0KG9mZnNldCwgKEFTVE5vZGUpIGV2ZW50
LmdldE5ld1ZhbHVlKCksIDAsIGZhbHNlLCBlZGl0R3JvdXApOworCQkJZG9UZXh0SW5zZXJ0KG9m
ZnNldCwgIl0iLCBlZGl0R3JvdXApOyAvLyROT04tTkxTLTEkCisJCQlwb3MgPSBlZGl0R3JvdXAu
Z2V0UmVnaW9uKCkuZ2V0T2Zmc2V0KCkgKyBlZGl0R3JvdXAuZ2V0UmVnaW9uKCkuZ2V0TGVuZ3Ro
KCk7CisJCX0gZWxzZSB7CisJCQlBU1ROb2RlIGVsZW09IChBU1ROb2RlKSBldmVudC5nZXRPcmln
aW5hbFZhbHVlKCk7CisJCQlpbnQgZWxlbUVuZD0gZWxlbS5nZXRTdGFydFBvc2l0aW9uKCkgKyBl
bGVtLmdldExlbmd0aCgpOworCQkJcG9zPSBnZXRTY2FubmVyKCkuZ2V0VG9rZW5FbmRPZmZzZXQo
VGVybWluYWxUb2tlbnMuVG9rZW5OYW1lUkJSQUNLRVQsIGVsZW1FbmQpOworCQkJaWYgKGNoYW5n
ZUtpbmQgPT0gUmV3cml0ZUV2ZW50LlJFTU9WRUQpIHsKKwkJCQllZGl0R3JvdXA9IGdldEVkaXRH
cm91cChldmVudCk7CisJCQkJZG9UZXh0UmVtb3ZlQW5kVmlzaXQob2Zmc2V0LCBwb3MgLSBvZmZz
ZXQsIGVsZW0sIGVkaXRHcm91cCk7CisJCQl9IGVsc2UgaWYgKGNoYW5nZUtpbmQgPT0gUmV3cml0
ZUV2ZW50LlJFUExBQ0VEKSB7CisJCQkJZWRpdEdyb3VwPSBnZXRFZGl0R3JvdXAoZXZlbnQpOwor
CQkJCVNvdXJjZVJhbmdlIHJhbmdlPSBnZXRFeHRlbmRlZFJhbmdlKGVsZW0pOworCQkJCWludCBl
bGVtT2Zmc2V0PSByYW5nZS5nZXRTdGFydFBvc2l0aW9uKCk7CisJCQkJaW50IGVsZW1MZW5ndGg9
IHJhbmdlLmdldExlbmd0aCgpOworCQkJCWRvVGV4dFJlbW92ZUFuZFZpc2l0KGVsZW1PZmZzZXQs
IGVsZW1MZW5ndGgsIGVsZW0sIGVkaXRHcm91cCk7CisJCQkJZG9UZXh0SW5zZXJ0KGVsZW1PZmZz
ZXQsIChBU1ROb2RlKSBldmVudC5nZXROZXdWYWx1ZSgpLCAwLCBmYWxzZSwgZWRpdEdyb3VwKTsK
KwkJCX0gZWxzZSB7CisJCQkJdm9pZFZpc2l0KGVsZW0pOworCQkJfQorCQl9CisJCXJldHVybiBw
b3M7CisJfQorCQogCS8qIChub24tSmF2YWRvYykKIAkgKiBAc2VlIG9yZy5lY2xpcHNlLmpkdC5j
b3JlLmRvbS5BU1RWaXNpdG9yI3Zpc2l0KEFycmF5Q3JlYXRpb24pCkBAIC0xOTczLDYgKzIwMDMs
NyBAQAogCQkJcmV0dXJuIGRvVmlzaXRVbmNoYW5nZWRDaGlsZHJlbihub2RlKTsKIAkJfQotCisJ
CWludCBvZmZzZXQ7CiAJCUFycmF5VHlwZSBhcnJheVR5cGU9IChBcnJheVR5cGUpIGdldE9yaWdp
bmFsVmFsdWUobm9kZSwgQXJyYXlDcmVhdGlvbi5UWVBFX1BST1BFUlRZKTsKKwkJQXJyYXlUeXBl
IHJlcGxhY2luZ1R5cGUgPSBhcnJheVR5cGU7CiAJCWludCBuT2xkQnJhY2tldHM9IGdldERpbWVu
c2lvbnMoYXJyYXlUeXBlKTsgLy8gbnVtYmVyIG9mIHRvdGFsIGJyYWNrZXRzCiAJCWludCBuTmV3
QnJhY2tldHM9IG5PbGRCcmFja2V0czsKQEAgLTE5ODEsNzUgKzIwMTIsNjEgQEAKIAkJUmV3cml0
ZUV2ZW50IHR5cGVFdmVudD0gZ2V0RXZlbnQobm9kZSwgQXJyYXlDcmVhdGlvbi5UWVBFX1BST1BF
UlRZKTsKIAkJaWYgKHR5cGVFdmVudCAhPSBudWxsICYmIHR5cGVFdmVudC5nZXRDaGFuZ2VLaW5k
KCkgPT0gUmV3cml0ZUV2ZW50LlJFUExBQ0VEKSB7IC8vIGNoYW5nZWQgYXJyYXl0eXBlIGNhbiBo
YXZlIGRpZmZlcmVudCBkaW1lbnNpb24gb3IgdHlwZSBuYW1lCi0JCQlBcnJheVR5cGUgcmVwbGFj
aW5nVHlwZT0gKEFycmF5VHlwZSkgdHlwZUV2ZW50LmdldE5ld1ZhbHVlKCk7CisJCQlyZXBsYWNp
bmdUeXBlPSAoQXJyYXlUeXBlKSB0eXBlRXZlbnQuZ2V0TmV3VmFsdWUoKTsKIAkJCWVkaXRHcm91
cD0gZ2V0RWRpdEdyb3VwKHR5cGVFdmVudCk7CiAJCQlUeXBlIG5ld1R5cGU9IHJlcGxhY2luZ1R5
cGUuZ2V0RWxlbWVudFR5cGUoKTsKIAkJCVR5cGUgb2xkVHlwZT0gZ2V0RWxlbWVudFR5cGUoYXJy
YXlUeXBlKTsKKwkJCVNvdXJjZVJhbmdlIHJhbmdlPSBnZXRFeHRlbmRlZFJhbmdlKG9sZFR5cGUp
OworCQkJb2Zmc2V0PSByYW5nZS5nZXRTdGFydFBvc2l0aW9uKCk7CiAJCQlpZiAoIW5ld1R5cGUu
ZXF1YWxzKG9sZFR5cGUpKSB7Ci0JCQkJU291cmNlUmFuZ2UgcmFuZ2U9IGdldEV4dGVuZGVkUmFu
Z2Uob2xkVHlwZSk7Ci0JCQkJaW50IG9mZnNldD0gcmFuZ2UuZ2V0U3RhcnRQb3NpdGlvbigpOwog
CQkJCWludCBsZW5ndGg9IHJhbmdlLmdldExlbmd0aCgpOwogCQkJCWRvVGV4dFJlbW92ZShvZmZz
ZXQsIGxlbmd0aCwgZWRpdEdyb3VwKTsKIAkJCQlkb1RleHRJbnNlcnQob2Zmc2V0LCBuZXdUeXBl
LCAwLCBmYWxzZSwgZWRpdEdyb3VwKTsKKwkJCQlvZmZzZXQgKz0gbmV3VHlwZS5nZXRMZW5ndGgo
KTsKKwkJCX0gZWxzZSB7CisJCQkJb2Zmc2V0ICs9IG9sZFR5cGUuZ2V0TGVuZ3RoKCk7CiAJCQl9
CiAJCQluTmV3QnJhY2tldHM9IHJlcGxhY2luZ1R5cGUuZ2V0RGltZW5zaW9ucygpOyAvLyBpcyBy
ZXBsYWNlZCB0eXBlCisJCX0gZWxzZSB7CisJCQlvZmZzZXQgPSBhcnJheVR5cGUuZ2V0U3RhcnRQ
b3NpdGlvbigpICsgYXJyYXlUeXBlLmdldExlbmd0aCgpOwogCQl9CiAJCXZvaWRWaXNpdChhcnJh
eVR5cGUpOwotCi0KLQkJdHJ5IHsKLQkJCWludCBvZmZzZXQ9IGdldFNjYW5uZXIoKS5nZXRUb2tl
blN0YXJ0T2Zmc2V0KFRlcm1pbmFsVG9rZW5zLlRva2VuTmFtZUxCUkFDS0VULCBhcnJheVR5cGUu
Z2V0U3RhcnRQb3NpdGlvbigpKTsKLQkJCS8vIGRpbWVuc2lvbiBub2RlIHdpdGggZXhwcmVzc2lv
bnMKLQkJCVJld3JpdGVFdmVudCBkaW1FdmVudD0gZ2V0RXZlbnQobm9kZSwgQXJyYXlDcmVhdGlv
bi5ESU1FTlNJT05TX1BST1BFUlRZKTsKLQkJCWJvb2xlYW4gaGFzRGltZW5zaW9uQ2hhbmdlcz0g
KGRpbUV2ZW50ICE9IG51bGwgJiYgZGltRXZlbnQuZ2V0Q2hhbmdlS2luZCgpICE9IFJld3JpdGVF
dmVudC5VTkNIQU5HRUQpOwotCQkJaWYgKGhhc0RpbWVuc2lvbkNoYW5nZXMpIHsKLQkJCQlSZXdy
aXRlRXZlbnRbXSBldmVudHM9IGRpbUV2ZW50LmdldENoaWxkcmVuKCk7Ci0JCQkJLy8gb2Zmc2V0
IG9uIGZpcnN0IG9wZW5pbmcgYnJhY2UKLQkJCQlmb3IgKGludCBpPSAwOyBpIDwgZXZlbnRzLmxl
bmd0aDsgaSsrKSB7Ci0JCQkJCVJld3JpdGVFdmVudCBldmVudD0gZXZlbnRzW2ldOwotCQkJCQlp
bnQgY2hhbmdlS2luZD0gZXZlbnQuZ2V0Q2hhbmdlS2luZCgpOwotCQkJCQlpZiAoY2hhbmdlS2lu
ZCA9PSBSZXdyaXRlRXZlbnQuSU5TRVJURUQpIHsgLy8gaW5zZXJ0IG5ldyBkaW1lbnNpb24KLQkJ
CQkJCWVkaXRHcm91cD0gZ2V0RWRpdEdyb3VwKGV2ZW50KTsKLQkJCQkJCWRvVGV4dEluc2VydChv
ZmZzZXQsICJbIiwgZWRpdEdyb3VwKTsgLy8kTk9OLU5MUy0xJAotCQkJCQkJZG9UZXh0SW5zZXJ0
KG9mZnNldCwgKEFTVE5vZGUpIGV2ZW50LmdldE5ld1ZhbHVlKCksIDAsIGZhbHNlLCBlZGl0R3Jv
dXApOwotCQkJCQkJZG9UZXh0SW5zZXJ0KG9mZnNldCwgIl0iLCBlZGl0R3JvdXApOyAvLyROT04t
TkxTLTEkCi0JCQkJCQluTmV3QnJhY2tldHMtLTsKLQkJCQkJfSBlbHNlIHsKLQkJCQkJCUFTVE5v
ZGUgZWxlbT0gKEFTVE5vZGUpIGV2ZW50LmdldE9yaWdpbmFsVmFsdWUoKTsKLQkJCQkJCWludCBl
bGVtRW5kPSBlbGVtLmdldFN0YXJ0UG9zaXRpb24oKSArIGVsZW0uZ2V0TGVuZ3RoKCk7Ci0JCQkJ
CQlpbnQgZW5kUG9zPSBnZXRTY2FubmVyKCkuZ2V0VG9rZW5FbmRPZmZzZXQoVGVybWluYWxUb2tl
bnMuVG9rZW5OYW1lUkJSQUNLRVQsIGVsZW1FbmQpOwotCQkJCQkJaWYgKGNoYW5nZUtpbmQgPT0g
UmV3cml0ZUV2ZW50LlJFTU9WRUQpIHsKLQkJCQkJCQllZGl0R3JvdXA9IGdldEVkaXRHcm91cChl
dmVudCk7Ci0JCQkJCQkJZG9UZXh0UmVtb3ZlQW5kVmlzaXQob2Zmc2V0LCBlbmRQb3MgLSBvZmZz
ZXQsIGVsZW0sIGVkaXRHcm91cCk7Ci0JCQkJCQl9IGVsc2UgaWYgKGNoYW5nZUtpbmQgPT0gUmV3
cml0ZUV2ZW50LlJFUExBQ0VEKSB7Ci0JCQkJCQkJZWRpdEdyb3VwPSBnZXRFZGl0R3JvdXAoZXZl
bnQpOwotCQkJCQkJCVNvdXJjZVJhbmdlIHJhbmdlPSBnZXRFeHRlbmRlZFJhbmdlKGVsZW0pOwot
CQkJCQkJCWludCBlbGVtT2Zmc2V0PSByYW5nZS5nZXRTdGFydFBvc2l0aW9uKCk7Ci0JCQkJCQkJ
aW50IGVsZW1MZW5ndGg9IHJhbmdlLmdldExlbmd0aCgpOwotCQkJCQkJCWRvVGV4dFJlbW92ZUFu
ZFZpc2l0KGVsZW1PZmZzZXQsIGVsZW1MZW5ndGgsIGVsZW0sIGVkaXRHcm91cCk7Ci0JCQkJCQkJ
ZG9UZXh0SW5zZXJ0KGVsZW1PZmZzZXQsIChBU1ROb2RlKSBldmVudC5nZXROZXdWYWx1ZSgpLCAw
LCBmYWxzZSwgZWRpdEdyb3VwKTsKLQkJCQkJCQluTmV3QnJhY2tldHMtLTsKLQkJCQkJCX0gZWxz
ZSB7Ci0JCQkJCQkJdm9pZFZpc2l0KGVsZW0pOwotCQkJCQkJCW5OZXdCcmFja2V0cy0tOwotCQkJ
CQkJfQotCQkJCQkJb2Zmc2V0PSBlbmRQb3M7Ci0JCQkJCQluT2xkQnJhY2tldHMtLTsKKwkJUmV3
cml0ZUV2ZW50IGRpbUV2ZW50PSBnZXRFdmVudChub2RlLCBBcnJheUNyZWF0aW9uLkRJTUVOU0lP
TlNfUFJPUEVSVFkpOworCQlib29sZWFuIGhhc0RpbWVuc2lvbkNoYW5nZXM9IChkaW1FdmVudCAh
PSBudWxsICYmIGRpbUV2ZW50LmdldENoYW5nZUtpbmQoKSAhPSBSZXdyaXRlRXZlbnQuVU5DSEFO
R0VEKTsKKwkJUmV3cml0ZUV2ZW50W10gZXZlbnRzPSAoaGFzRGltZW5zaW9uQ2hhbmdlcykgPyBk
aW1FdmVudC5nZXRDaGlsZHJlbigpIDogbnVsbDsKKwkJQXJyYXlUeXBlIGN1cnJlbnRMZXZlbCA9
IChBcnJheVR5cGUpIHJlcGxhY2luZ1R5cGUuZ2V0RWxlbWVudFR5cGUoKS5nZXRQYXJlbnQoKTsK
KwkJTGlzdCBkaW1lbnNpb25zID0gbm9kZS5kaW1lbnNpb25zKCk7CisJCWludCBkaW1TaXplID0g
ZGltZW5zaW9ucy5zaXplKCk7CisJCXdoaWxlKGN1cnJlbnRMZXZlbCAhPSBudWxsKSB7CisJCQlS
ZXdyaXRlRXZlbnQgYW5ub3RhdGlvbnNFdmVudCA9IGdldEV2ZW50KGN1cnJlbnRMZXZlbCwgQXJy
YXlUeXBlLkFOTk9UQVRJT05TX1BST1BFUlRZKTsKKwkJCWJvb2xlYW4gaGFzQW5ub3RhdGlvbkNo
YW5nZXMgPSBhbm5vdGF0aW9uc0V2ZW50ICE9IG51bGwgJiYgYW5ub3RhdGlvbnNFdmVudC5nZXRD
aGFuZ2VLaW5kKCkgIT0gUmV3cml0ZUV2ZW50LlVOQ0hBTkdFRDsKKwkJCWlmIChoYXNBbm5vdGF0
aW9uQ2hhbmdlcykgeworCQkJCW9mZnNldCA9IHJld3JpdGVOb2RlTGlzdChjdXJyZW50TGV2ZWws
IEFycmF5VHlwZS5BTk5PVEFUSU9OU19QUk9QRVJUWSwgb2Zmc2V0LCBVdGlsLkVNUFRZX1NUUklO
RywgIiAiKTsgLy8kTk9OLU5MUy0xJAorCQkJfSBlbHNlIHsKKwkJCQlvZmZzZXQ9IGRvVmlzaXQo
Y3VycmVudExldmVsLCBBcnJheVR5cGUuQU5OT1RBVElPTlNfUFJPUEVSVFksIG9mZnNldCk7CisJ
CQl9CisJCQlpZiAobk5ld0JyYWNrZXRzIDw9IGRpbVNpemUgKSB7CisJCQkJaWYgKGhhc0RpbWVu
c2lvbkNoYW5nZXMpIHsKKwkJCQkJdHJ5IHsKKwkJCQkJCW9mZnNldD0gcmV3cml0ZURpbWVuc2lv
bldpdGhFeHByZXNzaW9ucyhvZmZzZXQsIGV2ZW50c1tuTmV3QnJhY2tldHMtMV0sIGVkaXRHcm91
cCk7CisJCQkJCX0gY2F0Y2ggKENvcmVFeGNlcHRpb24gZSkgeworCQkJCQkJaGFuZGxlRXhjZXB0
aW9uKGUpOwogCQkJCQl9CisJCQkJfSBlbHNlIHsKKwkJCQkJRXhwcmVzc2lvbiBkaW0gPSAoRXhw
cmVzc2lvbikgZGltZW5zaW9ucy5nZXQobk5ld0JyYWNrZXRzLTEpOworCQkJCQl2b2lkVmlzaXQo
ZGltKTsKIAkJCQl9CiAJCQl9IGVsc2UgewotCQkJCW9mZnNldD0gZG9WaXNpdChub2RlLCBBcnJh
eUNyZWF0aW9uLkRJTUVOU0lPTlNfUFJPUEVSVFksIG9mZnNldCk7CisvLwkJCQlkb1RleHRJbnNl
cnQob2Zmc2V0LCAiW10iLCBlZGl0R3JvdXApOyAvLyROT04tTkxTLTEkCisvLwkJCQlvZmZzZXQg
Kz0gMjsKIAkJCX0KLQkJCWlmIChuT2xkQnJhY2tldHMgIT0gbk5ld0JyYWNrZXRzKSB7Ci0JCQkJ
aWYgKCFoYXNEaW1lbnNpb25DaGFuZ2VzKSB7Ci0JCQkJCW9mZnNldD0gZ2V0U2Nhbm5lcigpLmdl
dFRva2VuRW5kT2Zmc2V0KFRlcm1pbmFsVG9rZW5zLlRva2VuTmFtZVJCUkFDS0VULCBvZmZzZXQp
OwotCQkJCX0KLQkJCQlyZXdyaXRlRXh0cmFEaW1lbnNpb25zKG5PbGRCcmFja2V0cywgbk5ld0Jy
YWNrZXRzLCBvZmZzZXQsIGVkaXRHcm91cCk7Ci0JCQl9Ci0KKwkJCWlmIChjdXJyZW50TGV2ZWwg
PT0gcmVwbGFjaW5nVHlwZSkgYnJlYWs7CisJCQljdXJyZW50TGV2ZWwgPSAoQXJyYXlUeXBlKSBj
dXJyZW50TGV2ZWwuZ2V0UGFyZW50KCk7CisJCQluTmV3QnJhY2tldHMtLTsKKwkJfQorCQkKKwkJ
dHJ5IHsKIAkJCWludCBraW5kPSBnZXRDaGFuZ2VLaW5kKG5vZGUsIEFycmF5Q3JlYXRpb24uSU5J
VElBTElaRVJfUFJPUEVSVFkpOwogCQkJaWYgKGtpbmQgPT0gUmV3cml0ZUV2ZW50LlJFTU9WRUQp
IHsKIAkJCQlvZmZzZXQ9IGdldFNjYW5uZXIoKS5nZXRQcmV2aW91c1Rva2VuRW5kT2Zmc2V0KFRl
cm1pbmFsVG9rZW5zLlRva2VuTmFtZUxCUkFDRSwgb2Zmc2V0KTsKLQkJCX0gZWxzZSB7Ci0JCQkJ
b2Zmc2V0PSBub2RlLmdldFN0YXJ0UG9zaXRpb24oKSArIG5vZGUuZ2V0TGVuZ3RoKCk7IC8vIGlu
c2VydCBwb3MKIAkJCX0KIAkJCXJld3JpdGVOb2RlKG5vZGUsIEFycmF5Q3JlYXRpb24uSU5JVElB
TElaRVJfUFJPUEVSVFksIG9mZnNldCwgQVNUUmV3cml0ZUZvcm1hdHRlci5TUEFDRSk7CmRpZmYg
LS1naXQgYS9vcmcuZWNsaXBzZS5qZHQuY29yZS9kb20vb3JnL2VjbGlwc2UvamR0L2ludGVybmFs
L2NvcmUvZG9tL3Jld3JpdGUvQVNUUmV3cml0ZUZsYXR0ZW5lci5qYXZhIGIvb3JnLmVjbGlwc2Uu
amR0LmNvcmUvZG9tL29yZy9lY2xpcHNlL2pkdC9pbnRlcm5hbC9jb3JlL2RvbS9yZXdyaXRlL0FT
VFJld3JpdGVGbGF0dGVuZXIuamF2YQppbmRleCA2NDg1YWZmLi42ZjRkYTEyIDEwMDY0NAotLS0g
YS9vcmcuZWNsaXBzZS5qZHQuY29yZS9kb20vb3JnL2VjbGlwc2UvamR0L2ludGVybmFsL2NvcmUv
ZG9tL3Jld3JpdGUvQVNUUmV3cml0ZUZsYXR0ZW5lci5qYXZhCisrKyBiL29yZy5lY2xpcHNlLmpk
dC5jb3JlL2RvbS9vcmcvZWNsaXBzZS9qZHQvaW50ZXJuYWwvY29yZS9kb20vcmV3cml0ZS9BU1RS
ZXdyaXRlRmxhdHRlbmVyLmphdmEKQEAgLTE3Miw0ICsxNzIsMjIgQEAKIAl9CiAKKwlwcml2YXRl
IHZvaWQgdmlzaXRBcnJheVR5cGVXaXRoRXhwcmVzc2lvbihBcnJheVR5cGUgbm9kZSwgTGlzdCBk
aW1lbnNpb25zLCBpbnQgZGVwdGgpIHsKKwkJaWYgKG5vZGUuZ2V0QVNUKCkuYXBpTGV2ZWwoKSA+
PSBBU1QuSkxTOCkgeworCQkJdmlzaXRMaXN0KG5vZGUsIEFycmF5VHlwZS5BTk5PVEFUSU9OU19Q
Uk9QRVJUWSwgU3RyaW5nLnZhbHVlT2YoJyAnKSwgVXRpbC5FTVBUWV9TVFJJTkcsIFN0cmluZy52
YWx1ZU9mKCcgJykpOworCQl9CisJCWlmIChkZXB0aCA8IGRpbWVuc2lvbnMuc2l6ZSgpKSB7CisJ
CQl0aGlzLnJlc3VsdC5hcHBlbmQoJ1snKTsKKwkJCSgoQVNUTm9kZSkgZGltZW5zaW9ucy5nZXQo
ZGVwdGgpKS5hY2NlcHQodGhpcyk7CisJCQl0aGlzLnJlc3VsdC5hcHBlbmQoJ10nKTsKKwkJfSBl
bHNlIHsKKwkJCXRoaXMucmVzdWx0LmFwcGVuZCgiW10iKTsgLy8kTk9OLU5MUy0xJAorCQl9CisJ
CVR5cGUgY29tcG9uZW50VHlwZSA9IG5vZGUuZ2V0Q29tcG9uZW50VHlwZSgpOworCQlpZiAoY29t
cG9uZW50VHlwZS5pc0FycmF5VHlwZSgpKSB7CisJCQl2aXNpdEFycmF5VHlwZVdpdGhFeHByZXNz
aW9uKChBcnJheVR5cGUpIGNvbXBvbmVudFR5cGUsIGRpbWVuc2lvbnMsIC0tZGVwdGgpOworCQl9
IGVsc2UgeworCQkJY29tcG9uZW50VHlwZS5hY2NlcHQodGhpcyk7CisJCX0KKwl9CiAJcHJpdmF0
ZSB2b2lkIHZpc2l0RXh0cmFEaW1lbnNpb25zKEFTVE5vZGUgbm9kZSwgU2ltcGxlUHJvcGVydHlE
ZXNjcmlwdG9yIGRpbWVuc2lvbnMsIENoaWxkTGlzdFByb3BlcnR5RGVzY3JpcHRvciBkaW1lbnNp
b25zSW5mbykgewogCQlpZiAobm9kZS5nZXRBU1QoKS5hcGlMZXZlbCgpIDwgQVNULkpMUzgpIHsK
QEAgLTIxOCwxOSArMjM2LDcgQEAKIAkJCWVsZW1lbnRUeXBlID0gKFR5cGUpIGdldENoaWxkTm9k
ZShlbGVtZW50VHlwZSwgQXJyYXlUeXBlLkNPTVBPTkVOVF9UWVBFX1BST1BFUlRZKTsKIAkJfQot
Ci0JCWVsZW1lbnRUeXBlLmFjY2VwdCh0aGlzKTsKLQogCQlMaXN0IGxpc3Q9IGdldENoaWxkTGlz
dChub2RlLCBBcnJheUNyZWF0aW9uLkRJTUVOU0lPTlNfUFJPUEVSVFkpOwotCQlmb3IgKGludCBp
PSAwOyBpIDwgbGlzdC5zaXplKCk7IGkrKykgewotCQkJdGhpcy5yZXN1bHQuYXBwZW5kKCdbJyk7
Ci0JCQkoKEFTVE5vZGUpIGxpc3QuZ2V0KGkpKS5hY2NlcHQodGhpcyk7Ci0JCQl0aGlzLnJlc3Vs
dC5hcHBlbmQoJ10nKTsKLQkJCWRpbWVuc2lvbnMtLTsKLQkJfQorCQl2aXNpdEFycmF5VHlwZVdp
dGhFeHByZXNzaW9uKGFycmF5VHlwZSwgbGlzdCwgLS1kaW1lbnNpb25zKTsKIAotCQkvLyBhZGQg
ZW1wdHkgIltdIiBmb3IgZWFjaCBleHRyYSBhcnJheSBkaW1lbnNpb24KLQkJZm9yIChpbnQgaT0g
MDsgaSA8IGRpbWVuc2lvbnM7IGkrKykgewotCQkJdGhpcy5yZXN1bHQuYXBwZW5kKCJbXSIpOyAv
LyROT04tTkxTLTEkCi0JCX0KIAkJQVNUTm9kZSBpbml0aWFsaXplcj0gZ2V0Q2hpbGROb2RlKG5v
ZGUsIEFycmF5Q3JlYXRpb24uSU5JVElBTElaRVJfUFJPUEVSVFkpOwogCQlpZiAoaW5pdGlhbGl6
ZXIgIT0gbnVsbCkgew==
</data>

          </attachment>
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>227431</attachid>
            <date>2013-02-21 23:31:00 -0500</date>
            <delta_ts>2013-03-04 07:11:52 -0500</delta_ts>
            <desc>Updated patch</desc>
            <filename>Fix-for-bug-400568.patch</filename>
            <type>text/plain</type>
            <size>13579</size>
            <attacher name="Jay Arthanareeswaran">jarthana</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3NyYy9vcmcvZWNs
aXBzZS9qZHQvY29yZS90ZXN0cy9yZXdyaXRlL2Rlc2NyaWJpbmcvQVNUUmV3cml0aW5nU3RhdGVt
ZW50c1Rlc3QuamF2YSBiL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3NyYy9vcmcv
ZWNsaXBzZS9qZHQvY29yZS90ZXN0cy9yZXdyaXRlL2Rlc2NyaWJpbmcvQVNUUmV3cml0aW5nU3Rh
dGVtZW50c1Rlc3QuamF2YQppbmRleCBlM2UzMjc2Li40NDg2YzgzIDEwMDY0NAotLS0gYS9vcmcu
ZWNsaXBzZS5qZHQuY29yZS50ZXN0cy5tb2RlbC9zcmMvb3JnL2VjbGlwc2UvamR0L2NvcmUvdGVz
dHMvcmV3cml0ZS9kZXNjcmliaW5nL0FTVFJld3JpdGluZ1N0YXRlbWVudHNUZXN0LmphdmEKKysr
IGIvb3JnLmVjbGlwc2UuamR0LmNvcmUudGVzdHMubW9kZWwvc3JjL29yZy9lY2xpcHNlL2pkdC9j
b3JlL3Rlc3RzL3Jld3JpdGUvZGVzY3JpYmluZy9BU1RSZXdyaXRpbmdTdGF0ZW1lbnRzVGVzdC5q
YXZhCkBAIC0yNiw0ICsyNiw2IEBACiBpbXBvcnQgb3JnLmVjbGlwc2UuamR0LmNvcmUuZG9tLkFT
VE5vZGU7CiBpbXBvcnQgb3JnLmVjbGlwc2UuamR0LmNvcmUuZG9tLkFic3RyYWN0VHlwZURlY2xh
cmF0aW9uOworaW1wb3J0IG9yZy5lY2xpcHNlLmpkdC5jb3JlLmRvbS5BcnJheUNyZWF0aW9uOwor
aW1wb3J0IG9yZy5lY2xpcHNlLmpkdC5jb3JlLmRvbS5BcnJheVR5cGU7CiBpbXBvcnQgb3JnLmVj
bGlwc2UuamR0LmNvcmUuZG9tLkFzc2VydFN0YXRlbWVudDsKIGltcG9ydCBvcmcuZWNsaXBzZS5q
ZHQuY29yZS5kb20uQXNzaWdubWVudDsKQEAgLTM5LDggKzQxLDEwIEBACiBpbXBvcnQgb3JnLmVj
bGlwc2UuamR0LmNvcmUuZG9tLkV4cHJlc3Npb247CiBpbXBvcnQgb3JnLmVjbGlwc2UuamR0LmNv
cmUuZG9tLkV4cHJlc3Npb25TdGF0ZW1lbnQ7CitpbXBvcnQgb3JnLmVjbGlwc2UuamR0LmNvcmUu
ZG9tLkV4dHJhRGltZW5zaW9uOwogaW1wb3J0IG9yZy5lY2xpcHNlLmpkdC5jb3JlLmRvbS5Gb3JT
dGF0ZW1lbnQ7CiBpbXBvcnQgb3JnLmVjbGlwc2UuamR0LmNvcmUuZG9tLklmU3RhdGVtZW50Owog
aW1wb3J0IG9yZy5lY2xpcHNlLmpkdC5jb3JlLmRvbS5JbmZpeEV4cHJlc3Npb247CiBpbXBvcnQg
b3JnLmVjbGlwc2UuamR0LmNvcmUuZG9tLkxhYmVsZWRTdGF0ZW1lbnQ7CitpbXBvcnQgb3JnLmVj
bGlwc2UuamR0LmNvcmUuZG9tLk1hcmtlckFubm90YXRpb247CiBpbXBvcnQgb3JnLmVjbGlwc2Uu
amR0LmNvcmUuZG9tLk1ldGhvZERlY2xhcmF0aW9uOwogaW1wb3J0IG9yZy5lY2xpcHNlLmpkdC5j
b3JlLmRvbS5NZXRob2RJbnZvY2F0aW9uOwpAQCAtNTg5Miw0ICs1ODk2LDkwIEBACiAJCX0KIAl9
CisJcHVibGljIHZvaWQgdGVzdEJ1ZzQwMDU2OF9zaW5jZV84KCkgdGhyb3dzIEV4Y2VwdGlvbiB7
CisJCUlQYWNrYWdlRnJhZ21lbnQgcGFjazE9IHRoaXMuc291cmNlRm9sZGVyLmNyZWF0ZVBhY2th
Z2VGcmFnbWVudCgidGVzdDEiLCBmYWxzZSwgbnVsbCk7CisJCVN0cmluZ0J1ZmZlciBidWY9IG5l
dyBTdHJpbmdCdWZmZXIoKTsKKwkJYnVmLmFwcGVuZCgicGFja2FnZSB0ZXN0MTtcbiIpOworCQli
dWYuYXBwZW5kKCJpbXBvcnQgamF2YS5sYW5nLmFubm90YXRpb24uRWxlbWVudFR5cGU7XG4iKTsK
KwkJYnVmLmFwcGVuZCgicHVibGljIGNsYXNzIEUge1xuIik7CisJCWJ1Zi5hcHBlbmQoIiAgICBw
dWJsaWMgdm9pZCBmb28oKSB7XG4iKTsKKwkJYnVmLmFwcGVuZCgiICAgIAlpbnQgW10gaSBAQW5u
b3QxIEBBbm5vdDIgW10gQEFubm90MSBAQW5ub3QzIFtdID0gbmV3IGludCBAQW5ub3QxIEBBbm5v
dDIgIFsyXSBAQW5ub3QyIEBBbm5vdDMgW3NpemUoKV0gQEFubm90MiBAQW5ub3QxIFtdO1xuIik7
CisJCWJ1Zi5hcHBlbmQoIiAgICAJLy9pbnQgW11bXVtdIGogPSBuZXcgQEFubm90MSBAQW5ub3Qy
IFsyXSBAQW5ub3QyIEBBbm5vdDMgW3NpemUoKV0gQEFubm90MSBAQW5ub3QzIFtdLAlrID0gbmV3
IEBBbm5vdDEgQEFubm90MiBbMl0gQEFubm90MiBAQW5ub3QzIFtzaXplKCldIEBBbm5vdDEgQEFu
bm90MyBbXSBcbiIpOworCQlidWYuYXBwZW5kKCIgICAgfVxuIik7CisJCWJ1Zi5hcHBlbmQoIiAg
ICBwdWJsaWMgaW50IHNpemUoKSB7IHJldHVybiAyOyB9XG4iKTsKKwkJYnVmLmFwcGVuZCgifVxu
Iik7CisJCWJ1Zi5hcHBlbmQoIkBqYXZhLmxhbmcuYW5ub3RhdGlvbi5UYXJnZXQodmFsdWU9IHtF
bGVtZW50VHlwZS5UWVBFX1VTRX0pXG4iKTsKKwkJYnVmLmFwcGVuZCgiQGludGVyZmFjZSBBbm5v
dDEge31cbiIpOworCQlidWYuYXBwZW5kKCJAamF2YS5sYW5nLmFubm90YXRpb24uVGFyZ2V0KHZh
bHVlPSB7RWxlbWVudFR5cGUuVFlQRV9VU0V9KVxuIik7CisJCWJ1Zi5hcHBlbmQoIkBpbnRlcmZh
Y2UgQW5ub3QyIHt9XG4iKTsKKwkJYnVmLmFwcGVuZCgiQGphdmEubGFuZy5hbm5vdGF0aW9uLlRh
cmdldCh2YWx1ZT0ge0VsZW1lbnRUeXBlLlRZUEVfVVNFfSlcbiIpOworCQlidWYuYXBwZW5kKCJA
aW50ZXJmYWNlIEFubm90MiB7fVxuIik7CisJCUlDb21waWxhdGlvblVuaXQgY3U9IHBhY2sxLmNy
ZWF0ZUNvbXBpbGF0aW9uVW5pdCgiRS5qYXZhIiwgYnVmLnRvU3RyaW5nKCksIGZhbHNlLCBudWxs
KTsKKworCQlDb21waWxhdGlvblVuaXQgYXN0Um9vdD0gY3JlYXRlQVNUKGN1KTsKKwkJQVNUIGFz
dD0gYXN0Um9vdC5nZXRBU1QoKTsKKwkJQVNUUmV3cml0ZSByZXdyaXRlPSBBU1RSZXdyaXRlLmNy
ZWF0ZShhc3RSb290LmdldEFTVCgpKTsKKworCQkvLyBHZXQgd2hpbGUgc3RhdGVtZW50IGJsb2Nr
CisJCVR5cGVEZWNsYXJhdGlvbiB0eXBlRGVjbCA9IChUeXBlRGVjbGFyYXRpb24pIGFzdFJvb3Qu
dHlwZXMoKS5nZXQoMCk7CisJCU1ldGhvZERlY2xhcmF0aW9uIG1ldGhvZERlY2w9IHR5cGVEZWNs
LmdldE1ldGhvZHMoKVswXTsKKwkJQmxvY2sgYmxvY2s9IG1ldGhvZERlY2wuZ2V0Qm9keSgpOwor
CQlMaXN0IHN0YXRlbWVudHM9IGJsb2NrLnN0YXRlbWVudHMoKTsKKworCQlWYXJpYWJsZURlY2xh
cmF0aW9uU3RhdGVtZW50IHN0YXRlbWVudCA9IChWYXJpYWJsZURlY2xhcmF0aW9uU3RhdGVtZW50
KSBzdGF0ZW1lbnRzLmdldCgwKTsKKwkJTGlzdCBmcmFnbWVudHMgPSBzdGF0ZW1lbnQuZnJhZ21l
bnRzKCk7CisJCWFzc2VydEVxdWFscygiSW5jb3JyZWN0IG5vIG9mIGZyYWdtZW50cyIsIDEsIGZy
YWdtZW50cy5zaXplKCkpOworCQlWYXJpYWJsZURlY2xhcmF0aW9uRnJhZ21lbnQgZnJhZ21lbnQg
PSAoVmFyaWFibGVEZWNsYXJhdGlvbkZyYWdtZW50KSBmcmFnbWVudHMuZ2V0KDApOworCQlUeXBl
IHR5cGUgPSBzdGF0ZW1lbnQuZ2V0VHlwZSgpOworCisJCXsKKwkJCS8vIEFkZCBuZXcgZGltZW5z
aW9uCisJCQlhc3NlcnRFcXVhbHMoIkluY29ycmVjdCB0eXBlIiwgQVNUTm9kZS5BUlJBWV9UWVBF
LCB0eXBlLmdldE5vZGVUeXBlKCkpOworCQkJQXJyYXlDcmVhdGlvbiBjcmVhdGlvbiA9IChBcnJh
eUNyZWF0aW9uKSBmcmFnbWVudC5nZXRJbml0aWFsaXplcigpOworCisJCQlMaXN0UmV3cml0ZSBs
aXN0UmV3cml0ZT0gcmV3cml0ZS5nZXRMaXN0UmV3cml0ZShmcmFnbWVudCwgVmFyaWFibGVEZWNs
YXJhdGlvbkZyYWdtZW50LkVYVFJBX0RJTUVOU0lPTl9JTkZPU19QUk9QRVJUWSk7CisJCQlFeHRy
YURpbWVuc2lvbiBkaW09IGFzdC5uZXdFeHRyYURpbWVuc2lvbigpOworCQkJTWFya2VyQW5ub3Rh
dGlvbiBtYXJrZXJBbm5vdGF0aW9uOworCQkJbGlzdFJld3JpdGUuaW5zZXJ0QXQoZGltLCAwLCBu
dWxsKTsKKworCQkJQXJyYXlUeXBlIGNyZWF0aW9uVHlwZSA9IGNyZWF0aW9uLmdldFR5cGUoKTsK
KwkJCUFycmF5VHlwZSBuZXdBcnJheVR5cGUgPSBhc3QubmV3QXJyYXlUeXBlKChBcnJheVR5cGUp
IEFTVE5vZGUuY29weVN1YnRyZWUoYXN0LCBjcmVhdGlvblR5cGUpKTsKKwkJCW5ld0FycmF5VHlw
ZSA9IGFzdC5uZXdBcnJheVR5cGUobmV3QXJyYXlUeXBlKTsKKwkJCXJld3JpdGUuc2V0KGNyZWF0
aW9uLCBBcnJheUNyZWF0aW9uLlRZUEVfUFJPUEVSVFksIG5ld0FycmF5VHlwZSwgbnVsbCk7CisK
KwkJCWxpc3RSZXdyaXRlPSByZXdyaXRlLmdldExpc3RSZXdyaXRlKG5ld0FycmF5VHlwZSwgQXJy
YXlUeXBlLkFOTk9UQVRJT05TX1BST1BFUlRZKTsKKwkJCW1hcmtlckFubm90YXRpb249IGFzdC5u
ZXdNYXJrZXJBbm5vdGF0aW9uKCk7CisJCQltYXJrZXJBbm5vdGF0aW9uLnNldFR5cGVOYW1lKGFz
dC5uZXdTaW1wbGVOYW1lKCJBbm5vdDMiKSk7CisJCQlsaXN0UmV3cml0ZS5pbnNlcnRBdChtYXJr
ZXJBbm5vdGF0aW9uLCAwLCBudWxsKTsKKwkJCW5ld0FycmF5VHlwZS5hbm5vdGF0aW9ucygpLmFk
ZChtYXJrZXJBbm5vdGF0aW9uKTsKKwkJCW1hcmtlckFubm90YXRpb249IGFzdC5uZXdNYXJrZXJB
bm5vdGF0aW9uKCk7CisJCQltYXJrZXJBbm5vdGF0aW9uLnNldFR5cGVOYW1lKGFzdC5uZXdTaW1w
bGVOYW1lKCJBbm5vdDIiKSk7CisJCQlsaXN0UmV3cml0ZS5pbnNlcnRBdChtYXJrZXJBbm5vdGF0
aW9uLCAxLCBudWxsKTsKKwkJCW1hcmtlckFubm90YXRpb249IGFzdC5uZXdNYXJrZXJBbm5vdGF0
aW9uKCk7CisJCQltYXJrZXJBbm5vdGF0aW9uLnNldFR5cGVOYW1lKGFzdC5uZXdTaW1wbGVOYW1l
KCJBbm5vdDEiKSk7CisJCQlsaXN0UmV3cml0ZS5pbnNlcnRBdChtYXJrZXJBbm5vdGF0aW9uLCAy
LCBudWxsKTsKKwkJfQorCQkKKwkJLy8gR2V0IG5ldyBjb2RlCisJCVN0cmluZyBwcmV2aWV3PSBl
dmFsdWF0ZVJld3JpdGUoY3UsIHJld3JpdGUpOworCisJCWJ1Zj0gbmV3IFN0cmluZ0J1ZmZlcigp
OworCQlidWYuYXBwZW5kKCJwYWNrYWdlIHRlc3QxO1xuIik7CisJCWJ1Zi5hcHBlbmQoImltcG9y
dCBqYXZhLmxhbmcuYW5ub3RhdGlvbi5FbGVtZW50VHlwZTtcbiIpOworCQlidWYuYXBwZW5kKCJw
dWJsaWMgY2xhc3MgRSB7XG4iKTsKKwkJYnVmLmFwcGVuZCgiICAgIHB1YmxpYyB2b2lkIGZvbygp
IHtcbiIpOworCQlidWYuYXBwZW5kKCIgICAgCWludCBbXSBpIFtdIEBBbm5vdDEgQEFubm90MiBb
XSBAQW5ub3QxIEBBbm5vdDMgW10gPSBuZXcgaW50IEBBbm5vdDEgQEFubm90MiAgWzJdIEBBbm5v
dDIgQEFubm90MyBbc2l6ZSgpXSBAQW5ub3QyIEBBbm5vdDEgW11bXVtdO1xuIik7CisJCWJ1Zi5h
cHBlbmQoIiAgICAJLy9pbnQgW11bXVtdIGogPSBuZXcgQEFubm90MSBAQW5ub3QyIFsyXSBAQW5u
b3QyIEBBbm5vdDMgW3NpemUoKV0gQEFubm90MSBAQW5ub3QzIFtdLAlrID0gbmV3IEBBbm5vdDEg
QEFubm90MiBbMl0gQEFubm90MiBAQW5ub3QzIFtzaXplKCldIEBBbm5vdDEgQEFubm90MyBbXSBc
biIpOworCQlidWYuYXBwZW5kKCIgICAgfVxuIik7CisJCWJ1Zi5hcHBlbmQoIiAgICBwdWJsaWMg
aW50IHNpemUoKSB7IHJldHVybiAyOyB9XG4iKTsKKwkJYnVmLmFwcGVuZCgifVxuIik7CisJCWJ1
Zi5hcHBlbmQoIkBqYXZhLmxhbmcuYW5ub3RhdGlvbi5UYXJnZXQodmFsdWU9IHtFbGVtZW50VHlw
ZS5UWVBFX1VTRX0pXG4iKTsKKwkJYnVmLmFwcGVuZCgiQGludGVyZmFjZSBBbm5vdDEge31cbiIp
OworCQlidWYuYXBwZW5kKCJAamF2YS5sYW5nLmFubm90YXRpb24uVGFyZ2V0KHZhbHVlPSB7RWxl
bWVudFR5cGUuVFlQRV9VU0V9KVxuIik7CisJCWJ1Zi5hcHBlbmQoIkBpbnRlcmZhY2UgQW5ub3Qy
IHt9XG4iKTsKKwkJYnVmLmFwcGVuZCgiQGphdmEubGFuZy5hbm5vdGF0aW9uLlRhcmdldCh2YWx1
ZT0ge0VsZW1lbnRUeXBlLlRZUEVfVVNFfSlcbiIpOworCQlidWYuYXBwZW5kKCJAaW50ZXJmYWNl
IEFubm90MiB7fVxuIik7CisJCWFzc2VydEVxdWFsU3RyaW5nKHByZXZpZXcsIGJ1Zi50b1N0cmlu
ZygpKTsKKwkJCisJfQogfQogCmRpZmYgLS1naXQgYS9vcmcuZWNsaXBzZS5qZHQuY29yZS9kb20v
b3JnL2VjbGlwc2UvamR0L2ludGVybmFsL2NvcmUvZG9tL3Jld3JpdGUvQVNUUmV3cml0ZUFuYWx5
emVyLmphdmEgYi9vcmcuZWNsaXBzZS5qZHQuY29yZS9kb20vb3JnL2VjbGlwc2UvamR0L2ludGVy
bmFsL2NvcmUvZG9tL3Jld3JpdGUvQVNUUmV3cml0ZUFuYWx5emVyLmphdmEKaW5kZXggZjc5YzZk
ZC4uYjBjNzJiZCAxMDA2NDQKLS0tIGEvb3JnLmVjbGlwc2UuamR0LmNvcmUvZG9tL29yZy9lY2xp
cHNlL2pkdC9pbnRlcm5hbC9jb3JlL2RvbS9yZXdyaXRlL0FTVFJld3JpdGVBbmFseXplci5qYXZh
CisrKyBiL29yZy5lY2xpcHNlLmpkdC5jb3JlL2RvbS9vcmcvZWNsaXBzZS9qZHQvaW50ZXJuYWwv
Y29yZS9kb20vcmV3cml0ZS9BU1RSZXdyaXRlQW5hbHl6ZXIuamF2YQpAQCAtMTk3NSw0ICsxOTc1
LDUgQEAKIAogCQlBcnJheVR5cGUgYXJyYXlUeXBlPSAoQXJyYXlUeXBlKSBnZXRPcmlnaW5hbFZh
bHVlKG5vZGUsIEFycmF5Q3JlYXRpb24uVFlQRV9QUk9QRVJUWSk7CisJCUFycmF5VHlwZSByZXBs
YWNpbmdUeXBlID0gYXJyYXlUeXBlOwogCQlpbnQgbk9sZEJyYWNrZXRzPSBnZXREaW1lbnNpb25z
KGFycmF5VHlwZSk7IC8vIG51bWJlciBvZiB0b3RhbCBicmFja2V0cwogCQlpbnQgbk5ld0JyYWNr
ZXRzPSBuT2xkQnJhY2tldHM7CkBAIC0xOTgxLDUgKzE5ODIsNSBAQAogCQlSZXdyaXRlRXZlbnQg
dHlwZUV2ZW50PSBnZXRFdmVudChub2RlLCBBcnJheUNyZWF0aW9uLlRZUEVfUFJPUEVSVFkpOwog
CQlpZiAodHlwZUV2ZW50ICE9IG51bGwgJiYgdHlwZUV2ZW50LmdldENoYW5nZUtpbmQoKSA9PSBS
ZXdyaXRlRXZlbnQuUkVQTEFDRUQpIHsgLy8gY2hhbmdlZCBhcnJheXR5cGUgY2FuIGhhdmUgZGlm
ZmVyZW50IGRpbWVuc2lvbiBvciB0eXBlIG5hbWUKLQkJCUFycmF5VHlwZSByZXBsYWNpbmdUeXBl
PSAoQXJyYXlUeXBlKSB0eXBlRXZlbnQuZ2V0TmV3VmFsdWUoKTsKKwkJCXJlcGxhY2luZ1R5cGU9
IChBcnJheVR5cGUpIHR5cGVFdmVudC5nZXROZXdWYWx1ZSgpOwogCQkJZWRpdEdyb3VwPSBnZXRF
ZGl0R3JvdXAodHlwZUV2ZW50KTsKIAkJCVR5cGUgbmV3VHlwZT0gcmVwbGFjaW5nVHlwZS5nZXRF
bGVtZW50VHlwZSgpOwpAQCAtMTk5OCw1MSArMTk5OSw2NCBAQAogCiAJCXRyeSB7Ci0JCQlpbnQg
b2Zmc2V0PSBnZXRTY2FubmVyKCkuZ2V0VG9rZW5TdGFydE9mZnNldChUZXJtaW5hbFRva2Vucy5U
b2tlbk5hbWVMQlJBQ0tFVCwgYXJyYXlUeXBlLmdldFN0YXJ0UG9zaXRpb24oKSk7CiAJCQkvLyBk
aW1lbnNpb24gbm9kZSB3aXRoIGV4cHJlc3Npb25zCiAJCQlSZXdyaXRlRXZlbnQgZGltRXZlbnQ9
IGdldEV2ZW50KG5vZGUsIEFycmF5Q3JlYXRpb24uRElNRU5TSU9OU19QUk9QRVJUWSk7CiAJCQli
b29sZWFuIGhhc0RpbWVuc2lvbkNoYW5nZXM9IChkaW1FdmVudCAhPSBudWxsICYmIGRpbUV2ZW50
LmdldENoYW5nZUtpbmQoKSAhPSBSZXdyaXRlRXZlbnQuVU5DSEFOR0VEKTsKLQkJCWlmIChoYXNE
aW1lbnNpb25DaGFuZ2VzKSB7Ci0JCQkJUmV3cml0ZUV2ZW50W10gZXZlbnRzPSBkaW1FdmVudC5n
ZXRDaGlsZHJlbigpOwotCQkJCS8vIG9mZnNldCBvbiBmaXJzdCBvcGVuaW5nIGJyYWNlCi0JCQkJ
Zm9yIChpbnQgaT0gMDsgaSA8IGV2ZW50cy5sZW5ndGg7IGkrKykgewotCQkJCQlSZXdyaXRlRXZl
bnQgZXZlbnQ9IGV2ZW50c1tpXTsKLQkJCQkJaW50IGNoYW5nZUtpbmQ9IGV2ZW50LmdldENoYW5n
ZUtpbmQoKTsKLQkJCQkJaWYgKGNoYW5nZUtpbmQgPT0gUmV3cml0ZUV2ZW50LklOU0VSVEVEKSB7
IC8vIGluc2VydCBuZXcgZGltZW5zaW9uCi0JCQkJCQllZGl0R3JvdXA9IGdldEVkaXRHcm91cChl
dmVudCk7Ci0JCQkJCQlkb1RleHRJbnNlcnQob2Zmc2V0LCAiWyIsIGVkaXRHcm91cCk7IC8vJE5P
Ti1OTFMtMSQKLQkJCQkJCWRvVGV4dEluc2VydChvZmZzZXQsIChBU1ROb2RlKSBldmVudC5nZXRO
ZXdWYWx1ZSgpLCAwLCBmYWxzZSwgZWRpdEdyb3VwKTsKLQkJCQkJCWRvVGV4dEluc2VydChvZmZz
ZXQsICJdIiwgZWRpdEdyb3VwKTsgLy8kTk9OLU5MUy0xJAotCQkJCQkJbk5ld0JyYWNrZXRzLS07
Ci0JCQkJCX0gZWxzZSB7Ci0JCQkJCQlBU1ROb2RlIGVsZW09IChBU1ROb2RlKSBldmVudC5nZXRP
cmlnaW5hbFZhbHVlKCk7Ci0JCQkJCQlpbnQgZWxlbUVuZD0gZWxlbS5nZXRTdGFydFBvc2l0aW9u
KCkgKyBlbGVtLmdldExlbmd0aCgpOwotCQkJCQkJaW50IGVuZFBvcz0gZ2V0U2Nhbm5lcigpLmdl
dFRva2VuRW5kT2Zmc2V0KFRlcm1pbmFsVG9rZW5zLlRva2VuTmFtZVJCUkFDS0VULCBlbGVtRW5k
KTsKLQkJCQkJCWlmIChjaGFuZ2VLaW5kID09IFJld3JpdGVFdmVudC5SRU1PVkVEKSB7CisJCQlS
ZXdyaXRlRXZlbnRbXSBldmVudHM9IGhhc0RpbWVuc2lvbkNoYW5nZXMgPyBkaW1FdmVudC5nZXRD
aGlsZHJlbigpIDogbnVsbDsKKwkJCUFycmF5VHlwZSBjdXJyZW50TGV2ZWwgPSAoQXJyYXlUeXBl
KSByZXBsYWNpbmdUeXBlLmdldEVsZW1lbnRUeXBlKCkuZ2V0UGFyZW50KCk7CisJCQlMaXN0IGRp
bWVuc2lvbnMgPSBub2RlLmRpbWVuc2lvbnMoKTsKKwkJCWludCBkaW1TaXplID0gZGltZW5zaW9u
cy5zaXplKCk7CisJCQlpbnQgaSA9IDA7CisJCQlpbnQgb2Zmc2V0PSBjdXJyZW50TGV2ZWwuZ2V0
U3RhcnRQb3NpdGlvbigpOworCQkJd2hpbGUoY3VycmVudExldmVsICE9IG51bGwpIHsKKwkJCQlp
ZiAobm9kZS5nZXRBU1QoKS5hcGlMZXZlbCgpID49IEFTVC5KTFM4KSB7CisJCQkJCSBvZmZzZXQg
PSByZXdyaXRlVHlwZUFubm90YXRpb25zKGN1cnJlbnRMZXZlbCwgQXJyYXlUeXBlLkFOTk9UQVRJ
T05TX1BST1BFUlRZLCBvZmZzZXQpOworCQkJCX0KKwkJCQlpZiAoaSA8IGRpbVNpemUpIHsKKwkJ
CQkJb2Zmc2V0PSBnZXRTY2FubmVyKCkuZ2V0VG9rZW5TdGFydE9mZnNldChUZXJtaW5hbFRva2Vu
cy5Ub2tlbk5hbWVMQlJBQ0tFVCwgb2Zmc2V0KTsKKwkJCQkJaWYgKGhhc0RpbWVuc2lvbkNoYW5n
ZXMpIHsKKwkJCQkJCVJld3JpdGVFdmVudCBldmVudD0gZXZlbnRzW2ldOworCQkJCQkJaW50IGNo
YW5nZUtpbmQ9IGV2ZW50LmdldENoYW5nZUtpbmQoKTsKKwkJCQkJCWlmIChjaGFuZ2VLaW5kID09
IFJld3JpdGVFdmVudC5JTlNFUlRFRCkgeyAvLyBpbnNlcnQgbmV3IGRpbWVuc2lvbgogCQkJCQkJ
CWVkaXRHcm91cD0gZ2V0RWRpdEdyb3VwKGV2ZW50KTsKLQkJCQkJCQlkb1RleHRSZW1vdmVBbmRW
aXNpdChvZmZzZXQsIGVuZFBvcyAtIG9mZnNldCwgZWxlbSwgZWRpdEdyb3VwKTsKLQkJCQkJCX0g
ZWxzZSBpZiAoY2hhbmdlS2luZCA9PSBSZXdyaXRlRXZlbnQuUkVQTEFDRUQpIHsKLQkJCQkJCQll
ZGl0R3JvdXA9IGdldEVkaXRHcm91cChldmVudCk7Ci0JCQkJCQkJU291cmNlUmFuZ2UgcmFuZ2U9
IGdldEV4dGVuZGVkUmFuZ2UoZWxlbSk7Ci0JCQkJCQkJaW50IGVsZW1PZmZzZXQ9IHJhbmdlLmdl
dFN0YXJ0UG9zaXRpb24oKTsKLQkJCQkJCQlpbnQgZWxlbUxlbmd0aD0gcmFuZ2UuZ2V0TGVuZ3Ro
KCk7Ci0JCQkJCQkJZG9UZXh0UmVtb3ZlQW5kVmlzaXQoZWxlbU9mZnNldCwgZWxlbUxlbmd0aCwg
ZWxlbSwgZWRpdEdyb3VwKTsKLQkJCQkJCQlkb1RleHRJbnNlcnQoZWxlbU9mZnNldCwgKEFTVE5v
ZGUpIGV2ZW50LmdldE5ld1ZhbHVlKCksIDAsIGZhbHNlLCBlZGl0R3JvdXApOworCQkJCQkJCWRv
VGV4dEluc2VydChvZmZzZXQsICJbIiwgZWRpdEdyb3VwKTsgLy8kTk9OLU5MUy0xJAorCQkJCQkJ
CWRvVGV4dEluc2VydChvZmZzZXQsIChBU1ROb2RlKSBldmVudC5nZXROZXdWYWx1ZSgpLCAwLCBm
YWxzZSwgZWRpdEdyb3VwKTsKKwkJCQkJCQlkb1RleHRJbnNlcnQob2Zmc2V0LCAiXSIsIGVkaXRH
cm91cCk7IC8vJE5PTi1OTFMtMSQKIAkJCQkJCQluTmV3QnJhY2tldHMtLTsKIAkJCQkJCX0gZWxz
ZSB7Ci0JCQkJCQkJdm9pZFZpc2l0KGVsZW0pOwotCQkJCQkJCW5OZXdCcmFja2V0cy0tOworCQkJ
CQkJCUFTVE5vZGUgZWxlbT0gKEFTVE5vZGUpIGV2ZW50LmdldE9yaWdpbmFsVmFsdWUoKTsKKwkJ
CQkJCQlpbnQgZWxlbUVuZD0gZWxlbS5nZXRTdGFydFBvc2l0aW9uKCkgKyBlbGVtLmdldExlbmd0
aCgpOworCQkJCQkJCWludCBlbmRQb3M9IGdldFNjYW5uZXIoKS5nZXRUb2tlbkVuZE9mZnNldChU
ZXJtaW5hbFRva2Vucy5Ub2tlbk5hbWVSQlJBQ0tFVCwgZWxlbUVuZCk7CisJCQkJCQkJaWYgKGNo
YW5nZUtpbmQgPT0gUmV3cml0ZUV2ZW50LlJFTU9WRUQpIHsKKwkJCQkJCQkJZWRpdEdyb3VwPSBn
ZXRFZGl0R3JvdXAoZXZlbnQpOworCQkJCQkJCQlkb1RleHRSZW1vdmVBbmRWaXNpdChvZmZzZXQs
IGVuZFBvcyAtIG9mZnNldCwgZWxlbSwgZWRpdEdyb3VwKTsKKwkJCQkJCQl9IGVsc2UgaWYgKGNo
YW5nZUtpbmQgPT0gUmV3cml0ZUV2ZW50LlJFUExBQ0VEKSB7CisJCQkJCQkJCWVkaXRHcm91cD0g
Z2V0RWRpdEdyb3VwKGV2ZW50KTsKKwkJCQkJCQkJU291cmNlUmFuZ2UgcmFuZ2U9IGdldEV4dGVu
ZGVkUmFuZ2UoZWxlbSk7CisJCQkJCQkJCWludCBlbGVtT2Zmc2V0PSByYW5nZS5nZXRTdGFydFBv
c2l0aW9uKCk7CisJCQkJCQkJCWludCBlbGVtTGVuZ3RoPSByYW5nZS5nZXRMZW5ndGgoKTsKKwkJ
CQkJCQkJZG9UZXh0UmVtb3ZlQW5kVmlzaXQoZWxlbU9mZnNldCwgZWxlbUxlbmd0aCwgZWxlbSwg
ZWRpdEdyb3VwKTsKKwkJCQkJCQkJZG9UZXh0SW5zZXJ0KGVsZW1PZmZzZXQsIChBU1ROb2RlKSBl
dmVudC5nZXROZXdWYWx1ZSgpLCAwLCBmYWxzZSwgZWRpdEdyb3VwKTsKKwkJCQkJCQkJbk5ld0Jy
YWNrZXRzLS07CisJCQkJCQkJfSBlbHNlIHsKKwkJCQkJCQkJdm9pZFZpc2l0KGVsZW0pOworCQkJ
CQkJCQluTmV3QnJhY2tldHMtLTsKKwkJCQkJCQl9CisJCQkJCQkJb2Zmc2V0PSBlbmRQb3M7CisJ
CQkJCQkJbk9sZEJyYWNrZXRzLS07CiAJCQkJCQl9Ci0JCQkJCQlvZmZzZXQ9IGVuZFBvczsKLQkJ
CQkJCW5PbGRCcmFja2V0cy0tOworCQkJCQl9IGVsc2UgeworCQkJCQkJQVNUTm9kZSBlbGVtID0g
KEFTVE5vZGUpIG5vZGUuZGltZW5zaW9ucygpLmdldChpKTsKKwkJCQkJCXZvaWRWaXNpdChlbGVt
KTsKKwkJCQkJCW9mZnNldD0gZ2V0U2Nhbm5lcigpLmdldFRva2VuRW5kT2Zmc2V0KFRlcm1pbmFs
VG9rZW5zLlRva2VuTmFtZVJCUkFDS0VULCBvZmZzZXQpOwogCQkJCQl9Ci0JCQkJfQotCQkJfSBl
bHNlIHsKLQkJCQlvZmZzZXQ9IGRvVmlzaXQobm9kZSwgQXJyYXlDcmVhdGlvbi5ESU1FTlNJT05T
X1BST1BFUlRZLCBvZmZzZXQpOwotCQkJfQotCQkJaWYgKG5PbGRCcmFja2V0cyAhPSBuTmV3QnJh
Y2tldHMpIHsKLQkJCQlpZiAoIWhhc0RpbWVuc2lvbkNoYW5nZXMpIHsKKwkJCQl9IAorCQkJCWVs
c2UgaWYgKGkgPCBuT2xkQnJhY2tldHMpIHsKIAkJCQkJb2Zmc2V0PSBnZXRTY2FubmVyKCkuZ2V0
VG9rZW5FbmRPZmZzZXQoVGVybWluYWxUb2tlbnMuVG9rZW5OYW1lUkJSQUNLRVQsIG9mZnNldCk7
CisJCQkJfSBlbHNlIHsKKwkJCQkJZG9UZXh0SW5zZXJ0KG9mZnNldCwgIltdIiwgZWRpdEdyb3Vw
KTsgLy8kTk9OLU5MUy0xJAogCQkJCX0KLQkJCQlyZXdyaXRlRXh0cmFEaW1lbnNpb25zKG5PbGRC
cmFja2V0cywgbk5ld0JyYWNrZXRzLCBvZmZzZXQsIGVkaXRHcm91cCk7CisJCQkJaWYgKGN1cnJl
bnRMZXZlbCA9PSByZXBsYWNpbmdUeXBlKSBicmVhazsKKwkJCQljdXJyZW50TGV2ZWwgPSAoQXJy
YXlUeXBlKSBjdXJyZW50TGV2ZWwuZ2V0UGFyZW50KCk7CisJCQkJaSsrOwogCQkJfQogCmRpZmYg
LS1naXQgYS9vcmcuZWNsaXBzZS5qZHQuY29yZS9kb20vb3JnL2VjbGlwc2UvamR0L2ludGVybmFs
L2NvcmUvZG9tL3Jld3JpdGUvQVNUUmV3cml0ZUZsYXR0ZW5lci5qYXZhIGIvb3JnLmVjbGlwc2Uu
amR0LmNvcmUvZG9tL29yZy9lY2xpcHNlL2pkdC9pbnRlcm5hbC9jb3JlL2RvbS9yZXdyaXRlL0FT
VFJld3JpdGVGbGF0dGVuZXIuamF2YQppbmRleCA2NDg1YWZmLi42ZjRkYTEyIDEwMDY0NAotLS0g
YS9vcmcuZWNsaXBzZS5qZHQuY29yZS9kb20vb3JnL2VjbGlwc2UvamR0L2ludGVybmFsL2NvcmUv
ZG9tL3Jld3JpdGUvQVNUUmV3cml0ZUZsYXR0ZW5lci5qYXZhCisrKyBiL29yZy5lY2xpcHNlLmpk
dC5jb3JlL2RvbS9vcmcvZWNsaXBzZS9qZHQvaW50ZXJuYWwvY29yZS9kb20vcmV3cml0ZS9BU1RS
ZXdyaXRlRmxhdHRlbmVyLmphdmEKQEAgLTE3Miw0ICsxNzIsMjIgQEAKIAl9CiAKKwlwcml2YXRl
IHZvaWQgdmlzaXRBcnJheVR5cGVXaXRoRXhwcmVzc2lvbihBcnJheVR5cGUgbm9kZSwgTGlzdCBk
aW1lbnNpb25zLCBpbnQgZGVwdGgpIHsKKwkJaWYgKG5vZGUuZ2V0QVNUKCkuYXBpTGV2ZWwoKSA+
PSBBU1QuSkxTOCkgeworCQkJdmlzaXRMaXN0KG5vZGUsIEFycmF5VHlwZS5BTk5PVEFUSU9OU19Q
Uk9QRVJUWSwgU3RyaW5nLnZhbHVlT2YoJyAnKSwgVXRpbC5FTVBUWV9TVFJJTkcsIFN0cmluZy52
YWx1ZU9mKCcgJykpOworCQl9CisJCWlmIChkZXB0aCA8IGRpbWVuc2lvbnMuc2l6ZSgpKSB7CisJ
CQl0aGlzLnJlc3VsdC5hcHBlbmQoJ1snKTsKKwkJCSgoQVNUTm9kZSkgZGltZW5zaW9ucy5nZXQo
ZGVwdGgpKS5hY2NlcHQodGhpcyk7CisJCQl0aGlzLnJlc3VsdC5hcHBlbmQoJ10nKTsKKwkJfSBl
bHNlIHsKKwkJCXRoaXMucmVzdWx0LmFwcGVuZCgiW10iKTsgLy8kTk9OLU5MUy0xJAorCQl9CisJ
CVR5cGUgY29tcG9uZW50VHlwZSA9IG5vZGUuZ2V0Q29tcG9uZW50VHlwZSgpOworCQlpZiAoY29t
cG9uZW50VHlwZS5pc0FycmF5VHlwZSgpKSB7CisJCQl2aXNpdEFycmF5VHlwZVdpdGhFeHByZXNz
aW9uKChBcnJheVR5cGUpIGNvbXBvbmVudFR5cGUsIGRpbWVuc2lvbnMsIC0tZGVwdGgpOworCQl9
IGVsc2UgeworCQkJY29tcG9uZW50VHlwZS5hY2NlcHQodGhpcyk7CisJCX0KKwl9CiAJcHJpdmF0
ZSB2b2lkIHZpc2l0RXh0cmFEaW1lbnNpb25zKEFTVE5vZGUgbm9kZSwgU2ltcGxlUHJvcGVydHlE
ZXNjcmlwdG9yIGRpbWVuc2lvbnMsIENoaWxkTGlzdFByb3BlcnR5RGVzY3JpcHRvciBkaW1lbnNp
b25zSW5mbykgewogCQlpZiAobm9kZS5nZXRBU1QoKS5hcGlMZXZlbCgpIDwgQVNULkpMUzgpIHsK
QEAgLTIxOCwxOSArMjM2LDcgQEAKIAkJCWVsZW1lbnRUeXBlID0gKFR5cGUpIGdldENoaWxkTm9k
ZShlbGVtZW50VHlwZSwgQXJyYXlUeXBlLkNPTVBPTkVOVF9UWVBFX1BST1BFUlRZKTsKIAkJfQot
Ci0JCWVsZW1lbnRUeXBlLmFjY2VwdCh0aGlzKTsKLQogCQlMaXN0IGxpc3Q9IGdldENoaWxkTGlz
dChub2RlLCBBcnJheUNyZWF0aW9uLkRJTUVOU0lPTlNfUFJPUEVSVFkpOwotCQlmb3IgKGludCBp
PSAwOyBpIDwgbGlzdC5zaXplKCk7IGkrKykgewotCQkJdGhpcy5yZXN1bHQuYXBwZW5kKCdbJyk7
Ci0JCQkoKEFTVE5vZGUpIGxpc3QuZ2V0KGkpKS5hY2NlcHQodGhpcyk7Ci0JCQl0aGlzLnJlc3Vs
dC5hcHBlbmQoJ10nKTsKLQkJCWRpbWVuc2lvbnMtLTsKLQkJfQorCQl2aXNpdEFycmF5VHlwZVdp
dGhFeHByZXNzaW9uKGFycmF5VHlwZSwgbGlzdCwgLS1kaW1lbnNpb25zKTsKIAotCQkvLyBhZGQg
ZW1wdHkgIltdIiBmb3IgZWFjaCBleHRyYSBhcnJheSBkaW1lbnNpb24KLQkJZm9yIChpbnQgaT0g
MDsgaSA8IGRpbWVuc2lvbnM7IGkrKykgewotCQkJdGhpcy5yZXN1bHQuYXBwZW5kKCJbXSIpOyAv
LyROT04tTkxTLTEkCi0JCX0KIAkJQVNUTm9kZSBpbml0aWFsaXplcj0gZ2V0Q2hpbGROb2RlKG5v
ZGUsIEFycmF5Q3JlYXRpb24uSU5JVElBTElaRVJfUFJPUEVSVFkpOwogCQlpZiAoaW5pdGlhbGl6
ZXIgIT0gbnVsbCkgew==
</data>

          </attachment>
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>227872</attachid>
            <date>2013-03-04 07:11:00 -0500</date>
            <delta_ts>2013-03-06 05:04:29 -0500</delta_ts>
            <desc>Updated patch</desc>
            <filename>Fix-for-bug-400568.patch</filename>
            <type>text/plain</type>
            <size>18040</size>
            <attacher name="Jay Arthanareeswaran">jarthana</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3NyYy9vcmcvZWNs
aXBzZS9qZHQvY29yZS90ZXN0cy9yZXdyaXRlL2Rlc2NyaWJpbmcvQVNUUmV3cml0aW5nU3RhdGVt
ZW50c1Rlc3QuamF2YSBiL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3NyYy9vcmcv
ZWNsaXBzZS9qZHQvY29yZS90ZXN0cy9yZXdyaXRlL2Rlc2NyaWJpbmcvQVNUUmV3cml0aW5nU3Rh
dGVtZW50c1Rlc3QuamF2YQppbmRleCBhMDIzOTY0Li5iZGM4YjBiIDEwMDY0NAotLS0gYS9vcmcu
ZWNsaXBzZS5qZHQuY29yZS50ZXN0cy5tb2RlbC9zcmMvb3JnL2VjbGlwc2UvamR0L2NvcmUvdGVz
dHMvcmV3cml0ZS9kZXNjcmliaW5nL0FTVFJld3JpdGluZ1N0YXRlbWVudHNUZXN0LmphdmEKKysr
IGIvb3JnLmVjbGlwc2UuamR0LmNvcmUudGVzdHMubW9kZWwvc3JjL29yZy9lY2xpcHNlL2pkdC9j
b3JlL3Rlc3RzL3Jld3JpdGUvZGVzY3JpYmluZy9BU1RSZXdyaXRpbmdTdGF0ZW1lbnRzVGVzdC5q
YXZhCkBAIC0yNiw0ICsyNiw2IEBACiBpbXBvcnQgb3JnLmVjbGlwc2UuamR0LmNvcmUuZG9tLkFT
VE5vZGU7CiBpbXBvcnQgb3JnLmVjbGlwc2UuamR0LmNvcmUuZG9tLkFic3RyYWN0VHlwZURlY2xh
cmF0aW9uOworaW1wb3J0IG9yZy5lY2xpcHNlLmpkdC5jb3JlLmRvbS5BcnJheUNyZWF0aW9uOwor
aW1wb3J0IG9yZy5lY2xpcHNlLmpkdC5jb3JlLmRvbS5BcnJheVR5cGU7CiBpbXBvcnQgb3JnLmVj
bGlwc2UuamR0LmNvcmUuZG9tLkFzc2VydFN0YXRlbWVudDsKIGltcG9ydCBvcmcuZWNsaXBzZS5q
ZHQuY29yZS5kb20uQXNzaWdubWVudDsKQEAgLTM5LDggKzQxLDEwIEBACiBpbXBvcnQgb3JnLmVj
bGlwc2UuamR0LmNvcmUuZG9tLkV4cHJlc3Npb247CiBpbXBvcnQgb3JnLmVjbGlwc2UuamR0LmNv
cmUuZG9tLkV4cHJlc3Npb25TdGF0ZW1lbnQ7CitpbXBvcnQgb3JnLmVjbGlwc2UuamR0LmNvcmUu
ZG9tLkV4dHJhRGltZW5zaW9uOwogaW1wb3J0IG9yZy5lY2xpcHNlLmpkdC5jb3JlLmRvbS5Gb3JT
dGF0ZW1lbnQ7CiBpbXBvcnQgb3JnLmVjbGlwc2UuamR0LmNvcmUuZG9tLklmU3RhdGVtZW50Owog
aW1wb3J0IG9yZy5lY2xpcHNlLmpkdC5jb3JlLmRvbS5JbmZpeEV4cHJlc3Npb247CiBpbXBvcnQg
b3JnLmVjbGlwc2UuamR0LmNvcmUuZG9tLkxhYmVsZWRTdGF0ZW1lbnQ7CitpbXBvcnQgb3JnLmVj
bGlwc2UuamR0LmNvcmUuZG9tLk1hcmtlckFubm90YXRpb247CiBpbXBvcnQgb3JnLmVjbGlwc2Uu
amR0LmNvcmUuZG9tLk1ldGhvZERlY2xhcmF0aW9uOwogaW1wb3J0IG9yZy5lY2xpcHNlLmpkdC5j
b3JlLmRvbS5NZXRob2RJbnZvY2F0aW9uOwpAQCAtNTg5Niw0ICs1OTAwLDE1NCBAQAogCQl9CiAJ
fQorCXB1YmxpYyB2b2lkIHRlc3RCdWc0MDA1Njhfc2luY2VfOCgpIHRocm93cyBFeGNlcHRpb24g
eworCQlJUGFja2FnZUZyYWdtZW50IHBhY2sxPSB0aGlzLnNvdXJjZUZvbGRlci5jcmVhdGVQYWNr
YWdlRnJhZ21lbnQoInRlc3QxIiwgZmFsc2UsIG51bGwpOworCQlTdHJpbmdCdWZmZXIgYnVmPSBu
ZXcgU3RyaW5nQnVmZmVyKCk7CisJCWJ1Zi5hcHBlbmQoInBhY2thZ2UgdGVzdDE7XG4iKTsKKwkJ
YnVmLmFwcGVuZCgiaW1wb3J0IGphdmEubGFuZy5hbm5vdGF0aW9uLkVsZW1lbnRUeXBlO1xuIik7
CisJCWJ1Zi5hcHBlbmQoInB1YmxpYyBjbGFzcyBFIHtcbiIpOworCQlidWYuYXBwZW5kKCIgICAg
cHVibGljIHZvaWQgZm9vKCkge1xuIik7CisJCWJ1Zi5hcHBlbmQoIiAgICAJaW50IFtdIGkgQEFu
bm90MSBAQW5ub3QyIFtdIEBBbm5vdDEgQEFubm90MyBbXSA9IG5ldyBpbnQgQEFubm90MSBAQW5u
b3QyICBbMl0gQEFubm90MiBAQW5ub3QzIFtzaXplKCldIEBBbm5vdDIgQEFubm90MSBbXTtcbiIp
OworCQlidWYuYXBwZW5kKCIgICAgCWludCBbXSBqIFtdW10gPSBuZXcgaW50IEBBbm5vdDEgQEFu
bm90MiBbMl0gQEFubm90MiBAQW5ub3QzIFtzaXplKCldIEBBbm5vdDEgQEFubm90MyBbXSwgayBb
XVtdID0gbmV3IGludCBAQW5ub3QxIEBBbm5vdDIgWzJdIEBBbm5vdDIgQEFubm90MyBbc2l6ZSgp
XSBAQW5ub3QxIEBBbm5vdDMgW107XG4iKTsKKwkJYnVmLmFwcGVuZCgiICAgIH1cbiIpOworCQli
dWYuYXBwZW5kKCIgICAgcHVibGljIGludCBzaXplKCkgeyByZXR1cm4gMjsgfVxuIik7CisJCWJ1
Zi5hcHBlbmQoIn1cbiIpOworCQlidWYuYXBwZW5kKCJAamF2YS5sYW5nLmFubm90YXRpb24uVGFy
Z2V0KHZhbHVlPSB7RWxlbWVudFR5cGUuVFlQRV9VU0V9KVxuIik7CisJCWJ1Zi5hcHBlbmQoIkBp
bnRlcmZhY2UgQW5ub3QxIHt9XG4iKTsKKwkJYnVmLmFwcGVuZCgiQGphdmEubGFuZy5hbm5vdGF0
aW9uLlRhcmdldCh2YWx1ZT0ge0VsZW1lbnRUeXBlLlRZUEVfVVNFfSlcbiIpOworCQlidWYuYXBw
ZW5kKCJAaW50ZXJmYWNlIEFubm90MiB7fVxuIik7CisJCWJ1Zi5hcHBlbmQoIkBqYXZhLmxhbmcu
YW5ub3RhdGlvbi5UYXJnZXQodmFsdWU9IHtFbGVtZW50VHlwZS5UWVBFX1VTRX0pXG4iKTsKKwkJ
YnVmLmFwcGVuZCgiQGludGVyZmFjZSBBbm5vdDIge31cbiIpOworCQlJQ29tcGlsYXRpb25Vbml0
IGN1PSBwYWNrMS5jcmVhdGVDb21waWxhdGlvblVuaXQoIkUuamF2YSIsIGJ1Zi50b1N0cmluZygp
LCBmYWxzZSwgbnVsbCk7CisKKwkJQ29tcGlsYXRpb25Vbml0IGFzdFJvb3Q9IGNyZWF0ZUFTVChj
dSk7CisJCUFTVCBhc3Q9IGFzdFJvb3QuZ2V0QVNUKCk7CisJCUFTVFJld3JpdGUgcmV3cml0ZT0g
QVNUUmV3cml0ZS5jcmVhdGUoYXN0Um9vdC5nZXRBU1QoKSk7CisKKwkJLy8gR2V0IHdoaWxlIHN0
YXRlbWVudCBibG9jaworCQlUeXBlRGVjbGFyYXRpb24gdHlwZURlY2wgPSAoVHlwZURlY2xhcmF0
aW9uKSBhc3RSb290LnR5cGVzKCkuZ2V0KDApOworCQlNZXRob2REZWNsYXJhdGlvbiBtZXRob2RE
ZWNsPSB0eXBlRGVjbC5nZXRNZXRob2RzKClbMF07CisJCUJsb2NrIGJsb2NrPSBtZXRob2REZWNs
LmdldEJvZHkoKTsKKwkJTGlzdCBzdGF0ZW1lbnRzPSBibG9jay5zdGF0ZW1lbnRzKCk7CisKKwkJ
VmFyaWFibGVEZWNsYXJhdGlvblN0YXRlbWVudCBzdGF0ZW1lbnQgPSAoVmFyaWFibGVEZWNsYXJh
dGlvblN0YXRlbWVudCkgc3RhdGVtZW50cy5nZXQoMCk7CisJCUxpc3QgZnJhZ21lbnRzID0gc3Rh
dGVtZW50LmZyYWdtZW50cygpOworCQlWYXJpYWJsZURlY2xhcmF0aW9uRnJhZ21lbnQgZnJhZ21l
bnQgPSAoVmFyaWFibGVEZWNsYXJhdGlvbkZyYWdtZW50KSBmcmFnbWVudHMuZ2V0KDApOworCQlU
eXBlIHR5cGUgPSBzdGF0ZW1lbnQuZ2V0VHlwZSgpOworCisJCXsKKwkJCS8vIEFkZCBuZXcgZGlt
ZW5zaW9uIHdpdGggYW5kIHdpdGhvdXQgYW5ub3RhdGlvbnMKKwkJCWFzc2VydEVxdWFscygiSW5j
b3JyZWN0IHR5cGUiLCBBU1ROb2RlLkFSUkFZX1RZUEUsIHR5cGUuZ2V0Tm9kZVR5cGUoKSk7CisJ
CQlBcnJheUNyZWF0aW9uIGNyZWF0aW9uID0gKEFycmF5Q3JlYXRpb24pIGZyYWdtZW50LmdldElu
aXRpYWxpemVyKCk7CisKKwkJCUxpc3RSZXdyaXRlIGxpc3RSZXdyaXRlPSByZXdyaXRlLmdldExp
c3RSZXdyaXRlKGZyYWdtZW50LCBWYXJpYWJsZURlY2xhcmF0aW9uRnJhZ21lbnQuRVhUUkFfRElN
RU5TSU9OUzJfUFJPUEVSVFkpOworCQkJRXh0cmFEaW1lbnNpb24gZGltPSBhc3QubmV3RXh0cmFE
aW1lbnNpb24oKTsKKwkJCU1hcmtlckFubm90YXRpb24gbWFya2VyQW5ub3RhdGlvbjsKKwkJCWxp
c3RSZXdyaXRlLmluc2VydEF0KGRpbSwgMCwgbnVsbCk7CisKKwkJCUFycmF5VHlwZSBjcmVhdGlv
blR5cGUgPSBjcmVhdGlvbi5nZXRUeXBlKCk7CisJCQlBcnJheVR5cGUgbmV3QXJyYXlUeXBlID0g
YXN0Lm5ld0FycmF5VHlwZSgoQXJyYXlUeXBlKSBBU1ROb2RlLmNvcHlTdWJ0cmVlKGFzdCwgY3Jl
YXRpb25UeXBlKSk7CisJCQluZXdBcnJheVR5cGUgPSBhc3QubmV3QXJyYXlUeXBlKG5ld0FycmF5
VHlwZSk7CisJCQlyZXdyaXRlLnNldChjcmVhdGlvbiwgQXJyYXlDcmVhdGlvbi5UWVBFX1BST1BF
UlRZLCBuZXdBcnJheVR5cGUsIG51bGwpOworCisJCQlsaXN0UmV3cml0ZT0gcmV3cml0ZS5nZXRM
aXN0UmV3cml0ZShuZXdBcnJheVR5cGUsIEFycmF5VHlwZS5BTk5PVEFUSU9OU19QUk9QRVJUWSk7
CisJCQltYXJrZXJBbm5vdGF0aW9uPSBhc3QubmV3TWFya2VyQW5ub3RhdGlvbigpOworCQkJbWFy
a2VyQW5ub3RhdGlvbi5zZXRUeXBlTmFtZShhc3QubmV3U2ltcGxlTmFtZSgiQW5ub3QzIikpOwor
CQkJbGlzdFJld3JpdGUuaW5zZXJ0QXQobWFya2VyQW5ub3RhdGlvbiwgMCwgbnVsbCk7CisJCQlu
ZXdBcnJheVR5cGUuYW5ub3RhdGlvbnMoKS5hZGQobWFya2VyQW5ub3RhdGlvbik7CisJCQltYXJr
ZXJBbm5vdGF0aW9uPSBhc3QubmV3TWFya2VyQW5ub3RhdGlvbigpOworCQkJbWFya2VyQW5ub3Rh
dGlvbi5zZXRUeXBlTmFtZShhc3QubmV3U2ltcGxlTmFtZSgiQW5ub3QyIikpOworCQkJbGlzdFJl
d3JpdGUuaW5zZXJ0QXQobWFya2VyQW5ub3RhdGlvbiwgMSwgbnVsbCk7CisJCQltYXJrZXJBbm5v
dGF0aW9uPSBhc3QubmV3TWFya2VyQW5ub3RhdGlvbigpOworCQkJbWFya2VyQW5ub3RhdGlvbi5z
ZXRUeXBlTmFtZShhc3QubmV3U2ltcGxlTmFtZSgiQW5ub3QxIikpOworCQkJbGlzdFJld3JpdGUu
aW5zZXJ0QXQobWFya2VyQW5ub3RhdGlvbiwgMiwgbnVsbCk7CisJCX0KKwkJeworCQkJc3RhdGVt
ZW50ID0gKFZhcmlhYmxlRGVjbGFyYXRpb25TdGF0ZW1lbnQpIHN0YXRlbWVudHMuZ2V0KDEpOwor
CQkJZnJhZ21lbnRzID0gc3RhdGVtZW50LmZyYWdtZW50cygpOworCQkJYXNzZXJ0RXF1YWxzKCJJ
bmNvcnJlY3Qgbm8gb2YgZnJhZ21lbnRzIiwgMiwgZnJhZ21lbnRzLnNpemUoKSk7CisJCQlmcmFn
bWVudCA9IChWYXJpYWJsZURlY2xhcmF0aW9uRnJhZ21lbnQpIGZyYWdtZW50cy5nZXQoMCk7CisJ
CQl0eXBlID0gc3RhdGVtZW50LmdldFR5cGUoKTsKKworCQkJLy8gTW9kaWZ5IGV4aXN0aW5nIGFu
bm90YXRpb25zIGJ5IGFsdGVyaW5nIGFubm90YXRpb25zIGFuZCBleHByZXNzaW9ucworCQkJYXNz
ZXJ0RXF1YWxzKCJJbmNvcnJlY3QgdHlwZSIsIEFTVE5vZGUuQVJSQVlfVFlQRSwgdHlwZS5nZXRO
b2RlVHlwZSgpKTsKKwkJCUFycmF5Q3JlYXRpb24gY3JlYXRpb24gPSAoQXJyYXlDcmVhdGlvbikg
ZnJhZ21lbnQuZ2V0SW5pdGlhbGl6ZXIoKTsKKwkJCUFycmF5VHlwZSBjcmVhdGlvblR5cGUgPSBj
cmVhdGlvbi5nZXRUeXBlKCk7CisKKwkJCUxpc3QgZXhwcmVzc2lvbnMgPSBjcmVhdGlvbi5kaW1l
bnNpb25zKCk7CisJCQlMaXN0UmV3cml0ZSBsaXN0UmV3cml0ZSA9IHJld3JpdGUuZ2V0TGlzdFJl
d3JpdGUoY3JlYXRpb24sIEFycmF5Q3JlYXRpb24uRElNRU5TSU9OU19QUk9QRVJUWSk7CisJCQls
aXN0UmV3cml0ZS5yZW1vdmUoKEV4cHJlc3Npb24pIGV4cHJlc3Npb25zLmdldCgxKSwgbnVsbCk7
CisJCQkKKwkJCWxpc3RSZXdyaXRlID0gcmV3cml0ZS5nZXRMaXN0UmV3cml0ZShjcmVhdGlvblR5
cGUsIEFycmF5VHlwZS5BTk5PVEFUSU9OU19QUk9QRVJUWSk7CisJCQlNYXJrZXJBbm5vdGF0aW9u
IGFubm90YXRpb24gPSAoTWFya2VyQW5ub3RhdGlvbikgY3JlYXRpb25UeXBlLmFubm90YXRpb25z
KCkuZ2V0KDApOworCQkJbGlzdFJld3JpdGUucmVtb3ZlKGFubm90YXRpb24sIG51bGwpOworCQkJ
CisJCQljcmVhdGlvblR5cGUgPSAoQXJyYXlUeXBlKSBjcmVhdGlvblR5cGUuZ2V0Q29tcG9uZW50
VHlwZSgpOworCQkJbGlzdFJld3JpdGUgPSByZXdyaXRlLmdldExpc3RSZXdyaXRlKGNyZWF0aW9u
VHlwZSwgQXJyYXlUeXBlLkFOTk9UQVRJT05TX1BST1BFUlRZKTsKKwkJCWFubm90YXRpb24gPSAo
TWFya2VyQW5ub3RhdGlvbikgY3JlYXRpb25UeXBlLmFubm90YXRpb25zKCkuZ2V0KDEpOworCQkJ
bGlzdFJld3JpdGUucmVtb3ZlKGFubm90YXRpb24sIG51bGwpOworCisJCQljcmVhdGlvblR5cGUg
PSAoQXJyYXlUeXBlKSBjcmVhdGlvblR5cGUuZ2V0Q29tcG9uZW50VHlwZSgpOworCQkJbGlzdFJl
d3JpdGUgPSByZXdyaXRlLmdldExpc3RSZXdyaXRlKGNyZWF0aW9uVHlwZSwgQXJyYXlUeXBlLkFO
Tk9UQVRJT05TX1BST1BFUlRZKTsKKwkJCWFubm90YXRpb24gPSAoTWFya2VyQW5ub3RhdGlvbikg
Y3JlYXRpb25UeXBlLmFubm90YXRpb25zKCkuZ2V0KDEpOworCQkJbGlzdFJld3JpdGUucmVtb3Zl
KGFubm90YXRpb24sIG51bGwpOworCisJCQlmcmFnbWVudCA9IChWYXJpYWJsZURlY2xhcmF0aW9u
RnJhZ21lbnQpIGZyYWdtZW50cy5nZXQoMSk7CisJCQl0eXBlID0gc3RhdGVtZW50LmdldFR5cGUo
KTsKKworCQkJYXNzZXJ0RXF1YWxzKCJJbmNvcnJlY3QgdHlwZSIsIEFTVE5vZGUuQVJSQVlfVFlQ
RSwgdHlwZS5nZXROb2RlVHlwZSgpKTsKKwkJCWNyZWF0aW9uID0gKEFycmF5Q3JlYXRpb24pIGZy
YWdtZW50LmdldEluaXRpYWxpemVyKCk7CisJCQljcmVhdGlvblR5cGUgPSBjcmVhdGlvbi5nZXRU
eXBlKCk7CisKKwkJCWxpc3RSZXdyaXRlID0gcmV3cml0ZS5nZXRMaXN0UmV3cml0ZShjcmVhdGlv
blR5cGUsIEFycmF5VHlwZS5BTk5PVEFUSU9OU19QUk9QRVJUWSk7CisJCQlhbm5vdGF0aW9uID0g
KE1hcmtlckFubm90YXRpb24pIGNyZWF0aW9uVHlwZS5hbm5vdGF0aW9ucygpLmdldCgwKTsKKwkJ
CWxpc3RSZXdyaXRlLnJlbW92ZShhbm5vdGF0aW9uLCBudWxsKTsKKwkJCWFubm90YXRpb24gPSAo
TWFya2VyQW5ub3RhdGlvbikgY3JlYXRpb25UeXBlLmFubm90YXRpb25zKCkuZ2V0KDEpOworCQkJ
bGlzdFJld3JpdGUucmVtb3ZlKGFubm90YXRpb24sIG51bGwpOworCQkJCisJCQljcmVhdGlvblR5
cGUgPSAoQXJyYXlUeXBlKSBjcmVhdGlvblR5cGUuZ2V0Q29tcG9uZW50VHlwZSgpOworCQkJbGlz
dFJld3JpdGUgPSByZXdyaXRlLmdldExpc3RSZXdyaXRlKGNyZWF0aW9uVHlwZSwgQXJyYXlUeXBl
LkFOTk9UQVRJT05TX1BST1BFUlRZKTsKKwkJCWFubm90YXRpb24gPSAoTWFya2VyQW5ub3RhdGlv
bikgY3JlYXRpb25UeXBlLmFubm90YXRpb25zKCkuZ2V0KDApOworCQkJbGlzdFJld3JpdGUucmVt
b3ZlKGFubm90YXRpb24sIG51bGwpOworCQkJYW5ub3RhdGlvbiA9IChNYXJrZXJBbm5vdGF0aW9u
KSBjcmVhdGlvblR5cGUuYW5ub3RhdGlvbnMoKS5nZXQoMSk7CisJCQlsaXN0UmV3cml0ZS5yZW1v
dmUoYW5ub3RhdGlvbiwgbnVsbCk7CisKKwkJCWNyZWF0aW9uVHlwZSA9IChBcnJheVR5cGUpIGNy
ZWF0aW9uVHlwZS5nZXRDb21wb25lbnRUeXBlKCk7CisJCQlsaXN0UmV3cml0ZSA9IHJld3JpdGUu
Z2V0TGlzdFJld3JpdGUoY3JlYXRpb25UeXBlLCBBcnJheVR5cGUuQU5OT1RBVElPTlNfUFJPUEVS
VFkpOworCQkJYW5ub3RhdGlvbiA9IChNYXJrZXJBbm5vdGF0aW9uKSBjcmVhdGlvblR5cGUuYW5u
b3RhdGlvbnMoKS5nZXQoMCk7CisJCQlsaXN0UmV3cml0ZS5yZW1vdmUoYW5ub3RhdGlvbiwgbnVs
bCk7CisJCQlhbm5vdGF0aW9uID0gKE1hcmtlckFubm90YXRpb24pIGNyZWF0aW9uVHlwZS5hbm5v
dGF0aW9ucygpLmdldCgxKTsKKwkJCWxpc3RSZXdyaXRlLnJlbW92ZShhbm5vdGF0aW9uLCBudWxs
KTsKKwkJCQorCQkJZXhwcmVzc2lvbnMgPSBjcmVhdGlvbi5kaW1lbnNpb25zKCk7CisJCQlsaXN0
UmV3cml0ZSA9IHJld3JpdGUuZ2V0TGlzdFJld3JpdGUoY3JlYXRpb24sIEFycmF5Q3JlYXRpb24u
RElNRU5TSU9OU19QUk9QRVJUWSk7CisJCQlFeHByZXNzaW9uIGV4cHJlc3Npb24gPSBhc3QubmV3
TnVtYmVyTGl0ZXJhbCgiMTAiKTsgCisJCQlsaXN0UmV3cml0ZS5pbnNlcnRBdChleHByZXNzaW9u
LCAxLCBudWxsKTsKKwkJCQorCQkJTWV0aG9kSW52b2NhdGlvbiBpbnZvYyA9IGFzdC5uZXdNZXRo
b2RJbnZvY2F0aW9uKCk7CisJCQlpbnZvYy5zZXROYW1lKGFzdC5uZXdTaW1wbGVOYW1lKCJzaXpl
IikpOworCQkJbGlzdFJld3JpdGUuaW5zZXJ0QXQoaW52b2MsIDIsIG51bGwpOworCQl9CisJCS8v
IEdldCBuZXcgY29kZQorCQlTdHJpbmcgcHJldmlldz0gZXZhbHVhdGVSZXdyaXRlKGN1LCByZXdy
aXRlKTsKKworCQlidWY9IG5ldyBTdHJpbmdCdWZmZXIoKTsKKwkJYnVmLmFwcGVuZCgicGFja2Fn
ZSB0ZXN0MTtcbiIpOworCQlidWYuYXBwZW5kKCJpbXBvcnQgamF2YS5sYW5nLmFubm90YXRpb24u
RWxlbWVudFR5cGU7XG4iKTsKKwkJYnVmLmFwcGVuZCgicHVibGljIGNsYXNzIEUge1xuIik7CisJ
CWJ1Zi5hcHBlbmQoIiAgICBwdWJsaWMgdm9pZCBmb28oKSB7XG4iKTsKKwkJYnVmLmFwcGVuZCgi
ICAgIAlpbnQgW10gaSBbXSBAQW5ub3QxIEBBbm5vdDIgW10gQEFubm90MSBAQW5ub3QzIFtdID0g
bmV3IGludCBAQW5ub3QxIEBBbm5vdDIgIFsyXSBAQW5ub3QyIEBBbm5vdDMgW3NpemUoKV0gQEFu
bm90MiBAQW5ub3QxIFtdIFtdIEBBbm5vdDMgQEFubm90MiBAQW5ub3QxIFtdO1xuIik7CisJCWJ1
Zi5hcHBlbmQoIiAgICAJaW50IFtdIGogW11bXSA9IG5ldyBpbnQgQEFubm90MSBbMl0gQEFubm90
MiBbXSBAQW5ub3QzIFtdLCBrIFtdW10gPSBuZXcgaW50IFsyXSBbMTApXSBbc2l6ZSgpXTtcbiIp
OworCQlidWYuYXBwZW5kKCIgICAgfVxuIik7CisJCWJ1Zi5hcHBlbmQoIiAgICBwdWJsaWMgaW50
IHNpemUoKSB7IHJldHVybiAyOyB9XG4iKTsKKwkJYnVmLmFwcGVuZCgifVxuIik7CisJCWJ1Zi5h
cHBlbmQoIkBqYXZhLmxhbmcuYW5ub3RhdGlvbi5UYXJnZXQodmFsdWU9IHtFbGVtZW50VHlwZS5U
WVBFX1VTRX0pXG4iKTsKKwkJYnVmLmFwcGVuZCgiQGludGVyZmFjZSBBbm5vdDEge31cbiIpOwor
CQlidWYuYXBwZW5kKCJAamF2YS5sYW5nLmFubm90YXRpb24uVGFyZ2V0KHZhbHVlPSB7RWxlbWVu
dFR5cGUuVFlQRV9VU0V9KVxuIik7CisJCWJ1Zi5hcHBlbmQoIkBpbnRlcmZhY2UgQW5ub3QyIHt9
XG4iKTsKKwkJYnVmLmFwcGVuZCgiQGphdmEubGFuZy5hbm5vdGF0aW9uLlRhcmdldCh2YWx1ZT0g
e0VsZW1lbnRUeXBlLlRZUEVfVVNFfSlcbiIpOworCQlidWYuYXBwZW5kKCJAaW50ZXJmYWNlIEFu
bm90MiB7fVxuIik7CisJCWFzc2VydEVxdWFsU3RyaW5nKHByZXZpZXcsIGJ1Zi50b1N0cmluZygp
KTsKKwkJCisJfQogfQogCmRpZmYgLS1naXQgYS9vcmcuZWNsaXBzZS5qZHQuY29yZS9kb20vb3Jn
L2VjbGlwc2UvamR0L2ludGVybmFsL2NvcmUvZG9tL3Jld3JpdGUvQVNUUmV3cml0ZUFuYWx5emVy
LmphdmEgYi9vcmcuZWNsaXBzZS5qZHQuY29yZS9kb20vb3JnL2VjbGlwc2UvamR0L2ludGVybmFs
L2NvcmUvZG9tL3Jld3JpdGUvQVNUUmV3cml0ZUFuYWx5emVyLmphdmEKaW5kZXggNzQ1YjVlYS4u
NjdhOGJiNCAxMDA2NDQKLS0tIGEvb3JnLmVjbGlwc2UuamR0LmNvcmUvZG9tL29yZy9lY2xpcHNl
L2pkdC9pbnRlcm5hbC9jb3JlL2RvbS9yZXdyaXRlL0FTVFJld3JpdGVBbmFseXplci5qYXZhCisr
KyBiL29yZy5lY2xpcHNlLmpkdC5jb3JlL2RvbS9vcmcvZWNsaXBzZS9qZHQvaW50ZXJuYWwvY29y
ZS9kb20vcmV3cml0ZS9BU1RSZXdyaXRlQW5hbHl6ZXIuamF2YQpAQCAtMTUxNyw1ICsxNTE3LDUg
QEAKIAkJYm9vbGVhbiBpc0FsbFJlbW92ZT0gaXNBbGxPZktpbmQoY2hpbGRyZW4sIFJld3JpdGVF
dmVudC5SRU1PVkVEKTsKIAkJU3RyaW5nIGtleXdvcmQ9IFV0aWwuRU1QVFlfU1RSSU5HOwotCQlp
ZiAocHJvcGVydHkgPT0gU2luZ2xlVmFyaWFibGVEZWNsYXJhdGlvbi5WQVJBUkdTX0FOTk9UQVRJ
T05TX1BST1BFUlRZKSB7CisJCWlmIChwcm9wZXJ0eSA9PSBTaW5nbGVWYXJpYWJsZURlY2xhcmF0
aW9uLlZBUkFSR1NfQU5OT1RBVElPTlNfUFJPUEVSVFkgfHwgcHJvcGVydHkgPT0gQXJyYXlUeXBl
LkFOTk9UQVRJT05TX1BST1BFUlRZKSB7CiAJCQlrZXl3b3JkPSAiICI7IC8vJE5PTi1OTFMtMSQK
IAkJfSBlbHNlIGlmIChpc0FsbEluc2VydCB8fCBpc0FsbFJlbW92ZSkgewpAQCAtMTUyOSw1ICsx
NTI5LDYgQEAKIAogCQlQcmVmaXggZm9ybWF0dGVyUHJlZml4OwotCQlpZiAocHJvcGVydHkgPT0g
U2luZ2xlVmFyaWFibGVEZWNsYXJhdGlvbi5NT0RJRklFUlMyX1BST1BFUlRZIHx8IHByb3BlcnR5
ID09IFNpbmdsZVZhcmlhYmxlRGVjbGFyYXRpb24uVkFSQVJHU19BTk5PVEFUSU9OU19QUk9QRVJU
WSkKKwkJaWYgKHByb3BlcnR5ID09IFNpbmdsZVZhcmlhYmxlRGVjbGFyYXRpb24uTU9ESUZJRVJT
Ml9QUk9QRVJUWSB8fCBwcm9wZXJ0eSA9PSBTaW5nbGVWYXJpYWJsZURlY2xhcmF0aW9uLlZBUkFS
R1NfQU5OT1RBVElPTlNfUFJPUEVSVFkgCisJCQkJCQkJfHwgcHJvcGVydHkgPT0gQXJyYXlUeXBl
LkFOTk9UQVRJT05TX1BST1BFUlRZKQogCQkJZm9ybWF0dGVyUHJlZml4PSB0aGlzLmZvcm1hdHRl
ci5QQVJBTV9BTk5PVEFUSU9OX1NFUEFSQVRJT047CiAJCWVsc2UKQEAgLTE1NDUsNSArMTU0Niw1
IEBACiAJCQkJcmV0dXJuIG5leHRQb3M7CiAJCQl9IGVsc2UgaWYgKChpc0FsbEluc2VydCB8fCAo
bmV4dFBvcyA9PSBlbmRQb3MgJiYgbGFzdFVuY2hhbmdlZCkpIC8vIHNlZSBidWcgMTY1NjU0Ci0J
CQkJCSYmIHByb3BlcnR5ICE9IFNpbmdsZVZhcmlhYmxlRGVjbGFyYXRpb24uVkFSQVJHU19BTk5P
VEFUSU9OU19QUk9QRVJUWSkgeworCQkJCQkmJiBwcm9wZXJ0eSAhPSBTaW5nbGVWYXJpYWJsZURl
Y2xhcmF0aW9uLlZBUkFSR1NfQU5OT1RBVElPTlNfUFJPUEVSVFkgJiYgcHJvcGVydHkgIT0gQXJy
YXlUeXBlLkFOTk9UQVRJT05TX1BST1BFUlRZKSB7CiAJCQkJU3RyaW5nIHNlcGFyYXRvcjsKIAkJ
CQlpZiAobGFzdENoaWxkLmdldE5ld1ZhbHVlKCkgaW5zdGFuY2VvZiBBbm5vdGF0aW9uKSB7CkBA
IC0xOTcwLDQgKzE5NzEsNSBAQAogCiAJCUFycmF5VHlwZSBhcnJheVR5cGU9IChBcnJheVR5cGUp
IGdldE9yaWdpbmFsVmFsdWUobm9kZSwgQXJyYXlDcmVhdGlvbi5UWVBFX1BST1BFUlRZKTsKKwkJ
QXJyYXlUeXBlIHJlcGxhY2luZ1R5cGUgPSBhcnJheVR5cGU7CiAJCWludCBuT2xkQnJhY2tldHM9
IGdldERpbWVuc2lvbnMoYXJyYXlUeXBlKTsgLy8gbnVtYmVyIG9mIHRvdGFsIGJyYWNrZXRzCiAJ
CWludCBuTmV3QnJhY2tldHM9IG5PbGRCcmFja2V0czsKQEAgLTE5NzYsNSArMTk3OCw1IEBACiAJ
CVJld3JpdGVFdmVudCB0eXBlRXZlbnQ9IGdldEV2ZW50KG5vZGUsIEFycmF5Q3JlYXRpb24uVFlQ
RV9QUk9QRVJUWSk7CiAJCWlmICh0eXBlRXZlbnQgIT0gbnVsbCAmJiB0eXBlRXZlbnQuZ2V0Q2hh
bmdlS2luZCgpID09IFJld3JpdGVFdmVudC5SRVBMQUNFRCkgeyAvLyBjaGFuZ2VkIGFycmF5dHlw
ZSBjYW4gaGF2ZSBkaWZmZXJlbnQgZGltZW5zaW9uIG9yIHR5cGUgbmFtZQotCQkJQXJyYXlUeXBl
IHJlcGxhY2luZ1R5cGU9IChBcnJheVR5cGUpIHR5cGVFdmVudC5nZXROZXdWYWx1ZSgpOworCQkJ
cmVwbGFjaW5nVHlwZT0gKEFycmF5VHlwZSkgdHlwZUV2ZW50LmdldE5ld1ZhbHVlKCk7CiAJCQll
ZGl0R3JvdXA9IGdldEVkaXRHcm91cCh0eXBlRXZlbnQpOwogCQkJVHlwZSBuZXdUeXBlPSByZXBs
YWNpbmdUeXBlLmdldEVsZW1lbnRUeXBlKCk7CkBAIC0xOTkzLDUxICsxOTk1LDY0IEBACiAKIAkJ
dHJ5IHsKLQkJCWludCBvZmZzZXQ9IGdldFNjYW5uZXIoKS5nZXRUb2tlblN0YXJ0T2Zmc2V0KFRl
cm1pbmFsVG9rZW5zLlRva2VuTmFtZUxCUkFDS0VULCBhcnJheVR5cGUuZ2V0U3RhcnRQb3NpdGlv
bigpKTsKIAkJCS8vIGRpbWVuc2lvbiBub2RlIHdpdGggZXhwcmVzc2lvbnMKIAkJCVJld3JpdGVF
dmVudCBkaW1FdmVudD0gZ2V0RXZlbnQobm9kZSwgQXJyYXlDcmVhdGlvbi5ESU1FTlNJT05TX1BS
T1BFUlRZKTsKIAkJCWJvb2xlYW4gaGFzRGltZW5zaW9uQ2hhbmdlcz0gKGRpbUV2ZW50ICE9IG51
bGwgJiYgZGltRXZlbnQuZ2V0Q2hhbmdlS2luZCgpICE9IFJld3JpdGVFdmVudC5VTkNIQU5HRUQp
OwotCQkJaWYgKGhhc0RpbWVuc2lvbkNoYW5nZXMpIHsKLQkJCQlSZXdyaXRlRXZlbnRbXSBldmVu
dHM9IGRpbUV2ZW50LmdldENoaWxkcmVuKCk7Ci0JCQkJLy8gb2Zmc2V0IG9uIGZpcnN0IG9wZW5p
bmcgYnJhY2UKLQkJCQlmb3IgKGludCBpPSAwOyBpIDwgZXZlbnRzLmxlbmd0aDsgaSsrKSB7Ci0J
CQkJCVJld3JpdGVFdmVudCBldmVudD0gZXZlbnRzW2ldOwotCQkJCQlpbnQgY2hhbmdlS2luZD0g
ZXZlbnQuZ2V0Q2hhbmdlS2luZCgpOwotCQkJCQlpZiAoY2hhbmdlS2luZCA9PSBSZXdyaXRlRXZl
bnQuSU5TRVJURUQpIHsgLy8gaW5zZXJ0IG5ldyBkaW1lbnNpb24KLQkJCQkJCWVkaXRHcm91cD0g
Z2V0RWRpdEdyb3VwKGV2ZW50KTsKLQkJCQkJCWRvVGV4dEluc2VydChvZmZzZXQsICJbIiwgZWRp
dEdyb3VwKTsgLy8kTk9OLU5MUy0xJAotCQkJCQkJZG9UZXh0SW5zZXJ0KG9mZnNldCwgKEFTVE5v
ZGUpIGV2ZW50LmdldE5ld1ZhbHVlKCksIDAsIGZhbHNlLCBlZGl0R3JvdXApOwotCQkJCQkJZG9U
ZXh0SW5zZXJ0KG9mZnNldCwgIl0iLCBlZGl0R3JvdXApOyAvLyROT04tTkxTLTEkCi0JCQkJCQlu
TmV3QnJhY2tldHMtLTsKLQkJCQkJfSBlbHNlIHsKLQkJCQkJCUFTVE5vZGUgZWxlbT0gKEFTVE5v
ZGUpIGV2ZW50LmdldE9yaWdpbmFsVmFsdWUoKTsKLQkJCQkJCWludCBlbGVtRW5kPSBlbGVtLmdl
dFN0YXJ0UG9zaXRpb24oKSArIGVsZW0uZ2V0TGVuZ3RoKCk7Ci0JCQkJCQlpbnQgZW5kUG9zPSBn
ZXRTY2FubmVyKCkuZ2V0VG9rZW5FbmRPZmZzZXQoVGVybWluYWxUb2tlbnMuVG9rZW5OYW1lUkJS
QUNLRVQsIGVsZW1FbmQpOwotCQkJCQkJaWYgKGNoYW5nZUtpbmQgPT0gUmV3cml0ZUV2ZW50LlJF
TU9WRUQpIHsKKwkJCVJld3JpdGVFdmVudFtdIGV2ZW50cz0gaGFzRGltZW5zaW9uQ2hhbmdlcyA/
IGRpbUV2ZW50LmdldENoaWxkcmVuKCkgOiBudWxsOworCQkJQXJyYXlUeXBlIGN1cnJlbnRMZXZl
bCA9IChBcnJheVR5cGUpIHJlcGxhY2luZ1R5cGUuZ2V0RWxlbWVudFR5cGUoKS5nZXRQYXJlbnQo
KTsKKwkJCUxpc3QgZGltZW5zaW9ucyA9IG5vZGUuZGltZW5zaW9ucygpOworCQkJaW50IGRpbVNp
emUgPSBkaW1lbnNpb25zLnNpemUoKTsKKwkJCWludCBpID0gMDsKKwkJCWludCBvZmZzZXQ9IGN1
cnJlbnRMZXZlbC5nZXRTdGFydFBvc2l0aW9uKCk7CisJCQl3aGlsZShjdXJyZW50TGV2ZWwgIT0g
bnVsbCkgeworCQkJCWlmIChub2RlLmdldEFTVCgpLmFwaUxldmVsKCkgPj0gQVNULkpMUzgpIHsK
KwkJCQkJIG9mZnNldCA9IHJld3JpdGVUeXBlQW5ub3RhdGlvbnMoY3VycmVudExldmVsLCBBcnJh
eVR5cGUuQU5OT1RBVElPTlNfUFJPUEVSVFksIG9mZnNldCk7CisJCQkJfQorCQkJCWlmIChpIDwg
ZGltU2l6ZSkgeworCQkJCQlvZmZzZXQ9IGdldFNjYW5uZXIoKS5nZXRUb2tlblN0YXJ0T2Zmc2V0
KFRlcm1pbmFsVG9rZW5zLlRva2VuTmFtZUxCUkFDS0VULCBvZmZzZXQpOworCQkJCQlpZiAoaGFz
RGltZW5zaW9uQ2hhbmdlcykgeworCQkJCQkJUmV3cml0ZUV2ZW50IGV2ZW50PSBldmVudHNbaV07
CisJCQkJCQlpbnQgY2hhbmdlS2luZD0gZXZlbnQuZ2V0Q2hhbmdlS2luZCgpOworCQkJCQkJaWYg
KGNoYW5nZUtpbmQgPT0gUmV3cml0ZUV2ZW50LklOU0VSVEVEKSB7IC8vIGluc2VydCBuZXcgZGlt
ZW5zaW9uCiAJCQkJCQkJZWRpdEdyb3VwPSBnZXRFZGl0R3JvdXAoZXZlbnQpOwotCQkJCQkJCWRv
VGV4dFJlbW92ZUFuZFZpc2l0KG9mZnNldCwgZW5kUG9zIC0gb2Zmc2V0LCBlbGVtLCBlZGl0R3Jv
dXApOwotCQkJCQkJfSBlbHNlIGlmIChjaGFuZ2VLaW5kID09IFJld3JpdGVFdmVudC5SRVBMQUNF
RCkgewotCQkJCQkJCWVkaXRHcm91cD0gZ2V0RWRpdEdyb3VwKGV2ZW50KTsKLQkJCQkJCQlTb3Vy
Y2VSYW5nZSByYW5nZT0gZ2V0RXh0ZW5kZWRSYW5nZShlbGVtKTsKLQkJCQkJCQlpbnQgZWxlbU9m
ZnNldD0gcmFuZ2UuZ2V0U3RhcnRQb3NpdGlvbigpOwotCQkJCQkJCWludCBlbGVtTGVuZ3RoPSBy
YW5nZS5nZXRMZW5ndGgoKTsKLQkJCQkJCQlkb1RleHRSZW1vdmVBbmRWaXNpdChlbGVtT2Zmc2V0
LCBlbGVtTGVuZ3RoLCBlbGVtLCBlZGl0R3JvdXApOwotCQkJCQkJCWRvVGV4dEluc2VydChlbGVt
T2Zmc2V0LCAoQVNUTm9kZSkgZXZlbnQuZ2V0TmV3VmFsdWUoKSwgMCwgZmFsc2UsIGVkaXRHcm91
cCk7CisJCQkJCQkJZG9UZXh0SW5zZXJ0KG9mZnNldCwgIlsiLCBlZGl0R3JvdXApOyAvLyROT04t
TkxTLTEkCisJCQkJCQkJZG9UZXh0SW5zZXJ0KG9mZnNldCwgKEFTVE5vZGUpIGV2ZW50LmdldE5l
d1ZhbHVlKCksIDAsIGZhbHNlLCBlZGl0R3JvdXApOworCQkJCQkJCWRvVGV4dEluc2VydChvZmZz
ZXQsICJdIiwgZWRpdEdyb3VwKTsgLy8kTk9OLU5MUy0xJAogCQkJCQkJCW5OZXdCcmFja2V0cy0t
OwogCQkJCQkJfSBlbHNlIHsKLQkJCQkJCQl2b2lkVmlzaXQoZWxlbSk7Ci0JCQkJCQkJbk5ld0Jy
YWNrZXRzLS07CisJCQkJCQkJQVNUTm9kZSBlbGVtPSAoQVNUTm9kZSkgZXZlbnQuZ2V0T3JpZ2lu
YWxWYWx1ZSgpOworCQkJCQkJCWludCBlbGVtRW5kPSBlbGVtLmdldFN0YXJ0UG9zaXRpb24oKSAr
IGVsZW0uZ2V0TGVuZ3RoKCk7CisJCQkJCQkJaW50IGVuZFBvcz0gZ2V0U2Nhbm5lcigpLmdldFRv
a2VuRW5kT2Zmc2V0KFRlcm1pbmFsVG9rZW5zLlRva2VuTmFtZVJCUkFDS0VULCBlbGVtRW5kKTsK
KwkJCQkJCQlpZiAoY2hhbmdlS2luZCA9PSBSZXdyaXRlRXZlbnQuUkVNT1ZFRCkgeworCQkJCQkJ
CQllZGl0R3JvdXA9IGdldEVkaXRHcm91cChldmVudCk7CisJCQkJCQkJCWRvVGV4dFJlbW92ZUFu
ZFZpc2l0KG9mZnNldCwgZW5kUG9zIC0gb2Zmc2V0LCBlbGVtLCBlZGl0R3JvdXApOworCQkJCQkJ
CX0gZWxzZSBpZiAoY2hhbmdlS2luZCA9PSBSZXdyaXRlRXZlbnQuUkVQTEFDRUQpIHsKKwkJCQkJ
CQkJZWRpdEdyb3VwPSBnZXRFZGl0R3JvdXAoZXZlbnQpOworCQkJCQkJCQlTb3VyY2VSYW5nZSBy
YW5nZT0gZ2V0RXh0ZW5kZWRSYW5nZShlbGVtKTsKKwkJCQkJCQkJaW50IGVsZW1PZmZzZXQ9IHJh
bmdlLmdldFN0YXJ0UG9zaXRpb24oKTsKKwkJCQkJCQkJaW50IGVsZW1MZW5ndGg9IHJhbmdlLmdl
dExlbmd0aCgpOworCQkJCQkJCQlkb1RleHRSZW1vdmVBbmRWaXNpdChlbGVtT2Zmc2V0LCBlbGVt
TGVuZ3RoLCBlbGVtLCBlZGl0R3JvdXApOworCQkJCQkJCQlkb1RleHRJbnNlcnQoZWxlbU9mZnNl
dCwgKEFTVE5vZGUpIGV2ZW50LmdldE5ld1ZhbHVlKCksIDAsIGZhbHNlLCBlZGl0R3JvdXApOwor
CQkJCQkJCQluTmV3QnJhY2tldHMtLTsKKwkJCQkJCQl9IGVsc2UgeworCQkJCQkJCQl2b2lkVmlz
aXQoZWxlbSk7CisJCQkJCQkJCW5OZXdCcmFja2V0cy0tOworCQkJCQkJCX0KKwkJCQkJCQlvZmZz
ZXQ9IGVuZFBvczsKKwkJCQkJCQluT2xkQnJhY2tldHMtLTsKIAkJCQkJCX0KLQkJCQkJCW9mZnNl
dD0gZW5kUG9zOwotCQkJCQkJbk9sZEJyYWNrZXRzLS07CisJCQkJCX0gZWxzZSB7CisJCQkJCQlB
U1ROb2RlIGVsZW0gPSAoQVNUTm9kZSkgbm9kZS5kaW1lbnNpb25zKCkuZ2V0KGkpOworCQkJCQkJ
dm9pZFZpc2l0KGVsZW0pOworCQkJCQkJb2Zmc2V0PSBnZXRTY2FubmVyKCkuZ2V0VG9rZW5FbmRP
ZmZzZXQoVGVybWluYWxUb2tlbnMuVG9rZW5OYW1lUkJSQUNLRVQsIG9mZnNldCk7CiAJCQkJCX0K
LQkJCQl9Ci0JCQl9IGVsc2UgewotCQkJCW9mZnNldD0gZG9WaXNpdChub2RlLCBBcnJheUNyZWF0
aW9uLkRJTUVOU0lPTlNfUFJPUEVSVFksIG9mZnNldCk7Ci0JCQl9Ci0JCQlpZiAobk9sZEJyYWNr
ZXRzICE9IG5OZXdCcmFja2V0cykgewotCQkJCWlmICghaGFzRGltZW5zaW9uQ2hhbmdlcykgewor
CQkJCX0gCisJCQkJZWxzZSBpZiAoaSA8IG5PbGRCcmFja2V0cykgewogCQkJCQlvZmZzZXQ9IGdl
dFNjYW5uZXIoKS5nZXRUb2tlbkVuZE9mZnNldChUZXJtaW5hbFRva2Vucy5Ub2tlbk5hbWVSQlJB
Q0tFVCwgb2Zmc2V0KTsKKwkJCQl9IGVsc2UgeworCQkJCQlkb1RleHRJbnNlcnQob2Zmc2V0LCAi
IFtdIiwgZWRpdEdyb3VwKTsgLy8kTk9OLU5MUy0xJAogCQkJCX0KLQkJCQlyZXdyaXRlRXh0cmFE
aW1lbnNpb25zKG5PbGRCcmFja2V0cywgbk5ld0JyYWNrZXRzLCBvZmZzZXQsIGVkaXRHcm91cCk7
CisJCQkJaWYgKGN1cnJlbnRMZXZlbCA9PSByZXBsYWNpbmdUeXBlKSBicmVhazsKKwkJCQljdXJy
ZW50TGV2ZWwgPSAoQXJyYXlUeXBlKSBjdXJyZW50TGV2ZWwuZ2V0UGFyZW50KCk7CisJCQkJaSsr
OwogCQkJfQogCmRpZmYgLS1naXQgYS9vcmcuZWNsaXBzZS5qZHQuY29yZS9kb20vb3JnL2VjbGlw
c2UvamR0L2ludGVybmFsL2NvcmUvZG9tL3Jld3JpdGUvQVNUUmV3cml0ZUZsYXR0ZW5lci5qYXZh
IGIvb3JnLmVjbGlwc2UuamR0LmNvcmUvZG9tL29yZy9lY2xpcHNlL2pkdC9pbnRlcm5hbC9jb3Jl
L2RvbS9yZXdyaXRlL0FTVFJld3JpdGVGbGF0dGVuZXIuamF2YQppbmRleCA5MGVjOWFkLi41NjRh
OTM2IDEwMDY0NAotLS0gYS9vcmcuZWNsaXBzZS5qZHQuY29yZS9kb20vb3JnL2VjbGlwc2UvamR0
L2ludGVybmFsL2NvcmUvZG9tL3Jld3JpdGUvQVNUUmV3cml0ZUZsYXR0ZW5lci5qYXZhCisrKyBi
L29yZy5lY2xpcHNlLmpkdC5jb3JlL2RvbS9vcmcvZWNsaXBzZS9qZHQvaW50ZXJuYWwvY29yZS9k
b20vcmV3cml0ZS9BU1RSZXdyaXRlRmxhdHRlbmVyLmphdmEKQEAgLTE5NCw0ICsxOTQsMjIgQEAK
IAl9CiAKKwlwcml2YXRlIHZvaWQgdmlzaXRBcnJheVR5cGVXaXRoRXhwcmVzc2lvbihBcnJheVR5
cGUgbm9kZSwgTGlzdCBkaW1lbnNpb25zLCBpbnQgZGVwdGgpIHsKKwkJaWYgKG5vZGUuZ2V0QVNU
KCkuYXBpTGV2ZWwoKSA+PSBBU1QuSkxTOCkgeworCQkJdmlzaXRMaXN0KG5vZGUsIEFycmF5VHlw
ZS5BTk5PVEFUSU9OU19QUk9QRVJUWSwgU3RyaW5nLnZhbHVlT2YoJyAnKSwgVXRpbC5FTVBUWV9T
VFJJTkcsIFN0cmluZy52YWx1ZU9mKCcgJykpOworCQl9CisJCWlmIChkZXB0aCA8IGRpbWVuc2lv
bnMuc2l6ZSgpKSB7CisJCQl0aGlzLnJlc3VsdC5hcHBlbmQoJ1snKTsKKwkJCSgoQVNUTm9kZSkg
ZGltZW5zaW9ucy5nZXQoZGVwdGgpKS5hY2NlcHQodGhpcyk7CisJCQl0aGlzLnJlc3VsdC5hcHBl
bmQoJ10nKTsKKwkJfSBlbHNlIHsKKwkJCXRoaXMucmVzdWx0LmFwcGVuZCgiW10iKTsgLy8kTk9O
LU5MUy0xJAorCQl9CisJCVR5cGUgY29tcG9uZW50VHlwZSA9IG5vZGUuZ2V0Q29tcG9uZW50VHlw
ZSgpOworCQlpZiAoY29tcG9uZW50VHlwZS5pc0FycmF5VHlwZSgpKSB7CisJCQl2aXNpdEFycmF5
VHlwZVdpdGhFeHByZXNzaW9uKChBcnJheVR5cGUpIGNvbXBvbmVudFR5cGUsIGRpbWVuc2lvbnMs
IC0tZGVwdGgpOworCQl9IGVsc2UgeworCQkJY29tcG9uZW50VHlwZS5hY2NlcHQodGhpcyk7CisJ
CX0KKwl9CiAJcHJpdmF0ZSB2b2lkIHZpc2l0RXh0cmFEaW1lbnNpb25zKEFTVE5vZGUgbm9kZSwg
U2ltcGxlUHJvcGVydHlEZXNjcmlwdG9yIGRpbWVuc2lvbnMsIENoaWxkTGlzdFByb3BlcnR5RGVz
Y3JpcHRvciBkaW1lbnNpb25zSW5mbykgewogCQlpZiAobm9kZS5nZXRBU1QoKS5hcGlMZXZlbCgp
IDwgQVNULkpMUzgpIHsKQEAgLTI0MCwxOSArMjU4LDcgQEAKIAkJCWVsZW1lbnRUeXBlID0gKFR5
cGUpIGdldENoaWxkTm9kZShlbGVtZW50VHlwZSwgQXJyYXlUeXBlLkNPTVBPTkVOVF9UWVBFX1BS
T1BFUlRZKTsKIAkJfQotCi0JCWVsZW1lbnRUeXBlLmFjY2VwdCh0aGlzKTsKLQogCQlMaXN0IGxp
c3Q9IGdldENoaWxkTGlzdChub2RlLCBBcnJheUNyZWF0aW9uLkRJTUVOU0lPTlNfUFJPUEVSVFkp
OwotCQlmb3IgKGludCBpPSAwOyBpIDwgbGlzdC5zaXplKCk7IGkrKykgewotCQkJdGhpcy5yZXN1
bHQuYXBwZW5kKCdbJyk7Ci0JCQkoKEFTVE5vZGUpIGxpc3QuZ2V0KGkpKS5hY2NlcHQodGhpcyk7
Ci0JCQl0aGlzLnJlc3VsdC5hcHBlbmQoJ10nKTsKLQkJCWRpbWVuc2lvbnMtLTsKLQkJfQorCQl2
aXNpdEFycmF5VHlwZVdpdGhFeHByZXNzaW9uKGFycmF5VHlwZSwgbGlzdCwgLS1kaW1lbnNpb25z
KTsKIAotCQkvLyBhZGQgZW1wdHkgIltdIiBmb3IgZWFjaCBleHRyYSBhcnJheSBkaW1lbnNpb24K
LQkJZm9yIChpbnQgaT0gMDsgaSA8IGRpbWVuc2lvbnM7IGkrKykgewotCQkJdGhpcy5yZXN1bHQu
YXBwZW5kKCJbXSIpOyAvLyROT04tTkxTLTEkCi0JCX0KIAkJQVNUTm9kZSBpbml0aWFsaXplcj0g
Z2V0Q2hpbGROb2RlKG5vZGUsIEFycmF5Q3JlYXRpb24uSU5JVElBTElaRVJfUFJPUEVSVFkpOwog
CQlpZiAoaW5pdGlhbGl6ZXIgIT0gbnVsbCkgew==
</data>

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>227981</attachid>
            <date>2013-03-06 05:04:00 -0500</date>
            <delta_ts>2013-03-06 05:04:29 -0500</delta_ts>
            <desc>Patch for review</desc>
            <filename>Fix-for-bug-400568.patch</filename>
            <type>text/plain</type>
            <size>24485</size>
            <attacher name="Jay Arthanareeswaran">jarthana</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3NyYy9vcmcvZWNs
aXBzZS9qZHQvY29yZS90ZXN0cy9yZXdyaXRlL2Rlc2NyaWJpbmcvQVNUUmV3cml0aW5nU3RhdGVt
ZW50c1Rlc3QuamF2YSBiL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3NyYy9vcmcv
ZWNsaXBzZS9qZHQvY29yZS90ZXN0cy9yZXdyaXRlL2Rlc2NyaWJpbmcvQVNUUmV3cml0aW5nU3Rh
dGVtZW50c1Rlc3QuamF2YQppbmRleCBhMDIzOTY0Li5mNDFiZWZkIDEwMDY0NAotLS0gYS9vcmcu
ZWNsaXBzZS5qZHQuY29yZS50ZXN0cy5tb2RlbC9zcmMvb3JnL2VjbGlwc2UvamR0L2NvcmUvdGVz
dHMvcmV3cml0ZS9kZXNjcmliaW5nL0FTVFJld3JpdGluZ1N0YXRlbWVudHNUZXN0LmphdmEKKysr
IGIvb3JnLmVjbGlwc2UuamR0LmNvcmUudGVzdHMubW9kZWwvc3JjL29yZy9lY2xpcHNlL2pkdC9j
b3JlL3Rlc3RzL3Jld3JpdGUvZGVzY3JpYmluZy9BU1RSZXdyaXRpbmdTdGF0ZW1lbnRzVGVzdC5q
YXZhCkBAIC0yNiw0ICsyNiw2IEBACiBpbXBvcnQgb3JnLmVjbGlwc2UuamR0LmNvcmUuZG9tLkFT
VE5vZGU7CiBpbXBvcnQgb3JnLmVjbGlwc2UuamR0LmNvcmUuZG9tLkFic3RyYWN0VHlwZURlY2xh
cmF0aW9uOworaW1wb3J0IG9yZy5lY2xpcHNlLmpkdC5jb3JlLmRvbS5BcnJheUNyZWF0aW9uOwor
aW1wb3J0IG9yZy5lY2xpcHNlLmpkdC5jb3JlLmRvbS5BcnJheVR5cGU7CiBpbXBvcnQgb3JnLmVj
bGlwc2UuamR0LmNvcmUuZG9tLkFzc2VydFN0YXRlbWVudDsKIGltcG9ydCBvcmcuZWNsaXBzZS5q
ZHQuY29yZS5kb20uQXNzaWdubWVudDsKQEAgLTM5LDggKzQxLDEwIEBACiBpbXBvcnQgb3JnLmVj
bGlwc2UuamR0LmNvcmUuZG9tLkV4cHJlc3Npb247CiBpbXBvcnQgb3JnLmVjbGlwc2UuamR0LmNv
cmUuZG9tLkV4cHJlc3Npb25TdGF0ZW1lbnQ7CitpbXBvcnQgb3JnLmVjbGlwc2UuamR0LmNvcmUu
ZG9tLkV4dHJhRGltZW5zaW9uOwogaW1wb3J0IG9yZy5lY2xpcHNlLmpkdC5jb3JlLmRvbS5Gb3JT
dGF0ZW1lbnQ7CiBpbXBvcnQgb3JnLmVjbGlwc2UuamR0LmNvcmUuZG9tLklmU3RhdGVtZW50Owog
aW1wb3J0IG9yZy5lY2xpcHNlLmpkdC5jb3JlLmRvbS5JbmZpeEV4cHJlc3Npb247CiBpbXBvcnQg
b3JnLmVjbGlwc2UuamR0LmNvcmUuZG9tLkxhYmVsZWRTdGF0ZW1lbnQ7CitpbXBvcnQgb3JnLmVj
bGlwc2UuamR0LmNvcmUuZG9tLk1hcmtlckFubm90YXRpb247CiBpbXBvcnQgb3JnLmVjbGlwc2Uu
amR0LmNvcmUuZG9tLk1ldGhvZERlY2xhcmF0aW9uOwogaW1wb3J0IG9yZy5lY2xpcHNlLmpkdC5j
b3JlLmRvbS5NZXRob2RJbnZvY2F0aW9uOwpAQCAtNTg5Niw0ICs1OTAwLDI0MCBAQAogCQl9CiAJ
fQorCXB1YmxpYyB2b2lkIHRlc3RCdWc0MDA1Njhfc2luY2VfOCgpIHRocm93cyBFeGNlcHRpb24g
eworCQlJUGFja2FnZUZyYWdtZW50IHBhY2sxPSB0aGlzLnNvdXJjZUZvbGRlci5jcmVhdGVQYWNr
YWdlRnJhZ21lbnQoInRlc3QxIiwgZmFsc2UsIG51bGwpOworCQlTdHJpbmdCdWZmZXIgYnVmPSBu
ZXcgU3RyaW5nQnVmZmVyKCk7CisJCWJ1Zi5hcHBlbmQoInBhY2thZ2UgdGVzdDE7XG4iKTsKKwkJ
YnVmLmFwcGVuZCgiaW1wb3J0IGphdmEubGFuZy5hbm5vdGF0aW9uLkVsZW1lbnRUeXBlO1xuIik7
CisJCWJ1Zi5hcHBlbmQoInB1YmxpYyBjbGFzcyBFIHtcbiIpOworCQlidWYuYXBwZW5kKCIgICAg
cHVibGljIHZvaWQgZm9vKCkge1xuIik7CisJCWJ1Zi5hcHBlbmQoIiAgICAJaW50IFtdIGkgQEFu
bm90MSBAQW5ub3QyIFtdIEBBbm5vdDEgQEFubm90MyBbXSA9IG5ldyBpbnQgQEFubm90MSBAQW5u
b3QyICBbMl0gQEFubm90MiBAQW5ub3QzIFtzaXplKCldIEBBbm5vdDIgQEFubm90MSBbXTtcbiIp
OworCQlidWYuYXBwZW5kKCIgICAgCWludCBbXSBqIFtdW10gPSBuZXcgaW50IEBBbm5vdDEgQEFu
bm90MiBbMl0gQEFubm90MiBAQW5ub3QzIFtzaXplKCldIEBBbm5vdDEgQEFubm90MyBbXSwgayBb
XVtdID0gbmV3IGludCBAQW5ub3QxIEBBbm5vdDIgWzJdIEBBbm5vdDIgQEFubm90MyBbc2l6ZSgp
XSBAQW5ub3QxIEBBbm5vdDMgW107XG4iKTsKKwkJYnVmLmFwcGVuZCgiICAgIH1cbiIpOworCQli
dWYuYXBwZW5kKCIgICAgcHVibGljIGludCBzaXplKCkgeyByZXR1cm4gMjsgfVxuIik7CisJCWJ1
Zi5hcHBlbmQoIn1cbiIpOworCQlidWYuYXBwZW5kKCJAamF2YS5sYW5nLmFubm90YXRpb24uVGFy
Z2V0KHZhbHVlPSB7RWxlbWVudFR5cGUuVFlQRV9VU0V9KVxuIik7CisJCWJ1Zi5hcHBlbmQoIkBp
bnRlcmZhY2UgQW5ub3QxIHt9XG4iKTsKKwkJYnVmLmFwcGVuZCgiQGphdmEubGFuZy5hbm5vdGF0
aW9uLlRhcmdldCh2YWx1ZT0ge0VsZW1lbnRUeXBlLlRZUEVfVVNFfSlcbiIpOworCQlidWYuYXBw
ZW5kKCJAaW50ZXJmYWNlIEFubm90MiB7fVxuIik7CisJCWJ1Zi5hcHBlbmQoIkBqYXZhLmxhbmcu
YW5ub3RhdGlvbi5UYXJnZXQodmFsdWU9IHtFbGVtZW50VHlwZS5UWVBFX1VTRX0pXG4iKTsKKwkJ
YnVmLmFwcGVuZCgiQGludGVyZmFjZSBBbm5vdDMge31cbiIpOworCQlJQ29tcGlsYXRpb25Vbml0
IGN1PSBwYWNrMS5jcmVhdGVDb21waWxhdGlvblVuaXQoIkUuamF2YSIsIGJ1Zi50b1N0cmluZygp
LCBmYWxzZSwgbnVsbCk7CisKKwkJQ29tcGlsYXRpb25Vbml0IGFzdFJvb3Q9IGNyZWF0ZUFTVChj
dSk7CisJCUFTVCBhc3Q9IGFzdFJvb3QuZ2V0QVNUKCk7CisJCUFTVFJld3JpdGUgcmV3cml0ZT0g
QVNUUmV3cml0ZS5jcmVhdGUoYXN0Um9vdC5nZXRBU1QoKSk7CisKKwkJLy8gR2V0IHdoaWxlIHN0
YXRlbWVudCBibG9jaworCQlUeXBlRGVjbGFyYXRpb24gdHlwZURlY2wgPSAoVHlwZURlY2xhcmF0
aW9uKSBhc3RSb290LnR5cGVzKCkuZ2V0KDApOworCQlNZXRob2REZWNsYXJhdGlvbiBtZXRob2RE
ZWNsPSB0eXBlRGVjbC5nZXRNZXRob2RzKClbMF07CisJCUJsb2NrIGJsb2NrPSBtZXRob2REZWNs
LmdldEJvZHkoKTsKKwkJTGlzdCBzdGF0ZW1lbnRzPSBibG9jay5zdGF0ZW1lbnRzKCk7CisKKwkJ
VmFyaWFibGVEZWNsYXJhdGlvblN0YXRlbWVudCBzdGF0ZW1lbnQgPSAoVmFyaWFibGVEZWNsYXJh
dGlvblN0YXRlbWVudCkgc3RhdGVtZW50cy5nZXQoMCk7CisJCUxpc3QgZnJhZ21lbnRzID0gc3Rh
dGVtZW50LmZyYWdtZW50cygpOworCQlWYXJpYWJsZURlY2xhcmF0aW9uRnJhZ21lbnQgZnJhZ21l
bnQgPSAoVmFyaWFibGVEZWNsYXJhdGlvbkZyYWdtZW50KSBmcmFnbWVudHMuZ2V0KDApOworCQlU
eXBlIHR5cGUgPSBzdGF0ZW1lbnQuZ2V0VHlwZSgpOworCisJCXsKKwkJCS8vIEFkZCBuZXcgZGlt
ZW5zaW9uIHdpdGggYW5kIHdpdGhvdXQgYW5ub3RhdGlvbnMKKwkJCWFzc2VydEVxdWFscygiSW5j
b3JyZWN0IHR5cGUiLCBBU1ROb2RlLkFSUkFZX1RZUEUsIHR5cGUuZ2V0Tm9kZVR5cGUoKSk7CisJ
CQlBcnJheUNyZWF0aW9uIGNyZWF0aW9uID0gKEFycmF5Q3JlYXRpb24pIGZyYWdtZW50LmdldElu
aXRpYWxpemVyKCk7CisKKwkJCUxpc3RSZXdyaXRlIGxpc3RSZXdyaXRlPSByZXdyaXRlLmdldExp
c3RSZXdyaXRlKGZyYWdtZW50LCBWYXJpYWJsZURlY2xhcmF0aW9uRnJhZ21lbnQuRVhUUkFfRElN
RU5TSU9OUzJfUFJPUEVSVFkpOworCQkJRXh0cmFEaW1lbnNpb24gZGltPSBhc3QubmV3RXh0cmFE
aW1lbnNpb24oKTsKKwkJCU1hcmtlckFubm90YXRpb24gbWFya2VyQW5ub3RhdGlvbjsKKwkJCWxp
c3RSZXdyaXRlLmluc2VydEF0KGRpbSwgMCwgbnVsbCk7CisKKwkJCUFycmF5VHlwZSBjcmVhdGlv
blR5cGUgPSBjcmVhdGlvbi5nZXRUeXBlKCk7CisJCQlBcnJheVR5cGUgbmV3QXJyYXlUeXBlID0g
YXN0Lm5ld0FycmF5VHlwZSgoQXJyYXlUeXBlKSBBU1ROb2RlLmNvcHlTdWJ0cmVlKGFzdCwgY3Jl
YXRpb25UeXBlKSk7CisJCQluZXdBcnJheVR5cGUgPSBhc3QubmV3QXJyYXlUeXBlKG5ld0FycmF5
VHlwZSk7CisJCQlyZXdyaXRlLnNldChjcmVhdGlvbiwgQXJyYXlDcmVhdGlvbi5UWVBFX1BST1BF
UlRZLCBuZXdBcnJheVR5cGUsIG51bGwpOworCisJCQlsaXN0UmV3cml0ZT0gcmV3cml0ZS5nZXRM
aXN0UmV3cml0ZShuZXdBcnJheVR5cGUsIEFycmF5VHlwZS5BTk5PVEFUSU9OU19QUk9QRVJUWSk7
CisJCQltYXJrZXJBbm5vdGF0aW9uPSBhc3QubmV3TWFya2VyQW5ub3RhdGlvbigpOworCQkJbWFy
a2VyQW5ub3RhdGlvbi5zZXRUeXBlTmFtZShhc3QubmV3U2ltcGxlTmFtZSgiQW5ub3QzIikpOwor
CQkJbGlzdFJld3JpdGUuaW5zZXJ0QXQobWFya2VyQW5ub3RhdGlvbiwgMCwgbnVsbCk7CisJCQlu
ZXdBcnJheVR5cGUuYW5ub3RhdGlvbnMoKS5hZGQobWFya2VyQW5ub3RhdGlvbik7CisJCQltYXJr
ZXJBbm5vdGF0aW9uPSBhc3QubmV3TWFya2VyQW5ub3RhdGlvbigpOworCQkJbWFya2VyQW5ub3Rh
dGlvbi5zZXRUeXBlTmFtZShhc3QubmV3U2ltcGxlTmFtZSgiQW5ub3QyIikpOworCQkJbGlzdFJl
d3JpdGUuaW5zZXJ0QXQobWFya2VyQW5ub3RhdGlvbiwgMSwgbnVsbCk7CisJCQltYXJrZXJBbm5v
dGF0aW9uPSBhc3QubmV3TWFya2VyQW5ub3RhdGlvbigpOworCQkJbWFya2VyQW5ub3RhdGlvbi5z
ZXRUeXBlTmFtZShhc3QubmV3U2ltcGxlTmFtZSgiQW5ub3QxIikpOworCQkJbGlzdFJld3JpdGUu
aW5zZXJ0QXQobWFya2VyQW5ub3RhdGlvbiwgMiwgbnVsbCk7CisJCX0KKwkJeworCQkJc3RhdGVt
ZW50ID0gKFZhcmlhYmxlRGVjbGFyYXRpb25TdGF0ZW1lbnQpIHN0YXRlbWVudHMuZ2V0KDEpOwor
CQkJZnJhZ21lbnRzID0gc3RhdGVtZW50LmZyYWdtZW50cygpOworCQkJYXNzZXJ0RXF1YWxzKCJJ
bmNvcnJlY3Qgbm8gb2YgZnJhZ21lbnRzIiwgMiwgZnJhZ21lbnRzLnNpemUoKSk7CisJCQlmcmFn
bWVudCA9IChWYXJpYWJsZURlY2xhcmF0aW9uRnJhZ21lbnQpIGZyYWdtZW50cy5nZXQoMCk7CisJ
CQl0eXBlID0gc3RhdGVtZW50LmdldFR5cGUoKTsKKworCQkJLy8gTW9kaWZ5IGV4aXN0aW5nIGFu
bm90YXRpb25zIGJ5IGFsdGVyaW5nIGFubm90YXRpb25zIGFuZCBleHByZXNzaW9ucworCQkJYXNz
ZXJ0RXF1YWxzKCJJbmNvcnJlY3QgdHlwZSIsIEFTVE5vZGUuQVJSQVlfVFlQRSwgdHlwZS5nZXRO
b2RlVHlwZSgpKTsKKwkJCUFycmF5Q3JlYXRpb24gY3JlYXRpb24gPSAoQXJyYXlDcmVhdGlvbikg
ZnJhZ21lbnQuZ2V0SW5pdGlhbGl6ZXIoKTsKKwkJCUFycmF5VHlwZSBjcmVhdGlvblR5cGUgPSBj
cmVhdGlvbi5nZXRUeXBlKCk7CisKKwkJCUxpc3QgZXhwcmVzc2lvbnMgPSBjcmVhdGlvbi5kaW1l
bnNpb25zKCk7CisJCQlMaXN0UmV3cml0ZSBsaXN0UmV3cml0ZSA9IHJld3JpdGUuZ2V0TGlzdFJl
d3JpdGUoY3JlYXRpb24sIEFycmF5Q3JlYXRpb24uRElNRU5TSU9OU19QUk9QRVJUWSk7CisJCQlF
eHByZXNzaW9uIGV4cCA9IChFeHByZXNzaW9uKSBleHByZXNzaW9ucy5nZXQoMSk7CisJCQlsaXN0
UmV3cml0ZS5yZW1vdmUoZXhwLCBudWxsKTsKKwkJCQorCQkJbGlzdFJld3JpdGUgPSByZXdyaXRl
LmdldExpc3RSZXdyaXRlKGNyZWF0aW9uVHlwZSwgQXJyYXlUeXBlLkFOTk9UQVRJT05TX1BST1BF
UlRZKTsKKwkJCU1hcmtlckFubm90YXRpb24gYW5ub3RhdGlvbiA9IChNYXJrZXJBbm5vdGF0aW9u
KSBjcmVhdGlvblR5cGUuYW5ub3RhdGlvbnMoKS5nZXQoMCk7CisJCQlsaXN0UmV3cml0ZS5yZW1v
dmUoYW5ub3RhdGlvbiwgbnVsbCk7CisJCQkKKwkJCWNyZWF0aW9uVHlwZSA9IChBcnJheVR5cGUp
IGNyZWF0aW9uVHlwZS5nZXRDb21wb25lbnRUeXBlKCk7CisJCQlsaXN0UmV3cml0ZSA9IHJld3Jp
dGUuZ2V0TGlzdFJld3JpdGUoY3JlYXRpb25UeXBlLCBBcnJheVR5cGUuQU5OT1RBVElPTlNfUFJP
UEVSVFkpOworCQkJYW5ub3RhdGlvbiA9IChNYXJrZXJBbm5vdGF0aW9uKSBjcmVhdGlvblR5cGUu
YW5ub3RhdGlvbnMoKS5nZXQoMSk7CisJCQlsaXN0UmV3cml0ZS5yZW1vdmUoYW5ub3RhdGlvbiwg
bnVsbCk7CisKKwkJCWNyZWF0aW9uVHlwZSA9IChBcnJheVR5cGUpIGNyZWF0aW9uVHlwZS5nZXRD
b21wb25lbnRUeXBlKCk7CisJCQlsaXN0UmV3cml0ZSA9IHJld3JpdGUuZ2V0TGlzdFJld3JpdGUo
Y3JlYXRpb25UeXBlLCBBcnJheVR5cGUuQU5OT1RBVElPTlNfUFJPUEVSVFkpOworCQkJYW5ub3Rh
dGlvbiA9IChNYXJrZXJBbm5vdGF0aW9uKSBjcmVhdGlvblR5cGUuYW5ub3RhdGlvbnMoKS5nZXQo
MSk7CisJCQlsaXN0UmV3cml0ZS5yZW1vdmUoYW5ub3RhdGlvbiwgbnVsbCk7CisKKwkJCWZyYWdt
ZW50ID0gKFZhcmlhYmxlRGVjbGFyYXRpb25GcmFnbWVudCkgZnJhZ21lbnRzLmdldCgxKTsKKwor
CQkJY3JlYXRpb24gPSAoQXJyYXlDcmVhdGlvbikgZnJhZ21lbnQuZ2V0SW5pdGlhbGl6ZXIoKTsK
KwkJCWNyZWF0aW9uVHlwZSA9IGNyZWF0aW9uLmdldFR5cGUoKTsKKworCQkJbGlzdFJld3JpdGUg
PSByZXdyaXRlLmdldExpc3RSZXdyaXRlKGNyZWF0aW9uVHlwZSwgQXJyYXlUeXBlLkFOTk9UQVRJ
T05TX1BST1BFUlRZKTsKKwkJCWFubm90YXRpb24gPSAoTWFya2VyQW5ub3RhdGlvbikgY3JlYXRp
b25UeXBlLmFubm90YXRpb25zKCkuZ2V0KDApOworCQkJbGlzdFJld3JpdGUucmVtb3ZlKGFubm90
YXRpb24sIG51bGwpOworCQkJYW5ub3RhdGlvbiA9IChNYXJrZXJBbm5vdGF0aW9uKSBjcmVhdGlv
blR5cGUuYW5ub3RhdGlvbnMoKS5nZXQoMSk7CisJCQlsaXN0UmV3cml0ZS5yZW1vdmUoYW5ub3Rh
dGlvbiwgbnVsbCk7CisJCQkKKwkJCWNyZWF0aW9uVHlwZSA9IChBcnJheVR5cGUpIGNyZWF0aW9u
VHlwZS5nZXRDb21wb25lbnRUeXBlKCk7CisJCQlsaXN0UmV3cml0ZSA9IHJld3JpdGUuZ2V0TGlz
dFJld3JpdGUoY3JlYXRpb25UeXBlLCBBcnJheVR5cGUuQU5OT1RBVElPTlNfUFJPUEVSVFkpOwor
CQkJYW5ub3RhdGlvbiA9IChNYXJrZXJBbm5vdGF0aW9uKSBjcmVhdGlvblR5cGUuYW5ub3RhdGlv
bnMoKS5nZXQoMCk7CisJCQlsaXN0UmV3cml0ZS5yZW1vdmUoYW5ub3RhdGlvbiwgbnVsbCk7CisJ
CQlhbm5vdGF0aW9uID0gKE1hcmtlckFubm90YXRpb24pIGNyZWF0aW9uVHlwZS5hbm5vdGF0aW9u
cygpLmdldCgxKTsKKwkJCWxpc3RSZXdyaXRlLnJlbW92ZShhbm5vdGF0aW9uLCBudWxsKTsKKwor
CQkJY3JlYXRpb25UeXBlID0gKEFycmF5VHlwZSkgY3JlYXRpb25UeXBlLmdldENvbXBvbmVudFR5
cGUoKTsKKwkJCWxpc3RSZXdyaXRlID0gcmV3cml0ZS5nZXRMaXN0UmV3cml0ZShjcmVhdGlvblR5
cGUsIEFycmF5VHlwZS5BTk5PVEFUSU9OU19QUk9QRVJUWSk7CisJCQlhbm5vdGF0aW9uID0gKE1h
cmtlckFubm90YXRpb24pIGNyZWF0aW9uVHlwZS5hbm5vdGF0aW9ucygpLmdldCgwKTsKKwkJCWxp
c3RSZXdyaXRlLnJlbW92ZShhbm5vdGF0aW9uLCBudWxsKTsKKwkJCWFubm90YXRpb24gPSAoTWFy
a2VyQW5ub3RhdGlvbikgY3JlYXRpb25UeXBlLmFubm90YXRpb25zKCkuZ2V0KDEpOworCQkJbGlz
dFJld3JpdGUucmVtb3ZlKGFubm90YXRpb24sIG51bGwpOworCQkJCisJCQlleHByZXNzaW9ucyA9
IGNyZWF0aW9uLmRpbWVuc2lvbnMoKTsKKwkJCWxpc3RSZXdyaXRlID0gcmV3cml0ZS5nZXRMaXN0
UmV3cml0ZShjcmVhdGlvbiwgQXJyYXlDcmVhdGlvbi5ESU1FTlNJT05TX1BST1BFUlRZKTsKKwkJ
CUV4cHJlc3Npb24gZXhwcmVzc2lvbiA9IGFzdC5uZXdOdW1iZXJMaXRlcmFsKCIxMCIpOyAKKwkJ
CWxpc3RSZXdyaXRlLnJlcGxhY2UoKEFTVE5vZGUpIGV4cHJlc3Npb25zLmdldCgxKSwgZXhwcmVz
c2lvbiwgbnVsbCk7CisJCQkKKwkJCU1ldGhvZEludm9jYXRpb24gaW52b2MgPSBhc3QubmV3TWV0
aG9kSW52b2NhdGlvbigpOworCQkJaW52b2Muc2V0TmFtZShhc3QubmV3U2ltcGxlTmFtZSgic2l6
ZSIpKTsKKwkJCWxpc3RSZXdyaXRlLmluc2VydEF0KGludm9jLCAyLCBudWxsKTsKKwkJCQorCQl9
CisJCS8vIEdldCBuZXcgY29kZQorCQlTdHJpbmcgcHJldmlldz0gZXZhbHVhdGVSZXdyaXRlKGN1
LCByZXdyaXRlKTsKKworCQlidWY9IG5ldyBTdHJpbmdCdWZmZXIoKTsKKwkJYnVmLmFwcGVuZCgi
cGFja2FnZSB0ZXN0MTtcbiIpOworCQlidWYuYXBwZW5kKCJpbXBvcnQgamF2YS5sYW5nLmFubm90
YXRpb24uRWxlbWVudFR5cGU7XG4iKTsKKwkJYnVmLmFwcGVuZCgicHVibGljIGNsYXNzIEUge1xu
Iik7CisJCWJ1Zi5hcHBlbmQoIiAgICBwdWJsaWMgdm9pZCBmb28oKSB7XG4iKTsKKwkJYnVmLmFw
cGVuZCgiICAgIAlpbnQgW10gaSBbXSBAQW5ub3QxIEBBbm5vdDIgW10gQEFubm90MSBAQW5ub3Qz
IFtdID0gbmV3IGludCBAQW5ub3QxIEBBbm5vdDIgIFsyXSBAQW5ub3QyIEBBbm5vdDMgW3NpemUo
KV0gQEFubm90MiBAQW5ub3QxIFtdW10gQEFubm90MyBAQW5ub3QyIEBBbm5vdDFbXTtcbiIpOwor
CQlidWYuYXBwZW5kKCIgICAgCWludCBbXSBqIFtdW10gPSBuZXcgaW50IEBBbm5vdDEgWzJdIEBB
bm5vdDIgW10gQEFubm90MyBbXSwgayBbXVtdID0gbmV3IGludFsyXVsxMF1bc2l6ZSgpXTtcbiIp
OworCQlidWYuYXBwZW5kKCIgICAgfVxuIik7CisJCWJ1Zi5hcHBlbmQoIiAgICBwdWJsaWMgaW50
IHNpemUoKSB7IHJldHVybiAyOyB9XG4iKTsKKwkJYnVmLmFwcGVuZCgifVxuIik7CisJCWJ1Zi5h
cHBlbmQoIkBqYXZhLmxhbmcuYW5ub3RhdGlvbi5UYXJnZXQodmFsdWU9IHtFbGVtZW50VHlwZS5U
WVBFX1VTRX0pXG4iKTsKKwkJYnVmLmFwcGVuZCgiQGludGVyZmFjZSBBbm5vdDEge31cbiIpOwor
CQlidWYuYXBwZW5kKCJAamF2YS5sYW5nLmFubm90YXRpb24uVGFyZ2V0KHZhbHVlPSB7RWxlbWVu
dFR5cGUuVFlQRV9VU0V9KVxuIik7CisJCWJ1Zi5hcHBlbmQoIkBpbnRlcmZhY2UgQW5ub3QyIHt9
XG4iKTsKKwkJYnVmLmFwcGVuZCgiQGphdmEubGFuZy5hbm5vdGF0aW9uLlRhcmdldCh2YWx1ZT0g
e0VsZW1lbnRUeXBlLlRZUEVfVVNFfSlcbiIpOworCQlidWYuYXBwZW5kKCJAaW50ZXJmYWNlIEFu
bm90MyB7fVxuIik7CisJCWFzc2VydEVxdWFsU3RyaW5nKHByZXZpZXcsIGJ1Zi50b1N0cmluZygp
KTsKKwkJCisJfQorCXB1YmxpYyB2b2lkIHRlc3RCdWc0MDA1NjhfYV9zaW5jZV84KCkgdGhyb3dz
IEV4Y2VwdGlvbiB7CisJCUlQYWNrYWdlRnJhZ21lbnQgcGFjazE9IHRoaXMuc291cmNlRm9sZGVy
LmNyZWF0ZVBhY2thZ2VGcmFnbWVudCgidGVzdDEiLCBmYWxzZSwgbnVsbCk7CisJCVN0cmluZ0J1
ZmZlciBidWY9IG5ldyBTdHJpbmdCdWZmZXIoKTsKKwkJYnVmLmFwcGVuZCgicGFja2FnZSB0ZXN0
MTtcbiIpOworCQlidWYuYXBwZW5kKCJpbXBvcnQgamF2YS5sYW5nLmFubm90YXRpb24uRWxlbWVu
dFR5cGU7XG4iKTsKKwkJYnVmLmFwcGVuZCgicHVibGljIGNsYXNzIEUge1xuIik7CisJCWJ1Zi5h
cHBlbmQoIiAgICBwdWJsaWMgdm9pZCBmb28oKSB7XG4iKTsKKwkJYnVmLmFwcGVuZCgiICAgIAlp
bnQgW10gaSBbXVtdID0gbmV3IGludCBAQW5ub3QxIEBBbm5vdDIgIFsyXSBAQW5ub3QyIEBBbm5v
dDMgW3NpemUobmV3IGludFtdW117fSldIFtdO1xuIik7CisJCWJ1Zi5hcHBlbmQoIiAgICAJaW50
IFtdIGogW11bXSA9IG5ldyBpbnQgQEFubm90MSBAQW5ub3QyIFsyXSBAQW5ub3QyIEBBbm5vdDMg
W3NpemUobmV3IGludFtde30pXSBAQW5ub3QxIEBBbm5vdDMgW10sIGsgW11bXSA9IG5ldyBpbnQg
QEFubm90MSBAQW5ub3QyIFsyXSBAQW5ub3QyIEBBbm5vdDMgWzEwXSBAQW5ub3QxIEBBbm5vdDMg
W3NpemUobmV3IGludFtdW117fSldO1xuIik7CisJCWJ1Zi5hcHBlbmQoIiAgICB9XG4iKTsKKwkJ
YnVmLmFwcGVuZCgiICAgIHB1YmxpYyBpbnQgc2l6ZShPYmplY3Qgb2JqKSB7IHJldHVybiAyOyB9
XG4iKTsKKwkJYnVmLmFwcGVuZCgifVxuIik7CisJCWJ1Zi5hcHBlbmQoIkBqYXZhLmxhbmcuYW5u
b3RhdGlvbi5UYXJnZXQodmFsdWU9IHtFbGVtZW50VHlwZS5UWVBFX1VTRX0pXG4iKTsKKwkJYnVm
LmFwcGVuZCgiQGludGVyZmFjZSBBbm5vdDEge31cbiIpOworCQlidWYuYXBwZW5kKCJAamF2YS5s
YW5nLmFubm90YXRpb24uVGFyZ2V0KHZhbHVlPSB7RWxlbWVudFR5cGUuVFlQRV9VU0V9KVxuIik7
CisJCWJ1Zi5hcHBlbmQoIkBpbnRlcmZhY2UgQW5ub3QyIHt9XG4iKTsKKwkJYnVmLmFwcGVuZCgi
QGphdmEubGFuZy5hbm5vdGF0aW9uLlRhcmdldCh2YWx1ZT0ge0VsZW1lbnRUeXBlLlRZUEVfVVNF
fSlcbiIpOworCQlidWYuYXBwZW5kKCJAaW50ZXJmYWNlIEFubm90MyB7fVxuIik7CisJCUlDb21w
aWxhdGlvblVuaXQgY3U9IHBhY2sxLmNyZWF0ZUNvbXBpbGF0aW9uVW5pdCgiRS5qYXZhIiwgYnVm
LnRvU3RyaW5nKCksIGZhbHNlLCBudWxsKTsKKworCQlDb21waWxhdGlvblVuaXQgYXN0Um9vdD0g
Y3JlYXRlQVNUKGN1KTsKKwkJQVNUUmV3cml0ZSByZXdyaXRlPSBBU1RSZXdyaXRlLmNyZWF0ZShh
c3RSb290LmdldEFTVCgpKTsKKworCQkvLyBHZXQgd2hpbGUgc3RhdGVtZW50IGJsb2NrCisJCVR5
cGVEZWNsYXJhdGlvbiB0eXBlRGVjbCA9IChUeXBlRGVjbGFyYXRpb24pIGFzdFJvb3QudHlwZXMo
KS5nZXQoMCk7CisJCU1ldGhvZERlY2xhcmF0aW9uIG1ldGhvZERlY2w9IHR5cGVEZWNsLmdldE1l
dGhvZHMoKVswXTsKKwkJQmxvY2sgYmxvY2s9IG1ldGhvZERlY2wuZ2V0Qm9keSgpOworCQlMaXN0
IHN0YXRlbWVudHM9IGJsb2NrLnN0YXRlbWVudHMoKTsKKworCQlWYXJpYWJsZURlY2xhcmF0aW9u
U3RhdGVtZW50IHN0YXRlbWVudCA9IChWYXJpYWJsZURlY2xhcmF0aW9uU3RhdGVtZW50KSBzdGF0
ZW1lbnRzLmdldCgwKTsKKwkJTGlzdCBmcmFnbWVudHMgPSBzdGF0ZW1lbnQuZnJhZ21lbnRzKCk7
CisJCVZhcmlhYmxlRGVjbGFyYXRpb25GcmFnbWVudCBmcmFnbWVudCA9IChWYXJpYWJsZURlY2xh
cmF0aW9uRnJhZ21lbnQpIGZyYWdtZW50cy5nZXQoMCk7CisJCVR5cGUgdHlwZSA9IHN0YXRlbWVu
dC5nZXRUeXBlKCk7CisKKwkJeworCQkJYXNzZXJ0RXF1YWxzKCJJbmNvcnJlY3QgdHlwZSIsIEFT
VE5vZGUuQVJSQVlfVFlQRSwgdHlwZS5nZXROb2RlVHlwZSgpKTsKKwkJCUFycmF5Q3JlYXRpb24g
Y3JlYXRpb24gPSAoQXJyYXlDcmVhdGlvbikgZnJhZ21lbnQuZ2V0SW5pdGlhbGl6ZXIoKTsKKwor
CQkJQXJyYXlUeXBlIGFycmF5VHlwZSA9IGNyZWF0aW9uLmdldFR5cGUoKTsKKwkJCWFycmF5VHlw
ZSA9IChBcnJheVR5cGUpIGFycmF5VHlwZS5nZXRDb21wb25lbnRUeXBlKCk7CisJCQlMaXN0UmV3
cml0ZSBsaXN0UmV3cml0ZT0gcmV3cml0ZS5nZXRMaXN0UmV3cml0ZShhcnJheVR5cGUsIEFycmF5
VHlwZS5BTk5PVEFUSU9OU19QUk9QRVJUWSk7CisJCQlsaXN0UmV3cml0ZS5yZW1vdmUoKEFTVE5v
ZGUpYXJyYXlUeXBlLmFubm90YXRpb25zKCkuZ2V0KDApLCBudWxsKTsKKwkJCWxpc3RSZXdyaXRl
LnJlbW92ZSgoQVNUTm9kZSlhcnJheVR5cGUuYW5ub3RhdGlvbnMoKS5nZXQoMSksIG51bGwpOwor
CQkJcmV3cml0ZS5zZXQoY3JlYXRpb24sIEFycmF5Q3JlYXRpb24uVFlQRV9QUk9QRVJUWSwgYXJy
YXlUeXBlLCBudWxsKTsKKwkJfQorCQl7CisJCQlzdGF0ZW1lbnQgPSAoVmFyaWFibGVEZWNsYXJh
dGlvblN0YXRlbWVudCkgc3RhdGVtZW50cy5nZXQoMSk7CisJCQlmcmFnbWVudHMgPSBzdGF0ZW1l
bnQuZnJhZ21lbnRzKCk7CisJCQlhc3NlcnRFcXVhbHMoIkluY29ycmVjdCBubyBvZiBmcmFnbWVu
dHMiLCAyLCBmcmFnbWVudHMuc2l6ZSgpKTsKKwkJCWZyYWdtZW50ID0gKFZhcmlhYmxlRGVjbGFy
YXRpb25GcmFnbWVudCkgZnJhZ21lbnRzLmdldCgwKTsKKworCQkJYXNzZXJ0RXF1YWxzKCJJbmNv
cnJlY3QgdHlwZSIsIEFTVE5vZGUuQVJSQVlfVFlQRSwgdHlwZS5nZXROb2RlVHlwZSgpKTsKKwkJ
CUFycmF5Q3JlYXRpb24gY3JlYXRpb24gPSAoQXJyYXlDcmVhdGlvbikgZnJhZ21lbnQuZ2V0SW5p
dGlhbGl6ZXIoKTsKKwkJCUFycmF5VHlwZSBjcmVhdGlvblR5cGUgPSBjcmVhdGlvbi5nZXRUeXBl
KCk7CisKKwkJCUFycmF5VHlwZSBuZXdBcnJheVR5cGUgPSAoQXJyYXlUeXBlKSBjcmVhdGlvblR5
cGUuZ2V0Q29tcG9uZW50VHlwZSgpOworCQkJcmV3cml0ZS5zZXQoY3JlYXRpb24sIEFycmF5Q3Jl
YXRpb24uVFlQRV9QUk9QRVJUWSwgbmV3QXJyYXlUeXBlLCBudWxsKTsKKwkJCQorCQkJZnJhZ21l
bnQgPSAoVmFyaWFibGVEZWNsYXJhdGlvbkZyYWdtZW50KSBmcmFnbWVudHMuZ2V0KDEpOworCQkJ
Y3JlYXRpb24gPSAoQXJyYXlDcmVhdGlvbikgZnJhZ21lbnQuZ2V0SW5pdGlhbGl6ZXIoKTsKKwkJ
CWNyZWF0aW9uVHlwZSA9IGNyZWF0aW9uLmdldFR5cGUoKTsKKwkJCQorCQkJbmV3QXJyYXlUeXBl
ID0gKEFycmF5VHlwZSkgY3JlYXRpb25UeXBlLmdldENvbXBvbmVudFR5cGUoKTsKKwkJCXJld3Jp
dGUuc2V0KGNyZWF0aW9uLCBBcnJheUNyZWF0aW9uLlRZUEVfUFJPUEVSVFksIG5ld0FycmF5VHlw
ZSwgbnVsbCk7CisJCX0KKwkJLy8gR2V0IG5ldyBjb2RlCisJCVN0cmluZyBwcmV2aWV3PSBldmFs
dWF0ZVJld3JpdGUoY3UsIHJld3JpdGUpOworCisJCWJ1Zj0gbmV3IFN0cmluZ0J1ZmZlcigpOwor
CQlidWYuYXBwZW5kKCJwYWNrYWdlIHRlc3QxO1xuIik7CisJCWJ1Zi5hcHBlbmQoImltcG9ydCBq
YXZhLmxhbmcuYW5ub3RhdGlvbi5FbGVtZW50VHlwZTtcbiIpOworCQlidWYuYXBwZW5kKCJwdWJs
aWMgY2xhc3MgRSB7XG4iKTsKKwkJYnVmLmFwcGVuZCgiICAgIHB1YmxpYyB2b2lkIGZvbygpIHtc
biIpOworCQlidWYuYXBwZW5kKCIgICAgCWludCBbXSBpIFtdW10gPSBuZXcgaW50IEBBbm5vdDEg
QEFubm90MiAgWzJdW3NpemUobmV3IGludFtdW117fSldO1xuIik7CisJCWJ1Zi5hcHBlbmQoIiAg
ICAJaW50IFtdIGogW11bXSA9IG5ldyBpbnQgQEFubm90MSBAQW5ub3QyIFsyXSBAQW5ub3QyIEBB
bm5vdDMgW3NpemUobmV3IGludFtde30pXSwgayBbXVtdID0gbmV3IGludCBAQW5ub3QxIEBBbm5v
dDIgWzJdIEBBbm5vdDIgQEFubm90MyBbMTBdO1xuIik7CisJCWJ1Zi5hcHBlbmQoIiAgICB9XG4i
KTsKKwkJYnVmLmFwcGVuZCgiICAgIHB1YmxpYyBpbnQgc2l6ZShPYmplY3Qgb2JqKSB7IHJldHVy
biAyOyB9XG4iKTsKKwkJYnVmLmFwcGVuZCgifVxuIik7CisJCWJ1Zi5hcHBlbmQoIkBqYXZhLmxh
bmcuYW5ub3RhdGlvbi5UYXJnZXQodmFsdWU9IHtFbGVtZW50VHlwZS5UWVBFX1VTRX0pXG4iKTsK
KwkJYnVmLmFwcGVuZCgiQGludGVyZmFjZSBBbm5vdDEge31cbiIpOworCQlidWYuYXBwZW5kKCJA
amF2YS5sYW5nLmFubm90YXRpb24uVGFyZ2V0KHZhbHVlPSB7RWxlbWVudFR5cGUuVFlQRV9VU0V9
KVxuIik7CisJCWJ1Zi5hcHBlbmQoIkBpbnRlcmZhY2UgQW5ub3QyIHt9XG4iKTsKKwkJYnVmLmFw
cGVuZCgiQGphdmEubGFuZy5hbm5vdGF0aW9uLlRhcmdldCh2YWx1ZT0ge0VsZW1lbnRUeXBlLlRZ
UEVfVVNFfSlcbiIpOworCQlidWYuYXBwZW5kKCJAaW50ZXJmYWNlIEFubm90MyB7fVxuIik7CisJ
CWFzc2VydEVxdWFsU3RyaW5nKHByZXZpZXcsIGJ1Zi50b1N0cmluZygpKTsKKwl9CiB9CiAKZGlm
ZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlL2RvbS9vcmcvZWNsaXBzZS9qZHQvY29yZS9k
b20vQVNUQ29udmVydGVyLmphdmEgYi9vcmcuZWNsaXBzZS5qZHQuY29yZS9kb20vb3JnL2VjbGlw
c2UvamR0L2NvcmUvZG9tL0FTVENvbnZlcnRlci5qYXZhCmluZGV4IDk2NDhiYmQuLjliODMzOWEg
MTAwNjQ0Ci0tLSBhL29yZy5lY2xpcHNlLmpkdC5jb3JlL2RvbS9vcmcvZWNsaXBzZS9qZHQvY29y
ZS9kb20vQVNUQ29udmVydGVyLmphdmEKKysrIGIvb3JnLmVjbGlwc2UuamR0LmNvcmUvZG9tL29y
Zy9lY2xpcHNlL2pkdC9jb3JlL2RvbS9BU1RDb252ZXJ0ZXIuamF2YQpAQCAtMzI2Miw1ICszMjYy
LDcgQEAKIAkJCUFycmF5VHlwZSBhcnJheVR5cGUgPSAoQXJyYXlUeXBlKSB0eXBlOwogCQkJb3Jn
LmVjbGlwc2UuamR0LmludGVybmFsLmNvbXBpbGVyLmFzdC5Bbm5vdGF0aW9uW10gdHlwZUFubm90
YXRpb25zID0gYW5ub3RhdGlvbnNbbGV2ZWwtLV07Ci0JCQlhbm5vdGF0ZVR5cGUoYXJyYXlUeXBl
LCB0eXBlQW5ub3RhdGlvbnMpOworCQkJaWYgKHR5cGVBbm5vdGF0aW9ucyAhPSBudWxsKSB7CisJ
CQkJYW5ub3RhdGVUeXBlKGFycmF5VHlwZSwgdHlwZUFubm90YXRpb25zKTsKKwkJCX0KIAkJCXR5
cGUgPSBhcnJheVR5cGUuZ2V0Q29tcG9uZW50VHlwZSgpOwogCQl9CmRpZmYgLS1naXQgYS9vcmcu
ZWNsaXBzZS5qZHQuY29yZS9kb20vb3JnL2VjbGlwc2UvamR0L2ludGVybmFsL2NvcmUvZG9tL3Jl
d3JpdGUvQVNUUmV3cml0ZUFuYWx5emVyLmphdmEgYi9vcmcuZWNsaXBzZS5qZHQuY29yZS9kb20v
b3JnL2VjbGlwc2UvamR0L2ludGVybmFsL2NvcmUvZG9tL3Jld3JpdGUvQVNUUmV3cml0ZUFuYWx5
emVyLmphdmEKaW5kZXggNzQ1YjVlYS4uNWMzOWM5OSAxMDA2NDQKLS0tIGEvb3JnLmVjbGlwc2Uu
amR0LmNvcmUvZG9tL29yZy9lY2xpcHNlL2pkdC9pbnRlcm5hbC9jb3JlL2RvbS9yZXdyaXRlL0FT
VFJld3JpdGVBbmFseXplci5qYXZhCisrKyBiL29yZy5lY2xpcHNlLmpkdC5jb3JlL2RvbS9vcmcv
ZWNsaXBzZS9qZHQvaW50ZXJuYWwvY29yZS9kb20vcmV3cml0ZS9BU1RSZXdyaXRlQW5hbHl6ZXIu
amF2YQpAQCAtMTUxNyw1ICsxNTE3LDUgQEAKIAkJYm9vbGVhbiBpc0FsbFJlbW92ZT0gaXNBbGxP
ZktpbmQoY2hpbGRyZW4sIFJld3JpdGVFdmVudC5SRU1PVkVEKTsKIAkJU3RyaW5nIGtleXdvcmQ9
IFV0aWwuRU1QVFlfU1RSSU5HOwotCQlpZiAocHJvcGVydHkgPT0gU2luZ2xlVmFyaWFibGVEZWNs
YXJhdGlvbi5WQVJBUkdTX0FOTk9UQVRJT05TX1BST1BFUlRZKSB7CisJCWlmIChwcm9wZXJ0eSA9
PSBTaW5nbGVWYXJpYWJsZURlY2xhcmF0aW9uLlZBUkFSR1NfQU5OT1RBVElPTlNfUFJPUEVSVFkg
fHwgcHJvcGVydHkgPT0gQXJyYXlUeXBlLkFOTk9UQVRJT05TX1BST1BFUlRZKSB7CiAJCQlrZXl3
b3JkPSAiICI7IC8vJE5PTi1OTFMtMSQKIAkJfSBlbHNlIGlmIChpc0FsbEluc2VydCB8fCBpc0Fs
bFJlbW92ZSkgewpAQCAtMTUyOSw1ICsxNTI5LDYgQEAKIAogCQlQcmVmaXggZm9ybWF0dGVyUHJl
Zml4OwotCQlpZiAocHJvcGVydHkgPT0gU2luZ2xlVmFyaWFibGVEZWNsYXJhdGlvbi5NT0RJRklF
UlMyX1BST1BFUlRZIHx8IHByb3BlcnR5ID09IFNpbmdsZVZhcmlhYmxlRGVjbGFyYXRpb24uVkFS
QVJHU19BTk5PVEFUSU9OU19QUk9QRVJUWSkKKwkJaWYgKHByb3BlcnR5ID09IFNpbmdsZVZhcmlh
YmxlRGVjbGFyYXRpb24uTU9ESUZJRVJTMl9QUk9QRVJUWSB8fCBwcm9wZXJ0eSA9PSBTaW5nbGVW
YXJpYWJsZURlY2xhcmF0aW9uLlZBUkFSR1NfQU5OT1RBVElPTlNfUFJPUEVSVFkgCisJCQkJCQkJ
fHwgcHJvcGVydHkgPT0gQXJyYXlUeXBlLkFOTk9UQVRJT05TX1BST1BFUlRZKQogCQkJZm9ybWF0
dGVyUHJlZml4PSB0aGlzLmZvcm1hdHRlci5QQVJBTV9BTk5PVEFUSU9OX1NFUEFSQVRJT047CiAJ
CWVsc2UKQEAgLTE1NDUsNSArMTU0Niw1IEBACiAJCQkJcmV0dXJuIG5leHRQb3M7CiAJCQl9IGVs
c2UgaWYgKChpc0FsbEluc2VydCB8fCAobmV4dFBvcyA9PSBlbmRQb3MgJiYgbGFzdFVuY2hhbmdl
ZCkpIC8vIHNlZSBidWcgMTY1NjU0Ci0JCQkJCSYmIHByb3BlcnR5ICE9IFNpbmdsZVZhcmlhYmxl
RGVjbGFyYXRpb24uVkFSQVJHU19BTk5PVEFUSU9OU19QUk9QRVJUWSkgeworCQkJCQkmJiBwcm9w
ZXJ0eSAhPSBTaW5nbGVWYXJpYWJsZURlY2xhcmF0aW9uLlZBUkFSR1NfQU5OT1RBVElPTlNfUFJP
UEVSVFkgJiYgcHJvcGVydHkgIT0gQXJyYXlUeXBlLkFOTk9UQVRJT05TX1BST1BFUlRZKSB7CiAJ
CQkJU3RyaW5nIHNlcGFyYXRvcjsKIAkJCQlpZiAobGFzdENoaWxkLmdldE5ld1ZhbHVlKCkgaW5z
dGFuY2VvZiBBbm5vdGF0aW9uKSB7CkBAIC0xOTcwLDExICsxOTcxLDExIEBACiAKIAkJQXJyYXlU
eXBlIGFycmF5VHlwZT0gKEFycmF5VHlwZSkgZ2V0T3JpZ2luYWxWYWx1ZShub2RlLCBBcnJheUNy
ZWF0aW9uLlRZUEVfUFJPUEVSVFkpOworCQlBcnJheVR5cGUgcmVwbGFjaW5nVHlwZT0gYXJyYXlU
eXBlOwogCQlpbnQgbk9sZEJyYWNrZXRzPSBnZXREaW1lbnNpb25zKGFycmF5VHlwZSk7IC8vIG51
bWJlciBvZiB0b3RhbCBicmFja2V0cwotCQlpbnQgbk5ld0JyYWNrZXRzPSBuT2xkQnJhY2tldHM7
CiAKIAkJVGV4dEVkaXRHcm91cCBlZGl0R3JvdXA9IG51bGw7CiAJCVJld3JpdGVFdmVudCB0eXBl
RXZlbnQ9IGdldEV2ZW50KG5vZGUsIEFycmF5Q3JlYXRpb24uVFlQRV9QUk9QRVJUWSk7CiAJCWlm
ICh0eXBlRXZlbnQgIT0gbnVsbCAmJiB0eXBlRXZlbnQuZ2V0Q2hhbmdlS2luZCgpID09IFJld3Jp
dGVFdmVudC5SRVBMQUNFRCkgeyAvLyBjaGFuZ2VkIGFycmF5dHlwZSBjYW4gaGF2ZSBkaWZmZXJl
bnQgZGltZW5zaW9uIG9yIHR5cGUgbmFtZQotCQkJQXJyYXlUeXBlIHJlcGxhY2luZ1R5cGU9IChB
cnJheVR5cGUpIHR5cGVFdmVudC5nZXROZXdWYWx1ZSgpOworCQkJcmVwbGFjaW5nVHlwZT0gKEFy
cmF5VHlwZSkgdHlwZUV2ZW50LmdldE5ld1ZhbHVlKCk7CiAJCQllZGl0R3JvdXA9IGdldEVkaXRH
cm91cCh0eXBlRXZlbnQpOwogCQkJVHlwZSBuZXdUeXBlPSByZXBsYWNpbmdUeXBlLmdldEVsZW1l
bnRUeXBlKCk7CkBAIC0xOTg3LDU3ICsxOTg4LDY1IEBACiAJCQkJZG9UZXh0SW5zZXJ0KG9mZnNl
dCwgbmV3VHlwZSwgMCwgZmFsc2UsIGVkaXRHcm91cCk7CiAJCQl9Ci0JCQluTmV3QnJhY2tldHM9
IHJlcGxhY2luZ1R5cGUuZ2V0RGltZW5zaW9ucygpOyAvLyBpcyByZXBsYWNlZCB0eXBlCiAJCX0K
LQkJdm9pZFZpc2l0KGFycmF5VHlwZSk7Ci0KIAogCQl0cnkgewotCQkJaW50IG9mZnNldD0gZ2V0
U2Nhbm5lcigpLmdldFRva2VuU3RhcnRPZmZzZXQoVGVybWluYWxUb2tlbnMuVG9rZW5OYW1lTEJS
QUNLRVQsIGFycmF5VHlwZS5nZXRTdGFydFBvc2l0aW9uKCkpOwotCQkJLy8gZGltZW5zaW9uIG5v
ZGUgd2l0aCBleHByZXNzaW9ucworCQkJLy8gZGltZW5zaW9uIG5vZGUgd2l0aCBleHByZXNzaW9u
cyBhbmQvb3IgYW5ub3RhdGlvbnMKIAkJCVJld3JpdGVFdmVudCBkaW1FdmVudD0gZ2V0RXZlbnQo
bm9kZSwgQXJyYXlDcmVhdGlvbi5ESU1FTlNJT05TX1BST1BFUlRZKTsKIAkJCWJvb2xlYW4gaGFz
RGltZW5zaW9uQ2hhbmdlcz0gKGRpbUV2ZW50ICE9IG51bGwgJiYgZGltRXZlbnQuZ2V0Q2hhbmdl
S2luZCgpICE9IFJld3JpdGVFdmVudC5VTkNIQU5HRUQpOwotCQkJaWYgKGhhc0RpbWVuc2lvbkNo
YW5nZXMpIHsKLQkJCQlSZXdyaXRlRXZlbnRbXSBldmVudHM9IGRpbUV2ZW50LmdldENoaWxkcmVu
KCk7Ci0JCQkJLy8gb2Zmc2V0IG9uIGZpcnN0IG9wZW5pbmcgYnJhY2UKLQkJCQlmb3IgKGludCBp
PSAwOyBpIDwgZXZlbnRzLmxlbmd0aDsgaSsrKSB7Ci0JCQkJCVJld3JpdGVFdmVudCBldmVudD0g
ZXZlbnRzW2ldOwotCQkJCQlpbnQgY2hhbmdlS2luZD0gZXZlbnQuZ2V0Q2hhbmdlS2luZCgpOwot
CQkJCQlpZiAoY2hhbmdlS2luZCA9PSBSZXdyaXRlRXZlbnQuSU5TRVJURUQpIHsgLy8gaW5zZXJ0
IG5ldyBkaW1lbnNpb24KLQkJCQkJCWVkaXRHcm91cD0gZ2V0RWRpdEdyb3VwKGV2ZW50KTsKLQkJ
CQkJCWRvVGV4dEluc2VydChvZmZzZXQsICJbIiwgZWRpdEdyb3VwKTsgLy8kTk9OLU5MUy0xJAot
CQkJCQkJZG9UZXh0SW5zZXJ0KG9mZnNldCwgKEFTVE5vZGUpIGV2ZW50LmdldE5ld1ZhbHVlKCks
IDAsIGZhbHNlLCBlZGl0R3JvdXApOwotCQkJCQkJZG9UZXh0SW5zZXJ0KG9mZnNldCwgIl0iLCBl
ZGl0R3JvdXApOyAvLyROT04tTkxTLTEkCi0JCQkJCQluTmV3QnJhY2tldHMtLTsKLQkJCQkJfSBl
bHNlIHsKLQkJCQkJCUFTVE5vZGUgZWxlbT0gKEFTVE5vZGUpIGV2ZW50LmdldE9yaWdpbmFsVmFs
dWUoKTsKLQkJCQkJCWludCBlbGVtRW5kPSBlbGVtLmdldFN0YXJ0UG9zaXRpb24oKSArIGVsZW0u
Z2V0TGVuZ3RoKCk7Ci0JCQkJCQlpbnQgZW5kUG9zPSBnZXRTY2FubmVyKCkuZ2V0VG9rZW5FbmRP
ZmZzZXQoVGVybWluYWxUb2tlbnMuVG9rZW5OYW1lUkJSQUNLRVQsIGVsZW1FbmQpOwotCQkJCQkJ
aWYgKGNoYW5nZUtpbmQgPT0gUmV3cml0ZUV2ZW50LlJFTU9WRUQpIHsKKwkJCVJld3JpdGVFdmVu
dFtdIGV2ZW50cz0gaGFzRGltZW5zaW9uQ2hhbmdlcyA/IGRpbUV2ZW50LmdldENoaWxkcmVuKCkg
OiBudWxsOworCQkJQXJyYXlUeXBlIGN1cnJlbnRMZXZlbD0gKEFycmF5VHlwZSkgcmVwbGFjaW5n
VHlwZS5nZXRFbGVtZW50VHlwZSgpLmdldFBhcmVudCgpOworCQkJaW50IGk9MCwgZGltU2l6ZT0g
KGV2ZW50cyA9PSBudWxsKSA/IDAgOiBldmVudHMubGVuZ3RoOworCQkJVHlwZSBlbGVtZW50VHlw
ZT0gYXJyYXlUeXBlLmdldEVsZW1lbnRUeXBlKCk7CisJCQlpbnQgb2Zmc2V0PSBlbGVtZW50VHlw
ZS5nZXRTdGFydFBvc2l0aW9uKCkgKyBlbGVtZW50VHlwZS5nZXRMZW5ndGgoKTsKKwkJCXdoaWxl
KGN1cnJlbnRMZXZlbCAhPSBudWxsKSB7CisJCQkJaWYgKG5vZGUuZ2V0QVNUKCkuYXBpTGV2ZWwo
KSA+PSBBU1QuSkxTOCkgeworCQkJCQlyZXdyaXRlVHlwZUFubm90YXRpb25zKGN1cnJlbnRMZXZl
bCwgQXJyYXlUeXBlLkFOTk9UQVRJT05TX1BST1BFUlRZLCBvZmZzZXQpOworCQkJCX0KKwkJCQlp
ZiAoaSA8IGRpbVNpemUpIHsKKwkJCQkJIG9mZnNldD0gZ2V0U2Nhbm5lcigpLmdldFRva2VuRW5k
T2Zmc2V0KFRlcm1pbmFsVG9rZW5zLlRva2VuTmFtZUxCUkFDS0VULCBvZmZzZXQpOworCQkJCQlp
ZiAoaGFzRGltZW5zaW9uQ2hhbmdlcykgeworCQkJCQkJUmV3cml0ZUV2ZW50IGV2ZW50PSBldmVu
dHNbaV07CisJCQkJCQlpbnQgY2hhbmdlS2luZD0gZXZlbnQuZ2V0Q2hhbmdlS2luZCgpOworCQkJ
CQkJaWYgKGNoYW5nZUtpbmQgPT0gUmV3cml0ZUV2ZW50LklOU0VSVEVEKSB7IC8vIGluc2VydCBu
ZXcgZGltZW5zaW9uCiAJCQkJCQkJZWRpdEdyb3VwPSBnZXRFZGl0R3JvdXAoZXZlbnQpOwotCQkJ
CQkJCWRvVGV4dFJlbW92ZUFuZFZpc2l0KG9mZnNldCwgZW5kUG9zIC0gb2Zmc2V0LCBlbGVtLCBl
ZGl0R3JvdXApOwotCQkJCQkJfSBlbHNlIGlmIChjaGFuZ2VLaW5kID09IFJld3JpdGVFdmVudC5S
RVBMQUNFRCkgewotCQkJCQkJCWVkaXRHcm91cD0gZ2V0RWRpdEdyb3VwKGV2ZW50KTsKLQkJCQkJ
CQlTb3VyY2VSYW5nZSByYW5nZT0gZ2V0RXh0ZW5kZWRSYW5nZShlbGVtKTsKLQkJCQkJCQlpbnQg
ZWxlbU9mZnNldD0gcmFuZ2UuZ2V0U3RhcnRQb3NpdGlvbigpOwotCQkJCQkJCWludCBlbGVtTGVu
Z3RoPSByYW5nZS5nZXRMZW5ndGgoKTsKLQkJCQkJCQlkb1RleHRSZW1vdmVBbmRWaXNpdChlbGVt
T2Zmc2V0LCBlbGVtTGVuZ3RoLCBlbGVtLCBlZGl0R3JvdXApOwotCQkJCQkJCWRvVGV4dEluc2Vy
dChlbGVtT2Zmc2V0LCAoQVNUTm9kZSkgZXZlbnQuZ2V0TmV3VmFsdWUoKSwgMCwgZmFsc2UsIGVk
aXRHcm91cCk7Ci0JCQkJCQkJbk5ld0JyYWNrZXRzLS07CisJCQkJCQkJaW50IGVuZFBvcz0gZ2V0
U2Nhbm5lcigpLmdldFRva2VuU3RhcnRPZmZzZXQoVGVybWluYWxUb2tlbnMuVG9rZW5OYW1lUkJS
QUNLRVQsIG9mZnNldCk7CisJCQkJCQkJZG9UZXh0UmVtb3ZlKG9mZnNldCwgZW5kUG9zIC0gb2Zm
c2V0LCBlZGl0R3JvdXApOworCQkJCQkJCWRvVGV4dEluc2VydChvZmZzZXQsIChBU1ROb2RlKSBl
dmVudC5nZXROZXdWYWx1ZSgpLCAwLCBmYWxzZSwgZWRpdEdyb3VwKTsKIAkJCQkJCX0gZWxzZSB7
Ci0JCQkJCQkJdm9pZFZpc2l0KGVsZW0pOwotCQkJCQkJCW5OZXdCcmFja2V0cy0tOworCQkJCQkJ
CUFTVE5vZGUgZWxlbT0gKEFTVE5vZGUpIGV2ZW50LmdldE9yaWdpbmFsVmFsdWUoKTsKKwkJCQkJ
CQlpbnQgZWxlbUVuZD0gZWxlbS5nZXRTdGFydFBvc2l0aW9uKCkgKyBlbGVtLmdldExlbmd0aCgp
OworCQkJCQkJCWludCBlbmRQb3M9IGdldFNjYW5uZXIoKS5nZXRUb2tlblN0YXJ0T2Zmc2V0KFRl
cm1pbmFsVG9rZW5zLlRva2VuTmFtZVJCUkFDS0VULCBlbGVtRW5kKTsKKwkJCQkJCQlpZiAoY2hh
bmdlS2luZCA9PSBSZXdyaXRlRXZlbnQuUkVNT1ZFRCkgeworCQkJCQkJCQllZGl0R3JvdXA9IGdl
dEVkaXRHcm91cChldmVudCk7CisJCQkJCQkJCWRvVGV4dFJlbW92ZUFuZFZpc2l0KG9mZnNldCwg
ZW5kUG9zIC0gb2Zmc2V0LCBlbGVtLCBlZGl0R3JvdXApOworCQkJCQkJCX0gZWxzZSBpZiAoY2hh
bmdlS2luZCA9PSBSZXdyaXRlRXZlbnQuUkVQTEFDRUQpIHsKKwkJCQkJCQkJZWRpdEdyb3VwPSBn
ZXRFZGl0R3JvdXAoZXZlbnQpOworCQkJCQkJCQlTb3VyY2VSYW5nZSByYW5nZT0gZ2V0RXh0ZW5k
ZWRSYW5nZShlbGVtKTsKKwkJCQkJCQkJaW50IGVsZW1PZmZzZXQ9IHJhbmdlLmdldFN0YXJ0UG9z
aXRpb24oKTsKKwkJCQkJCQkJaW50IGVsZW1MZW5ndGg9IHJhbmdlLmdldExlbmd0aCgpOworCQkJ
CQkJCQlkb1RleHRSZW1vdmVBbmRWaXNpdChlbGVtT2Zmc2V0LCBlbGVtTGVuZ3RoLCBlbGVtLCBl
ZGl0R3JvdXApOworCQkJCQkJCQlkb1RleHRJbnNlcnQoZWxlbU9mZnNldCwgKEFTVE5vZGUpIGV2
ZW50LmdldE5ld1ZhbHVlKCksIDAsIGZhbHNlLCBlZGl0R3JvdXApOworCQkJCQkJCX0gZWxzZSB7
CisJCQkJCQkJCXZvaWRWaXNpdChlbGVtKTsKKwkJCQkJCQl9CiAJCQkJCQl9Ci0JCQkJCQlvZmZz
ZXQ9IGVuZFBvczsKLQkJCQkJCW5PbGRCcmFja2V0cy0tOworCQkJCQkJb2Zmc2V0PSByZXRyaWV2
ZVJpZ2h0QnJhY2tldEVuZFBvc2l0aW9uKG9mZnNldCwgMSwgdHJ1ZSk7CisJCQkJCX0gZWxzZSB7
CisJCQkJCQlBU1ROb2RlIGVsZW09IChBU1ROb2RlKSBub2RlLmRpbWVuc2lvbnMoKS5nZXQoaSk7
CisJCQkJCQl2b2lkVmlzaXQoZWxlbSk7CisJCQkJCQlvZmZzZXQ9IHJldHJpZXZlUmlnaHRCcmFj
a2V0RW5kUG9zaXRpb24ob2Zmc2V0LCAxLCB0cnVlKTsKIAkJCQkJfQorCQkJCX0gZWxzZSBpZiAo
aSA8IG5PbGRCcmFja2V0cykgeworCQkJCQlvZmZzZXQ9IHJldHJpZXZlUmlnaHRCcmFja2V0RW5k
UG9zaXRpb24ob2Zmc2V0LCAxLCBmYWxzZSk7CisJCQkJfSBlbHNlIHsKKwkJCQkJZG9UZXh0SW5z
ZXJ0KG9mZnNldCwgIltdIiwgZWRpdEdyb3VwKTsgLy8kTk9OLU5MUy0xJAkJCQkJCQogCQkJCX0K
LQkJCX0gZWxzZSB7Ci0JCQkJb2Zmc2V0PSBkb1Zpc2l0KG5vZGUsIEFycmF5Q3JlYXRpb24uRElN
RU5TSU9OU19QUk9QRVJUWSwgb2Zmc2V0KTsKKwkJCQlpKys7CisJCQkJaWYgKGN1cnJlbnRMZXZl
bCA9PSByZXBsYWNpbmdUeXBlKSBicmVhazsKKwkJCQljdXJyZW50TGV2ZWw9IChBcnJheVR5cGUp
IGN1cnJlbnRMZXZlbC5nZXRQYXJlbnQoKTsKIAkJCX0KLQkJCWlmIChuT2xkQnJhY2tldHMgIT0g
bk5ld0JyYWNrZXRzKSB7Ci0JCQkJaWYgKCFoYXNEaW1lbnNpb25DaGFuZ2VzKSB7Ci0JCQkJCW9m
ZnNldD0gZ2V0U2Nhbm5lcigpLmdldFRva2VuRW5kT2Zmc2V0KFRlcm1pbmFsVG9rZW5zLlRva2Vu
TmFtZVJCUkFDS0VULCBvZmZzZXQpOwotCQkJCX0KLQkJCQlyZXdyaXRlRXh0cmFEaW1lbnNpb25z
KG5PbGRCcmFja2V0cywgbk5ld0JyYWNrZXRzLCBvZmZzZXQsIGVkaXRHcm91cCk7CisJCQlpZiAo
aSA8IG5PbGRCcmFja2V0cykgeworCQkJCWludCBlbmRQb3M9IHJldHJpZXZlUmlnaHRCcmFja2V0
RW5kUG9zaXRpb24ob2Zmc2V0LCBuT2xkQnJhY2tldHMgLSBpLCBmYWxzZSk7CisJCQkJZG9UZXh0
UmVtb3ZlKG9mZnNldCwgZW5kUG9zIC0gb2Zmc2V0LCBlZGl0R3JvdXApOwogCQkJfQogCkBAIC0y
MDU1LDQgKzIwNjQsMzIgQEAKIAl9CiAKKwkvKioKKwkgKiBUaGlzIG1ldGhvZCBpcyB1c2VkIHRv
IHJldHJpZXZlIHRoZSBwb3NpdGlvbiBvZiB0aGUgcmlnaHQgYnJhY2tldC4KKwkgKiBAcmV0dXJu
IGludCB0aGUgZGltZW5zaW9uIGZvdW5kLCAtMSBpZiBub25lCisJICovCisJcHJvdGVjdGVkIGlu
dCByZXRyaWV2ZVJpZ2h0QnJhY2tldEVuZFBvc2l0aW9uKGludCBvZmZzZXQsIGludCBjb3VudCwg
Ym9vbGVhbiBpc0xlZnRSZWFkKSB0aHJvd3MgQ29yZUV4Y2VwdGlvbiB7CisJCVRva2VuU2Nhbm5l
ciBzY2FubmVyPSBnZXRTY2FubmVyKCk7CisJCWludCB0b2tlbjsKKwkJaW50IGJhbGFuY2U9IDA7
CisJCWlmIChpc0xlZnRSZWFkKSBiYWxhbmNlKys7CisJCXNjYW5uZXIuc2V0T2Zmc2V0KG9mZnNl
dCk7CisJCXdoaWxlICgodG9rZW49IHNjYW5uZXIucmVhZE5leHQodHJ1ZSkpICE9IFRlcm1pbmFs
VG9rZW5zLlRva2VuTmFtZUVPRikgeworCQkJc3dpdGNoKHRva2VuKSB7CisJCQkJY2FzZSBUZXJt
aW5hbFRva2Vucy5Ub2tlbk5hbWVMQlJBQ0tFVCA6CisJCQkJCWJhbGFuY2UrKzsKKwkJCQkJYnJl
YWs7CisJCQkJY2FzZSBUZXJtaW5hbFRva2Vucy5Ub2tlbk5hbWVSQlJBQ0tFVCA6CisJCQkJCWJh
bGFuY2UtLTsKKwkJCQkJaWYgKGJhbGFuY2UgPT0gMCkgeworCQkJCQkJaWYgKC0tY291bnQgPT0g
MCkgeworCQkJCQkJCXJldHVybiBzY2FubmVyLmdldEN1cnJlbnRFbmRPZmZzZXQoKTsKKwkJCQkJ
CX0KKwkJCQkJfQorCQkJCQlicmVhazsKKwkJCX0KKwkJfQorCQlyZXR1cm4gLTE7CisJfQorCiAJ
cHJpdmF0ZSBUeXBlIGdldEVsZW1lbnRUeXBlKEFycmF5VHlwZSBwYXJlbnQpIHsKIAkJVHlwZSB0
ID0gKFR5cGUpIGdldE9yaWdpbmFsVmFsdWUocGFyZW50LCBBcnJheVR5cGUuQ09NUE9ORU5UX1RZ
UEVfUFJPUEVSVFkpOwpkaWZmIC0tZ2l0IGEvb3JnLmVjbGlwc2UuamR0LmNvcmUvZG9tL29yZy9l
Y2xpcHNlL2pkdC9pbnRlcm5hbC9jb3JlL2RvbS9yZXdyaXRlL0FTVFJld3JpdGVGbGF0dGVuZXIu
amF2YSBiL29yZy5lY2xpcHNlLmpkdC5jb3JlL2RvbS9vcmcvZWNsaXBzZS9qZHQvaW50ZXJuYWwv
Y29yZS9kb20vcmV3cml0ZS9BU1RSZXdyaXRlRmxhdHRlbmVyLmphdmEKaW5kZXggOTBlYzlhZC4u
NTY0YTkzNiAxMDA2NDQKLS0tIGEvb3JnLmVjbGlwc2UuamR0LmNvcmUvZG9tL29yZy9lY2xpcHNl
L2pkdC9pbnRlcm5hbC9jb3JlL2RvbS9yZXdyaXRlL0FTVFJld3JpdGVGbGF0dGVuZXIuamF2YQor
KysgYi9vcmcuZWNsaXBzZS5qZHQuY29yZS9kb20vb3JnL2VjbGlwc2UvamR0L2ludGVybmFsL2Nv
cmUvZG9tL3Jld3JpdGUvQVNUUmV3cml0ZUZsYXR0ZW5lci5qYXZhCkBAIC0xOTQsNCArMTk0LDIy
IEBACiAJfQogCisJcHJpdmF0ZSB2b2lkIHZpc2l0QXJyYXlUeXBlV2l0aEV4cHJlc3Npb24oQXJy
YXlUeXBlIG5vZGUsIExpc3QgZGltZW5zaW9ucywgaW50IGRlcHRoKSB7CisJCWlmIChub2RlLmdl
dEFTVCgpLmFwaUxldmVsKCkgPj0gQVNULkpMUzgpIHsKKwkJCXZpc2l0TGlzdChub2RlLCBBcnJh
eVR5cGUuQU5OT1RBVElPTlNfUFJPUEVSVFksIFN0cmluZy52YWx1ZU9mKCcgJyksIFV0aWwuRU1Q
VFlfU1RSSU5HLCBTdHJpbmcudmFsdWVPZignICcpKTsKKwkJfQorCQlpZiAoZGVwdGggPCBkaW1l
bnNpb25zLnNpemUoKSkgeworCQkJdGhpcy5yZXN1bHQuYXBwZW5kKCdbJyk7CisJCQkoKEFTVE5v
ZGUpIGRpbWVuc2lvbnMuZ2V0KGRlcHRoKSkuYWNjZXB0KHRoaXMpOworCQkJdGhpcy5yZXN1bHQu
YXBwZW5kKCddJyk7CisJCX0gZWxzZSB7CisJCQl0aGlzLnJlc3VsdC5hcHBlbmQoIltdIik7IC8v
JE5PTi1OTFMtMSQKKwkJfQorCQlUeXBlIGNvbXBvbmVudFR5cGUgPSBub2RlLmdldENvbXBvbmVu
dFR5cGUoKTsKKwkJaWYgKGNvbXBvbmVudFR5cGUuaXNBcnJheVR5cGUoKSkgeworCQkJdmlzaXRB
cnJheVR5cGVXaXRoRXhwcmVzc2lvbigoQXJyYXlUeXBlKSBjb21wb25lbnRUeXBlLCBkaW1lbnNp
b25zLCAtLWRlcHRoKTsKKwkJfSBlbHNlIHsKKwkJCWNvbXBvbmVudFR5cGUuYWNjZXB0KHRoaXMp
OworCQl9CisJfQogCXByaXZhdGUgdm9pZCB2aXNpdEV4dHJhRGltZW5zaW9ucyhBU1ROb2RlIG5v
ZGUsIFNpbXBsZVByb3BlcnR5RGVzY3JpcHRvciBkaW1lbnNpb25zLCBDaGlsZExpc3RQcm9wZXJ0
eURlc2NyaXB0b3IgZGltZW5zaW9uc0luZm8pIHsKIAkJaWYgKG5vZGUuZ2V0QVNUKCkuYXBpTGV2
ZWwoKSA8IEFTVC5KTFM4KSB7CkBAIC0yNDAsMTkgKzI1OCw3IEBACiAJCQllbGVtZW50VHlwZSA9
IChUeXBlKSBnZXRDaGlsZE5vZGUoZWxlbWVudFR5cGUsIEFycmF5VHlwZS5DT01QT05FTlRfVFlQ
RV9QUk9QRVJUWSk7CiAJCX0KLQotCQllbGVtZW50VHlwZS5hY2NlcHQodGhpcyk7Ci0KIAkJTGlz
dCBsaXN0PSBnZXRDaGlsZExpc3Qobm9kZSwgQXJyYXlDcmVhdGlvbi5ESU1FTlNJT05TX1BST1BF
UlRZKTsKLQkJZm9yIChpbnQgaT0gMDsgaSA8IGxpc3Quc2l6ZSgpOyBpKyspIHsKLQkJCXRoaXMu
cmVzdWx0LmFwcGVuZCgnWycpOwotCQkJKChBU1ROb2RlKSBsaXN0LmdldChpKSkuYWNjZXB0KHRo
aXMpOwotCQkJdGhpcy5yZXN1bHQuYXBwZW5kKCddJyk7Ci0JCQlkaW1lbnNpb25zLS07Ci0JCX0K
KwkJdmlzaXRBcnJheVR5cGVXaXRoRXhwcmVzc2lvbihhcnJheVR5cGUsIGxpc3QsIC0tZGltZW5z
aW9ucyk7CiAKLQkJLy8gYWRkIGVtcHR5ICJbXSIgZm9yIGVhY2ggZXh0cmEgYXJyYXkgZGltZW5z
aW9uCi0JCWZvciAoaW50IGk9IDA7IGkgPCBkaW1lbnNpb25zOyBpKyspIHsKLQkJCXRoaXMucmVz
dWx0LmFwcGVuZCgiW10iKTsgLy8kTk9OLU5MUy0xJAotCQl9CiAJCUFTVE5vZGUgaW5pdGlhbGl6
ZXI9IGdldENoaWxkTm9kZShub2RlLCBBcnJheUNyZWF0aW9uLklOSVRJQUxJWkVSX1BST1BFUlRZ
KTsKIAkJaWYgKGluaXRpYWxpemVyICE9IG51bGwpIHs=
</data>

          </attachment>
      

    </bug>

</bugzilla>