<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>427677</bug_id>
          
          <creation_ts>2014-02-07 10:30:00 -0500</creation_ts>
          <short_desc>[1.8][search] NPE in MatchLocator.reportMatching with unresolved NameQualifiedType qualifier</short_desc>
          <delta_ts>2014-02-21 07:48:23 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>4.4</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows 7</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>BETA J8</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Markus Keller">markus_keller</reporter>
          <assigned_to name="Manoj Palat Away Until May 11 2015">manpalat</assigned_to>
          <cc>jarthana</cc>
    
    <cc>srikanth_sankaran</cc>
          
          <votes>0</votes>

      

      

      <flag name="review"
          id="61576"
          type_id="1"
          status="+"
          setter="srikanth_sankaran"
    />

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2360252</commentid>
    <comment_count>0</comment_count>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2014-02-07 10:30:48 -0500</bug_when>
    <thetext>Select &quot;TYPE_USE&quot; and search for references in Workspace =&gt; stops with NPE.

============================================================
package testing;
import java.lang.annotation.ElementType;
import java.lang.annotation.Target;

class Y0 implements unresolved. @Marker1 Collection&lt;Integer&gt; { }

@Target (ElementType.TYPE_USE)
@interface Marker1 {}
============================================================


!ENTRY org.eclipse.core.jobs 4 2 2014-02-07 16:21:02.575
!MESSAGE An internal error occurred during: &quot;Java Search&quot;.
!STACK 0
java.lang.NullPointerException
	at org.eclipse.jdt.internal.core.search.matching.MatchLocator.reportMatching(MatchLocator.java:2328)
	at org.eclipse.jdt.internal.core.search.matching.MatchLocator.reportMatching(MatchLocator.java:2733)
	at org.eclipse.jdt.internal.core.search.matching.MatchLocator.reportMatching(MatchLocator.java:2513)
	at org.eclipse.jdt.internal.core.search.matching.MatchLocator.process(MatchLocator.java:1746)
	at org.eclipse.jdt.internal.core.search.matching.MatchLocator.locateMatches(MatchLocator.java:1155)
	at org.eclipse.jdt.internal.core.search.matching.MatchLocator.locateMatches(MatchLocator.java:1196)
	at org.eclipse.jdt.internal.core.search.matching.MatchLocator.locateMatches(MatchLocator.java:1328)
	at org.eclipse.jdt.internal.core.search.JavaSearchParticipant.locateMatches(JavaSearchParticipant.java:96)
	at org.eclipse.jdt.internal.core.search.BasicSearchEngine.findMatches(BasicSearchEngine.java:232)
	at org.eclipse.jdt.internal.core.search.BasicSearchEngine.search(BasicSearchEngine.java:516)
	at org.eclipse.jdt.core.search.SearchEngine.search(SearchEngine.java:584)
	at org.eclipse.jdt.internal.ui.search.JavaSearchQuery.run(JavaSearchQuery.java:144)
	at org.eclipse.search2.internal.ui.InternalSearchUI$InternalSearchJob.run(InternalSearchUI.java:91)
	at org.eclipse.core.internal.jobs.Worker.run(Worker.java:53)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2360761</commentid>
    <comment_count>1</comment_count>
      <attachid>239773</attachid>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2014-02-10 00:50:17 -0500</bug_when>
    <thetext>Created attachment 239773
Proposed Patch</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2360772</commentid>
    <comment_count>2</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2014-02-10 02:16:18 -0500</bug_when>
    <thetext>Thanks Manoj, patch looks good. For good measure, I added an NPE guard
in org.eclipse.jdt.internal.core.search.matching.MatchLocator.reportMatching(Annotation[], IJavaElement, IJavaElement[], Binding, MatchingNodeSet, boolean, boolean)

and released here: 

http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?h=BETA_JAVA8&amp;id=5981e91cc71ba86df42ff9d60654ccdd89adffe1</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2366738</commentid>
    <comment_count>3</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2014-02-21 07:48:23 -0500</bug_when>
    <thetext>Verified for Java 8 RC1 using Kepler SR2 +  
Eclipse Java Development Tools Patch for Java 8 Support (BETA)   
1.0.0.v20140220-2054</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>239773</attachid>
            <date>2014-02-10 00:50:00 -0500</date>
            <delta_ts>2014-02-10 00:50:17 -0500</delta_ts>
            <desc>Proposed Patch</desc>
            <filename>Fix-for-Bug-427677-18search-NPE-in-MatchLocatorrepor.patch</filename>
            <type>text/plain</type>
            <size>3995</size>
            <attacher name="Manoj Palat Away Until May 11 2015">manpalat</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3NyYy9vcmcvZWNs
aXBzZS9qZHQvY29yZS90ZXN0cy9tb2RlbC9KYXZhU2VhcmNoQnVnczhUZXN0cy5qYXZhIGIvb3Jn
LmVjbGlwc2UuamR0LmNvcmUudGVzdHMubW9kZWwvc3JjL29yZy9lY2xpcHNlL2pkdC9jb3JlL3Rl
c3RzL21vZGVsL0phdmFTZWFyY2hCdWdzOFRlc3RzLmphdmEKaW5kZXggMWIwMWE1Zi4uMzQ3ODZl
MyAxMDA2NDQKLS0tIGEvb3JnLmVjbGlwc2UuamR0LmNvcmUudGVzdHMubW9kZWwvc3JjL29yZy9l
Y2xpcHNlL2pkdC9jb3JlL3Rlc3RzL21vZGVsL0phdmFTZWFyY2hCdWdzOFRlc3RzLmphdmEKKysr
IGIvb3JnLmVjbGlwc2UuamR0LmNvcmUudGVzdHMubW9kZWwvc3JjL29yZy9lY2xpcHNlL2pkdC9j
b3JlL3Rlc3RzL21vZGVsL0phdmFTZWFyY2hCdWdzOFRlc3RzLmphdmEKQEAgLTk4LDYgKzk4LDcg
QEAKIAlzdWl0ZS5hZGRUZXN0KG5ldyBKYXZhU2VhcmNoQnVnczhUZXN0cygidGVzdEJ1ZzQyNDEx
OV8wMDIiKSk7CiAJc3VpdGUuYWRkVGVzdChuZXcgSmF2YVNlYXJjaEJ1Z3M4VGVzdHMoInRlc3RC
dWc0MjQxMTlfMDAzIikpOwogCXN1aXRlLmFkZFRlc3QobmV3IEphdmFTZWFyY2hCdWdzOFRlc3Rz
KCJ0ZXN0QnVnNDI3NTM3YSIpKTsKKwlzdWl0ZS5hZGRUZXN0KG5ldyBKYXZhU2VhcmNoQnVnczhU
ZXN0cygidGVzdEJ1ZzQyNzY3NyIpKTsKIAlyZXR1cm4gc3VpdGU7CiB9CiBjbGFzcyBUZXN0Q29s
bGVjdG9yIGV4dGVuZHMgSmF2YVNlYXJjaFJlc3VsdENvbGxlY3RvciB7CkBAIC0xNzUyLDUgKzE3
NTMsMzAgQEAKIAkJInNyYy9iNDI3NTM3L1guamF2YSB2b2lkIGI0Mjc1MzcuWC5tYWluKFN0cmlu
Z1tdKSBbSV0gRVhBQ1RfTUFUQ0giCiAJKTsKIH0KKy8qKgorICogQGJ1ZyA0Mjc2Nzc6IFsxLjhd
W3NlYXJjaF0gTlBFIGluIE1hdGNoTG9jYXRvci5yZXBvcnRNYXRjaGluZyB3aXRoIHVucmVzb2x2
ZWQgTmFtZVF1YWxpZmllZFR5cGUgcXVhbGlmaWVyCisgKiBAdGVzdCB0ZXN0CisgKiBAc2VlICJo
dHRwczovL2J1Z3MuZWNsaXBzZS5vcmcvYnVncy9zaG93X2J1Zy5jZ2k/aWQ9NDI3Njc3IgorICov
CitwdWJsaWMgdm9pZCB0ZXN0QnVnNDI3Njc3KCkgdGhyb3dzIENvcmVFeGNlcHRpb24geworCXRo
aXMud29ya2luZ0NvcGllcyA9IG5ldyBJQ29tcGlsYXRpb25Vbml0WzFdOworCXRoaXMud29ya2lu
Z0NvcGllc1swXSA9IGdldFdvcmtpbmdDb3B5KCIvSmF2YVNlYXJjaEJ1Z3Mvc3JjL2I0Mjc2Nzcv
WC5qYXZhIiwKKwkJCSJpbXBvcnQgamF2YS5sYW5nLmFubm90YXRpb24uKjsgXG4iICsKKwkJCSJj
bGFzcyBYIGltcGxlbWVudHMgdW5yZXNvbHZlZC4gQE1hcmtlcjEgQ29sbGVjdGlvbjxJbnRlZ2Vy
PiB7IH0gXG4iICsKKwkJCSJAVGFyZ2V0IChFbGVtZW50VHlwZS5UWVBFX1VTRSkgXG4iICsKKwkJ
CSJAaW50ZXJmYWNlIE1hcmtlcjEge30iCisJKTsKKwlTZWFyY2hQYXR0ZXJuIHBhdHRlcm4gPSBT
ZWFyY2hQYXR0ZXJuLmNyZWF0ZVBhdHRlcm4oCisJCSJNYXJrZXIxIiwKKwkJQU5OT1RBVElPTl9U
WVBFLAorCQlSRUZFUkVOQ0VTLAorCQlFWEFDVF9SVUxFKTsKKwluZXcgU2VhcmNoRW5naW5lKHRo
aXMud29ya2luZ0NvcGllcykuc2VhcmNoKHBhdHRlcm4sCisJCQluZXcgU2VhcmNoUGFydGljaXBh
bnRbXSB7U2VhcmNoRW5naW5lLmdldERlZmF1bHRTZWFyY2hQYXJ0aWNpcGFudCgpfSwKKwkJCWdl
dEphdmFTZWFyY2hXb3JraW5nQ29waWVzU2NvcGUoKSwKKwkJCXRoaXMucmVzdWx0Q29sbGVjdG9y
LAorCQkJbnVsbCk7CisJYXNzZXJ0U2VhcmNoUmVzdWx0cygic3JjL2I0Mjc2NzcvWC5qYXZhIGI0
Mjc2NzcuWCBbTWFya2VyMV0gRVhBQ1RfTUFUQ0giKTsKK30KIC8vIEFkZCBuZXcgdGVzdHMgaW4g
SmF2YVNlYXJjaEJ1Z3M4VGVzdHMKIH0KXCBObyBuZXdsaW5lIGF0IGVuZCBvZiBmaWxlCmRpZmYg
LS1naXQgYS9vcmcuZWNsaXBzZS5qZHQuY29yZS9zZWFyY2gvb3JnL2VjbGlwc2UvamR0L2ludGVy
bmFsL2NvcmUvc2VhcmNoL21hdGNoaW5nL01hdGNoTG9jYXRvci5qYXZhIGIvb3JnLmVjbGlwc2Uu
amR0LmNvcmUvc2VhcmNoL29yZy9lY2xpcHNlL2pkdC9pbnRlcm5hbC9jb3JlL3NlYXJjaC9tYXRj
aGluZy9NYXRjaExvY2F0b3IuamF2YQppbmRleCAyYTJjNDk0Li44MDg0OTkwIDEwMDY0NAotLS0g
YS9vcmcuZWNsaXBzZS5qZHQuY29yZS9zZWFyY2gvb3JnL2VjbGlwc2UvamR0L2ludGVybmFsL2Nv
cmUvc2VhcmNoL21hdGNoaW5nL01hdGNoTG9jYXRvci5qYXZhCisrKyBiL29yZy5lY2xpcHNlLmpk
dC5jb3JlL3NlYXJjaC9vcmcvZWNsaXBzZS9qZHQvaW50ZXJuYWwvY29yZS9zZWFyY2gvbWF0Y2hp
bmcvTWF0Y2hMb2NhdG9yLmphdmEKQEAgLTI3MjAsNyArMjcyMCw5IEBACiAJCWlmIChzdXBlckNs
YXNzICE9IG51bGwpIHsKIAkJCXJlcG9ydE1hdGNoaW5nU3VwZXIoc3VwZXJDbGFzcywgZW5jbG9z
aW5nRWxlbWVudCwgdHlwZS5iaW5kaW5nLCBub2RlU2V0LCBtYXRjaGVkQ2xhc3NDb250YWluZXIp
OwogCQkJZm9yIChpbnQgaSA9IDAsIGxlbmd0aCA9IHN1cGVyQ2xhc3MuYW5ub3RhdGlvbnMgPT0g
bnVsbCA/IDAgOiBzdXBlckNsYXNzLmFubm90YXRpb25zLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsr
KSB7Ci0JCQkJcmVwb3J0TWF0Y2hpbmcoc3VwZXJDbGFzcy5hbm5vdGF0aW9uc1tpXSwgZW5jbG9z
aW5nRWxlbWVudCwgbnVsbCwgdHlwZS5iaW5kaW5nLCBub2RlU2V0LCBtYXRjaGVkQ2xhc3NDb250
YWluZXIsIGVuY2xvc2VzRWxlbWVudCk7CQorCQkJCUFubm90YXRpb25bXSBhbm5vdGF0aW9ucyA9
IHN1cGVyQ2xhc3MuYW5ub3RhdGlvbnNbaV07CisJCQkJaWYgKGFubm90YXRpb25zID09IG51bGwp
IGNvbnRpbnVlOworCQkJCXJlcG9ydE1hdGNoaW5nKGFubm90YXRpb25zLCBlbmNsb3NpbmdFbGVt
ZW50LCBudWxsLCB0eXBlLmJpbmRpbmcsIG5vZGVTZXQsIG1hdGNoZWRDbGFzc0NvbnRhaW5lciwg
ZW5jbG9zZXNFbGVtZW50KTsJCiAJCQl9CiAJCX0KIAkJVHlwZVJlZmVyZW5jZVtdIHN1cGVySW50
ZXJmYWNlcyA9IHR5cGUuc3VwZXJJbnRlcmZhY2VzOwpAQCAtMjcyOCw5ICsyNzMwLDExIEBACiAJ
CQlmb3IgKGludCBpID0gMCwgbCA9IHN1cGVySW50ZXJmYWNlcy5sZW5ndGg7IGkgPCBsOyBpKysp
IHsKIAkJCQlyZXBvcnRNYXRjaGluZ1N1cGVyKHN1cGVySW50ZXJmYWNlc1tpXSwgZW5jbG9zaW5n
RWxlbWVudCwgdHlwZS5iaW5kaW5nLCBub2RlU2V0LCBtYXRjaGVkQ2xhc3NDb250YWluZXIpOwog
CQkJCVR5cGVSZWZlcmVuY2UgdHlwZVJlZmVyZW5jZSAgPSB0eXBlLnN1cGVySW50ZXJmYWNlc1tp
XTsKLQkJCQlpZiAodHlwZVJlZmVyZW5jZSAhPSBudWxsICYmICB0eXBlUmVmZXJlbmNlLmFubm90
YXRpb25zICE9IG51bGwpIHsKLQkJCQkJZm9yIChpbnQgaiA9IDAsIGxlbmd0aCA9IHR5cGVSZWZl
cmVuY2UuYW5ub3RhdGlvbnMubGVuZ3RoOyBqIDwgbGVuZ3RoOyBqKyspIHsKLQkJCQkJCXJlcG9y
dE1hdGNoaW5nKHR5cGVSZWZlcmVuY2UuYW5ub3RhdGlvbnNbal0sIGVuY2xvc2luZ0VsZW1lbnQs
IG51bGwsIHR5cGUuYmluZGluZywgbm9kZVNldCwgbWF0Y2hlZENsYXNzQ29udGFpbmVyLCBlbmNs
b3Nlc0VsZW1lbnQpOwkKKwkJCQlBbm5vdGF0aW9uW11bXSBhbm5vdGF0aW9ucyA9IHR5cGVSZWZl
cmVuY2UgIT0gbnVsbCA/IHR5cGVSZWZlcmVuY2UuYW5ub3RhdGlvbnMgOiBudWxsOworCQkJCWlm
IChhbm5vdGF0aW9ucyAhPSBudWxsKSB7CisJCQkJCWZvciAoaW50IGogPSAwLCBsZW5ndGggPSBh
bm5vdGF0aW9ucy5sZW5ndGg7IGogPCBsZW5ndGg7IGorKykgeworCQkJCQkJaWYgKGFubm90YXRp
b25zW2pdID09IG51bGwpIGNvbnRpbnVlOworCQkJCQkJcmVwb3J0TWF0Y2hpbmcoYW5ub3RhdGlv
bnNbal0sIGVuY2xvc2luZ0VsZW1lbnQsIG51bGwsIHR5cGUuYmluZGluZywgbm9kZVNldCwgbWF0
Y2hlZENsYXNzQ29udGFpbmVyLCBlbmNsb3Nlc0VsZW1lbnQpOwkKIAkJCQkJfQogCQkJCX0JCQkK
IAkJCX0=
</data>

          </attachment>
      

    </bug>

</bugzilla>