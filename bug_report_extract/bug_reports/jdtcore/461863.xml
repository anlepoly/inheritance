<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>461863</bug_id>
          
          <creation_ts>2015-03-10 13:39:00 -0400</creation_ts>
          <short_desc>[import rewrite] addImport creates .ypename for unqualified type from default package</short_desc>
          <delta_ts>2015-03-18 00:55:38 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>4.5</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows 7</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          <see_also>https://git.eclipse.org/r/43619</see_also>
    
    <see_also>https://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=d5ff27f4ac6567ec3845ab2a4c87d426d2f2009e</see_also>
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>4.5 M6</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Markus Keller">markus_keller</reporter>
          <assigned_to name="John Glassmyer">jogl</assigned_to>
          <cc>jogl</cc>
    
    <cc>Olivier_Thomann</cc>
    
    <cc>shankhba</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2529563</commentid>
    <comment_count>0</comment_count>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2015-03-10 13:39:50 -0400</bug_when>
    <thetext>master

- copy the following to the clipboard:
------------------------------
public class Default {
	Default d;
}
package p;
public class C {
	C c;
	
}
------------------------------

- open the Package Explorer, clear the selection, paste
- go to Default.java
- select line &quot;Default d;&quot;
- copy
- go to C.java
- set caret to the empty line
- paste

=&gt; expected: as in 4.4, you should get an &quot;import Default;&quot;
=&gt; was: you get an &quot;import .efault;&quot;

If you copied multiple type references from the default package, and the preferences are set to create star-imports, then you can produce &quot;import .*;&quot;.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2529595</commentid>
    <comment_count>1</comment_count>
    <who name="John Glassmyer">jogl</who>
    <bug_when>2015-03-10 14:35:23 -0400</bug_when>
    <thetext>Java Language Specification requires that an import declaration be qualified:

&quot;The name must be qualified (6.5.5.2), or a compile-time error occurs.&quot;
http://docs.oracle.com/javase/specs/jls/se8/html/jls-7.html#jls-7.5.1

If you type &quot;import Default;&quot; in C.java, Eclipse will mark the import with a &quot;cannot be resolved&quot; error. If you try to compile it with javac, javac will report &quot;error: &apos;.&apos; expected&quot;.

The reported expectation (you should get an &quot;import Default;&quot;) is wrong, as that would be an illegal, uncompilable result.

I would expect the paste operation in this case either
a) to prevent the paste from proceeding, as there is no way to refer to the type &quot;Default&quot; in compilation units outside the default package, or
b) to allow the paste to proceed, but not to attempt to create an illegal import declaration

The only deficiency in ImportRewrite&apos;s behavior here is that it does not throw IllegalArgumentException when the caller attempts to import an unqualified name.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2529609</commentid>
    <comment_count>2</comment_count>
    <who name="Olivier Thomann">Olivier_Thomann</who>
    <bug_when>2015-03-10 14:58:39 -0400</bug_when>
    <thetext>Importing from the default package was permitted in 1.3 compliance.
In this specific case, I would expect the types in the default package to simply be ignored. I don&apos;t expect a failure from the ImportRewrite.
Copying Default d; into the type C should just report a compile error. Nothing should be done to try to import the missing type.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2529630</commentid>
    <comment_count>3</comment_count>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2015-03-10 15:43:28 -0400</bug_when>
    <thetext>(In reply to Olivier Thomann from comment #2)
&gt; Importing from the default package was permitted in 1.3 compliance.

Thanks, I already forgot that. So the ImportRewrite should just treat the default package as a legal package and let clients make sure they know what they&apos;re doing.

For the Paste action, the 4.4 behavior gave the user a useful compile error (&quot;The import Default cannot be resolved&quot;). In master, you get a syntax error that has nothing to do with the problem.

Fixed the Paste action to stop adding these imports for compliance &gt; 1.3: http://git.eclipse.org/c/jdt/eclipse.jdt.ui.git/commit/?id=39e0ead8242e9eb1099154b0bb2a01053a4fc6c0</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2529634</commentid>
    <comment_count>4</comment_count>
    <who name="John Glassmyer">jogl</who>
    <bug_when>2015-03-10 15:49:50 -0400</bug_when>
    <thetext>(In reply to Markus Keller from comment #3)
&gt; (In reply to Olivier Thomann from comment #2)
&gt; &gt; Importing from the default package was permitted in 1.3 compliance.
&gt; 
&gt; Thanks, I already forgot that. So the ImportRewrite should just treat the
&gt; default package as a legal package and let clients make sure they know what
&gt; they&apos;re doing.

That makes sense. I&apos;ll change ImportRewrite to support this again.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2529697</commentid>
    <comment_count>5</comment_count>
    <who name="Eclipse Genie">genie</who>
    <bug_when>2015-03-10 18:33:59 -0400</bug_when>
    <thetext>New Gerrit change created: https://git.eclipse.org/r/43619</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2529699</commentid>
    <comment_count>6</comment_count>
    <who name="John Glassmyer">jogl</who>
    <bug_when>2015-03-10 18:37:30 -0400</bug_when>
    <thetext>In the patch, I have changed Import Rewrite to support adding unqualified imports and to not attempt to reduce them into on-demand (.*) imports, and I&apos;ve added a test for this in ImportRewriteTest.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2530257</commentid>
    <comment_count>7</comment_count>
    <who name="Eclipse Genie">genie</who>
    <bug_when>2015-03-11 16:08:06 -0400</bug_when>
    <thetext>Gerrit change https://git.eclipse.org/r/43619 was merged to [master].
Commit: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=d5ff27f4ac6567ec3845ab2a4c87d426d2f2009e</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2530261</commentid>
    <comment_count>8</comment_count>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2015-03-11 16:12:03 -0400</bug_when>
    <thetext>Thanks. I made the code a bit easier to read by using Signature.getSimpleName(..).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2533314</commentid>
    <comment_count>9</comment_count>
    <who name="shankha banerjee">shankhba</who>
    <bug_when>2015-03-18 00:55:38 -0400</bug_when>
    <thetext>Verified for 4.5 M6 with build I20150316-2000.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>