<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>331138</bug_id>
          
          <creation_ts>2010-11-25 11:30:00 -0500</creation_ts>
          <short_desc>ASTRewrite#replace(..) does not consider the TargetSourceRangeComputer</short_desc>
          <delta_ts>2011-03-07 11:37:21 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>3.7</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows 7</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>3.7 M6</target_milestone>
          
          <blocked>331116</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Markus Keller">markus_keller</reporter>
          <assigned_to name="Ayushman Jain">amj87.iitr</assigned_to>
          <cc>deepakazad</cc>
    
    <cc>Olivier_Thomann</cc>
          
          <votes>0</votes>

      

      

      <flag name="review"
          id="39019"
          type_id="1"
          status="+"
          setter="Olivier_Thomann"
    />

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>1848261</commentid>
    <comment_count>0</comment_count>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2010-11-25 11:30:13 -0500</bug_when>
    <thetext>HEAD

ASTRewrite#replace(..) does not consider the TargetSourceRangeComputer. My fix for bug 331116 only resolved that bug partially because of this core bug.

Steps (with QuickAssistProcessor from HEAD):

- have:
    void foo() {
        String message;

        // this comment gets removed

        message = &quot;&quot;;        
    }

- set caret into second &quot;message&quot;
- apply the &quot;Join variable declaration&quot; quick assist
=&gt; comment wrongly gets removed

At the end of QuickAssistProcessor#getJoinVariableProposals(..), we have the line:

    rewrite.replace(assignParent, rewrite.createMoveTarget(statement), null);

When I replace that line with the following, (using #remove() instead of #replace()), then it works as expected:

    ListRewrite listRewrite= rewrite.getListRewrite(assignParent.getParent(),
	(ChildListPropertyDescriptor)assignParent.getLocationInParent());
    listRewrite.insertAfter(rewrite.createMoveTarget(statement), assignParent,
	null);
    rewrite.remove(assignParent, null);</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1848721</commentid>
    <comment_count>1</comment_count>
    <who name="Olivier Thomann">Olivier_Thomann</who>
    <bug_when>2010-11-26 10:55:01 -0500</bug_when>
    <thetext>Ayushman, if you get some time, please take a look.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1877025</commentid>
    <comment_count>2</comment_count>
      <attachid>188141</attachid>
    <who name="Ayushman Jain">amj87.iitr</who>
    <bug_when>2011-02-02 09:15:28 -0500</bug_when>
    <thetext>Created attachment 188141
proposed fix v1.0 + regression tests

This patch makes sure that whenever a replace operation takes place in the ASTRewriteAnalyzer, we check for comments, and place the starting point beyond the end of comments so that they dont get removed.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1877558</commentid>
    <comment_count>3</comment_count>
      <attachid>188210</attachid>
    <who name="Ayushman Jain">amj87.iitr</who>
    <bug_when>2011-02-03 01:11:28 -0500</bug_when>
    <thetext>Created attachment 188210
proposed fix v1.1 + regression tests

Modified the fix a bit to handle multiple comments and to make sure the comments in the extended source range of a node are also replaced with the node.

Unfortunately, since the extended source range is defined to include comments and whitespaces just preceeding or trailing a node, they will get deleted if the node is replaced by another node. ASTRewritingModifyingReplaceTest.test0014b() shows such a case. 

Anyway, the fix takes care of preserving all other comments and will fix several UI bugs where comments are deleted upon refactoring, etc.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1877559</commentid>
    <comment_count>4</comment_count>
    <who name="Ayushman Jain">amj87.iitr</who>
    <bug_when>2011-02-03 01:12:21 -0500</bug_when>
    <thetext>Olivier, can you please review? Thanks.

I&apos;ll also get the JDT/UI tests run with the patch.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1877648</commentid>
    <comment_count>5</comment_count>
    <who name="Ayushman Jain">amj87.iitr</who>
    <bug_when>2011-02-03 05:33:57 -0500</bug_when>
    <thetext>&gt; I&apos;ll also get the JDT/UI tests run with the patch.

All UI tests pass.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1879356</commentid>
    <comment_count>6</comment_count>
    <who name="Olivier Thomann">Olivier_Thomann</who>
    <bug_when>2011-02-07 12:36:54 -0500</bug_when>
    <thetext>Looks good to me.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1880445</commentid>
    <comment_count>7</comment_count>
    <who name="Ayushman Jain">amj87.iitr</who>
    <bug_when>2011-02-09 08:40:04 -0500</bug_when>
    <thetext>Released in HEAD for 3.7M6</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1894334</commentid>
    <comment_count>8</comment_count>
    <who name="Olivier Thomann">Olivier_Thomann</who>
    <bug_when>2011-03-07 11:37:21 -0500</bug_when>
    <thetext>Verified for 3.7M6.</thetext>
  </long_desc>
      
          <attachment
              isobsolete="1"
              ispatch="1"
              isprivate="0"
          >
            <attachid>188141</attachid>
            <date>2011-02-02 09:15:00 -0500</date>
            <delta_ts>2011-02-03 01:11:28 -0500</delta_ts>
            <desc>proposed fix v1.0 + regression tests</desc>
            <filename>patch331138.txt</filename>
            <type>text/plain</type>
            <size>4663</size>
            <attacher name="Ayushman Jain">amj87.iitr</attacher>
            
              <data encoding="base64">IyMjIEVjbGlwc2UgV29ya3NwYWNlIFBhdGNoIDEuMA0KI1Agb3JnLmVjbGlwc2UuamR0LmNvcmUN
CkluZGV4OiBkb20vb3JnL2VjbGlwc2UvamR0L2ludGVybmFsL2NvcmUvZG9tL3Jld3JpdGUvQVNU
UmV3cml0ZUFuYWx5emVyLmphdmENCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NClJDUyBmaWxlOiAvY3Zzcm9vdC9lY2xp
cHNlL29yZy5lY2xpcHNlLmpkdC5jb3JlL2RvbS9vcmcvZWNsaXBzZS9qZHQvaW50ZXJuYWwvY29y
ZS9kb20vcmV3cml0ZS9BU1RSZXdyaXRlQW5hbHl6ZXIuamF2YSx2DQpyZXRyaWV2aW5nIHJldmlz
aW9uIDEuNzgNCmRpZmYgLXUgLXIxLjc4IEFTVFJld3JpdGVBbmFseXplci5qYXZhDQotLS0gZG9t
L29yZy9lY2xpcHNlL2pkdC9pbnRlcm5hbC9jb3JlL2RvbS9yZXdyaXRlL0FTVFJld3JpdGVBbmFs
eXplci5qYXZhCTIyIE9jdCAyMDEwIDIwOjEwOjM3IC0wMDAwCTEuNzgNCisrKyBkb20vb3JnL2Vj
bGlwc2UvamR0L2ludGVybmFsL2NvcmUvZG9tL3Jld3JpdGUvQVNUUmV3cml0ZUFuYWx5emVyLmph
dmEJMiBGZWIgMjAxMSAxMzo1NzowNiAtMDAwMA0KQEAgLTEsNSArMSw1IEBADQogLyoqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioNCi0gKiBDb3B5cmlnaHQgKGMpIDIwMDAsIDIwMTAgSUJNIENvcnBvcmF0
aW9uIGFuZCBvdGhlcnMuDQorICogQ29weXJpZ2h0IChjKSAyMDAwLCAyMDExIElCTSBDb3Jwb3Jh
dGlvbiBhbmQgb3RoZXJzLg0KICAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuIFRoaXMgcHJvZ3JhbSBh
bmQgdGhlIGFjY29tcGFueWluZyBtYXRlcmlhbHMNCiAgKiBhcmUgbWFkZSBhdmFpbGFibGUgdW5k
ZXIgdGhlIHRlcm1zIG9mIHRoZSBFY2xpcHNlIFB1YmxpYyBMaWNlbnNlIHYxLjANCiAgKiB3aGlj
aCBhY2NvbXBhbmllcyB0aGlzIGRpc3RyaWJ1dGlvbiwgYW5kIGlzIGF2YWlsYWJsZSBhdA0KQEAg
LTY2MCw3ICs2NjAsMTcgQEANCiAJCQkJCQlBU1ROb2RlIGNoYW5nZWQ9IChBU1ROb2RlKSBjdXJy
RXZlbnQuZ2V0TmV3VmFsdWUoKTsNCiAJCQkJCQkNCiAJCQkJCQl1cGRhdGVJbmRlbnQocHJldk1h
cmssIGN1cnJQb3MsIGksIGVkaXRHcm91cCk7DQotCQkJCQkJDQorCQkJCQkJVG9rZW5TY2FubmVy
IHNjYW5uZXIgPSBnZXRTY2FubmVyKCk7DQorCQkJCQkJdHJ5IHsNCisJCQkJCQkJLy8gbWFrZSBz
dXJlIHRoYXQgY29tbWVudHMgYmV0d2VlbiBsYXN0IG1vZGlmaWVkIHNvdXJjZSBwb3NpdGlvbiBh
bmQgc3RhcnRpbmcgcG9zaXRpb24gb2YNCisJCQkJCQkJLy8gbm9kZSB0byBiZSByZXBsYWNlZCBh
cmUgbm90IHRvdWNoZWQNCisJCQkJCQkJaW50IG5leHRUb2tlbj0gc2Nhbm5lci5yZWFkTmV4dChj
dXJyUG9zLCBmYWxzZSk7DQorCQkJCQkJCWlmIChUb2tlblNjYW5uZXIuaXNDb21tZW50KG5leHRU
b2tlbikpIHsNCisJCQkJCQkJCWN1cnJQb3MgPSBzY2FubmVyLmdldE5leHRTdGFydE9mZnNldChj
dXJyUG9zLCB0cnVlKTsNCisJCQkJCQkJfQ0KKwkJCQkJCX0gY2F0Y2ggKENvcmVFeGNlcHRpb24g
ZSkgew0KKwkJCQkJCQkvLyBpZ25vcmUNCisJCQkJCQl9DQogCQkJCQkJZG9UZXh0UmVtb3ZlQW5k
VmlzaXQoY3VyclBvcywgY3VyckVuZCAtIGN1cnJQb3MsIG5vZGUsIGVkaXRHcm91cCk7DQogCQkJ
CQkJZG9UZXh0SW5zZXJ0KGN1cnJQb3MsIGNoYW5nZWQsIGdldE5vZGVJbmRlbnQoaSksIHRydWUs
IGVkaXRHcm91cCk7DQogDQojUCBvcmcuZWNsaXBzZS5qZHQuY29yZS50ZXN0cy5tb2RlbA0KSW5k
ZXg6IHNyYy9vcmcvZWNsaXBzZS9qZHQvY29yZS90ZXN0cy9yZXdyaXRlL21vZGlmeWluZy9BU1RS
ZXdyaXRpbmdNb2RpZnlpbmdSZXBsYWNlVGVzdC5qYXZhDQo9PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQpSQ1MgZmlsZTog
L2N2c3Jvb3QvZWNsaXBzZS9vcmcuZWNsaXBzZS5qZHQuY29yZS50ZXN0cy5tb2RlbC9zcmMvb3Jn
L2VjbGlwc2UvamR0L2NvcmUvdGVzdHMvcmV3cml0ZS9tb2RpZnlpbmcvQVNUUmV3cml0aW5nTW9k
aWZ5aW5nUmVwbGFjZVRlc3QuamF2YSx2DQpyZXRyaWV2aW5nIHJldmlzaW9uIDEuMTENCmRpZmYg
LXUgLXIxLjExIEFTVFJld3JpdGluZ01vZGlmeWluZ1JlcGxhY2VUZXN0LmphdmENCi0tLSBzcmMv
b3JnL2VjbGlwc2UvamR0L2NvcmUvdGVzdHMvcmV3cml0ZS9tb2RpZnlpbmcvQVNUUmV3cml0aW5n
TW9kaWZ5aW5nUmVwbGFjZVRlc3QuamF2YQkxNyBNYXIgMjAxMCAxNjowOToxNiAtMDAwMAkxLjEx
DQorKysgc3JjL29yZy9lY2xpcHNlL2pkdC9jb3JlL3Rlc3RzL3Jld3JpdGUvbW9kaWZ5aW5nL0FT
VFJld3JpdGluZ01vZGlmeWluZ1JlcGxhY2VUZXN0LmphdmEJMiBGZWIgMjAxMSAxMzo1NzowNyAt
MDAwMA0KQEAgLTEsNSArMSw1IEBADQogLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCi0gKiBDb3B5
cmlnaHQgKGMpIDIwMDAsIDIwMTAgSUJNIENvcnBvcmF0aW9uIGFuZCBvdGhlcnMuDQorICogQ29w
eXJpZ2h0IChjKSAyMDAwLCAyMDExIElCTSBDb3Jwb3JhdGlvbiBhbmQgb3RoZXJzLg0KICAqIEFs
bCByaWdodHMgcmVzZXJ2ZWQuIFRoaXMgcHJvZ3JhbSBhbmQgdGhlIGFjY29tcGFueWluZyBtYXRl
cmlhbHMNCiAgKiBhcmUgbWFkZSBhdmFpbGFibGUgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBFY2xp
cHNlIFB1YmxpYyBMaWNlbnNlIHYxLjANCiAgKiB3aGljaCBhY2NvbXBhbmllcyB0aGlzIGRpc3Ry
aWJ1dGlvbiwgYW5kIGlzIGF2YWlsYWJsZSBhdA0KQEAgLTQ2Miw0ICs0NjIsNDggQEANCiAJCWJ1
Zi5hcHBlbmQoIn1cbiIpOw0KIAkJYXNzZXJ0RXF1YWxTdHJpbmcocHJldmlldywgYnVmLnRvU3Ry
aW5nKCkpOw0KIAl9DQorCQ0KKwkvLyBodHRwczovL2J1Z3MuZWNsaXBzZS5vcmcvYnVncy9zaG93
X2J1Zy5jZ2k/aWQ9MzMxMTM4DQorCS8vIE1ha2Ugc3VyZSBjb21tZW50cyBiZXR3ZWVuIHJlbW92
ZWQgYW5kIHJlcGxhY2VkIG5vZGUgYXJlIG5vdCByZW1vdmVkLg0KKwlwdWJsaWMgdm9pZCB0ZXN0
MDAxNCgpIHRocm93cyBFeGNlcHRpb24gew0KKwkJSVBhY2thZ2VGcmFnbWVudCBwYWNrMT0gdGhp
cy5zb3VyY2VGb2xkZXIuY3JlYXRlUGFja2FnZUZyYWdtZW50KCJ0ZXN0MDAxNCIsIGZhbHNlLCBu
dWxsKTsNCisJCVN0cmluZ0J1ZmZlciBidWY9IG5ldyBTdHJpbmdCdWZmZXIoKTsNCisJCWJ1Zi5h
cHBlbmQoInBhY2thZ2UgdGVzdDAwMTQ7XG4iKTsNCisJCWJ1Zi5hcHBlbmQoInB1YmxpYyBjbGFz
cyBYIHtcbiIpOw0KKwkJYnVmLmFwcGVuZCgiCXB1YmxpYyB2b2lkIG0oKSB7XG4iKTsNCisJCWJ1
Zi5hcHBlbmQoIiAgICAJU3RyaW5nIGFiYztcbiIpOw0KKwkJYnVmLmFwcGVuZCgiXG4iKTsNCisJ
CWJ1Zi5hcHBlbmQoIgkJLy8gZG8gbm90IGRlbGV0ZSB0aGlzXG4iKTsNCisJCWJ1Zi5hcHBlbmQo
IlxuIik7DQorCQlidWYuYXBwZW5kKCIgICAgIAlhYmMgPSBcIlwiO1xuIik7DQorCQlidWYuYXBw
ZW5kKCJ9XG4iKTsNCisJCUlDb21waWxhdGlvblVuaXQgY3U9IHBhY2sxLmNyZWF0ZUNvbXBpbGF0
aW9uVW5pdCgiWC5qYXZhIiwgYnVmLnRvU3RyaW5nKCksIGZhbHNlLCBudWxsKTsNCisNCisJCUNv
bXBpbGF0aW9uVW5pdCBhc3RSb290PSBjcmVhdGVDVShjdSwgZmFsc2UpOw0KKw0KKwkJYXN0Um9v
dC5yZWNvcmRNb2RpZmljYXRpb25zKCk7DQorDQorCQlMaXN0IHR5cGVzID0gYXN0Um9vdC50eXBl
cygpOw0KKwkJVHlwZURlY2xhcmF0aW9uIHR5cGVEZWNsYXJhdGlvbiA9IChUeXBlRGVjbGFyYXRp
b24pdHlwZXMuZ2V0KDApOw0KKwkJTWV0aG9kRGVjbGFyYXRpb24gbWV0aG9kRGVjbGFyYXRpb24g
PSB0eXBlRGVjbGFyYXRpb24uZ2V0TWV0aG9kcygpWzBdOw0KKwkJQmxvY2sgYm9keSA9IG1ldGhv
ZERlY2xhcmF0aW9uLmdldEJvZHkoKTsNCisJCUxpc3Qgc3RhdGVtZW50cyA9IGJvZHkuc3RhdGVt
ZW50cygpOw0KKwkJVmFyaWFibGVEZWNsYXJhdGlvblN0YXRlbWVudCB2YXJEZWNsYXJhdGlvbiA9
IChWYXJpYWJsZURlY2xhcmF0aW9uU3RhdGVtZW50KSBzdGF0ZW1lbnRzLmdldCgwKTsNCisJCXN0
YXRlbWVudHMucmVtb3ZlKDApOw0KKwkJDQorCQlzdGF0ZW1lbnRzLnNldCgwLCB2YXJEZWNsYXJh
dGlvbik7DQorCQlTdHJpbmcgcHJldmlldyA9IGV2YWx1YXRlUmV3cml0ZShjdSwgYXN0Um9vdCk7
DQorCQkNCisJCWJ1Zj0gbmV3IFN0cmluZ0J1ZmZlcigpOw0KKwkJYnVmLmFwcGVuZCgicGFja2Fn
ZSB0ZXN0MDAxNDtcbiIpOw0KKwkJYnVmLmFwcGVuZCgicHVibGljIGNsYXNzIFgge1xuIik7DQor
CQlidWYuYXBwZW5kKCIJcHVibGljIHZvaWQgbSgpIHtcbiIpOw0KKwkJYnVmLmFwcGVuZCgiICAg
IAlcbiIpOw0KKwkJYnVmLmFwcGVuZCgiXG4iKTsNCisJCWJ1Zi5hcHBlbmQoIgkJLy8gZG8gbm90
IGRlbGV0ZSB0aGlzXG4iKTsNCisJCWJ1Zi5hcHBlbmQoIlxuIik7DQorCQlidWYuYXBwZW5kKCIg
ICAgIAlTdHJpbmcgYWJjO1xuIik7DQorCQlidWYuYXBwZW5kKCJ9XG4iKTsNCisJCWFzc2VydEVx
dWFsU3RyaW5nKHByZXZpZXcsIGJ1Zi50b1N0cmluZygpKTsNCisJfQ0KIH0NCg==
</data>

          </attachment>
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>188210</attachid>
            <date>2011-02-03 01:11:00 -0500</date>
            <delta_ts>2011-02-03 01:11:28 -0500</delta_ts>
            <desc>proposed fix v1.1 + regression tests</desc>
            <filename>patch331138.txt</filename>
            <type>text/plain</type>
            <size>7401</size>
            <attacher name="Ayushman Jain">amj87.iitr</attacher>
            
              <data encoding="base64">IyMjIEVjbGlwc2UgV29ya3NwYWNlIFBhdGNoIDEuMA0KI1Agb3JnLmVjbGlwc2UuamR0LmNvcmUN
CkluZGV4OiBkb20vb3JnL2VjbGlwc2UvamR0L2ludGVybmFsL2NvcmUvZG9tL3Jld3JpdGUvQVNU
UmV3cml0ZUFuYWx5emVyLmphdmENCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NClJDUyBmaWxlOiAvY3Zzcm9vdC9lY2xp
cHNlL29yZy5lY2xpcHNlLmpkdC5jb3JlL2RvbS9vcmcvZWNsaXBzZS9qZHQvaW50ZXJuYWwvY29y
ZS9kb20vcmV3cml0ZS9BU1RSZXdyaXRlQW5hbHl6ZXIuamF2YSx2DQpyZXRyaWV2aW5nIHJldmlz
aW9uIDEuNzgNCmRpZmYgLXUgLXIxLjc4IEFTVFJld3JpdGVBbmFseXplci5qYXZhDQotLS0gZG9t
L29yZy9lY2xpcHNlL2pkdC9pbnRlcm5hbC9jb3JlL2RvbS9yZXdyaXRlL0FTVFJld3JpdGVBbmFs
eXplci5qYXZhCTIyIE9jdCAyMDEwIDIwOjEwOjM3IC0wMDAwCTEuNzgNCisrKyBkb20vb3JnL2Vj
bGlwc2UvamR0L2ludGVybmFsL2NvcmUvZG9tL3Jld3JpdGUvQVNUUmV3cml0ZUFuYWx5emVyLmph
dmEJMiBGZWIgMjAxMSAyMDowNzoxMCAtMDAwMA0KQEAgLTEsNSArMSw1IEBADQogLyoqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioNCi0gKiBDb3B5cmlnaHQgKGMpIDIwMDAsIDIwMTAgSUJNIENvcnBvcmF0
aW9uIGFuZCBvdGhlcnMuDQorICogQ29weXJpZ2h0IChjKSAyMDAwLCAyMDExIElCTSBDb3Jwb3Jh
dGlvbiBhbmQgb3RoZXJzLg0KICAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuIFRoaXMgcHJvZ3JhbSBh
bmQgdGhlIGFjY29tcGFueWluZyBtYXRlcmlhbHMNCiAgKiBhcmUgbWFkZSBhdmFpbGFibGUgdW5k
ZXIgdGhlIHRlcm1zIG9mIHRoZSBFY2xpcHNlIFB1YmxpYyBMaWNlbnNlIHYxLjANCiAgKiB3aGlj
aCBhY2NvbXBhbmllcyB0aGlzIGRpc3RyaWJ1dGlvbiwgYW5kIGlzIGF2YWlsYWJsZSBhdA0KQEAg
LTY2MCw3ICs2NjAsMzAgQEANCiAJCQkJCQlBU1ROb2RlIGNoYW5nZWQ9IChBU1ROb2RlKSBjdXJy
RXZlbnQuZ2V0TmV3VmFsdWUoKTsNCiAJCQkJCQkNCiAJCQkJCQl1cGRhdGVJbmRlbnQocHJldk1h
cmssIGN1cnJQb3MsIGksIGVkaXRHcm91cCk7DQotCQkJCQkJDQorCQkJCQkJLy8gbWFrZSBzdXJl
IHRoYXQgY29tbWVudHMgYmV0d2VlbiBsYXN0IG1vZGlmaWVkIHNvdXJjZSBwb3NpdGlvbiBhbmQg
ZXh0ZW5kZWQgc3RhcnRpbmcgcG9zaXRpb24gb2YNCisJCQkJCQkvLyBub2RlIHRvIGJlIHJlcGxh
Y2VkIGFyZSBub3QgdG91Y2hlZA0KKwkJCQkJCXRyeSB7DQorCQkJCQkJCVRva2VuU2Nhbm5lciBz
Y2FubmVyID0gZ2V0U2Nhbm5lcigpOw0KKwkJCQkJCQlpbnQgbmV3T2Zmc2V0ID0gcHJldkVuZDsN
CisJCQkJCQkJaW50IGV4dGVuZGVkT2Zmc2V0ID0gZ2V0RXh0ZW5kZWRPZmZzZXQobm9kZSk7DQor
CQkJCQkJCS8vIFRyeSB0byBmaW5kIHRoZSBlbmQgb2YgdGhlIGxhc3QgY29tbWVudCB3aGljaCBp
cyBub3QgcGFydCBvZiBleHRlbmRlZCBzb3VyY2UNCisJCQkJCQkJLy8gcmFuZ2Ugb2YgdGhlIG5v
ZGUuDQorCQkJCQkJCXdoaWxlIChUb2tlblNjYW5uZXIuaXNDb21tZW50KHNjYW5uZXIucmVhZE5l
eHQobmV3T2Zmc2V0LCBmYWxzZSkpKSB7DQorCQkJCQkJCQlpbnQgdGVtcE9mZnNldCA9IHNjYW5u
ZXIuZ2V0TmV4dEVuZE9mZnNldChuZXdPZmZzZXQsIGZhbHNlKTsNCisJCQkJCQkJCS8vIGNoZWNr
IHdoZXRoZXIgdGhlIGNvbW1lbnQgaXMgcGFydCBvZiBleHRlbmRlZCBzb3VyY2UgcmFuZ2Ugb2Yg
dGhlIG5vZGUuDQorCQkJCQkJCQkvLyBJZiBpdCBpcyB0aGVuIHdlIG5lZWQgdG8gc3RvcC4NCisJ
CQkJCQkJCWlmICh0ZW1wT2Zmc2V0IDwgZXh0ZW5kZWRPZmZzZXQpIHsNCisJCQkJCQkJCQluZXdP
ZmZzZXQgPSB0ZW1wT2Zmc2V0Ow0KKwkJCQkJCQkJfSBlbHNlIHsNCisJCQkJCQkJCQlicmVhazsN
CisJCQkJCQkJCX0NCisJCQkJCQkJfQ0KKwkJCQkJCQlpZiAoY3VyclBvcyA8IG5ld09mZnNldCkg
ew0KKwkJCQkJCQkJY3VyclBvcyA9IGV4dGVuZGVkT2Zmc2V0Ow0KKwkJCQkJCQl9IAkJDQorCQkJ
CQkJfSBjYXRjaCAoQ29yZUV4Y2VwdGlvbiBlKSB7DQorCQkJCQkJCS8vIGlnbm9yZQ0KKwkJCQkJ
CX0NCiAJCQkJCQlkb1RleHRSZW1vdmVBbmRWaXNpdChjdXJyUG9zLCBjdXJyRW5kIC0gY3VyclBv
cywgbm9kZSwgZWRpdEdyb3VwKTsNCiAJCQkJCQlkb1RleHRJbnNlcnQoY3VyclBvcywgY2hhbmdl
ZCwgZ2V0Tm9kZUluZGVudChpKSwgdHJ1ZSwgZWRpdEdyb3VwKTsNCiANCiNQIG9yZy5lY2xpcHNl
LmpkdC5jb3JlLnRlc3RzLm1vZGVsDQpJbmRleDogc3JjL29yZy9lY2xpcHNlL2pkdC9jb3JlL3Rl
c3RzL3Jld3JpdGUvbW9kaWZ5aW5nL0FTVFJld3JpdGluZ01vZGlmeWluZ1JlcGxhY2VUZXN0Lmph
dmENCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT0NClJDUyBmaWxlOiAvY3Zzcm9vdC9lY2xpcHNlL29yZy5lY2xpcHNlLmpk
dC5jb3JlLnRlc3RzLm1vZGVsL3NyYy9vcmcvZWNsaXBzZS9qZHQvY29yZS90ZXN0cy9yZXdyaXRl
L21vZGlmeWluZy9BU1RSZXdyaXRpbmdNb2RpZnlpbmdSZXBsYWNlVGVzdC5qYXZhLHYNCnJldHJp
ZXZpbmcgcmV2aXNpb24gMS4xMQ0KZGlmZiAtdSAtcjEuMTEgQVNUUmV3cml0aW5nTW9kaWZ5aW5n
UmVwbGFjZVRlc3QuamF2YQ0KLS0tIHNyYy9vcmcvZWNsaXBzZS9qZHQvY29yZS90ZXN0cy9yZXdy
aXRlL21vZGlmeWluZy9BU1RSZXdyaXRpbmdNb2RpZnlpbmdSZXBsYWNlVGVzdC5qYXZhCTE3IE1h
ciAyMDEwIDE2OjA5OjE2IC0wMDAwCTEuMTENCisrKyBzcmMvb3JnL2VjbGlwc2UvamR0L2NvcmUv
dGVzdHMvcmV3cml0ZS9tb2RpZnlpbmcvQVNUUmV3cml0aW5nTW9kaWZ5aW5nUmVwbGFjZVRlc3Qu
amF2YQkyIEZlYiAyMDExIDIwOjA3OjEyIC0wMDAwDQpAQCAtMSw1ICsxLDUgQEANCiAvKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKg0KLSAqIENvcHlyaWdodCAoYykgMjAwMCwgMjAxMCBJQk0gQ29ycG9y
YXRpb24gYW5kIG90aGVycy4NCisgKiBDb3B5cmlnaHQgKGMpIDIwMDAsIDIwMTEgSUJNIENvcnBv
cmF0aW9uIGFuZCBvdGhlcnMuDQogICogQWxsIHJpZ2h0cyByZXNlcnZlZC4gVGhpcyBwcm9ncmFt
IGFuZCB0aGUgYWNjb21wYW55aW5nIG1hdGVyaWFscw0KICAqIGFyZSBtYWRlIGF2YWlsYWJsZSB1
bmRlciB0aGUgdGVybXMgb2YgdGhlIEVjbGlwc2UgUHVibGljIExpY2Vuc2UgdjEuMA0KICAqIHdo
aWNoIGFjY29tcGFuaWVzIHRoaXMgZGlzdHJpYnV0aW9uLCBhbmQgaXMgYXZhaWxhYmxlIGF0DQpA
QCAtNDYyLDQgKzQ2MiwxMDkgQEANCiAJCWJ1Zi5hcHBlbmQoIn1cbiIpOw0KIAkJYXNzZXJ0RXF1
YWxTdHJpbmcocHJldmlldywgYnVmLnRvU3RyaW5nKCkpOw0KIAl9DQorCQ0KKwkvLyBodHRwczov
L2J1Z3MuZWNsaXBzZS5vcmcvYnVncy9zaG93X2J1Zy5jZ2k/aWQ9MzMxMTM4DQorCS8vIE1ha2Ug
c3VyZSBjb21tZW50cyBiZXR3ZWVuIHJlbW92ZWQgYW5kIHJlcGxhY2VkIG5vZGUgYXJlIG5vdCBy
ZW1vdmVkLg0KKwlwdWJsaWMgdm9pZCB0ZXN0MDAxNGEoKSB0aHJvd3MgRXhjZXB0aW9uIHsNCisJ
CUlQYWNrYWdlRnJhZ21lbnQgcGFjazE9IHRoaXMuc291cmNlRm9sZGVyLmNyZWF0ZVBhY2thZ2VG
cmFnbWVudCgidGVzdDAwMTRhIiwgZmFsc2UsIG51bGwpOw0KKwkJU3RyaW5nQnVmZmVyIGJ1Zj0g
bmV3IFN0cmluZ0J1ZmZlcigpOw0KKwkJYnVmLmFwcGVuZCgicGFja2FnZSB0ZXN0MDAxNDtcbiIp
Ow0KKwkJYnVmLmFwcGVuZCgicHVibGljIGNsYXNzIFgge1xuIik7DQorCQlidWYuYXBwZW5kKCIJ
cHVibGljIHZvaWQgbSgpIHtcbiIpOw0KKwkJYnVmLmFwcGVuZCgiICAgIAlTdHJpbmcgYWJjO1xu
Iik7DQorCQlidWYuYXBwZW5kKCJcbiIpOw0KKwkJYnVmLmFwcGVuZCgiCQkvLyBkbyBub3QgZGVs
ZXRlIHRoaXNcbiIpOw0KKwkJYnVmLmFwcGVuZCgiXG4iKTsNCisJCWJ1Zi5hcHBlbmQoIgkJLyog
ZG8gbm90IGRlbGV0ZSB0aGlzXG4iKTsNCisJCWJ1Zi5hcHBlbmQoIgkJICovXG4iKTsNCisJCWJ1
Zi5hcHBlbmQoIlxuIik7DQorCQlidWYuYXBwZW5kKCIgICAgIAlhYmMgPSBcIlwiO1xuIik7DQor
CQlidWYuYXBwZW5kKCIJfVxuIik7DQorCQlidWYuYXBwZW5kKCJ9XG4iKTsNCisJCUlDb21waWxh
dGlvblVuaXQgY3U9IHBhY2sxLmNyZWF0ZUNvbXBpbGF0aW9uVW5pdCgiWC5qYXZhIiwgYnVmLnRv
U3RyaW5nKCksIGZhbHNlLCBudWxsKTsNCisNCisJCUNvbXBpbGF0aW9uVW5pdCBhc3RSb290PSBj
cmVhdGVDVShjdSwgZmFsc2UpOw0KKw0KKwkJYXN0Um9vdC5yZWNvcmRNb2RpZmljYXRpb25zKCk7
DQorDQorCQlMaXN0IHR5cGVzID0gYXN0Um9vdC50eXBlcygpOw0KKwkJVHlwZURlY2xhcmF0aW9u
IHR5cGVEZWNsYXJhdGlvbiA9IChUeXBlRGVjbGFyYXRpb24pdHlwZXMuZ2V0KDApOw0KKwkJTWV0
aG9kRGVjbGFyYXRpb24gbWV0aG9kRGVjbGFyYXRpb24gPSB0eXBlRGVjbGFyYXRpb24uZ2V0TWV0
aG9kcygpWzBdOw0KKwkJQmxvY2sgYm9keSA9IG1ldGhvZERlY2xhcmF0aW9uLmdldEJvZHkoKTsN
CisJCUxpc3Qgc3RhdGVtZW50cyA9IGJvZHkuc3RhdGVtZW50cygpOw0KKwkJVmFyaWFibGVEZWNs
YXJhdGlvblN0YXRlbWVudCB2YXJEZWNsYXJhdGlvbiA9IChWYXJpYWJsZURlY2xhcmF0aW9uU3Rh
dGVtZW50KSBzdGF0ZW1lbnRzLmdldCgwKTsNCisJCXN0YXRlbWVudHMucmVtb3ZlKDApOw0KKwkJ
DQorCQlzdGF0ZW1lbnRzLnNldCgwLCB2YXJEZWNsYXJhdGlvbik7DQorCQlTdHJpbmcgcHJldmll
dyA9IGV2YWx1YXRlUmV3cml0ZShjdSwgYXN0Um9vdCk7DQorCQkNCisJCWJ1Zj0gbmV3IFN0cmlu
Z0J1ZmZlcigpOw0KKwkJYnVmLmFwcGVuZCgicGFja2FnZSB0ZXN0MDAxNDtcbiIpOw0KKwkJYnVm
LmFwcGVuZCgicHVibGljIGNsYXNzIFgge1xuIik7DQorCQlidWYuYXBwZW5kKCIJcHVibGljIHZv
aWQgbSgpIHtcbiIpOw0KKwkJYnVmLmFwcGVuZCgiICAgIAlcbiIpOw0KKwkJYnVmLmFwcGVuZCgi
XG4iKTsNCisJCWJ1Zi5hcHBlbmQoIgkJLy8gZG8gbm90IGRlbGV0ZSB0aGlzXG4iKTsNCisJCWJ1
Zi5hcHBlbmQoIlxuIik7DQorCQlidWYuYXBwZW5kKCIJCS8qIGRvIG5vdCBkZWxldGUgdGhpc1xu
Iik7DQorCQlidWYuYXBwZW5kKCIJCSAqL1xuIik7DQorCQlidWYuYXBwZW5kKCJcbiIpOw0KKwkJ
YnVmLmFwcGVuZCgiICAgICAJU3RyaW5nIGFiYztcbiIpOw0KKwkJYnVmLmFwcGVuZCgiCX1cbiIp
Ow0KKwkJYnVmLmFwcGVuZCgifVxuIik7DQorCQlhc3NlcnRFcXVhbFN0cmluZyhwcmV2aWV3LCBi
dWYudG9TdHJpbmcoKSk7DQorCX0NCisJDQorCS8vIGh0dHBzOi8vYnVncy5lY2xpcHNlLm9yZy9i
dWdzL3Nob3dfYnVnLmNnaT9pZD0zMzExMzgNCisJLy8gTWFrZSBzdXJlIGNvbW1lbnRzIGJldHdl
ZW4gcmVtb3ZlZCBhbmQgcmVwbGFjZWQgbm9kZSBhcmUgbm90IHJlbW92ZWQuDQorCXB1YmxpYyB2
b2lkIHRlc3QwMDE0YigpIHRocm93cyBFeGNlcHRpb24gew0KKwkJSVBhY2thZ2VGcmFnbWVudCBw
YWNrMT0gdGhpcy5zb3VyY2VGb2xkZXIuY3JlYXRlUGFja2FnZUZyYWdtZW50KCJ0ZXN0MDAxNGIi
LCBmYWxzZSwgbnVsbCk7DQorCQlTdHJpbmdCdWZmZXIgYnVmPSBuZXcgU3RyaW5nQnVmZmVyKCk7
DQorCQlidWYuYXBwZW5kKCJwYWNrYWdlIHRlc3QwMDE0O1xuIik7DQorCQlidWYuYXBwZW5kKCJw
dWJsaWMgY2xhc3MgWCB7XG4iKTsNCisJCWJ1Zi5hcHBlbmQoIglwdWJsaWMgdm9pZCBtKCkge1xu
Iik7DQorCQlidWYuYXBwZW5kKCIgICAgCVN0cmluZyBhYmM7XG4iKTsNCisJCWJ1Zi5hcHBlbmQo
IlxuIik7DQorCQlidWYuYXBwZW5kKCIJCS8vIGRvIG5vdCBkZWxldGUgdGhpc1xuIik7DQorCQli
dWYuYXBwZW5kKCJcbiIpOw0KKwkJYnVmLmFwcGVuZCgiCQkvKiBkbyBub3QgZGVsZXRlIHRoaXNc
biIpOw0KKwkJYnVmLmFwcGVuZCgiCQkgKi9cbiIpOw0KKwkJYnVmLmFwcGVuZCgiXG4iKTsNCisJ
CWJ1Zi5hcHBlbmQoIgkJLy8gZG8gbm90IGRlbGV0ZSB0aGlzXG4iKTsNCisJCWJ1Zi5hcHBlbmQo
IiAgICAgCWFiYyA9IFwiXCI7XG4iKTsNCisJCWJ1Zi5hcHBlbmQoIgl9XG4iKTsNCisJCWJ1Zi5h
cHBlbmQoIn1cbiIpOw0KKwkJSUNvbXBpbGF0aW9uVW5pdCBjdT0gcGFjazEuY3JlYXRlQ29tcGls
YXRpb25Vbml0KCJYLmphdmEiLCBidWYudG9TdHJpbmcoKSwgZmFsc2UsIG51bGwpOw0KKw0KKwkJ
Q29tcGlsYXRpb25Vbml0IGFzdFJvb3Q9IGNyZWF0ZUNVKGN1LCBmYWxzZSk7DQorDQorCQlhc3RS
b290LnJlY29yZE1vZGlmaWNhdGlvbnMoKTsNCisNCisJCUxpc3QgdHlwZXMgPSBhc3RSb290LnR5
cGVzKCk7DQorCQlUeXBlRGVjbGFyYXRpb24gdHlwZURlY2xhcmF0aW9uID0gKFR5cGVEZWNsYXJh
dGlvbil0eXBlcy5nZXQoMCk7DQorCQlNZXRob2REZWNsYXJhdGlvbiBtZXRob2REZWNsYXJhdGlv
biA9IHR5cGVEZWNsYXJhdGlvbi5nZXRNZXRob2RzKClbMF07DQorCQlCbG9jayBib2R5ID0gbWV0
aG9kRGVjbGFyYXRpb24uZ2V0Qm9keSgpOw0KKwkJTGlzdCBzdGF0ZW1lbnRzID0gYm9keS5zdGF0
ZW1lbnRzKCk7DQorCQlWYXJpYWJsZURlY2xhcmF0aW9uU3RhdGVtZW50IHZhckRlY2xhcmF0aW9u
ID0gKFZhcmlhYmxlRGVjbGFyYXRpb25TdGF0ZW1lbnQpIHN0YXRlbWVudHMuZ2V0KDApOw0KKwkJ
c3RhdGVtZW50cy5yZW1vdmUoMCk7DQorCQkNCisJCXN0YXRlbWVudHMuc2V0KDAsIHZhckRlY2xh
cmF0aW9uKTsNCisJCVN0cmluZyBwcmV2aWV3ID0gZXZhbHVhdGVSZXdyaXRlKGN1LCBhc3RSb290
KTsNCisJCQ0KKwkJYnVmPSBuZXcgU3RyaW5nQnVmZmVyKCk7DQorCQlidWYuYXBwZW5kKCJwYWNr
YWdlIHRlc3QwMDE0O1xuIik7DQorCQlidWYuYXBwZW5kKCJwdWJsaWMgY2xhc3MgWCB7XG4iKTsN
CisJCWJ1Zi5hcHBlbmQoIglwdWJsaWMgdm9pZCBtKCkge1xuIik7DQorCQlidWYuYXBwZW5kKCIg
ICAgCVxuIik7DQorCQlidWYuYXBwZW5kKCJcbiIpOw0KKwkJYnVmLmFwcGVuZCgiCQkvLyBkbyBu
b3QgZGVsZXRlIHRoaXNcbiIpOw0KKwkJYnVmLmFwcGVuZCgiXG4iKTsNCisJCWJ1Zi5hcHBlbmQo
IgkJLyogZG8gbm90IGRlbGV0ZSB0aGlzXG4iKTsNCisJCWJ1Zi5hcHBlbmQoIgkJICovXG4iKTsN
CisJCWJ1Zi5hcHBlbmQoIlxuIik7DQorCQlidWYuYXBwZW5kKCIJCVN0cmluZyBhYmM7XG4iKTsN
CisJCWJ1Zi5hcHBlbmQoIgl9XG4iKTsNCisJCWJ1Zi5hcHBlbmQoIn1cbiIpOw0KKwkJYXNzZXJ0
RXF1YWxTdHJpbmcocHJldmlldywgYnVmLnRvU3RyaW5nKCkpOw0KKwl9DQogfQ0K
</data>

          </attachment>
      

    </bug>

</bugzilla>