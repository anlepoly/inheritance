<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>339447</bug_id>
          
          <creation_ts>2011-03-09 18:48:00 -0500</creation_ts>
          <short_desc>synchronized access modifier retained on clone() bridge</short_desc>
          <delta_ts>2011-04-25 13:54:57 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>3.7</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>3.7 M7</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Tim Eck">timeck</reporter>
          <assigned_to name="Olivier Thomann">Olivier_Thomann</assigned_to>
          <cc>jarthana</cc>
    
    <cc>Olivier_Thomann</cc>
    
    <cc>srikanth_sankaran</cc>
    
    <cc>timeck</cc>
          
          <votes>0</votes>

      

      

      <flag name="review"
          id="39937"
          type_id="1"
          status="+"
          setter="srikanth_sankaran"
    />

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>1896185</commentid>
    <comment_count>0</comment_count>
    <who name="Tim Eck">timeck</who>
    <bug_when>2011-03-09 18:48:46 -0500</bug_when>
    <thetext>Build Identifier: M20110210-1200

public class Foo implements Cloneable {
    public synchronized Foo clone() {
        return this;
    }    
}

Compile this class with the eclipse compiler (default 1.6 compliance settings). Also compile the same class with javac from hotspot 1.6.0_24. 

In the resulting class files the bridge method for clone() ends up with different access modifiers. The eclipse compiler keeps the synchronized access where as javac does not. 

For the most part this difference doesn&apos;t really matter but it was biting me since the different modifiers leads to a different serialVersionUID and breaks serialization. 


Reproducible: Always</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1896186</commentid>
    <comment_count>1</comment_count>
    <who name="Tim Eck">timeck</who>
    <bug_when>2011-03-09 18:50:07 -0500</bug_when>
    <thetext>The javap output (from eclipse .class)
Compiled from &quot;Foo.java&quot;
public class Foo extends java.lang.Object implements java.lang.Cloneable{
public Foo();
  Code:
   0:   aload_0
   1:   invokespecial   #10; //Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V
   4:   return

public synchronized Foo clone();
  Code:
   0:   aload_0
   1:   areturn

public synchronized java.lang.Object clone()   throws java.lang.CloneNotSupportedException;
  Code:
   0:   aload_0
   1:   invokevirtual   #22; //Method clone:()LFoo;
   4:   areturn

}


And the output from the javac compiler one (note: clone() bridge is not synchronized access):

Compiled from &quot;Foo.java&quot;
public class Foo extends java.lang.Object implements java.lang.Cloneable{
public Foo();
  Code:
   0:   aload_0
   1:   invokespecial   #1; //Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V
   4:   return

public synchronized Foo clone();
  Code:
   0:   aload_0
   1:   areturn

public java.lang.Object clone()   throws java.lang.CloneNotSupportedException;
  Code:
   0:   aload_0
   1:   invokevirtual   #2; //Method clone:()LFoo;
   4:   areturn

}</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1896221</commentid>
    <comment_count>2</comment_count>
    <who name="Olivier Thomann">Olivier_Thomann</who>
    <bug_when>2011-03-09 20:55:33 -0500</bug_when>
    <thetext>(In reply to comment #0)
&gt; For the most part this difference doesn&apos;t really matter but it was biting me
&gt; since the different modifiers leads to a different serialVersionUID and breaks
&gt; serialization. 
There are multiple reasons that will lead to a different serialVersionUID from the javac&apos;s one. If you really care about serialization, you should set your own serialVersionUID.
This being said, we will check what is supposed to be done regarding the synchronized modifiers and bridge method.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1896298</commentid>
    <comment_count>3</comment_count>
    <who name="Tim Eck">timeck</who>
    <bug_when>2011-03-10 02:19:37 -0500</bug_when>
    <thetext>Thanks for the input Oliver. For sure the best thing to do for serialization is to be explicit in the code for serialVersionUID. 

I have no idea if this particular detail is covered in the specs. That said it does seem unnecessary to carry synchronized access in the bridge method so I lean towards javac being more &quot;correct&quot; in this case</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1896567</commentid>
    <comment_count>4</comment_count>
    <who name="Olivier Thomann">Olivier_Thomann</who>
    <bug_when>2011-03-10 09:42:54 -0500</bug_when>
    <thetext>(In reply to comment #3)
&gt; Thanks for the input Oliver. For sure the best thing to do for serialization is
&gt; to be explicit in the code for serialVersionUID. 
This is actually the only way to do it to get a reliable behavior. javac and the eclipse compiler don&apos;t handle the class literal (X.class for example) the same way. So any usage of the class literal in source would lead to a different serialVersionUID.

&gt; I have no idea if this particular detail is covered in the specs. That said it
&gt; does seem unnecessary to carry synchronized access in the bridge method so I
&gt; lean towards javac being more &quot;correct&quot; in this case.
I&apos;ll double-check that.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1899138</commentid>
    <comment_count>5</comment_count>
    <who name="Olivier Thomann">Olivier_Thomann</who>
    <bug_when>2011-03-15 11:44:55 -0400</bug_when>
    <thetext>I could not find any specific details on the synchronized keyword, but I agree that it makes sense to drop it since the &quot;inner&quot; call is synchronized.
Srikanth, any comment on this ?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1899150</commentid>
    <comment_count>6</comment_count>
      <attachid>191223</attachid>
    <who name="Olivier Thomann">Olivier_Thomann</who>
    <bug_when>2011-03-15 11:58:15 -0400</bug_when>
    <thetext>Created attachment 191223
Proposed fix + regression test</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1899151</commentid>
    <comment_count>7</comment_count>
    <who name="Olivier Thomann">Olivier_Thomann</who>
    <bug_when>2011-03-15 11:58:40 -0400</bug_when>
    <thetext>Srikanth, please review. Fix is trivial.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1899528</commentid>
    <comment_count>8</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2011-03-16 01:31:25 -0400</bug_when>
    <thetext>Agree with the fix. Patch looks good.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1900986</commentid>
    <comment_count>9</comment_count>
    <who name="Olivier Thomann">Olivier_Thomann</who>
    <bug_when>2011-03-18 09:20:10 -0400</bug_when>
    <thetext>Released for 3.7M7.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1918487</commentid>
    <comment_count>10</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2011-04-25 13:54:57 -0400</bug_when>
    <thetext>Verified for 3.7M7 using build I20110421-1800</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>191223</attachid>
            <date>2011-03-15 11:58:00 -0400</date>
            <delta_ts>2011-03-15 11:58:15 -0400</delta_ts>
            <desc>Proposed fix + regression test</desc>
            <filename>patch_339447.txt</filename>
            <type>text/plain</type>
            <size>4925</size>
            <attacher name="Olivier Thomann">Olivier_Thomann</attacher>
            
              <data encoding="base64">IyMjIEVjbGlwc2UgV29ya3NwYWNlIFBhdGNoIDEuMA0KI1Agb3JnLmVjbGlwc2UuamR0LmNvcmUN
CkluZGV4OiBjb21waWxlci9vcmcvZWNsaXBzZS9qZHQvaW50ZXJuYWwvY29tcGlsZXIvbG9va3Vw
L1N5bnRoZXRpY01ldGhvZEJpbmRpbmcuamF2YQ0KPT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KUkNTIGZpbGU6IC9jdnNy
b290L2VjbGlwc2Uvb3JnLmVjbGlwc2UuamR0LmNvcmUvY29tcGlsZXIvb3JnL2VjbGlwc2UvamR0
L2ludGVybmFsL2NvbXBpbGVyL2xvb2t1cC9TeW50aGV0aWNNZXRob2RCaW5kaW5nLmphdmEsdg0K
cmV0cmlldmluZyByZXZpc2lvbiAxLjI3DQpkaWZmIC11IC1yMS4yNyBTeW50aGV0aWNNZXRob2RC
aW5kaW5nLmphdmENCi0tLSBjb21waWxlci9vcmcvZWNsaXBzZS9qZHQvaW50ZXJuYWwvY29tcGls
ZXIvbG9va3VwL1N5bnRoZXRpY01ldGhvZEJpbmRpbmcuamF2YQk1IEphbiAyMDExIDE5OjU3OjI2
IC0wMDAwCTEuMjcNCisrKyBjb21waWxlci9vcmcvZWNsaXBzZS9qZHQvaW50ZXJuYWwvY29tcGls
ZXIvbG9va3VwL1N5bnRoZXRpY01ldGhvZEJpbmRpbmcuamF2YQkxNSBNYXIgMjAxMSAxNTo1Nzow
MCAtMDAwMA0KQEAgLTIzMSw3ICsyMzEsNyBAQA0KIAkgICAgdGhpcy5zZWxlY3RvciA9IG92ZXJy
aWRlbk1ldGhvZFRvQnJpZGdlLnNlbGVjdG9yOw0KIAkgICAgLy8gYW1vbmdzdCBvdGhlciwgY2xl
YXIgdGhlIEFjY0dlbmVyaWNTaWduYXR1cmUsIHNvIGFzIHRvIGVuc3VyZSBubyByZW1haW5zIG9m
IG9yaWdpbmFsIGluaGVyaXRlZCBwZXJzaXN0ICgxMDE3OTQpDQogCSAgICAvLyBhbHNvIHVzZSB0
aGUgbW9kaWZpZXJzIGZyb20gdGhlIHRhcmdldCBtZXRob2QsIGFzIG9wcG9zZWQgdG8gaW5oZXJp
dGVkIG9uZSAoMTQ3NjkwKQ0KLQkgICAgdGhpcy5tb2RpZmllcnMgPSAodGFyZ2V0TWV0aG9kLm1v
ZGlmaWVycyB8IENsYXNzRmlsZUNvbnN0YW50cy5BY2NCcmlkZ2UgfCBDbGFzc0ZpbGVDb25zdGFu
dHMuQWNjU3ludGhldGljKSAmIH4oQ2xhc3NGaWxlQ29uc3RhbnRzLkFjY0Fic3RyYWN0IHwgQ2xh
c3NGaWxlQ29uc3RhbnRzLkFjY05hdGl2ZSAgfCBDbGFzc0ZpbGVDb25zdGFudHMuQWNjRmluYWwg
fCBFeHRyYUNvbXBpbGVyTW9kaWZpZXJzLkFjY0dlbmVyaWNTaWduYXR1cmUpOw0KKwkgICAgdGhp
cy5tb2RpZmllcnMgPSAodGFyZ2V0TWV0aG9kLm1vZGlmaWVycyB8IENsYXNzRmlsZUNvbnN0YW50
cy5BY2NCcmlkZ2UgfCBDbGFzc0ZpbGVDb25zdGFudHMuQWNjU3ludGhldGljKSAmIH4oQ2xhc3NG
aWxlQ29uc3RhbnRzLkFjY1N5bmNocm9uaXplZCB8IENsYXNzRmlsZUNvbnN0YW50cy5BY2NBYnN0
cmFjdCB8IENsYXNzRmlsZUNvbnN0YW50cy5BY2NOYXRpdmUgIHwgQ2xhc3NGaWxlQ29uc3RhbnRz
LkFjY0ZpbmFsIHwgRXh0cmFDb21waWxlck1vZGlmaWVycy5BY2NHZW5lcmljU2lnbmF0dXJlKTsN
CiAJCXRoaXMudGFnQml0cyB8PSAoVGFnQml0cy5Bbm5vdGF0aW9uUmVzb2x2ZWQgfCBUYWdCaXRz
LkRlcHJlY2F0ZWRBbm5vdGF0aW9uUmVzb2x2ZWQpOw0KIAkgICAgdGhpcy5yZXR1cm5UeXBlID0g
b3ZlcnJpZGVuTWV0aG9kVG9CcmlkZ2UucmV0dXJuVHlwZTsNCiAJICAgIHRoaXMucGFyYW1ldGVy
cyA9IG92ZXJyaWRlbk1ldGhvZFRvQnJpZGdlLnBhcmFtZXRlcnM7DQpAQCAtMjk5LDcgKzI5OSw3
IEBADQogCSAgICB0aGlzLnNlbGVjdG9yID0gb3ZlcnJpZGVuTWV0aG9kVG9CcmlkZ2Uuc2VsZWN0
b3I7DQogCSAgICAvLyBhbW9uZ3N0IG90aGVyLCBjbGVhciB0aGUgQWNjR2VuZXJpY1NpZ25hdHVy
ZSwgc28gYXMgdG8gZW5zdXJlIG5vIHJlbWFpbnMgb2Ygb3JpZ2luYWwgaW5oZXJpdGVkIHBlcnNp
c3QgKDEwMTc5NCkNCiAJICAgIC8vIGFsc28gdXNlIHRoZSBtb2RpZmllcnMgZnJvbSB0aGUgdGFy
Z2V0IG1ldGhvZCwgYXMgb3Bwb3NlZCB0byBpbmhlcml0ZWQgb25lICgxNDc2OTApDQotCSAgICB0
aGlzLm1vZGlmaWVycyA9IChvdmVycmlkZW5NZXRob2RUb0JyaWRnZS5tb2RpZmllcnMgfCBDbGFz
c0ZpbGVDb25zdGFudHMuQWNjQnJpZGdlIHwgQ2xhc3NGaWxlQ29uc3RhbnRzLkFjY1N5bnRoZXRp
YykgJiB+KENsYXNzRmlsZUNvbnN0YW50cy5BY2NBYnN0cmFjdCB8IENsYXNzRmlsZUNvbnN0YW50
cy5BY2NOYXRpdmUgIHwgQ2xhc3NGaWxlQ29uc3RhbnRzLkFjY0ZpbmFsIHwgRXh0cmFDb21waWxl
ck1vZGlmaWVycy5BY2NHZW5lcmljU2lnbmF0dXJlKTsNCisJICAgIHRoaXMubW9kaWZpZXJzID0g
KG92ZXJyaWRlbk1ldGhvZFRvQnJpZGdlLm1vZGlmaWVycyB8IENsYXNzRmlsZUNvbnN0YW50cy5B
Y2NCcmlkZ2UgfCBDbGFzc0ZpbGVDb25zdGFudHMuQWNjU3ludGhldGljKSAmIH4oQ2xhc3NGaWxl
Q29uc3RhbnRzLkFjY1N5bmNocm9uaXplZCB8IENsYXNzRmlsZUNvbnN0YW50cy5BY2NBYnN0cmFj
dCB8IENsYXNzRmlsZUNvbnN0YW50cy5BY2NOYXRpdmUgIHwgQ2xhc3NGaWxlQ29uc3RhbnRzLkFj
Y0ZpbmFsIHwgRXh0cmFDb21waWxlck1vZGlmaWVycy5BY2NHZW5lcmljU2lnbmF0dXJlKTsNCiAJ
CXRoaXMudGFnQml0cyB8PSAoVGFnQml0cy5Bbm5vdGF0aW9uUmVzb2x2ZWQgfCBUYWdCaXRzLkRl
cHJlY2F0ZWRBbm5vdGF0aW9uUmVzb2x2ZWQpOw0KIAkgICAgdGhpcy5yZXR1cm5UeXBlID0gb3Zl
cnJpZGVuTWV0aG9kVG9CcmlkZ2UucmV0dXJuVHlwZTsNCiAJICAgIHRoaXMucGFyYW1ldGVycyA9
IG92ZXJyaWRlbk1ldGhvZFRvQnJpZGdlLnBhcmFtZXRlcnM7DQojUCBvcmcuZWNsaXBzZS5qZHQu
Y29yZS50ZXN0cy5jb21waWxlcg0KSW5kZXg6IHNyYy9vcmcvZWNsaXBzZS9qZHQvY29yZS90ZXN0
cy9jb21waWxlci9yZWdyZXNzaW9uL01ldGhvZFZlcmlmeVRlc3QuamF2YQ0KPT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0K
UkNTIGZpbGU6IC9jdnNyb290L2VjbGlwc2Uvb3JnLmVjbGlwc2UuamR0LmNvcmUudGVzdHMuY29t
cGlsZXIvc3JjL29yZy9lY2xpcHNlL2pkdC9jb3JlL3Rlc3RzL2NvbXBpbGVyL3JlZ3Jlc3Npb24v
TWV0aG9kVmVyaWZ5VGVzdC5qYXZhLHYNCnJldHJpZXZpbmcgcmV2aXNpb24gMS4yMjINCmRpZmYg
LXUgLXIxLjIyMiBNZXRob2RWZXJpZnlUZXN0LmphdmENCi0tLSBzcmMvb3JnL2VjbGlwc2UvamR0
L2NvcmUvdGVzdHMvY29tcGlsZXIvcmVncmVzc2lvbi9NZXRob2RWZXJpZnlUZXN0LmphdmEJMTcg
SmFuIDIwMTEgMDg6MDU6MDMgLTAwMDAJMS4yMjINCisrKyBzcmMvb3JnL2VjbGlwc2UvamR0L2Nv
cmUvdGVzdHMvY29tcGlsZXIvcmVncmVzc2lvbi9NZXRob2RWZXJpZnlUZXN0LmphdmEJMTUgTWFy
IDIwMTEgMTU6NTc6MDMgLTAwMDANCkBAIC0yNyw3ICsyNyw3IEBADQogDQogcHVibGljIGNsYXNz
IE1ldGhvZFZlcmlmeVRlc3QgZXh0ZW5kcyBBYnN0cmFjdENvbXBhcmFibGVUZXN0IHsNCiAJc3Rh
dGljIHsNCi0vLwkJVEVTVFNfTkFNRVMgPSBuZXcgU3RyaW5nW10geyAidGVzdDMzMTQ0NiIgfTsN
CisvLwkJVEVTVFNfTkFNRVMgPSBuZXcgU3RyaW5nW10geyAidGVzdDMzOTQ0NyIgfTsNCiAvLwkJ
VEVTVFNfTlVNQkVSUyA9IG5ldyBpbnRbXSB7IDIxMyB9Ow0KIC8vCQlURVNUU19SQU5HRSA9IG5l
dyBpbnRbXSB7IDE5MCwgLTF9Ow0KIAl9DQpAQCAtMTE5NjgsNCArMTE5NjgsMzIgQEANCiAJCWNv
bXBpbGVyT3B0aW9uczE0LA0KIAkJbnVsbCk7DQogfQ0KKy8vaHR0cHM6Ly9idWdzLmVjbGlwc2Uu
b3JnL2J1Z3Mvc2hvd19idWcuY2dpP2lkPTMzOTQ0Nw0KK3B1YmxpYyB2b2lkIHRlc3QzMzk0NDco
KSB0aHJvd3MgRXhjZXB0aW9uIHsNCisJdGhpcy5ydW5Db25mb3JtVGVzdCgNCisJCW5ldyBTdHJp
bmdbXSB7DQorCQkJIlguamF2YSIsDQorCQkJInB1YmxpYyBjbGFzcyBYIGltcGxlbWVudHMgQ2xv
bmVhYmxlIHtcbiIgKyANCisJCQkiCXB1YmxpYyBzeW5jaHJvbml6ZWQgWCBjbG9uZSgpIHtcbiIg
KyANCisJCQkiCQlyZXR1cm4gdGhpcztcbiIgKyANCisJCQkiCX1cbiIgKyANCisJCQkifSIsIC8v
ID09PT09PT09PT09PT09PT09DQorCQl9LA0KKwkJIiIpOw0KKwkvLyAJZW5zdXJlIGJyaWRnZSBt
ZXRob2RzIGhhdmUgdGFyZ2V0IG1ldGhvZCBtb2RpZmllcnMsIGFuZCBpbmhlcml0ZWQgdGhyb3du
IGV4Y2VwdGlvbnMNCisJU3RyaW5nIGV4cGVjdGVkT3V0cHV0ID0NCisJCQkiICBwdWJsaWMgYnJp
ZGdlIHN5bnRoZXRpYyBqYXZhLmxhbmcuT2JqZWN0IGNsb25lKCkgdGhyb3dzIGphdmEubGFuZy5D
bG9uZU5vdFN1cHBvcnRlZEV4Y2VwdGlvbjsiOw0KKw0KKwlGaWxlIGYgPSBuZXcgRmlsZShPVVRQ
VVRfRElSICsgRmlsZS5zZXBhcmF0b3IgKyAiWC5jbGFzcyIpOw0KKwlieXRlW10gY2xhc3NGaWxl
Qnl0ZXMgPSBvcmcuZWNsaXBzZS5qZHQuaW50ZXJuYWwuY29tcGlsZXIudXRpbC5VdGlsLmdldEZp
bGVCeXRlQ29udGVudChmKTsNCisJQ2xhc3NGaWxlQnl0ZXNEaXNhc3NlbWJsZXIgZGlzYXNzZW1i
bGVyID0gVG9vbEZhY3RvcnkuY3JlYXRlRGVmYXVsdENsYXNzRmlsZUJ5dGVzRGlzYXNzZW1ibGVy
KCk7DQorCVN0cmluZyByZXN1bHQgPSBkaXNhc3NlbWJsZXIuZGlzYXNzZW1ibGUoY2xhc3NGaWxl
Qnl0ZXMsICJcbiIsIENsYXNzRmlsZUJ5dGVzRGlzYXNzZW1ibGVyLkRFVEFJTEVEKTsNCisJaW50
IGluZGV4ID0gcmVzdWx0LmluZGV4T2YoZXhwZWN0ZWRPdXRwdXQpOw0KKwlpZiAoaW5kZXggPT0g
LTEgfHwgZXhwZWN0ZWRPdXRwdXQubGVuZ3RoKCkgPT0gMCkgew0KKwkJU3lzdGVtLm91dC5wcmlu
dGxuKFV0aWwuZGlzcGxheVN0cmluZyhyZXN1bHQsIDMpKTsNCisJfQ0KKwlpZiAoaW5kZXggPT0g
LTEpIHsNCisJCWFzc2VydEVxdWFscygiV3JvbmcgY29udGVudHMiLCBleHBlY3RlZE91dHB1dCwg
cmVzdWx0KTsNCisJfQ0KK30NCiB9DQo=
</data>

          </attachment>
      

    </bug>

</bugzilla>