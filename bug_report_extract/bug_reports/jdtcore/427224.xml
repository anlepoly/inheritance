<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>427224</bug_id>
          
          <creation_ts>2014-02-02 17:26:00 -0500</creation_ts>
          <short_desc>[1.8][inference] Reducing inner diamond against specific parameterization fails</short_desc>
          <delta_ts>2014-02-24 18:48:49 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>4.4</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>BETA J8</target_milestone>
          
          <blocked>427059</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Stephan Herrmann">stephan.herrmann</reporter>
          <assigned_to name="Stephan Herrmann">stephan.herrmann</assigned_to>
          <cc>anchakrk</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2357691</commentid>
    <comment_count>0</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2014-02-02 17:26:06 -0500</bug_when>
    <thetext>From bug 424591 comment 32:

public class Test2 {
    public static native &lt;T&gt; T applyToSet(java.util.Set&lt;String&gt; s);

    public static void applyToList(java.util.List&lt;String&gt; s) {
        applyToSet(new java.util.HashSet&lt;&gt;(s));
    }
}

$ /usr/lib/jvm/jdk1.8.0/bin/javac Test2.java
$ java -jar org.eclipse.jdt.core_3.9.2.v20140202-0105_BETA_JAVA8.jar -1.8 Test2.java
----------
1. ERROR in /home/dsimon/Test2.java (at line 13)
	applyToSet(new HashSet&lt;&gt;(s));
	^^^^^^^^^^
The method applyToSet(Set&lt;String&gt;) in the type Test2 is not applicable for the arguments (new HashSet&lt;&gt;(s))
----------
1 problem (1 error)
$

Removing the (unused) &quot;&lt;T&gt;&quot; from applyToSet makes the problem go away.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2357692</commentid>
    <comment_count>1</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2014-02-02 17:30:09 -0500</bug_when>
    <thetext>The problem is, we try to reduce 
  new java.util.HashSet&lt;&gt;(s)  java.util.Set&lt;java.lang.String&gt;

At this point the diamond is half-resolved, we haven&apos;t yet inferred its
parameterization. Yet 18.2.1 calls to simply check:
  &quot;If T is a proper type, the constraint reduces to true if the expression is compatible in a loose invocation context with T, and false otherwise.&quot;

At this point compatibility check is not yet equipped to finish the resolution of the diamond. Care must be taken to enable multiple resolution attempts if inference happens in an overload situation.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2358271</commentid>
    <comment_count>2</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2014-02-03 19:07:01 -0500</bug_when>
    <thetext>Luckily, AllocationExpression is already prepared for performing just one slice of resolving (and potentially do this multiple times).

Test &amp; fix released via http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?h=BETA_JAVA8&amp;id=431e7408b1f322cc72b90589fe7c96489b23e8aa</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2367922</commentid>
    <comment_count>3</comment_count>
    <who name="ANIRBAN CHAKRABORTY">anchakrk</who>
    <bug_when>2014-02-24 18:48:49 -0500</bug_when>
    <thetext>Verified as working for Eclipse + Java 8 RC1 using Kepler SR1 + Eclipse Java Development Tools Patch for Java 8 Support (BETA) 1.0.0.v20140220-2054</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>