<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>462790</bug_id>
          
          <creation_ts>2015-03-22 12:20:00 -0400</creation_ts>
          <short_desc>[null] NPE in Expression.computeConversion()</short_desc>
          <delta_ts>2015-04-23 23:59:36 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>4.5</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          <see_also>https://git.eclipse.org/r/45338</see_also>
    
    <see_also>https://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=004dbdfe97c4edd7611fb5b108326e4d3f2665ed</see_also>
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>4.5 M7</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Stephan Herrmann">stephan.herrmann</reporter>
          <assigned_to name="Stephan Herrmann">stephan.herrmann</assigned_to>
          <cc>manpalat</cc>
    
    <cc>tom.vandenberge</cc>
          
          <votes>1</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2535540</commentid>
    <comment_count>0</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2015-03-22 12:20:23 -0400</bug_when>
    <thetext>(In reply to Tom van den Berge from comment #6)
&gt; I&apos;m getting the same stack trace with Eclipse SDK 4.5M6. In my case, it
&gt; seems have something to do with null annotations and/or generics. I managed
&gt; to isolate the problem in the following code:
&gt; 
&gt; @NonNullByDefault
&gt; public class EclipseBug {
&gt; 
&gt; 	public void method(Class&lt;? extends String&gt; commandType) {
&gt; 		String command = (String)getCommand(commandType);
&gt; 	}
&gt; 	
&gt; 	public static &lt;T extends String&gt; T getCommand(Class&lt;T&gt; commandType) {
&gt; 		try {
&gt; 			return commandType.newInstance();
&gt; 		} catch (InstantiationException | IllegalAccessException e) {
&gt; 			throw new RuntimeException();
&gt; 		}
&gt; 	}
&gt; }
&gt; 
&gt; Compiling this class results in mentioned stack trace, and makes that I
&gt; can&apos;t compile my project anymore. This problem didn&apos;t occur in Eclipse 4.4
&gt; though.

I can reproduce the following exception:

java.lang.NullPointerException
        at org.eclipse.jdt.internal.compiler.ast.Expression.computeConversion(Expression.java:672)
        at org.eclipse.jdt.internal.compiler.ast.MessageSend.computeConversion(MessageSend.java:409)
        at org.eclipse.jdt.internal.compiler.ast.CastExpression.resolveType(CastExpression.java:562)
        at org.eclipse.jdt.internal.compiler.ast.LocalDeclaration.resolve(LocalDeclaration.java:252)
        at org.eclipse.jdt.internal.compiler.ast.AbstractMethodDeclaration.resolveStatements(AbstractMethodDeclaration.java:639)
        at org.eclipse.jdt.internal.compiler.ast.MethodDeclaration.resolveStatements(MethodDeclaration.java:307)
        at org.eclipse.jdt.internal.compiler.ast.AbstractMethodDeclaration.resolve(AbstractMethodDeclaration.java:549)
        at org.eclipse.jdt.internal.compiler.ast.TypeDeclaration.resolve(TypeDeclaration.java:1188)
        at org.eclipse.jdt.internal.compiler.ast.TypeDeclaration.resolve(TypeDeclaration.java:1301)
        at org.eclipse.jdt.internal.compiler.ast.CompilationUnitDeclaration.resolve(CompilationUnitDeclaration.java:590)
        at org.eclipse.jdt.internal.compiler.Compiler.process(Compiler.java:803)
        at org.eclipse.jdt.internal.compiler.ProcessTaskManager.run(ProcessTaskManager.java:141)
        at java.lang.Thread.run(Thread.java:745)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2542601</commentid>
    <comment_count>1</comment_count>
    <who name="Eclipse Genie">genie</who>
    <bug_when>2015-04-06 16:10:19 -0400</bug_when>
    <thetext>New Gerrit change created: https://git.eclipse.org/r/45338</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2542603</commentid>
    <comment_count>2</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2015-04-06 16:15:02 -0400</bug_when>
    <thetext>(In reply to Eclipse Genie from comment #1)
&gt; New Gerrit change created: https://git.eclipse.org/r/45338

This change addresses the NPE by slightly extending the solution from bug 418041:

When creating a CaptureBinding with type annotations we first create its unannotated version, but that poor guy was never subject to initializeBounds(). The solution in bug 418041 provides a mechanism for propagating firstBound/superclass/superInterfaces from an unannotated type to its annotated variants, which, however, missed the direction from an annotated capture to its unannotated version. This is where the change steps in.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2542636</commentid>
    <comment_count>3</comment_count>
    <who name="Eclipse Genie">genie</who>
    <bug_when>2015-04-06 18:29:52 -0400</bug_when>
    <thetext>Gerrit change https://git.eclipse.org/r/45338 was merged to [master].
Commit: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=004dbdfe97c4edd7611fb5b108326e4d3f2665ed</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2542637</commentid>
    <comment_count>4</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2015-04-06 18:30:50 -0400</bug_when>
    <thetext>.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2551051</commentid>
    <comment_count>5</comment_count>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2015-04-23 23:59:36 -0400</bug_when>
    <thetext>Verified for Eclipse 4.5 Mars M7 Build id: I20150422-1000</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>