<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>429110</bug_id>
          
          <creation_ts>2014-02-26 03:22:00 -0500</creation_ts>
          <short_desc>[1.8][quick fix] Hovering over the error does not show the quick fix</short_desc>
          <delta_ts>2014-03-07 02:27:50 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>4.4</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>BETA J8</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Noopur Gupta">noopur_gupta</reporter>
          <assigned_to name="Markus Keller">markus_keller</assigned_to>
          <cc>daniel_megert</cc>
    
    <cc>manju656</cc>
    
    <cc>markus_keller</cc>
    
    <cc>sarika.sinha</cc>
    
    <cc>srikanth_sankaran</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2368591</commentid>
    <comment_count>0</comment_count>
    <who name="Noopur Gupta">noopur_gupta</who>
    <bug_when>2014-02-26 03:22:05 -0500</bug_when>
    <thetext>Copied from bug 427122 comment #9:

When the Java project was on 1.6, hovering over the error marker on @NonNull did not show the Quick Fix for the below scenario:
package test1;

import java.lang.annotation.ElementType;
import java.lang.annotation.Target;
import java.util.List;

public class CheckCompiler {
	@Target(ElementType.TYPE_USE)
	static @interface NonNull { }

	List&lt;@NonNull String&gt; foo(List&lt;@NonNull String&gt; arg) {
		return arg;
	}
}

If we use &quot;Ctrl+1&apos; to invoke the Quick Fix, then the fix was available.
On analysis found that, when we invoke Quick Fix(Ctrl+1) JavaCorrectionProcessor#computeQuickAssistProposals is invoked which collects all the problem ids and suggest the proposal, but when we hover JavaCorrectionProcessor#collectCorrections is invoked with just one problem Id and that id (IProblem.DisallowedTargetForAnnotation) we are suppressing currently.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2368674</commentid>
    <comment_count>1</comment_count>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2014-02-26 06:05:53 -0500</bug_when>
    <thetext>Moving to JDT Core. The issue is that for each @NonNull reference, we have:

Multiple markers at this line
- The annotation @CheckCompiler.NonNull is disallowed for this location (IProblem.DisallowedTargetForAnnotation)
- Syntax error, type annotations are available only when source level is at 
	 least 1.8
(IProblem.InvalidUsageOfTypeAnnotations)

We have a quick fix for the second problem, but none for the first problem.
The two problems have the same source range, and the hover only shows the first problem, for which we don&apos;t have a quick fix.

The compiler should not report DisallowedTargetForAnnotation in this case, since it can&apos;t really judge that in the presence of a syntax error.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2368679</commentid>
    <comment_count>2</comment_count>
      <attachid>240324</attachid>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2014-02-26 06:15:47 -0500</bug_when>
    <thetext>Created attachment 240324
proposed fix</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2369099</commentid>
    <comment_count>3</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2014-02-26 20:08:40 -0500</bug_when>
    <thetext>Thanks for the patch, I&apos;ll review and release later this week.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2369180</commentid>
    <comment_count>4</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2014-02-27 03:50:48 -0500</bug_when>
    <thetext>(In reply to Markus Keller from comment #1)

&gt; The compiler should not report DisallowedTargetForAnnotation in this case,
&gt; since it can&apos;t really judge that in the presence of a syntax error.

Yes, it can. When compiling in 1.7 mode, it is not that the compiler forgets
all about Java 8. Otherwise we would just report syntax error and say nothing
about type annotations. I guess you are talking about the case of recovered
annotations ? That is not in picture here.

I agree with the proposed patch - the secondary error is not useful and comes
in the way - Thanks for the fix Markus.

I released it with a test here: 

http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?h=BETA_JAVA8&amp;id=6afa93473446fb2c6b874f92c72045670997535f</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2372824</commentid>
    <comment_count>5</comment_count>
    <who name="Sarika Sinha">sarika.sinha</who>
    <bug_when>2014-03-07 02:27:50 -0500</bug_when>
    <thetext>Verified as working for Eclipse + Java 8 RC2 using Kepler SR2 +   
Eclipse Java Development Tools Patch for Java 8 Support (BETA)
1.0.0.v20140306-1935</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>240324</attachid>
            <date>2014-02-26 06:15:00 -0500</date>
            <delta_ts>2014-02-26 06:15:47 -0500</delta_ts>
            <desc>proposed fix</desc>
            <filename>eclipse.jdt.core.patch</filename>
            <type>text/plain</type>
            <size>665</size>
            <attacher name="Markus Keller">markus_keller</attacher>
            
              <data encoding="base64">IyMjIEVjbGlwc2UgV29ya3NwYWNlIFBhdGNoIDEuMAojUCBvcmcuZWNsaXBzZS5qZHQuY29yZQpk
aWZmIC0tZ2l0IGNvbXBpbGVyL29yZy9lY2xpcHNlL2pkdC9pbnRlcm5hbC9jb21waWxlci9hc3Qv
QW5ub3RhdGlvbi5qYXZhIGNvbXBpbGVyL29yZy9lY2xpcHNlL2pkdC9pbnRlcm5hbC9jb21waWxl
ci9hc3QvQW5ub3RhdGlvbi5qYXZhCmluZGV4IDA0NGUxZDUuLjgwYmUzNDUgMTAwNjQ0Ci0tLSBj
b21waWxlci9vcmcvZWNsaXBzZS9qZHQvaW50ZXJuYWwvY29tcGlsZXIvYXN0L0Fubm90YXRpb24u
amF2YQorKysgY29tcGlsZXIvb3JnL2VjbGlwc2UvamR0L2ludGVybmFsL2NvbXBpbGVyL2FzdC9B
bm5vdGF0aW9uLmphdmEKQEAgLTkwMSw2ICs5MDEsMTAgQEAKIAkJCQkJLy8ganNyIDMwOAogCQkJ
CQlyZXR1cm4gdHJ1ZTsKIAkJCQl9CisJCQkJaWYgKHNjb3BlLmNvbXBpbGVyT3B0aW9ucygpLnNv
dXJjZUxldmVsIDwgQ2xhc3NGaWxlQ29uc3RhbnRzLkpESzFfOCkgeworCQkJCQkvLyBhbHJlYWR5
IHJlcG9ydGVkIGFzIHN5bnRheCBlcnJvcjsgZG9uJ3QgcmVwb3J0IHNlY29uZGFyeSBwcm9ibGVt
cworCQkJCQlyZXR1cm4gdHJ1ZTsKKwkJCQl9CiAJCQkJYnJlYWs7CiAJCQljYXNlIEJpbmRpbmcu
VFlQRSA6CiAJCQljYXNlIEJpbmRpbmcuR0VORVJJQ19UWVBFIDo=
</data>

          </attachment>
      

    </bug>

</bugzilla>