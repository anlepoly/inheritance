<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>460008</bug_id>
          
          <creation_ts>2015-02-16 06:58:00 -0500</creation_ts>
          <short_desc>[formatter] Inserts wrong line breaks on ASTRewrite (Extract Constant, Extract Local Variable)</short_desc>
          <delta_ts>2015-02-23 07:56:41 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>4.5</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>4.5 M6</target_milestone>
          <dependson>303519</dependson>
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Markus Keller">markus_keller</reporter>
          <assigned_to name="Markus Keller">markus_keller</assigned_to>
          <cc>manpalat</cc>
    
    <cc>markus_keller</cc>
    
    <cc>mateusz.matela</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2519270</commentid>
    <comment_count>0</comment_count>
      <attachid>250823</attachid>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2015-02-16 06:58:48 -0500</bug_when>
    <thetext>Created attachment 250823
FormatterTest project

With the formatter settings in the attached project, apply Extract Constant or Extract Local Variable to the integer literals &apos;1&apos; here:

public class MyTest {
	int i= 1;
	
	{
		if (hashCode() == 1) {
			
		}
	}
}

Result has too many line breaks:

public class MyTest {
	private static final int _1= 1;

	int i= _1
;
	
	{
		int j= 1;

		if (hashCode() == j
) {
			
		}
	}
}</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2519463</commentid>
    <comment_count>1</comment_count>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2015-02-16 11:58:27 -0500</bug_when>
    <thetext>The problem is that the the formatter now appends a line break when formatting CodeFormatter.K_EXPRESSION, K_STATEMENTS, and K_CLASS_BODY_DECLARATIONS kinds when &quot;insert_new_line_at_end_of_file_if_missing&quot; is set to &quot;insert&quot;.

This bug makes refactorings unusable when that option is enabled. I&apos;ll fix it for tomorrow&apos;s I-build.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2519488</commentid>
    <comment_count>2</comment_count>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2015-02-16 12:42:08 -0500</bug_when>
    <thetext>Fixed with http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=51017f7d8c9ef0baaf841def4e614f01aa0f81d6</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2522382</commentid>
    <comment_count>3</comment_count>
    <who name="Markus Keller">markus_keller</who>
    <bug_when>2015-02-23 07:56:41 -0500</bug_when>
    <thetext>Verified in I20150217-0800.</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="0"
              isprivate="0"
          >
            <attachid>250823</attachid>
            <date>2015-02-16 06:58:00 -0500</date>
            <delta_ts>2015-02-16 06:58:48 -0500</delta_ts>
            <desc>FormatterTest project</desc>
            <filename>FormatterTest.zip</filename>
            <type>image/zip</type>
            <size>4118</size>
            <attacher name="Markus Keller">markus_keller</attacher>
            
              <data encoding="base64">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
AAAAAAAAAAAAAAAAAAAARm9ybWF0dGVyVGVzdC8uY2xhc3NwYXRoUEsBAhQAFAAICAgAEmRQRoVA
1gPBAAAAhQEAABYAAAAAAAAAAAAAAAAA/AAAAEZvcm1hdHRlclRlc3QvLnByb2plY3RQSwECFAAU
AAgICAAqZFBGnVA2CTUJAACBYAAAMgAAAAAAAAAAAAAAAAABAgAARm9ybWF0dGVyVGVzdC8uc2V0
dGluZ3Mvb3JnLmVjbGlwc2UuamR0LmNvcmUucHJlZnNQSwECFAAUAAgICAAqZFBGQ7rt+10AAABw
AAAAMAAAAAAAAAAAAAAAAACWCwAARm9ybWF0dGVyVGVzdC8uc2V0dGluZ3Mvb3JnLmVjbGlwc2Uu
amR0LnVpLnByZWZzUEsBAhQAFAAICAgAEGZQRqdxz/TyAAAAPgEAAB4AAAAAAAAAAAAAAAAAUQwA
AEZvcm1hdHRlclRlc3QvYmluL015VGVzdC5jbGFzc1BLAQIUABQACAgIABBmUEYbJpWQRwAAAFUA
AAAdAAAAAAAAAAAAAAAAAI8NAABGb3JtYXR0ZXJUZXN0L3NyYy9NeVRlc3QuamF2YVBLBQYAAAAA
BgAGAN8BAAAhDgAAAAA=
</data>

          </attachment>
      

    </bug>

</bugzilla>