<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>463526</bug_id>
          
          <creation_ts>2015-03-30 19:30:00 -0400</creation_ts>
          <short_desc>Parenthesis are incorrectly allowed in lambda when LambdaBody is an expression statement</short_desc>
          <delta_ts>2015-04-24 08:51:37 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>4.4.2</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>4.5 M7</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Benjamin Horstman">bhorstman</reporter>
          <assigned_to name="Sasikanth Bharadwaj">saammana</assigned_to>
          <cc>jarthana</cc>
    
    <cc>manpalat</cc>
    
    <cc>shankhba</cc>
    
    <cc>stephan.herrmann</cc>
          
          <votes>0</votes>

      

      

      <flag name="review"
          id="64429"
          type_id="1"
          status="+"
          setter="jarthana"
    />

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2539706</commentid>
    <comment_count>0</comment_count>
      <attachid>252018</attachid>
    <who name="Benjamin Horstman">bhorstman</who>
    <bug_when>2015-03-30 19:30:20 -0400</bug_when>
    <thetext>Created attachment 252018
Fails with javac 1.8.0._20; no errors with eclipse 4.4.2

I found a case where javac won&apos;t compile a class, but eclipse compiles without errors.  The file is attached as Test.java.  

Compiling with javac 1.8.0_20 produces:
Test.java:6: error: method accept in class Receiver cannot be applied to given types;
        r.accept((l) -&gt; (doItOnTheClass(new Object())));
         ^
  required: Listener
  found: (l)-&gt;(doIt[...]t()))
  reason: argument mismatch; bad return type in lambda expression
      missing return value
1 error

Removing the parenthesis around &apos;doItOnTheClass(...)&apos; allows the code to compile in eclipse and javac.  

---

I am not a JLS expert, but my guess is that javac is correct, based on:

From JLS 15.27.3 Type of a Lambda Expression:
* If the function type&apos;s result is void, the lambda body is either a statement expression (14.8) or a void-compatible block.

Per JLS 14.8 Expression Statements, it is not legal to parenthesize a method invocation expression in a statement context:
* System.out.println(&quot;Hello world&quot;);  // OK
* (System.out.println(&quot;Hello world&quot;));  // illegal

Thanks!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2539714</commentid>
    <comment_count>1</comment_count>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2015-03-30 20:13:15 -0400</bug_when>
    <thetext>Sasi: Please take this forward</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2542848</commentid>
    <comment_count>2</comment_count>
    <who name="Sasikanth Bharadwaj">saammana</who>
    <bug_when>2015-04-07 07:25:33 -0400</bug_when>
    <thetext>You are right that ParenthesizedExpression should not be allowed as the body of a void compatible lambda. The reason for this behavior is that the compiler never sees a ParenthesizedExpression as the body of the LambdaExpression. Expressions have the bit ASTNode.ParenthesizedMASK set to indicate that they were parenthesized and this should be checked when answering statementExpression() by MessageSend, AllocationExpression &amp; Assignment. Change under test</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2544595</commentid>
    <comment_count>3</comment_count>
    <who name="Sasikanth Bharadwaj">saammana</who>
    <bug_when>2015-04-10 02:25:20 -0400</bug_when>
    <thetext>Jay, could you please take a look at the change at https://git.eclipse.org/r/45364.

Thanks</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2544732</commentid>
    <comment_count>4</comment_count>
    <who name="Jay Arthanareeswaran">jarthana</who>
    <bug_when>2015-04-10 05:31:57 -0400</bug_when>
    <thetext>(In reply to Sasikanth Bharadwaj from comment #3)
&gt; Jay, could you please take a look at the change at
&gt; https://git.eclipse.org/r/45364.
&gt; 
&gt; Thanks

Short and nice. Looks good to me.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2545368</commentid>
    <comment_count>5</comment_count>
    <who name="Sasikanth Bharadwaj">saammana</who>
    <bug_when>2015-04-13 02:01:15 -0400</bug_when>
    <thetext>(In reply to comment #4)
&gt; (In reply to Sasikanth Bharadwaj from comment #3)
&gt; &gt; Jay, could you please take a look at the change at
&gt; &gt; https://git.eclipse.org/r/45364.
&gt; &gt;
&gt; &gt; Thanks
&gt; 
&gt; Short and nice. Looks good to me.

Thanks Jay. Released via

http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=0ad09336754551fa665fa4c38447a25fd2dacf4e</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2551367</commentid>
    <comment_count>6</comment_count>
    <who name="shankha banerjee">shankhba</who>
    <bug_when>2015-04-24 08:51:37 -0400</bug_when>
    <thetext>Verified for 4.5M7 using I20150421-0800 build.</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="0"
              isprivate="0"
          >
            <attachid>252018</attachid>
            <date>2015-03-30 19:30:00 -0400</date>
            <delta_ts>2015-03-30 19:30:20 -0400</delta_ts>
            <desc>Fails with javac 1.8.0._20; no errors with eclipse 4.4.2</desc>
            <filename>Test.java</filename>
            <type>text/x-java</type>
            <size>473</size>
            <attacher name="Benjamin Horstman">bhorstman</attacher>
            
              <data encoding="base64">cHVibGljIGNsYXNzIFRlc3QgewoKICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBtYWluKFN0cmluZ1td
IGFyZ3MpIHsKICAgICAgICBSZWNlaXZlciByID0gbmV3IFJlY2VpdmVyKCk7CgogICAgICAgIHIu
YWNjZXB0KChsKSAtPiAoZG9JdE9uVGhlQ2xhc3MobmV3IE9iamVjdCgpKSkpOwogICAgfQoKICAg
IHB1YmxpYyBzdGF0aWMgdm9pZCBkb0l0T25UaGVDbGFzcyhPYmplY3QgbykgewogICAgICAgIFN5
c3RlbS5vdXQucHJpbnRsbigiZG9uZSBpdCIpOwogICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgY2xh
c3MgUmVjZWl2ZXIgewogICAgICAgIHB1YmxpYyB2b2lkIGFjY2VwdChMaXN0ZW5lciBsKSB7CiAg
ICAgICAgICAgIGwuZG9JdChuZXcgT2JqZWN0KCkpOwogICAgICAgIH0KICAgIH0KICAgIHB1Ymxp
YyBzdGF0aWMgaW50ZXJmYWNlIExpc3RlbmVyIHsKICAgICAgICBwdWJsaWMgdm9pZCBkb0l0KE9i
amVjdCBvKTsKICAgIH0KfQo=
</data>

          </attachment>
      

    </bug>

</bugzilla>