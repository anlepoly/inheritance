<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>432348</bug_id>
          
          <creation_ts>2014-04-08 16:08:00 -0400</creation_ts>
          <short_desc>[1.8] Internal compiler error (NPE) after upgrade to 1.8</short_desc>
          <delta_ts>2014-11-26 07:39:53 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>4.2</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Mac OS X</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>4.4 M7</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Tom van den Berge">tom.vandenberge</reporter>
          <assigned_to name="Stephan Herrmann">stephan.herrmann</assigned_to>
          <cc>jarthana</cc>
    
    <cc>jigarjm</cc>
    
    <cc>shankhba</cc>
    
    <cc>srikanth_sankaran</cc>
    
    <cc>stephan.herrmann</cc>
    
    <cc>zooi</cc>
          
          <votes>1</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2386508</commentid>
    <comment_count>0</comment_count>
    <who name="Tom van den Berge">tom.vandenberge</who>
    <bug_when>2014-04-08 16:08:27 -0400</bug_when>
    <thetext>I have upgraded my project from Java 1.7 to 1.8, performing the following steps:

1) Select JavaSE-1.8 as system libraray in the build path
2) Set compiler compliance level to 1.8
3) Changed the JDT null annotations library from 1.1.0 to 2.0.0
4) Changed the version of the Java facet to 1.8

Building the project results in a seemingly endless popping up of &apos;Problem occurred&apos; dialogs. In the error log, there is one error that keeps appearing that includes a hopefully useful stacktrace:

Problems occurred when invoking code from plug-in: &quot;org.eclipse.jdt.ui&quot;.
Java Model Exception: java.lang.NullPointerException
	at org.eclipse.jdt.internal.core.CompilationUnitProblemFinder.process(CompilationUnitProblemFinder.java:249)
	at org.eclipse.jdt.internal.core.CompilationUnitProblemFinder.process(CompilationUnitProblemFinder.java:271)
	at org.eclipse.jdt.internal.core.ReconcileWorkingCopyOperation.makeConsistent(ReconcileWorkingCopyOperation.java:191)
	at org.eclipse.jdt.internal.core.ReconcileWorkingCopyOperation.executeOperation(ReconcileWorkingCopyOperation.java:90)
	at org.eclipse.jdt.internal.core.JavaModelOperation.run(JavaModelOperation.java:729)
	at org.eclipse.jdt.internal.core.JavaModelOperation.runOperation(JavaModelOperation.java:789)
	at org.eclipse.jdt.internal.core.CompilationUnit.reconcile(CompilationUnit.java:1247)
	at org.eclipse.jdt.internal.ui.text.java.JavaReconcilingStrategy.reconcile(JavaReconcilingStrategy.java:126)
	at org.eclipse.jdt.internal.ui.text.java.JavaReconcilingStrategy.access$0(JavaReconcilingStrategy.java:108)
	at org.eclipse.jdt.internal.ui.text.java.JavaReconcilingStrategy$1.run(JavaReconcilingStrategy.java:89)
	at org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:42)
	at org.eclipse.jdt.internal.ui.text.java.JavaReconcilingStrategy.reconcile(JavaReconcilingStrategy.java:87)
	at org.eclipse.jdt.internal.ui.text.java.JavaReconcilingStrategy.reconcile(JavaReconcilingStrategy.java:151)
	at org.eclipse.jdt.internal.ui.text.CompositeReconcilingStrategy.reconcile(CompositeReconcilingStrategy.java:86)
	at org.eclipse.jdt.internal.ui.text.JavaCompositeReconcilingStrategy.reconcile(JavaCompositeReconcilingStrategy.java:104)
	at org.eclipse.jface.text.reconciler.MonoReconciler.process(MonoReconciler.java:77)
	at org.eclipse.jface.text.reconciler.AbstractReconciler$BackgroundThread.run(AbstractReconciler.java:206)
Caused by: java.lang.NullPointerException
Caused by: java.lang.NullPointerException

What might be useful to know is that when I skip step 3 (I&apos;m using the 1.1.0 null annotations library), these errors don&apos;t appear, but many errors about null type mismatches appear, which are not there when compiling against 1.7. But then, this might be caused by the illegal (?) combination of java 1.8 and null annotations library 1.1.0 -- I&apos;m not sure.

One final remark: I&apos;ve successfully upgraded other projects to 1.8, which are also using null annotations, but this project is the only one that is using facets. It might have something to do with it.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2386524</commentid>
    <comment_count>1</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2014-04-08 16:36:42 -0400</bug_when>
    <thetext>(In reply to Tom van den Berge from comment #0)
&gt; Caused by: java.lang.NullPointerException
&gt; Caused by: java.lang.NullPointerException

While you still have the log files: could you please paste those root exceptions? The exception you pasted is just a wrapper that doesn&apos;t show the real cause.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2386535</commentid>
    <comment_count>2</comment_count>
    <who name="Tom van den Berge">tom.vandenberge</who>
    <bug_when>2014-04-08 16:57:17 -0400</bug_when>
    <thetext>(In reply to Stephan Herrmann from comment #1)

&gt; While you still have the log files: could you please paste those root
&gt; exceptions? The exception you pasted is just a wrapper that doesn&apos;t show the
&gt; real cause.

I&apos;m afraid there is none. It&apos;s getting worse: I can&apos;t reproduce the stack trace above anymore. I&apos;m only getting NullPointerExceptions without a stacktrace now. Here&apos;s a dump of my log file after doing a build, until the first error popup appears:

!ENTRY org.eclipse.core.resources 4 2 2014-04-08 22:52:07.555
!MESSAGE Problems occurred when invoking code from plug-in: &quot;org.eclipse.core.resources&quot;.
!STACK 0
java.lang.NullPointerException

!ENTRY org.eclipse.core.resources 4 75 2014-04-08 22:52:07.710
!MESSAGE Errors occurred during the build.
!SUBENTRY 1 org.eclipse.jdt.core 4 75 2014-04-08 22:52:07.710
!MESSAGE Errors running builder &apos;Java Builder&apos; on project &apos;DRILLSTER-TRUNK&apos;.
!STACK 0
java.lang.NullPointerException</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2388434</commentid>
    <comment_count>3</comment_count>
    <who name="Tom van den Berge">tom.vandenberge</who>
    <bug_when>2014-04-13 07:13:34 -0400</bug_when>
    <thetext>After performing the same steps, I&apos;m now getting an &quot;Internal compiler error&quot;, including a stack trace. As far as I know, nothing else has changed. I hope this helps finding the cause of the problem.

java.lang.NullPointerException
	at org.eclipse.jdt.internal.compiler.ast.ASTNode.copySE8AnnotationsToType(ASTNode.java:1061)
	at org.eclipse.jdt.internal.compiler.lookup.SourceTypeBinding.resolveTypeFor(SourceTypeBinding.java:1732)
	at org.eclipse.jdt.internal.compiler.lookup.SourceTypeBinding.getField(SourceTypeBinding.java:1152)
	at org.eclipse.jdt.internal.compiler.lookup.Scope.findField(Scope.java:1440)
	at org.eclipse.jdt.internal.compiler.lookup.Scope.findField(Scope.java:1386)
	at org.eclipse.jdt.internal.compiler.lookup.MethodScope.findField(MethodScope.java:419)
	at org.eclipse.jdt.internal.compiler.lookup.BlockScope.getBinding(BlockScope.java:541)
	at org.eclipse.jdt.internal.compiler.ast.QualifiedNameReference.resolveType(QualifiedNameReference.java:998)
	at org.eclipse.jdt.internal.compiler.ast.EqualExpression.resolveType(EqualExpression.java:827)
	at org.eclipse.jdt.internal.compiler.ast.Expression.resolveTypeExpecting(Expression.java:1048)
	at org.eclipse.jdt.internal.compiler.ast.IfStatement.resolve(IfStatement.java:269)
	at org.eclipse.jdt.internal.compiler.ast.AbstractMethodDeclaration.resolveStatements(AbstractMethodDeclaration.java:619)
	at org.eclipse.jdt.internal.compiler.ast.MethodDeclaration.resolveStatements(MethodDeclaration.java:299)
	at org.eclipse.jdt.internal.compiler.ast.AbstractMethodDeclaration.resolve(AbstractMethodDeclaration.java:529)
	at org.eclipse.jdt.internal.compiler.ast.TypeDeclaration.resolve(TypeDeclaration.java:1207)
	at org.eclipse.jdt.internal.compiler.ast.TypeDeclaration.resolve(TypeDeclaration.java:1317)
	at org.eclipse.jdt.internal.compiler.ast.CompilationUnitDeclaration.resolve(CompilationUnitDeclaration.java:587)
	at org.eclipse.jdt.internal.compiler.Compiler.process(Compiler.java:771)
	at org.eclipse.jdt.internal.compiler.ProcessTaskManager.run(ProcessTaskManager.java:137)
	at java.lang.Thread.run(Thread.java:744)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2388467</commentid>
    <comment_count>4</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2014-04-13 12:46:09 -0400</bug_when>
    <thetext>Cool, that stacktrace lets me infer this repro (using 1.8):

import org.eclipse.jdt.annotation.NonNull;

public enum EnumField {
	@NonNull A, B, C
}


Workaround: don&apos;t use type annotations on an enum constant.

Since the fix in bug 411771 enum constant are always recognized as nonnull, no need to use @NonNull...</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2388470</commentid>
    <comment_count>5</comment_count>
    <who name="Tom van den Berge">tom.vandenberge</who>
    <bug_when>2014-04-13 13:34:42 -0400</bug_when>
    <thetext>Ah, that&apos;s great! There was exactly one such enum in my code base. After removing the annotation everything compiles again. Tanks a million!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2388476</commentid>
    <comment_count>6</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2014-04-13 14:02:51 -0400</bug_when>
    <thetext>(In reply to Tom van den Berge from comment #5)
&gt; Ah, that&apos;s great! There was exactly one such enum in my code base. After
&gt; removing the annotation everything compiles again. Tanks a million!

Thanks for confirming that this is also the cause on your system.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2388484</commentid>
    <comment_count>7</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2014-04-13 15:28:38 -0400</bug_when>
    <thetext>Test &amp; fix released for 4.4 M7 via http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=54adf8874a2139df84e504710c736c699ecdc8bd

Instead of NPE you now get:
   Syntax error, type annotations are illegal here
(because in an enum constant declaration there is not type use to be annotated).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2393904</commentid>
    <comment_count>8</comment_count>
    <who name="shankha banerjee">shankhba</who>
    <bug_when>2014-04-28 08:03:58 -0400</bug_when>
    <thetext>Syntax error with the example in Comment 4, no NPE.


Verified for 4.4 M7 using I20140427-2030 build.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2485195</commentid>
    <comment_count>9</comment_count>
    <who name="Jigar Joshi">jigarjm</who>
    <bug_when>2014-11-18 14:13:37 -0500</bug_when>
    <thetext>I ran into same exception for 

Eclipse Java EE IDE for Web Developers.

Version: Mars Milestone 3 (4.5.0M3)
Build id: 20141113-0320</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2485790</commentid>
    <comment_count>10</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2014-11-19 12:22:29 -0500</bug_when>
    <thetext>(In reply to Jigar Joshi from comment #9)
&gt; I ran into same exception for 
&gt; 
&gt; Eclipse Java EE IDE for Web Developers.
&gt; 
&gt; Version: Mars Milestone 3 (4.5.0M3)
&gt; Build id: 20141113-0320

The exact same exception in 4.5.0M3 would be a big surprise.

Can you please paste your stacktrace?

If you only compared to the stacktrace in comment 0 please search for a &quot;caused by&quot; clause, which is much more useful than the first part of the stacktrace.

If unsure whether the cause really matches the stacktrace from comment 3 please file a new ticket.

TIA</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2485794</commentid>
    <comment_count>11</comment_count>
    <who name="Jigar Joshi">jigarjm</who>
    <bug_when>2014-11-19 12:33:48 -0500</bug_when>
    <thetext>!ENTRY org.eclipse.core.resources 4 2 2014-11-17 13:54:30.035
!MESSAGE Problems occurred when invoking code from plug-in: &quot;org.eclipse.core.resources&quot;.
!STACK 0
java.lang.NullPointerException
	at org.eclipse.jdt.internal.compiler.lookup.ParameterizedGenericMethodBinding.computeCompatibleMethod18(ParameterizedGenericMethodBinding.java:191)
	at org.eclipse.jdt.internal.compiler.lookup.ParameterizedGenericMethodBinding.computeCompatibleMethod(ParameterizedGenericMethodBinding.java:81)
	at org.eclipse.jdt.internal.compiler.lookup.Scope.computeCompatibleMethod(Scope.java:730)
	at org.eclipse.jdt.internal.compiler.lookup.Scope.computeCompatibleMethod(Scope.java:687)
	at org.eclipse.jdt.internal.compiler.lookup.Scope.findMethod0(Scope.java:1619)
	at org.eclipse.jdt.internal.compiler.lookup.Scope.findMethod(Scope.java:1520)
	at org.eclipse.jdt.internal.compiler.lookup.Scope.getMethod(Scope.java:2791)
	at org.eclipse.jdt.internal.compiler.ast.JavadocFieldReference.internalResolveType(JavadocFieldReference.java:86)
	at org.eclipse.jdt.internal.compiler.ast.JavadocFieldReference.resolveType(JavadocFieldReference.java:128)
	at org.eclipse.jdt.internal.compiler.ast.Javadoc.resolveReference(Javadoc.java:386)
	at org.eclipse.jdt.internal.compiler.ast.Javadoc.resolve(Javadoc.java:281)
	at org.eclipse.jdt.internal.compiler.ast.AbstractMethodDeclaration.resolveJavadoc(AbstractMethodDeclaration.java:597)
	at org.eclipse.jdt.internal.compiler.ast.AbstractMethodDeclaration.resolve(AbstractMethodDeclaration.java:524)
	at org.eclipse.jdt.internal.compiler.ast.TypeDeclaration.resolve(TypeDeclaration.java:1207)
	at org.eclipse.jdt.internal.compiler.ast.TypeDeclaration.resolve(TypeDeclaration.java:1311)
	at org.eclipse.jdt.internal.compiler.ast.TypeDeclaration.resolve(TypeDeclaration.java:1106)
	at org.eclipse.jdt.internal.compiler.ast.TypeDeclaration.resolve(TypeDeclaration.java:1320)
	at org.eclipse.jdt.internal.compiler.ast.CompilationUnitDeclaration.resolve(CompilationUnitDeclaration.java:590)
	at org.eclipse.jdt.internal.compiler.Compiler.process(Compiler.java:770)
	at org.eclipse.jdt.internal.compiler.ProcessTaskManager.run(ProcessTaskManager.java:137)
	at java.lang.Thread.run(Thread.java:744)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2485996</commentid>
    <comment_count>12</comment_count>
    <who name="Stephan Herrmann">stephan.herrmann</who>
    <bug_when>2014-11-19 16:58:56 -0500</bug_when>
    <thetext>(In reply to Jigar Joshi from comment #11)
&gt; !ENTRY org.eclipse.core.resources 4 2 2014-11-17 13:54:30.035
&gt; !MESSAGE Problems occurred when invoking code from plug-in:
&gt; &quot;org.eclipse.core.resources&quot;.
&gt; !STACK 0
&gt; java.lang.NullPointerException
&gt; 	at
&gt; org.eclipse.jdt.internal.compiler.lookup.ParameterizedGenericMethodBinding.
&gt; computeCompatibleMethod18(ParameterizedGenericMethodBinding.java:191)


Hm, I don&apos;t see any connection to this current bug.
What you report looks much like bug 451418, which was fixed for M4.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2485998</commentid>
    <comment_count>13</comment_count>
    <who name="Jigar Joshi">jigarjm</who>
    <bug_when>2014-11-19 17:01:17 -0500</bug_when>
    <thetext>Sorry, over-looked it - Thanks!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2486069</commentid>
    <comment_count>14</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2014-11-19 19:28:58 -0500</bug_when>
    <thetext>(In reply to Jigar Joshi from comment #13)
&gt; Sorry, over-looked it - Thanks!

So, are you able to confirm that the problem goes away on master HEAD  ?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2486075</commentid>
    <comment_count>15</comment_count>
    <who name="Jigar Joshi">jigarjm</who>
    <bug_when>2014-11-19 20:12:43 -0500</bug_when>
    <thetext>I downloaded M3 and I was able to reproduce it, I didn&apos;t build from source on HEAD to reproduce it, I can try if it is required ?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2486079</commentid>
    <comment_count>16</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2014-11-19 20:58:28 -0500</bug_when>
    <thetext>(In reply to Jigar Joshi from comment #15)
&gt; I downloaded M3 and I was able to reproduce it, I didn&apos;t build from source
&gt; on HEAD to reproduce it, I can try if it is required ?

No need to build from source, you can grab a nightly build: say:
http://download.eclipse.org/eclipse/downloads/drops4/N20141118-2000/

Alernatelty, if you have a small code snippet that you are able to attach,
we can try it at our end too.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2486101</commentid>
    <comment_count>17</comment_count>
    <who name="Jigar Joshi">jigarjm</who>
    <bug_when>2014-11-19 23:33:04 -0500</bug_when>
    <thetext>I verified on latest available build dated 20141811, it works</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2486102</commentid>
    <comment_count>18</comment_count>
    <who name="Srikanth Sankaran">srikanth_sankaran</who>
    <bug_when>2014-11-19 23:36:04 -0500</bug_when>
    <thetext>(In reply to Jigar Joshi from comment #17)
&gt; I verified on latest available build dated 20141811, it works

Thanks!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2489027</commentid>
    <comment_count>19</comment_count>
    <who name="edbras">zooi</who>
    <bug_when>2014-11-25 17:35:35 -0500</bug_when>
    <thetext>I also just upgraded from 1.7 to 1.8 and get the same error.
I installed 4.5 build I20141125-0800 (25 nov). It&apos;s like the installation has no effect, but Eclipse installation details do show the installed build...

But the errors, still occur, I am not sure, if I am doing something wrong or the build occurs again/still.
The building workspace performs an endless loop.

The software doesn&apos;t contain any compile errors as the compile error that occurred are commented.

The installation details:
 Version: Luna Service Release 1 (4.4.1)
 Build id: 20140925-1800

The log file exception:
Java Model Exception: java.lang.ClassCastException
	at org.eclipse.jdt.internal.core.CompilationUnitProblemFinder.process(CompilationUnitProblemFinder.java:249)
	at org.eclipse.jdt.internal.core.CompilationUnitProblemFinder.process(CompilationUnitProblemFinder.java:271)
	at org.eclipse.jdt.internal.core.ReconcileWorkingCopyOperation.makeConsistent(ReconcileWorkingCopyOperation.java:191)
	at org.eclipse.jdt.internal.core.ReconcileWorkingCopyOperation.executeOperation(ReconcileWorkingCopyOperation.java:90)
	at org.eclipse.jdt.internal.core.JavaModelOperation.run(JavaModelOperation.java:729)
	at org.eclipse.jdt.internal.core.JavaModelOperation.runOperation(JavaModelOperation.java:789)
	at org.eclipse.jdt.internal.core.CompilationUnit.reconcile(CompilationUnit.java:1247)
	at org.eclipse.jdt.internal.ui.text.java.JavaReconcilingStrategy.reconcile(JavaReconcilingStrategy.java:126)
	at org.eclipse.jdt.internal.ui.text.java.JavaReconcilingStrategy.access$0(JavaReconcilingStrategy.java:108)
	at org.eclipse.jdt.internal.ui.text.java.JavaReconcilingStrategy$1.run(JavaReconcilingStrategy.java:89)
	at org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:42)
	at org.eclipse.jdt.internal.ui.text.java.JavaReconcilingStrategy.reconcile(JavaReconcilingStrategy.java:87)
	at org.eclipse.jdt.internal.ui.text.java.JavaReconcilingStrategy.reconcile(JavaReconcilingStrategy.java:151)
	at org.eclipse.jdt.internal.ui.text.CompositeReconcilingStrategy.reconcile(CompositeReconcilingStrategy.java:86)
	at org.eclipse.jdt.internal.ui.text.JavaCompositeReconcilingStrategy.reconcile(JavaCompositeReconcilingStrategy.java:104)
	at org.eclipse.jface.text.reconciler.MonoReconciler.process(MonoReconciler.java:77)
	at org.eclipse.jface.text.reconciler.AbstractReconciler$BackgroundThread.run(AbstractReconciler.java:206)
Caused by: java.lang.ClassCastException
Caused by: java.lang.ClassCastException</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2489210</commentid>
    <comment_count>20</comment_count>
    <who name="edbras">zooi</who>
    <bug_when>2014-11-26 07:39:53 -0500</bug_when>
    <thetext>I just installed a brand new Luna EE download, re-installed the plugins, and it seems to work fine now
(expect that I notice maven compiler errors that aren&apos;t showing up in Eclipse, but that&apos;s another problem).</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>