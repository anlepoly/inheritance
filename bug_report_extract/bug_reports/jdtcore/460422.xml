<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>460422</bug_id>
          
          <creation_ts>2015-02-20 05:14:00 -0500</creation_ts>
          <short_desc>IllegalStateException: Bad AST node structure at ASTConverter</short_desc>
          <delta_ts>2015-03-18 02:58:14 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>2</classification_id>
          <classification>Eclipse</classification>
          <product>JDT</product>
          <component>Core</component>
          <version>4.5</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>4.5 M6</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Noopur Gupta">noopur_gupta</reporter>
          <assigned_to name="Manoj Palat Away Until May 11 2015">manpalat</assigned_to>
          <cc>manpalat</cc>
    
    <cc>markus_keller</cc>
    
    <cc>saammana</cc>
          
          <votes>0</votes>

      

      

      <flag name="review"
          id="64246"
          type_id="1"
          status="+"
          setter="saammana"
    />

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2521541</commentid>
    <comment_count>0</comment_count>
    <who name="Noopur Gupta">noopur_gupta</who>
    <bug_when>2015-02-20 05:14:42 -0500</bug_when>
    <thetext>- In Debug configurations, enable Tracing for org.eclipse.jdt.core.
- Check &quot;debug&quot; and &quot;debug/dom/ast&quot; on the right pane.
- Click Apply and Debug.
- Paste the code snippet from the error message below to Package explorer.
- Edit the file. Following exception is logged in Error Log view:

eclipse.buildId=4.5.0.N20150216-2000
java.version=1.8.0
java.vendor=Oracle Corporation
BootLoader constants: OS=win32, ARCH=x86_64, WS=win32, NL=en_US
Framework arguments:  -product org.eclipse.sdk.ide
Command-line arguments:  -product org.eclipse.sdk.ide -data C:\ProjectWork\Workspace6/../runtime-J8 -dev file:C:/ProjectWork/Workspace6/.metadata/.plugins/org.eclipse.pde.core/Runtime-J8/dev.properties -debug C:\ProjectWork\Workspace6\.metadata\.plugins\org.eclipse.pde.core\Runtime-J8/.options -os win32 -ws win32 -arch x86_64 -consoleLog

org.eclipse.jdt.core
Error
Fri Feb 20 13:20:27 IST 2015
Bad AST node structure:
- parent [75, 119] org.eclipse.jdt.core.dom.EnumConstantDeclaration
   arguments [109, 120] org.eclipse.jdt.core.dom.ArrayCreation

----------------------------------- SOURCE BEGIN -------------------------------------
package p1;

public enum TestEnum {

    FIRST_ENUM(&quot;a&quot;, null),

    FOURTH_ENUM(&quot;b&quot;,
                new X[] { });

	private TestEnum(String s, Object o) {
	}
}


class X {
	Runnable r= new R 
	
}
----------------------------------- SOURCE END -------------------------------------

java.lang.IllegalStateException: Bad AST node structure
	at org.eclipse.jdt.core.dom.ASTConverter.convert(ASTConverter.java:1419)
	at org.eclipse.jdt.core.dom.AST.convertCompilationUnit(AST.java:270)
	at org.eclipse.jdt.internal.core.CompilationUnit.buildStructure(CompilationUnit.java:202)
	at org.eclipse.jdt.internal.core.Openable.generateInfos(Openable.java:259)
	at org.eclipse.jdt.internal.core.JavaElement.openWhenClosed(JavaElement.java:579)
	at org.eclipse.jdt.internal.core.CompilationUnit.makeConsistent(CompilationUnit.java:1085)
	at org.eclipse.jdt.internal.core.ReconcileWorkingCopyOperation.makeConsistent(ReconcileWorkingCopyOperation.java:171)
	at org.eclipse.jdt.internal.core.ReconcileWorkingCopyOperation.executeOperation(ReconcileWorkingCopyOperation.java:90)
	at org.eclipse.jdt.internal.core.JavaModelOperation.run(JavaModelOperation.java:729)
	at org.eclipse.jdt.internal.core.JavaModelOperation.runOperation(JavaModelOperation.java:789)
	at org.eclipse.jdt.internal.core.CompilationUnit.reconcile(CompilationUnit.java:1250)
	at org.eclipse.jdt.internal.ui.text.java.JavaReconcilingStrategy.reconcile(JavaReconcilingStrategy.java:126)
	at org.eclipse.jdt.internal.ui.text.java.JavaReconcilingStrategy.access$0(JavaReconcilingStrategy.java:108)
	at org.eclipse.jdt.internal.ui.text.java.JavaReconcilingStrategy$1.run(JavaReconcilingStrategy.java:89)
	at org.eclipse.core.runtime.SafeRunner.run(SafeRunner.java:42)
	at org.eclipse.jdt.internal.ui.text.java.JavaReconcilingStrategy.reconcile(JavaReconcilingStrategy.java:87)
	at org.eclipse.jdt.internal.ui.text.java.JavaReconcilingStrategy.reconcile(JavaReconcilingStrategy.java:151)
	at org.eclipse.jdt.internal.ui.text.CompositeReconcilingStrategy.reconcile(CompositeReconcilingStrategy.java:86)
	at org.eclipse.jdt.internal.ui.text.JavaCompositeReconcilingStrategy.reconcile(JavaCompositeReconcilingStrategy.java:104)
	at org.eclipse.jface.text.reconciler.MonoReconciler.process(MonoReconciler.java:77)
	at org.eclipse.jface.text.reconciler.AbstractReconciler$BackgroundThread.run(AbstractReconciler.java:206)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2522931</commentid>
    <comment_count>1</comment_count>
      <attachid>251063</attachid>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2015-02-24 06:47:00 -0500</bug_when>
    <thetext>Created attachment 251063
Proposed Patch

The issue is with the assignment of declarationSourceEnd propagated from Recovery parser in the RecoveredField.java. The updateSourcePosition need to assign the end of the brace and not one below.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2522933</commentid>
    <comment_count>2</comment_count>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2015-02-24 06:49:44 -0500</bug_when>
    <thetext>Sasi: since this is in recovery parser, could you please review this change?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2523359</commentid>
    <comment_count>3</comment_count>
    <who name="Sasikanth Bharadwaj">saammana</who>
    <bug_when>2015-02-25 03:42:36 -0500</bug_when>
    <thetext>(In reply to comment #2)
&gt; Sasi: since this is in recovery parser, could you please review this change?
Looks fine to me</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2523944</commentid>
    <comment_count>4</comment_count>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2015-02-25 19:05:03 -0500</bug_when>
    <thetext>(In reply to Sasikanth Bharadwaj from comment #3)
Thanks Sasi. Fix committed via: http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/?id=e23731bfbef54b7b257bcd8302a58a01db83c05d</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2523946</commentid>
    <comment_count>5</comment_count>
    <who name="Manoj Palat Away Until May 11 2015">manpalat</who>
    <bug_when>2015-02-25 19:05:52 -0500</bug_when>
    <thetext>(In reply to Manoj Palat from comment #4)
&gt; (In reply to Sasikanth Bharadwaj from comment #3)
&gt; Thanks Sasi. Fix committed via:
&gt; http://git.eclipse.org/c/jdt/eclipse.jdt.core.git/commit/
&gt; ?id=e23731bfbef54b7b257bcd8302a58a01db83c05d

Fixed</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2533347</commentid>
    <comment_count>6</comment_count>
    <who name="Sasikanth Bharadwaj">saammana</who>
    <bug_when>2015-03-18 02:58:14 -0400</bug_when>
    <thetext>Verified for 4.5 M6 using I20150316-2000 build</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>251063</attachid>
            <date>2015-02-24 06:47:00 -0500</date>
            <delta_ts>2015-02-24 06:47:00 -0500</delta_ts>
            <desc>Proposed Patch</desc>
            <filename>Fix-for-Bug-460422-IllegalStateException-Bad-AST-nod.patch</filename>
            <type>text/plain</type>
            <size>3204</size>
            <attacher name="Manoj Palat Away Until May 11 2015">manpalat</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3NyYy9vcmcvZWNs
aXBzZS9qZHQvY29yZS90ZXN0cy9kb20vQVNUQ29udmVydGVyMTVUZXN0LmphdmEgYi9vcmcuZWNs
aXBzZS5qZHQuY29yZS50ZXN0cy5tb2RlbC9zcmMvb3JnL2VjbGlwc2UvamR0L2NvcmUvdGVzdHMv
ZG9tL0FTVENvbnZlcnRlcjE1VGVzdC5qYXZhCmluZGV4IDkwNjkzZDcuLmI4NjZjODkgMTAwNjQ0
Ci0tLSBhL29yZy5lY2xpcHNlLmpkdC5jb3JlLnRlc3RzLm1vZGVsL3NyYy9vcmcvZWNsaXBzZS9q
ZHQvY29yZS90ZXN0cy9kb20vQVNUQ29udmVydGVyMTVUZXN0LmphdmEKKysrIGIvb3JnLmVjbGlw
c2UuamR0LmNvcmUudGVzdHMubW9kZWwvc3JjL29yZy9lY2xpcHNlL2pkdC9jb3JlL3Rlc3RzL2Rv
bS9BU1RDb252ZXJ0ZXIxNVRlc3QuamF2YQpAQCAtMSw1ICsxLDUgQEAKIC8qKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqCi0gKiBDb3B5cmlnaHQgKGMpIDIwMDAsIDIwMTQgSUJNIENvcnBvcmF0aW9uIGFu
ZCBvdGhlcnMuCisgKiBDb3B5cmlnaHQgKGMpIDIwMDAsIDIwMTUgSUJNIENvcnBvcmF0aW9uIGFu
ZCBvdGhlcnMuCiAgKiBBbGwgcmlnaHRzIHJlc2VydmVkLiBUaGlzIHByb2dyYW0gYW5kIHRoZSBh
Y2NvbXBhbnlpbmcgbWF0ZXJpYWxzCiAgKiBhcmUgbWFkZSBhdmFpbGFibGUgdW5kZXIgdGhlIHRl
cm1zIG9mIHRoZSBFY2xpcHNlIFB1YmxpYyBMaWNlbnNlIHYxLjAKICAqIHdoaWNoIGFjY29tcGFu
aWVzIHRoaXMgZGlzdHJpYnV0aW9uLCBhbmQgaXMgYXZhaWxhYmxlIGF0CkBAIC0xMTU2Niw0ICsx
MTU2NiwyOCBAQAogCQlhc3NlcnRUcnVlKHR5cGUuaXNRdWFsaWZpZWRUeXBlKCkpOwogCQlhc3Nl
cnRUcnVlKGlzTWFsZm9ybWVkKHR5cGUpKTsKIAl9CisJLy8gaHR0cHM6Ly9idWdzLmVjbGlwc2Uu
b3JnL2J1Z3Mvc2hvd19idWcuY2dpP2lkPTQ2MDQyMgorCXB1YmxpYyB2b2lkIHRlc3RCdWc0NjA0
MjIoKSB0aHJvd3MgSmF2YU1vZGVsRXhjZXB0aW9uIHsKKwkJU3RyaW5nIHN0ciA9CisJCQkJImVu
dW0gVGVzdEVudW0ge1xuIiArCisJCQkJIlxuIiArCisJCQkJIiAgICBGSVJTVF9FTlVNKFwiYVwi
LCBudWxsKSxcbiIgKworCQkJCSIgICAgXG4iICsKKwkJCQkiICAgIEZPVVJUSF9FTlVNKFwiYlwi
LCBuZXcgWFtdIHsgfSk7XG4iICsKKwkJCQkiXG4iICsKKwkJCQkiCXByaXZhdGUgVGVzdEVudW0o
U3RyaW5nIHMsIE9iamVjdCBvKSB7fVxuIiArCisJCQkJIn1cbiIgKworCQkJCSIgcHVibGljIGNs
YXNzIFgge1xuIiArCisJCQkJIgkgICAgICAgICAgUnVubmFibGUgcj0gbmV3IFIgIFxuIiArIC8v
IGVycm9yIGludGVuZGVkCisJCQkJIn1cbiI7CisJCXRoaXMud29ya2luZ0NvcHkgPSBnZXRXb3Jr
aW5nQ29weSgiL0NvbnZlcnRlcjE1L3NyYy9YLmphdmEiLCB0cnVlLypyZXNvbHZlKi8pOworCQlB
U1ROb2RlIG5vZGUgPSBidWlsZEFTVChzdHIsdGhpcy53b3JraW5nQ29weSwgZmFsc2UpOworCisJ
CWFzc2VydE5vdE51bGwoIk5vIG5vZGUiLCBub2RlKTsKKwkJYXNzZXJ0RXF1YWxzKCJOb3QgYSBj
b21waWxhdGlvbiB1bml0IiwgQVNUTm9kZS5DT01QSUxBVElPTl9VTklULCBub2RlLmdldE5vZGVU
eXBlKCkpOworCQlDb21waWxhdGlvblVuaXQgY29tcGlsYXRpb25Vbml0ID0gKENvbXBpbGF0aW9u
VW5pdCkgbm9kZTsKKwkJRW51bURlY2xhcmF0aW9uIGVEZWNsID0gKEVudW1EZWNsYXJhdGlvbikg
Y29tcGlsYXRpb25Vbml0LnR5cGVzKCkuZ2V0KDApOworCQlFbnVtQ29uc3RhbnREZWNsYXJhdGlv
biBlYyA9IChFbnVtQ29uc3RhbnREZWNsYXJhdGlvbikgZURlY2wuZW51bUNvbnN0YW50cygpLmdl
dCgxKTsKKwkJY2hlY2tTb3VyY2VSYW5nZShlYywgIkZPVVJUSF9FTlVNKFwiYlwiLCBuZXcgWFtd
IHsgfSIsIHN0cik7IC8vcmVjb3ZlcnkgcGFyc2VyIHByb3BhZ2F0ZWQKKwl9CiB9ClwgTm8gbmV3
bGluZSBhdCBlbmQgb2YgZmlsZQpkaWZmIC0tZ2l0IGEvb3JnLmVjbGlwc2UuamR0LmNvcmUvY29t
cGlsZXIvb3JnL2VjbGlwc2UvamR0L2ludGVybmFsL2NvbXBpbGVyL3BhcnNlci9SZWNvdmVyZWRG
aWVsZC5qYXZhIGIvb3JnLmVjbGlwc2UuamR0LmNvcmUvY29tcGlsZXIvb3JnL2VjbGlwc2UvamR0
L2ludGVybmFsL2NvbXBpbGVyL3BhcnNlci9SZWNvdmVyZWRGaWVsZC5qYXZhCmluZGV4IGFhNTIw
YWUuLmFjZTcxZjQgMTAwNjQ0Ci0tLSBhL29yZy5lY2xpcHNlLmpkdC5jb3JlL2NvbXBpbGVyL29y
Zy9lY2xpcHNlL2pkdC9pbnRlcm5hbC9jb21waWxlci9wYXJzZXIvUmVjb3ZlcmVkRmllbGQuamF2
YQorKysgYi9vcmcuZWNsaXBzZS5qZHQuY29yZS9jb21waWxlci9vcmcvZWNsaXBzZS9qZHQvaW50
ZXJuYWwvY29tcGlsZXIvcGFyc2VyL1JlY292ZXJlZEZpZWxkLmphdmEKQEAgLTEsNSArMSw1IEBA
CiAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKgotICogQ29weXJpZ2h0IChjKSAyMDAwLCAyMDEzIElC
TSBDb3Jwb3JhdGlvbiBhbmQgb3RoZXJzLgorICogQ29weXJpZ2h0IChjKSAyMDAwLCAyMDE1IElC
TSBDb3Jwb3JhdGlvbiBhbmQgb3RoZXJzLgogICogQWxsIHJpZ2h0cyByZXNlcnZlZC4gVGhpcyBw
cm9ncmFtIGFuZCB0aGUgYWNjb21wYW55aW5nIG1hdGVyaWFscwogICogYXJlIG1hZGUgYXZhaWxh
YmxlIHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgRWNsaXBzZSBQdWJsaWMgTGljZW5zZSB2MS4wCiAg
KiB3aGljaCBhY2NvbXBhbmllcyB0aGlzIGRpc3RyaWJ1dGlvbiwgYW5kIGlzIGF2YWlsYWJsZSBh
dApAQCAtMjcxLDcgKzI3MSw3IEBACiAJCXRoaXMuYnJhY2tldEJhbGFuY2UtLTsKIAkJaWYgKHRo
aXMuYnJhY2tldEJhbGFuY2UgPT0gMCkgewogCQkJaWYodGhpcy5maWVsZERlY2xhcmF0aW9uLmdl
dEtpbmQoKSA9PSBBYnN0cmFjdFZhcmlhYmxlRGVjbGFyYXRpb24uRU5VTV9DT05TVEFOVCkgewot
CQkJCXVwZGF0ZVNvdXJjZUVuZElmTmVjZXNzYXJ5KGJyYWNlRW5kIC0gMSk7CisJCQkJdXBkYXRl
U291cmNlRW5kSWZOZWNlc3NhcnkoYnJhY2VFbmQpOwogCQkJCXJldHVybiB0aGlzLnBhcmVudDsK
IAkJCX0gZWxzZSB7CiAJCQkJaWYgKHRoaXMuZmllbGREZWNsYXJhdGlvbi5kZWNsYXJhdGlvblNv
dXJjZUVuZCA+IDAp
</data>

          </attachment>
      

    </bug>

</bugzilla>