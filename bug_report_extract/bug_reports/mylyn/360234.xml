<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>360234</bug_id>
          
          <creation_ts>2011-10-07 10:08:00 -0400</creation_ts>
          <short_desc>R4E Editor navigation for external file has no outline information</short_desc>
          <delta_ts>2012-10-30 15:35:32 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>14</classification_id>
          <classification>Mylyn</classification>
          <product>Mylyn Reviews R4E</product>
          <component>UI</component>
          <version>unspecified</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows Vista</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>INVALID</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jacques Bouthillier">lmcbout</reporter>
          <assigned_to name="Sebastien Dubois">sebastien.dubois</assigned_to>
          <cc>alvsan09</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2006521</commentid>
    <comment_count>0</comment_count>
    <who name="Jacques Bouthillier">lmcbout</who>
    <bug_when>2011-10-07 10:08:46 -0400</bug_when>
    <thetext>How to reproduce:
1- Create a review
2- In Clear Case, check out a file, make some modification 
3- Create a new review item from the checked-out file
4- Un-checked-out the file
5- Open the review item created just before in an editor
--&gt; The &quot;OUTLINE &quot; view does not display anything
--&gt; If you try to navigate from the file in the editor, it doesn&apos;t open the link file, For example, select &quot;String&quot; and press F3 key</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2012549</commentid>
    <comment_count>1</comment_count>
    <who name="Sebastien Dubois">sebastien.dubois</who>
    <bug_when>2011-10-18 15:00:44 -0400</bug_when>
    <thetext>I do not see the problem with the outline view. However, there is a navigatability problem for Java file if the file is a target file that is not in the workspace (i.e. the target is an external file).

What seems to happens is that the CompilationUnit in JDT for the target file is not recognized properly and the one for the base file is used instead.  The first time a resolve for a Java element is done on a newly open compare editor target file, the correct CompilationUnit seems to be returned from the CompilationUnitDocumentProvider#getWorkingCopy, stored in the fFakeCUMapForMissingInfo HashMap.  However this &quot;correct&quot; CompilationUnit is changed by the SelectionConverter in performForkedCodeResolve that uses the CompilationUnit#reconcile method to replace it with incorrect contents.  From then onwards, every Java element resolve is made using the incorrect CompilationUnit.

The only place in the R4E code where we could have something wrong is in the R4EFileRevisionEditorInput, we I cannot see what could cause this.

Egit uses similar code for their history compare editor but it works fine for them.  I also verified that the problem is not dependent on the JRE used (1.5 and 1.6 equally fail).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2013424</commentid>
    <comment_count>2</comment_count>
    <who name="Sebastien Dubois">sebastien.dubois</who>
    <bug_when>2011-10-19 16:34:41 -0400</bug_when>
    <thetext>Update:

  It seems that the CompilationUnit class in JDT sees itself out of synch with the buffered contents.  This is shown in method JavaModelManager#getElementsOutOfSynchWithBuffers which contains our R4EFileRevisionEditorInput CompilationUnit contents as out of synch.  It should not be.  I&apos;m starting to wonder whether this is not linked to bug 359617 and the changes that were made to the CommandUtils#getTargetFileData and getBaseFileData methods</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2013429</commentid>
    <comment_count>3</comment_count>
    <who name="Sebastien Dubois">sebastien.dubois</who>
    <bug_when>2011-10-19 16:39:56 -0400</bug_when>
    <thetext>
The problem was that we were returning the same path for all file versions in ReviewsRFSProxy#getIStorage#getFullPath, so the internal buffers used by the JDT CompilationUnit to store the Java contents were overlapping.  The solution is to append the localId (SHA) to the file path so different file versions are stored in different buffers that are not overlapping.  Similar code is used in Egit CommitBlobStorage#getFullPath.

Now we can ahieve full navigatability for both workspace and external base and target files!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2016576</commentid>
    <comment_count>4</comment_count>
    <who name="Alvaro Sanchez-Leon">alvsan09</who>
    <bug_when>2011-10-25 21:55:31 -0400</bug_when>
    <thetext>Using latest code on Oct 25th, 
Navigation does not work from compare editor or single editor, nor from base file or target file.
Ouline info. is populated though.

To reproduce imported jgit git files, 
create a commit review item (a bit old, to find files out of sync with work space)
open the files in compare editor 
try navigation (did not work for most cases)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2016888</commentid>
    <comment_count>5</comment_count>
    <who name="Sebastien Dubois">sebastien.dubois</who>
    <bug_when>2011-10-26 11:02:55 -0400</bug_when>
    <thetext>After some investigation, it seems that navigation does not work when the classes we are trying to resolve are in the same project as the file we use.  Take note that this might not be an R4E issue, as using the Egit history files gives the same results</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2104420</commentid>
    <comment_count>6</comment_count>
    <who name="Jacques Bouthillier">lmcbout</who>
    <bug_when>2012-05-08 09:01:41 -0400</bug_when>
    <thetext>I use LINUX 64b with C files and there is no outline view</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2177697</commentid>
    <comment_count>7</comment_count>
    <who name="Sebastien Dubois">sebastien.dubois</who>
    <bug_when>2012-10-30 15:35:32 -0400</bug_when>
    <thetext>After some extensive investigation it seems that R4E behaves exactly like any other plugin regarding outline view content, navigatability vs workspace and external files

From the compare editor, outline view content is not available.  Navigatability works all the time with files synchronized with workspace and external files, if the resolve target is part of the workspace.

From the JDT editor, Outline view content is available for both workspace and external files, but the R4E menu is not available in the outline view for external files (see bug375149).  Navigatability works all the time with files synchronized with workspace and external files, if the resolve target is part of the workspace.

From the CDT editor, Outline view content is available for workspace files only.  Navigatability works all the time with files synchronized with workspace and external files, if the resolve target is part of the workspace.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>