<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>378855</bug_id>
          
          <creation_ts>2012-05-08 11:02:00 -0400</creation_ts>
          <short_desc>fix class loading issues with RepositoryClientManager</short_desc>
          <delta_ts>2012-06-03 14:27:06 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>14</classification_id>
          <classification>Mylyn</classification>
          <product>Mylyn Tasks</product>
          <component>Framework</component>
          <version>unspecified</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords>contributed</keywords>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>3.8</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Benjamin Muskalla">benjamin.muskalla</reporter>
          <assigned_to name="Benjamin Muskalla">benjamin.muskalla</assigned_to>
          <cc>steffen.pingel</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2104524</commentid>
    <comment_count>0</comment_count>
    <who name="Benjamin Muskalla">benjamin.muskalla</who>
    <bug_when>2012-05-08 11:02:58 -0400</bug_when>
    <thetext>RepositoryClientManager currenlty has problem accessing the configuration classes during deserialization. We should make it aware of the right classloader to make this work.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2104526</commentid>
    <comment_count>1</comment_count>
    <who name="Benjamin Muskalla">benjamin.muskalla</who>
    <bug_when>2012-05-08 11:06:40 -0400</bug_when>
    <thetext>Pushed a fix to http://review.mylyn.org/#change,511

Steffen, I don&apos;t see a chance to get hold of the classloader for the configuration based on the type parameter. Under regular circumstances, I don&apos;t see a reason why the config ctor should have any side effects (see TODO). Any thoughts?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2104537</commentid>
    <comment_count>2</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2012-05-08 11:17:08 -0400</bug_when>
    <thetext>Thanks for the patch. I don&apos;t think we should create objects to obtain a class loader reference. In the worst case scenario it might not be the right class loader if the class lives in a different bundle. I would prefer if we injected the class loader in the constructor of RepositoryClientManager to make it obvious how the class works.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2104790</commentid>
    <comment_count>3</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2012-05-08 16:55:22 -0400</bug_when>
    <thetext>We could also consider passing the configuration class object. That way we could provide a default implementation for createRepositoryConfiguration and access the classloader.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2104818</commentid>
    <comment_count>4</comment_count>
    <who name="Benjamin Muskalla">benjamin.muskalla</who>
    <bug_when>2012-05-08 17:56:28 -0400</bug_when>
    <thetext>I&apos;d try to avoid leaving classloading up to consumers. I think we should not expose the classloader in the API. I uploaded a new patch set which actually gets the right classloader from the configuration type param to load it.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2107473</commentid>
    <comment_count>5</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2012-05-14 07:07:05 -0400</bug_when>
    <thetext>While I agree that API should be kept as simple as possible the class loading complications are an inherent property of the implementation and consumers should be aware of that. Since the class is SPI, consumers are implementors of OSGi bundles and it seems reasonable to me to require a Class instance to obtain the corresponding class loader. I have pushed a change to Gerrit that modifies your implementation slightly:

 https://git.eclipse.org/r/5970
 https://git.eclipse.org/r/5971

The other consideration is maintainability of the code. I appreciate the smart use of reflective APIs but I&apos;m worried that understanding and changing this type code is significantly more challenging and error prone than a more common solution that obtains a class loader from a class.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2110847</commentid>
    <comment_count>6</comment_count>
    <who name="Benjamin Muskalla">benjamin.muskalla</who>
    <bug_when>2012-05-21 07:07:54 -0400</bug_when>
    <thetext>Steffen, I think we can close this as being fixed. The only item left for our consumers would be to push this into an API package. Or should we wait another release to see if there are any API changes left.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2112971</commentid>
    <comment_count>7</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2012-05-23 13:03:38 -0400</bug_when>
    <thetext>I moved the class into API: https://git.eclipse.org/r/#change,6094. Thanks for your efforts, Benjamin.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2113448</commentid>
    <comment_count>8</comment_count>
    <who name="Benjamin Muskalla">benjamin.muskalla</who>
    <bug_when>2012-05-24 05:07:42 -0400</bug_when>
    <thetext>Hm, @org.eclipse.mylyn.internal.tasks.core@ doesn&apos;t sound like API to me ;)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2118231</commentid>
    <comment_count>9</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2012-06-03 10:05:11 -0400</bug_when>
    <thetext>I would have to agree with that :).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2118266</commentid>
    <comment_count>10</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2012-06-03 14:27:06 -0400</bug_when>
    <thetext>Moved to API package in ba998485fdb6e76b3983890e0fa17538aa36728d.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>