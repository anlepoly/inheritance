<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>415140</bug_id>
          
          <creation_ts>2013-08-15 07:27:00 -0400</creation_ts>
          <short_desc>CorruptIndexException in tasklist index</short_desc>
          <delta_ts>2014-02-07 19:20:44 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>14</classification_id>
          <classification>Mylyn</classification>
          <product>Mylyn Tasks</product>
          <component>Framework</component>
          <version>unspecified</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>3.11</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Benjamin Muskalla">benjamin.muskalla</reporter>
          <assigned_to name="David Green">david.green</assigned_to>
          <cc>david.green</cc>
    
    <cc>sam.davis</cc>
    
    <cc>steffen.pingel</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2295141</commentid>
    <comment_count>0</comment_count>
    <who name="Benjamin Muskalla">benjamin.muskalla</who>
    <bug_when>2013-08-15 07:27:00 -0400</bug_when>
    <thetext>Using   Mylyn Task List	3.10.0.20130712-0937	org.eclipse.mylyn_feature.feature.group	Eclipse Mylyn

I see these exceptions every 10 minutes in my error log. Not sure if there is any further steps I have to reproduce.
Tasklist contains queries for JIRA (Atlassian Connector), Bugzilla and Gerrit.

-- Error Details --
Date: Wed Aug 14 23:11:36 CEST 2013
Message: Failed to update task list index
Severity: Error
Product: Eclipse SDK 4.2.2.v201302041200 (org.eclipse.sdk.ide)
Plugin: org.eclipse.mylyn.tasks.index.core
Session Data:
eclipse.buildId=M20130204-1200
java.version=1.7.0_25
java.vendor=Oracle Corporation
BootLoader constants: OS=linux, ARCH=x86, WS=gtk, NL=en_US
Command-line arguments:  -os linux -ws gtk -arch x86

Exception Stack Trace:
org.eclipse.core.runtime.CoreException: Unexpected exception: Unknown format version: -11
	at org.eclipse.mylyn.internal.tasks.index.core.TaskListIndex.maintainIndex(TaskListIndex.java:1097)
	at org.eclipse.mylyn.internal.tasks.index.core.TaskListIndex.access$0(TaskListIndex.java:1064)
	at org.eclipse.mylyn.internal.tasks.index.core.TaskListIndex$MaintainIndexJob.run(TaskListIndex.java:170)
	at org.eclipse.core.internal.jobs.Worker.run(Worker.java:53)
Caused by: org.apache.lucene.index.CorruptIndexException: Unknown format version: -11
	at org.apache.lucene.index.SegmentInfos.read(SegmentInfos.java:247)
	at org.apache.lucene.index.IndexFileDeleter.&lt;init&gt;(IndexFileDeleter.java:173)
	at org.apache.lucene.index.IndexWriter.init(IndexWriter.java:1609)
	at org.apache.lucene.index.IndexWriter.&lt;init&gt;(IndexWriter.java:1074)
	at org.eclipse.mylyn.internal.tasks.index.core.TaskListIndex.indexQueuedTasks(TaskListIndex.java:1151)
	at org.eclipse.mylyn.internal.tasks.index.core.TaskListIndex.maintainIndex(TaskListIndex.java:1092)
	... 3 more

-- Error Details --
Date: Wed Aug 14 23:11:36 CEST 2013
Message: Unexpected exception: Unknown format version: -11
Severity: Error
Product: Eclipse SDK 4.2.2.v201302041200 (org.eclipse.sdk.ide)
Plugin: org.eclipse.mylyn.tasks.index.core
Exception Stack Trace:
org.apache.lucene.index.CorruptIndexException: Unknown format version: -11
	at org.apache.lucene.index.SegmentInfos.read(SegmentInfos.java:247)
	at org.apache.lucene.index.IndexFileDeleter.&lt;init&gt;(IndexFileDeleter.java:173)
	at org.apache.lucene.index.IndexWriter.init(IndexWriter.java:1609)
	at org.apache.lucene.index.IndexWriter.&lt;init&gt;(IndexWriter.java:1074)
	at org.eclipse.mylyn.internal.tasks.index.core.TaskListIndex.indexQueuedTasks(TaskListIndex.java:1151)
	at org.eclipse.mylyn.internal.tasks.index.core.TaskListIndex.maintainIndex(TaskListIndex.java:1092)
	at org.eclipse.mylyn.internal.tasks.index.core.TaskListIndex.access$0(TaskListIndex.java:1064)
	at org.eclipse.mylyn.internal.tasks.index.core.TaskListIndex$MaintainIndexJob.run(TaskListIndex.java:170)
	at org.eclipse.core.internal.jobs.Worker.run(Worker.java:53)


-- Error Details --
Date: Wed Aug 14 23:11:36 CEST 2013
Message: Unexpected exception: Unknown format version: -11
Severity: Error
Product: Eclipse SDK 4.2.2.v201302041200 (org.eclipse.sdk.ide)
Plugin: org.eclipse.mylyn.tasks.index.core
Exception Stack Trace:
org.apache.lucene.index.CorruptIndexException: Unknown format version: -11
	at org.apache.lucene.index.SegmentInfos.read(SegmentInfos.java:247)
	at org.apache.lucene.index.IndexFileDeleter.&lt;init&gt;(IndexFileDeleter.java:173)
	at org.apache.lucene.index.IndexWriter.init(IndexWriter.java:1609)
	at org.apache.lucene.index.IndexWriter.&lt;init&gt;(IndexWriter.java:1074)
	at org.eclipse.mylyn.internal.tasks.index.core.TaskListIndex.indexQueuedTasks(TaskListIndex.java:1151)
	at org.eclipse.mylyn.internal.tasks.index.core.TaskListIndex.maintainIndex(TaskListIndex.java:1092)
	at org.eclipse.mylyn.internal.tasks.index.core.TaskListIndex.access$0(TaskListIndex.java:1064)
	at org.eclipse.mylyn.internal.tasks.index.core.TaskListIndex$MaintainIndexJob.run(TaskListIndex.java:170)
	at org.eclipse.core.internal.jobs.Worker.run(Worker.java:53)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2296570</commentid>
    <comment_count>1</comment_count>
    <who name="Benjamin Muskalla">benjamin.muskalla</who>
    <bug_when>2013-08-20 03:47:25 -0400</bug_when>
    <thetext>This is getting quite annoying as it fills up my error log every day. Is there any way to delete the index and reindex?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2296585</commentid>
    <comment_count>2</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-08-20 04:12:19 -0400</bug_when>
    <thetext>You can try &quot;Refresh Search Index&quot; from the Task List view menu or if that doesn&apos;t fix it delete &lt;workspace&gt;/.metadata/.mylyn/.taskListIndex/.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2323568</commentid>
    <comment_count>3</comment_count>
    <who name="David Green">david.green</who>
    <bug_when>2013-10-25 21:56:33 -0400</bug_when>
    <thetext>I&apos;ve pushed a change for this: https://git.eclipse.org/r/17789

The change adds a test that creates a corrupt index by writing random data over index files.  The task list index will attempt to remove the existing index and rebuild it.

comments on the approach are welcome.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2323741</commentid>
    <comment_count>4</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-10-27 16:11:57 -0400</bug_when>
    <thetext>David, I think there is an option for Lucene to force a certain format. That would ensure the index remains compatible when users switch between 2.9.1 and 3.5.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2328020</commentid>
    <comment_count>5</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-11-08 06:53:04 -0500</bug_when>
    <thetext>The class I had in mind was org.apache.lucene.util.Version. It support a compatiblity mode for 2.9 which could make sense in the Mylyn context where users may switch between Lucene 2.9 and 3.5. I haven&apos;t verified though if it works as I would expect and the documentation isn&apos;t entirely clear on that. Thoughts?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2328904</commentid>
    <comment_count>6</comment_count>
    <who name="David Green">david.green</who>
    <bug_when>2013-11-11 15:28:26 -0500</bug_when>
    <thetext>Steffen, good find.  It looks like Lucene is specifically designed to handle opening old index formats with newer versions of Lucene, but to do that the version has to be specified to the reader/writer.

I don&apos;t think that we&apos;ll be able to just specify 2.9 and be done with it; users of Mylyn who have created a task list index with a newer version of Lucene would then start to encounter the same problem since the code would be trying to open a newer version of the index with a lower version specified in the code.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2347654</commentid>
    <comment_count>7</comment_count>
    <who name="Sam Davis">sam.davis</who>
    <bug_when>2014-01-09 14:30:46 -0500</bug_when>
    <thetext>Should we merge the change in https://git.eclipse.org/r/17789?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2347749</commentid>
    <comment_count>8</comment_count>
    <who name="David Green">david.green</who>
    <bug_when>2014-01-09 17:28:53 -0500</bug_when>
    <thetext>we need buy-in on the approach and a code review before proceeding</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2348352</commentid>
    <comment_count>9</comment_count>
    <who name="Sam Davis">sam.davis</who>
    <bug_when>2014-01-10 14:09:53 -0500</bug_when>
    <thetext>It seems like a reasonable approach to me. An alternative would be to specify 2.9 in the writer but support reading both formats when using Lucene 3.5 (e.g. try 2.9 and if it fails, try again with 3.5). Does that make any sense?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2359376</commentid>
    <comment_count>10</comment_count>
    <who name="Sam Davis">sam.davis</who>
    <bug_when>2014-02-05 17:18:37 -0500</bug_when>
    <thetext>I&apos;ve updated the review and will submit it some time unless anyone has any further input.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2360487</commentid>
    <comment_count>11</comment_count>
    <who name="Sam Davis">sam.davis</who>
    <bug_when>2014-02-07 19:20:44 -0500</bug_when>
    <thetext>I&apos;ve merged the change to get some mileage on it before the release. Thanks, David, for the fix.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>