<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>360824</bug_id>
          
          <creation_ts>2011-10-13 09:37:00 -0400</creation_ts>
          <short_desc>commons tests hang when parsing discovery directory.xml</short_desc>
          <delta_ts>2011-10-13 13:48:10 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>14</classification_id>
          <classification>Mylyn</classification>
          <product>Mylyn Commons</product>
          <component>Discovery</component>
          <version>unspecified</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>3.7</target_milestone>
          
          <blocked>351100</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Steffen Pingel">steffen.pingel</reporter>
          <assigned_to name="Steffen Pingel">steffen.pingel</assigned_to>
          <cc>david.green</cc>
          <qa_contact name="Steffen Pingel">steffen.pingel</qa_contact>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2009878</commentid>
    <comment_count>0</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2011-10-13 09:37:09 -0400</bug_when>
    <thetext>For some reason commons tests hang when running on mylyn.org, e.g.: http://ci.mylyn.org/job/mylyn-commons-trigger/17/console. I can also reproduce that problem locally.

&quot;main&quot; prio=1 tid=0x09a2ed30 nid=0x7ea0 in Object.wait() [0xbfdea000..0xbfdec2a8]
	at java.lang.Object.wait(Native Method)
	- waiting on &lt;0x6414b1c0&gt; (a java.io.PipedInputStream)
	at java.io.PipedInputStream.read(PipedInputStream.java:258)
	- locked &lt;0x6414b1c0&gt; (a java.io.PipedInputStream)
	at java.io.PipedInputStream.read(PipedInputStream.java:303)
	- locked &lt;0x6414b1c0&gt; (a java.io.PipedInputStream)
	at org.eclipse.equinox.internal.p2.transport.ecf.FileReader$1.read(FileReader.java:246)
	at sun.nio.cs.StreamDecoder$CharsetSD.readBytes(StreamDecoder.java:411)
	at sun.nio.cs.StreamDecoder$CharsetSD.implRead(StreamDecoder.java:453)
	at sun.nio.cs.StreamDecoder.read(StreamDecoder.java:183)
	- locked &lt;0x60b07000&gt; (a java.io.InputStreamReader)
	at java.io.InputStreamReader.read(InputStreamReader.java:167)
	at java.io.BufferedReader.fill(BufferedReader.java:136)
	at java.io.BufferedReader.read1(BufferedReader.java:187)
	at java.io.BufferedReader.read(BufferedReader.java:261)
	- locked &lt;0x60b07000&gt; (a java.io.InputStreamReader)
	at com.sun.org.apache.xerces.internal.impl.XMLEntityScanner.load(XMLEntityScanner.java:1740)
	at com.sun.org.apache.xerces.internal.impl.XMLEntityScanner.skipString(XMLEntityScanner.java:1437)
	at com.sun.org.apache.xerces.internal.impl.XMLVersionDetector.determineDocVersion(XMLVersionDetector.java:191)
	at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:798)
	at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:764)
	at com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:148)
	at com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1242)
	at org.eclipse.mylyn.internal.discovery.core.model.DirectoryParser.parse(DirectoryParser.java:77)
	at org.eclipse.mylyn.internal.discovery.core.model.RemoteBundleDiscoveryStrategy$1.process(RemoteBundleDiscoveryStrategy.java:111)
	at org.eclipse.mylyn.internal.discovery.core.util.WebUtil.readResource(WebUtil.java:99)
	at org.eclipse.mylyn.internal.discovery.core.model.RemoteBundleDiscoveryStrategy.performDiscovery(RemoteBundleDiscoveryStrategy.java:107)
	at org.eclipse.mylyn.discovery.tests.core.RemoteBundleDiscoveryStrategyTest.testPerformDiscovery(RemoteBundleDiscoveryStrategyTest.java:45)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2009898</commentid>
    <comment_count>1</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2011-10-13 09:46:47 -0400</bug_when>
    <thetext>This is the contents of the file:

pre. 
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;directory xmlns=&quot;http://www.eclipse.org/mylyn/discovery/directory/&quot;&gt;
	&lt;entry url=&quot;http://www.eclipse.org/downloads/download.php?file=/mylyn/discovery/org.eclipse.mylyn.discovery-3.2.jar&amp;amp;r=1&amp;amp;protocol=http&quot; permitCategories=&quot;true&quot;/&gt;
	&lt;entry url=&quot;http://tasktop.com/downloads/discovery/com.tasktop.discovery.jar&quot; permitCategories=&quot;true&quot;/&gt;
&lt;/directory&gt;

David, do you have any idea what might be causing this?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2009902</commentid>
    <comment_count>2</comment_count>
      <attachid>205123</attachid>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2011-10-13 09:48:42 -0400</bug_when>
    <thetext>Created attachment 205123
mylyn/context/zip</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2009985</commentid>
    <comment_count>3</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2011-10-13 10:48:09 -0400</bug_when>
    <thetext>Looks like this is a problem in org.eclipse.equinox.internal.p2.transport.ecf.FileReader.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2010042</commentid>
    <comment_count>4</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2011-10-13 11:45:03 -0400</bug_when>
    <thetext>Exception happens in HttpHost which gets passed a proxy that has an empty null host. This is due to an empty &quot;http_proxy&quot; environment variable that is set in the parent pom.

Thread [main] (Suspended)	
	owns: HostConfiguration  (id=2028)	
	owns: RunnableLock  (id=1843)	
	ProxyHost(HttpHost).&lt;init&gt;(String, int, Protocol) line: 68	
	ProxyHost.&lt;init&gt;(String, int) line: 64	
	HostConfiguration.setProxy(String, int) line: 415	
	HttpClientRetrieveFileTransfer.setupProxy(Proxy) line: 1038	
	HttpClientRetrieveFileTransfer.setupProxies() line: 438	
	HttpClientRetrieveFileTransfer(AbstractRetrieveFileTransfer).sendRetrieveRequest(IFileID, IFileRangeSpecification, IFileTransferListener, Map) line: 888	
	HttpClientRetrieveFileTransfer(AbstractRetrieveFileTransfer).sendRetrieveRequest(IFileID, IFileTransferListener, Map) line: 576	
	MultiProtocolRetrieveAdapter.sendRetrieveRequest(IFileID, IFileTransferListener, Map) line: 106	
	FileReader.sendRetrieveRequest(URI, OutputStream, FileReader$DownloadRange, boolean, IProgressMonitor) line: 349	
	FileReader.read(URI, IProgressMonitor) line: 213	
	RepositoryTransport.stream(URI, IProgressMonitor) line: 146	
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 39	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 25	
	Method.invoke(Object, Object...) line: 597	
	P2TransportService.stream(URI, IProgressMonitor) line: 93	
	WebUtil.stream(URI, IProgressMonitor) line: 161	
	WebUtil.readResource(URI, WebUtil$TextContentProcessor, IProgressMonitor) line: 95	
	RemoteBundleDiscoveryStrategy.performDiscovery(IProgressMonitor) line: 107	
	RemoteBundleDiscoveryStrategyTest.testPerformDiscovery() line: 45	
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 39	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 25	
	Method.invoke(Object, Object...) line: 597	
	RemoteBundleDiscoveryStrategyTest(TestCase).runTest() line: 168	
	RemoteBundleDiscoveryStrategyTest(TestCase).runBare() line: 134	
	TestResult$1.protect() line: 110	
	TestResult.runProtected(Test, Protectable) line: 128	
	TestResult.run(TestCase) line: 113	
	RemoteBundleDiscoveryStrategyTest(TestCase).run(TestResult) line: 124	
	TestSuite.runTest(Test, TestResult) line: 243	
	TestSuite.run(TestResult) line: 238	
	TestSuite.runTest(Test, TestResult) line: 243	
	TestSuite.run(TestResult) line: 238	
	SuiteMethod(JUnit38ClassRunner).run(RunNotifier) line: 83	
	JUnit4TestSet.execute(ReporterManager, ClassLoader) line: 62	
	JUnit4DirectoryTestSuite(AbstractDirectoryTestSuite).executeTestSet(SurefireTestSet, ReporterManager, ClassLoader) line: 140	
	JUnit4DirectoryTestSuite(AbstractDirectoryTestSuite).execute(ReporterManager, ClassLoader) line: 127	
	Surefire.run(List, List, ClassLoader, ClassLoader, Boolean) line: 177	
	OsgiSurefireBooter.run(String[]) line: 72	
	AbstractUITestApplication$1.run() line: 35	
	RunnableLock.run() line: 35	
	UISynchronizer(Synchronizer).runAsyncMessages(boolean) line: 135	
	Display.runAsyncMessages(boolean) line: 3563	
	Display.readAndDispatch() line: 3212	
	Workbench.runEventLoop(Window$IExceptionHandler, Display) line: 2696	
	Workbench.runUI() line: 2660	
	Workbench.access$4(Workbench) line: 2494	
	Workbench$7.run() line: 674	
	Realm.runWithDefault(Realm, Runnable) line: 332	
	Workbench.createAndRunWorkbench(Display, WorkbenchAdvisor) line: 667	
	PlatformUI.createAndRunWorkbench(Display, WorkbenchAdvisor) line: 149	
	IDEApplication.start(IApplicationContext) line: 123	
	UITestApplication.runApplication(Object, String[]) line: 31	
	UITestApplication(AbstractUITestApplication).run(String[]) line: 114	
	UITestApplication.start(IApplicationContext) line: 37	
	EclipseAppHandle.run(Object) line: 196	
	EclipseAppLauncher.runApplication(Object) line: 110	
	EclipseAppLauncher.start(Object) line: 79	
	EclipseStarter.run(Object) line: 344	
	EclipseStarter.run(String[], Runnable) line: 179	
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 39	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 25	
	Method.invoke(Object, Object...) line: 597	
	Main.invokeFramework(String[], URL[]) line: 622	
	Main.basicRun(String[]) line: 577	
	Main.run(String[]) line: 1410	
	Main.main(String[]) line: 1386</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2010080</commentid>
    <comment_count>5</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2011-10-13 12:24:11 -0400</bug_when>
    <thetext>Fixed by removing the explicit setting of the http_proxy environment variables in the parent pom.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2010132</commentid>
    <comment_count>6</comment_count>
    <who name="David Green">david.green</who>
    <bug_when>2011-10-13 13:48:10 -0400</bug_when>
    <thetext>(In reply to comment #1)
&gt; David, do you have any idea what might be causing this?

Thanks for working this one out Steffen</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="0"
              isprivate="0"
          >
            <attachid>205123</attachid>
            <date>2011-10-13 09:48:00 -0400</date>
            <delta_ts>2011-10-13 09:48:42 -0400</delta_ts>
            <desc>mylyn/context/zip</desc>
            <filename>mylyn-context.zip</filename>
            <type>application/octet-stream</type>
            <size>2221</size>
            <attacher name="Steffen Pingel">steffen.pingel</attacher>
            
              <data encoding="base64">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
</data>

          </attachment>
      

    </bug>

</bugzilla>