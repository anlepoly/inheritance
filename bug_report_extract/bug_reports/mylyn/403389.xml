<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>403389</bug_id>
          
          <creation_ts>2013-03-14 16:21:00 -0400</creation_ts>
          <short_desc>[regression] cannot compare patch sets with new Remotes API implementation</short_desc>
          <delta_ts>2013-04-17 18:01:35 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>14</classification_id>
          <classification>Mylyn</classification>
          <product>Mylyn Reviews</product>
          <component>Gerrit Connector</component>
          <version>unspecified</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P2</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>2.0</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Sebastien Dubois">sebastien.dubois</reporter>
          <assigned_to name="Miles Parker">milesparker</assigned_to>
          <cc>milesparker</cc>
    
    <cc>steffen.pingel</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2231590</commentid>
    <comment_count>0</comment_count>
    <who name="Sebastien Dubois">sebastien.dubois</who>
    <bug_when>2013-03-14 16:21:23 -0400</bug_when>
    <thetext>The new Remotes API implemetation (see bug 400167) introduced a new way to communicate between the eclipse client and the Gerrit Remote server.  After the new implementation was merged in, it is not possible anymore to compare 2 patch sets together (using the &quot;Compare with...&quot; button).  

The problem that happens is that the Consumer request method is never called in CompareWithUiFactory#execute so the remote end is never contacted.

Also, this execute method should be optimized.  Most of the time, the data is available locally and there is no need to request the information from the remote end.
- When the current patch set is compared to the base, all the information needed is always available in the IReviewItemSet passed in when constructing the CompareWithUiFactory object.  So we can save the set and retrive the information for the base from it.
- Otherwise, we should first iterate through all the ReviewItemSets available locally under the IReview object to see if we can used the information cached locally.  Only if the info is nbot present should we request it from the Gerrit Remote server.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2231628</commentid>
    <comment_count>1</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-03-14 17:33:49 -0400</bug_when>
    <thetext>(In reply to comment #0)
&gt; The new Remotes API implemetation (see bug 400167) introduced a new way to
&gt; communicate between the eclipse client and the Gerrit Remote server.  After
&gt; the new implementation was merged in, it is not possible anymore to compare
&gt; 2 patch sets together (using the &quot;Compare with...&quot; button).  

Okay, I&apos;ll take a look tmrw. I did &quot;test&quot; this on a number of occasions, so I don&apos;t know why it isn&apos;t working now. Obviously something we need to put under unit testing. (And we can, now that it isn&apos;t all bound up to UI anymore.)

&gt; The problem that happens is that the Consumer request method is never called... &gt; Also, this execute method should be optimized.  Most of the time, the data
&gt; is available locally and there is no need to request the information from
&gt; the remote end.

Exactly. I&apos;ve been working on this as part of the https://git.eclipse.org/r/#/c/11012/, which will be broekn down further once I get everything working.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2232278</commentid>
    <comment_count>2</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-03-15 17:44:08 -0400</bug_when>
    <thetext>Miles, do you think you will be able to fix this for Kepler M6? It&apos;s a regression that breaks important functionality.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2232288</commentid>
    <comment_count>3</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-03-15 17:52:47 -0400</bug_when>
    <thetext>Already merged. :) https://git.eclipse.org/r/#/c/11205/

(Normally I would have linked this in sooner, but Sebastien and I discussed it on review.)</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>