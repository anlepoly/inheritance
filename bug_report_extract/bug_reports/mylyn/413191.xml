<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>413191</bug_id>
          
          <creation_ts>2013-07-17 14:14:00 -0400</creation_ts>
          <short_desc>[jvm][e3.6][linux] browser tests crash when run on Eclipse 3.6</short_desc>
          <delta_ts>2013-10-24 15:57:17 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>14</classification_id>
          <classification>Mylyn</classification>
          <product>Mylyn Commons</product>
          <component>UI</component>
          <version>unspecified</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux-GTK</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard>sprint=7;</status_whiteboard>
          <keywords>contributed</keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>3.11</target_milestone>
          <dependson>416743</dependson>
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Steffen Pingel">steffen.pingel</reporter>
          <assigned_to name="Tomasz Zarna">tomasz.zarna</assigned_to>
          <cc>milesparker</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2285652</commentid>
    <comment_count>0</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-07-17 14:14:34 -0400</bug_when>
    <thetext>When we switched targets to Eclipse 3.6 (bug 412743) browser tests started crashing. For now they have been excluded from the AllCommonsTestSuite but we should investigate a fix or dynamic way to exclude them only when running in incompatible environments (the crashes don&apos;t happen when running integration tests for instance).

pre.. 
Running org.eclipse.mylyn.commons.tests.AllCommonsTests
System: Linux 2.6.32.59-0.7-xen (amd64) / linux-x86_64-gtk / Sun Microsystems Inc. Java HotSpot(TM) 64-Bit Server VM 1.6.0_21

#
# A fatal error has been detected by the Java Runtime Environment:
#
#  SIGSEGV (0xb) at pc=0x00007f158edab9e0, pid=24634, tid=139731756320512
#
# JRE version: 6.0_21-b06
# Java VM: Java HotSpot(TM) 64-Bit Server VM (17.0-b16 mixed mode linux-amd64 )
# Problematic frame:
# C  [libxul.so+0xab59e0]
#
# An error report file with more information is saved as:
# /opt/users/hudsonbuild/workspace/mylyn-commons-nightly/org.eclipse.mylyn.commons.tests/hs_err_pid24634.log
#
# If you would like to submit a bug report, please visit:
#   http://java.sun.com/webapps/bugreport/crash.jsp
# The crash happened outside the Java Virtual Machine in native code.
# See problematic frame for where to report the bug.
#</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2309153</commentid>
    <comment_count>1</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-09-20 05:34:46 -0400</bug_when>
    <thetext>The same happens for Gerrit tests: https://hudson.eclipse.org/sandbox/job/mylyn-reviews-gerrit/971/console and the last 5 builds.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2310174</commentid>
    <comment_count>2</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-09-24 07:33:43 -0400</bug_when>
    <thetext>Review disabling the troublesome test in Gerrit: https://git.eclipse.org/r/#/c/16720/</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2310743</commentid>
    <comment_count>3</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-09-25 09:58:05 -0400</bug_when>
    <thetext>Steffen, I have to admit I&apos;m kinda clueless here. In https://git.eclipse.org/r/#/c/16720/ I tried various ways to cause the same JVM crash, but failed. Any chance for attaching the log file here? Maybe that would shed some light on this issue.

(In reply to Steffen Pingel from comment #0)
&gt; ... the crashes don&apos;t happen when running integration tests for instance

What makes them different? Are they not running against Eclipse 3.6?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2310826</commentid>
    <comment_count>4</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-09-25 12:25:47 -0400</bug_when>
    <thetext>
(In reply to comment #3)
&gt; Steffen, I have to admit I&apos;m kinda clueless here. In
&gt; https://git.eclipse.org/r/#/c/16720/ I tried various ways to cause the same JVM
&gt; crash, but failed. Any chance for attaching the log file here? Maybe that would
&gt; shed some light on this issue.

We would have to grab them from the workspace of the build machine. Not sure that would provide anymore information though since the crashes typically happen somewhere in native code.

Have you tried setting &quot;org.eclipse.swt.browser.UseWebKitGTK&quot; to &quot;true&quot;? I don&apos;t know if webkit is installed on the test machines but it might be more stable.

&gt; (In reply to Steffen Pingel from comment #0)
&gt; &gt; ... the crashes don&apos;t happen when running integration tests for instance
&gt; 
&gt; What makes them different? Are they not running against Eclipse 3.6?

The run against a number of targets: http://ci.mylyn.org/job/mylyn-3.10.x/ More importantly though they run on different infrastructure. I suspect that the xulrunner installed on mylyn.org is more recent (or at least a more compatible version) than what we have on hudson.eclipse.org.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2312479</commentid>
    <comment_count>5</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-09-30 08:34:44 -0400</bug_when>
    <thetext>(In reply to comment #4)
&gt; Have you tried setting &quot;org.eclipse.swt.browser.UseWebKitGTK&quot; to &quot;true&quot;? I don&apos;t
&gt; know if webkit is installed on the test machines but it might be more stable.

Yes, I tried in one of the patches from https://git.eclipse.org/r/#/c/16720/, it didn&apos;t work so I guess WebKitGTK is not available (or properly installed).

This is not my highest priority item at the moment, but definitely #1 on my Mylyn list. I&apos;m going to revisit it later this week and investigate further. In the meantime, if you have any other ideas, please share them here.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2313008</commentid>
    <comment_count>6</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-10-01 10:19:31 -0400</bug_when>
    <thetext>Tomek, can we exclude the failing test for now (using a check or if that&apos;s more trouble, just disabling it like you proposed originally)?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2313820</commentid>
    <comment_count>7</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-10-03 09:08:13 -0400</bug_when>
    <thetext>I&apos;ve been trying to figure out what&apos;s wrong with the Hudson Sandbox setup, but none of the sysouts I applied gave me a clue. 

Inspecting a created browser instance:
* webBrowser=Mozilla
* XPCOMInitWasGlued=true
* XPCOMWasGlued=true
* IsPre_1_9=false
* IsPre_1_8=false
* Initialized=true
* XULRunnerPath=/usr/lib64/xulrunner-1.9.0.19
* XULRunnerInitialized=true

The 1.9.0 is supposed to work just fine -- http://www.eclipse.org/swt/faq.php#browserplatforms

So in https://git.eclipse.org/r/16989 I added a dummy check that disables the test on Linux running Java 1.6 or lower (integration tests run on IBM JVM 1.7). Leaving this bug open to improve the check in the future.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2313903</commentid>
    <comment_count>8</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-10-03 11:00:13 -0400</bug_when>
    <thetext>It might just be the sandbox:

https://hudson.eclipse.org/sandbox/job/mylyn-context-gerrit/144/console

Running org.eclipse.mylyn.cdt.tests.AllCdtTests
[2013-10-03T10-56-30] Status ERROR: org.eclipse.mylyn.tasks.core code=0 Failed to find unmatched container for repository &quot;http://mylyn.org&quot; null, 
#
# A fatal error has been detected by the Java Runtime Environment:
#
#  SIGSEGV (0xb) at pc=0x00007f825104dcf1, pid=9747, tid=140198734083856
#
# JRE version: 6.0_21-b06
# Java VM: Java HotSpot(TM) 64-Bit Server VM (17.0-b16 mixed mode linux-amd64 )
# Problematic frame:
# C  [libpangoft2-1.0.so.0+0x18cf1]
#
# An error report file with more information is saved as:
# /opt/users/hudsonbuild/.hudson/jobs/mylyn-context-gerrit/workspace/org.eclipse.mylyn.cdt.tests/hs_err_pid9747.log
#
# If you would like to submit a bug report, please visit:
#   http://java.sun.com/webapps/bugreport/crash.jsp
# The crash happened outside the Java Virtual Machine in native code.
# See problematic frame for where to report the bug.
#


How about we move trigger jobs to the new HIPP instance (bug 416743).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2313924</commentid>
    <comment_count>9</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-10-03 11:33:42 -0400</bug_when>
    <thetext>(In reply to Steffen Pingel from comment #8)
&gt; How about we move trigger jobs to the new HIPP instance (bug 416743).

That gives some hope, I will try to look at it next week. Unless you have plan to work on it, hm?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2314075</commentid>
    <comment_count>10</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-10-03 17:07:29 -0400</bug_when>
    <thetext>I&apos;ll setup one job and you can do the other ones :).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2314115</commentid>
    <comment_count>11</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-10-03 18:39:58 -0400</bug_when>
    <thetext>This doesn&apos;t appear to happen on the HIPP instance: https://hudson.eclipse.org/mylyn/job/gerrit-mylyn-reviews/1/</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2314251</commentid>
    <comment_count>12</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-10-04 06:21:55 -0400</bug_when>
    <thetext>The failing test in Commons [1] got back to normal on the HIPP as well [2], but the build failed with a different error [3]. That however, should be investigated as part of bug 416743.

[1] https://git.eclipse.org/r/#/c/17024/
[2] https://hudson.eclipse.org/mylyn/job/gerrit-mylyn-commons/1/testReport/org.eclipse.mylyn.commons.tests.workbench.browser/BrowserUtilTest/
[3] https://hudson.eclipse.org/mylyn/job/gerrit-mylyn-commons/1/testReport/org.eclipse.mylyn.commons.repositories.http.tests/CommonHttpClientTest/testCertificateAuthenticationCertificate/</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2315299</commentid>
    <comment_count>13</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-10-07 15:59:23 -0400</bug_when>
    <thetext>The test was re-enabled and the crashes are no longer happening on the HIPP instance. If this comes up again we can reopen. Thanks for investigating this, Tomek!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2320160</commentid>
    <comment_count>14</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-10-18 07:59:16 -0400</bug_when>
    <thetext>I&apos;m afraid it&apos;s back, see last builds on mylyn-reviews-nightly e.g. https://hudson.eclipse.org/hudson/job/mylyn-reviews-nightly/2570/</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2320172</commentid>
    <comment_count>15</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-10-18 08:19:53 -0400</bug_when>
    <thetext>Args. Let&apos;s add a system property for skipping browser tests. We can set that through the pom in the build.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2320386</commentid>
    <comment_count>16</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-10-18 12:08:58 -0400</bug_when>
    <thetext>(In reply to comment #15)
&gt; Args. Let&apos;s add a system property for skipping browser tests.

https://git.eclipse.org/r/#/c/17531/

&gt; We can set that through the pom in the build.

Through the pom or in the failing build configuration?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2320414</commentid>
    <comment_count>17</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-10-18 12:46:59 -0400</bug_when>
    <thetext>https://hudson.eclipse.org/hudson/job/mylyn-reviews-nightly/2572/ is blue again</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2320570</commentid>
    <comment_count>18</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-10-18 17:26:34 -0400</bug_when>
    <thetext>(In reply to comment #16)
&gt; Through the pom or in the failing build configuration?

Both :). We would have to set a property in the Maven build and make sure it is passed along to the test execution.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2321165</commentid>
    <comment_count>19</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-10-21 11:43:32 -0400</bug_when>
    <thetext>Just a note that we should add the system property to http://wiki.eclipse.org/Mylyn/FAQ#System_Properties once the change is merged.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2321819</commentid>
    <comment_count>20</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-10-22 13:44:55 -0400</bug_when>
    <thetext>Pushed a patch for Mylyn Commons: https://git.eclipse.org/r/#/c/17658/

The browser tests can be disabled by adding a user VM arg, eg. @mvn clean install -Dtest.uservmargs=-Dmylyn.test.skipBrowserTests=true@

It&apos;s not perfect, but I wanted to avoid adding yet another test.*.skip property to the parent pom.xml

https://git.eclipse.org/r/#/c/17531/ in Mylyn Reviews now depends on the change in Commons.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2322050</commentid>
    <comment_count>21</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-10-23 06:13:36 -0400</bug_when>
    <thetext>(In reply to comment #19)
&gt; Just a note that we should add the system property to
&gt; http://wiki.eclipse.org/Mylyn/FAQ#System_Properties once the change is merged.

Done.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2322160</commentid>
    <comment_count>22</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-10-23 10:15:02 -0400</bug_when>
    <thetext>(In reply to comment #20)
&gt; The browser tests can be disabled by adding a user VM arg, eg. @mvn clean
&gt; install -Dtest.uservmargs=-Dmylyn.test.skipBrowserTests=true@

Did that for both mylyn-commons-nightly and mylyn-reviews-nightly.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2322230</commentid>
    <comment_count>23</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-10-23 11:44:33 -0400</bug_when>
    <thetext>Thanks very much! Feel free to resolve if the builds are working now.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2322523</commentid>
    <comment_count>24</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-10-24 06:04:05 -0400</bug_when>
    <thetext>Will do, but Hudson @ eclipse.org seems to be super slow today, so I&apos;m not able to verify if that actually helped at the moment. I will check it out later.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2322524</commentid>
    <comment_count>25</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-10-24 06:07:32 -0400</bug_when>
    <thetext>(In reply to comment #24)
&gt; Hudson @ eclipse.org seems to be super slow today

http://dev.eclipse.org/mhonarc/lists/cross-project-issues-dev/msg09993.html</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2322896</commentid>
    <comment_count>26</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-10-24 15:57:17 -0400</bug_when>
    <thetext>The troublesome tests were skipped on:
* https://hudson.eclipse.org/hudson/job/mylyn-commons-nightly/295/consoleFull
* https://hudson.eclipse.org/hudson/job/mylyn-reviews-nightly/2583/consoleFull

The former failed from a different reason.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>