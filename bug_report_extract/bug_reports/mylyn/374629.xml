<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>374629</bug_id>
          
          <creation_ts>2012-03-19 06:08:00 -0400</creation_ts>
          <short_desc>[e4.2] opening of WikiText files fails on 3.8 and 4.2</short_desc>
          <delta_ts>2012-03-22 13:58:50 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>14</classification_id>
          <classification>Mylyn</classification>
          <product>Mylyn Docs</product>
          <component>Wikitext</component>
          <version>unspecified</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>1.6.0</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Steffen Pingel">steffen.pingel</reporter>
          <assigned_to name="Steffen Pingel">steffen.pingel</assigned_to>
          <cc>david.green</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2082461</commentid>
    <comment_count>0</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2012-03-19 06:08:04 -0400</bug_when>
    <thetext>http://ci.mylyn.org/job/mylyn-3.7.x/114/TARGET=juno/testReport/

Error Message

Expected instanceof org.eclipse.mylyn.internal.wikitext.ui.editor.MarkupEditor but found org.eclipse.ui.internal.ErrorEditorPart
Stacktrace

junit.framework.AssertionFailedError: Expected instanceof org.eclipse.mylyn.internal.wikitext.ui.editor.MarkupEditor but found org.eclipse.ui.internal.ErrorEditorPart
	at junit.framework.Assert.fail(Assert.java:47)
	at org.eclipse.mylyn.wikitext.ui.FileTypesTest.assertInstanceOf(FileTypesTest.java:124)
	at org.eclipse.mylyn.wikitext.ui.FileTypesTest.editorAsserts(FileTypesTest.java:115)
	at org.eclipse.mylyn.wikitext.ui.FileTypesTest.testTextileFileType(FileTypesTest.java:56)
	
5 other tests are failing with similar errors. This started happening around M6.

Error part stack trace on 4.2M6:

java.lang.NullPointerException
	at org.eclipse.mylyn.internal.wikitext.ui.editor.MarkupEditor.setAction(MarkupEditor.java:1176)
	at org.eclipse.ui.texteditor.AbstractTextEditor.createActions(AbstractTextEditor.java:5704)
	at org.eclipse.ui.texteditor.AbstractDecoratedTextEditor.createActions(AbstractDecoratedTextEditor.java:1152)
	at org.eclipse.ui.editors.text.TextEditor.createActions(TextEditor.java:122)
	at org.eclipse.mylyn.internal.wikitext.ui.editor.MarkupEditor.createActions(MarkupEditor.java:1161)
	at org.eclipse.ui.texteditor.AbstractTextEditor.createPartControl(AbstractTextEditor.java:3565)
	at org.eclipse.ui.texteditor.StatusTextEditor.createPartControl(StatusTextEditor.java:54)
	at org.eclipse.ui.texteditor.AbstractDecoratedTextEditor.createPartControl(AbstractDecoratedTextEditor.java:448)
	at org.eclipse.mylyn.internal.wikitext.ui.editor.MarkupEditor.createPartControl(MarkupEditor.java:371)
	at org.eclipse.ui.internal.e4.compatibility.CompatibilityPart.createPartControl(CompatibilityPart.java:123)
	at org.eclipse.ui.internal.e4.compatibility.CompatibilityEditor.createPartControl(CompatibilityEditor.java:95)
	at org.eclipse.ui.internal.e4.compatibility.CompatibilityPart.create(CompatibilityPart.java:266)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2082465</commentid>
    <comment_count>1</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2012-03-19 06:15:10 -0400</bug_when>
    <thetext>It looks AbstractTextEditor.createActions() now invokes setAction(IWorkbenchCommandConstants.EDIT_CUT, null) prior to binding the action to a new instance:  setAction(ITextEditorActionConstants.CUT, action). This triggers the NPE. According to the JavaDoc it is legal to pass a null action.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2082466</commentid>
    <comment_count>2</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2012-03-19 06:20:10 -0400</bug_when>
    <thetext>David, this fixes the test but I don&apos;t know if we are missing something else there such as deactivating the handler: http://review.mylyn.org/#change,377 . Since it&apos;s a major regression and fairly simple and safe change it would be good to consider for 3.7.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2082685</commentid>
    <comment_count>3</comment_count>
    <who name="David Green">david.green</who>
    <bug_when>2012-03-19 12:37:47 -0400</bug_when>
    <thetext>Odd, I just installed Eclipse SDK Version: 4.2.0 Build id: I20120127-1145 and I&apos;m unable to reproduce.  Can you please provide steps to reproduce?

Thanks.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2082690</commentid>
    <comment_count>4</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2012-03-19 12:52:38 -0400</bug_when>
    <thetext>(In reply to comment #3)
&gt; Odd, I just installed Eclipse SDK Version: 4.2.0 Build id: I20120127-1145 and
&gt; I&apos;m unable to reproduce.  Can you please provide steps to reproduce?

That looks rather old. We are testing against the latest milestone/staging which is I20120315-1300 at the moment.

The problem is very obvious when you look at the platform code in AbstractTextEditor.createActions():

		setAction(IWorkbenchCommandConstants.EDIT_CUT, null);
		action= new TextOperationAction(EditorMessages.getBundleForConstructedKeys(), &quot;Editor.Cut.&quot;, this, ITextOperationTarget.CUT); //$NON-NLS-1$
		action.setHelpContextId(IAbstractTextEditorHelpContextIds.CUT_ACTION);
		action.setActionDefinitionId(IWorkbenchCommandConstants.EDIT_CUT);
		setAction(ITextEditorActionConstants.CUT, action);






 Is there anything that needs to be clarified here?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2082708</commentid>
    <comment_count>5</comment_count>
    <who name="David Green">david.green</who>
    <bug_when>2012-03-19 13:28:44 -0400</bug_when>
    <thetext>The change http://review.mylyn.org/#change,377 looks good as far as solving the NPE problem.  

As far as deactivating previous handler activations, it looks to me as though that problem also exists prior to this change.  I&apos;m not sure if it&apos;s a real issue - from what I can see the handler deactivation is really only a problem if the action ever gets changed during the lifecycle of the editor.  Do you think we should investigate this further?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2082746</commentid>
    <comment_count>6</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2012-03-19 14:09:44 -0400</bug_when>
    <thetext>Thanks for reviewing the change. I&apos;ll push this to master and the 3.7.x branch.

(In reply to comment #5)
&gt; As far as deactivating previous handler activations, it looks to me as though
&gt; that problem also exists prior to this change.  I&apos;m not sure if it&apos;s a real
&gt; issue - from what I can see the handler deactivation is really only a problem if
&gt; the action ever gets changed during the lifecycle of the editor.  Do you think
&gt; we should investigate this further?

Sounds good. I haven&apos;t seen any problem resulting out of this so I am fine with leaving the current implementation.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2082795</commentid>
    <comment_count>7</comment_count>
    <who name="David Green">david.green</who>
    <bug_when>2012-03-19 15:46:11 -0400</bug_when>
    <thetext>Thanks Steffen.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>