<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>368830</bug_id>
          
          <creation_ts>2012-01-17 09:58:00 -0500</creation_ts>
          <short_desc>fix NPE when releasing request</short_desc>
          <delta_ts>2012-02-23 09:02:55 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>14</classification_id>
          <classification>Mylyn</classification>
          <product>Mylyn Commons</product>
          <component>Team</component>
          <version>unspecified</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>3.7</target_milestone>
          
          <blocked>335254</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Steffen Pingel">steffen.pingel</reporter>
          <assigned_to name="Steffen Pingel">steffen.pingel</assigned_to>
          <cc>david.green</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2051574</commentid>
    <comment_count>0</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2012-01-17 09:58:12 -0500</bug_when>
    <thetext>HttpUtil.getResponseBodyAsStream() uses a producer/consumer pattern to read streams with support for cancellation. The implementation spawns a thread that fills a buffer until the stream is closed or exhausted. With HttpCore this can cause problems when the end of the stream is reached and it is automatically closed by the entity. If the request is released concurrently by the thread reading from the buffer this will cause an NPE. 

https://hudson.eclipse.org/hudson/user/spingel/my-views/view/Mylyn/job/mylyn-builds-nightly/215/testReport/org.eclipse.mylyn.hudson.tests.client/HudsonClientTest/testValidateValidUrl/

java.lang.NullPointerException
	at org.apache.http.conn.BasicManagedEntity.streamClosed(BasicManagedEntity.java:153)
	at org.apache.http.conn.EofSensorInputStream.checkClose(EofSensorInputStream.java:237)
	at org.apache.http.conn.EofSensorInputStream.close(EofSensorInputStream.java:186)
	at org.apache.http.util.EntityUtils.consume(EntityUtils.java:67)
	at org.eclipse.mylyn.commons.repositories.http.core.HttpUtil.release(HttpUtil.java:330)
	at org.eclipse.mylyn.internal.hudson.core.client.HudsonOperation.updateCrumb(HudsonOperation.java:128)
	at org.eclipse.mylyn.internal.hudson.core.client.HudsonOperation.authenticate(HudsonOperation.java:95)
	at org.eclipse.mylyn.commons.repositories.http.core.CommonHttpOperation.executeOnce(CommonHttpOperation.java:80)
	at org.eclipse.mylyn.commons.repositories.http.core.CommonHttpOperation.execute(CommonHttpOperation.java:64)
	at org.eclipse.mylyn.internal.hudson.core.client.RestfulHudsonClient$8.execute(RestfulHudsonClient.java:405)
	at org.eclipse.mylyn.internal.hudson.core.client.RestfulHudsonClient$8.execute(RestfulHudsonClient.java:1)
	at org.eclipse.mylyn.internal.hudson.core.client.HudsonOperation.run(HudsonOperation.java:134)
	at org.eclipse.mylyn.internal.hudson.core.client.RestfulHudsonClient.validate(RestfulHudsonClient.java:427)
	at org.eclipse.mylyn.hudson.tests.client.HudsonClientTest.testValidateValidUrl(HudsonClientTest.java:57)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2051890</commentid>
    <comment_count>1</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2012-01-17 16:54:49 -0500</bug_when>
    <thetext>I have committed a work-around in 6eba6ca65b76ed6589cc2f81c103d17e36fc055f to ignore the exception. This will need to get fixed properly though.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2051891</commentid>
    <comment_count>2</comment_count>
      <attachid>209648</attachid>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2012-01-17 16:54:51 -0500</bug_when>
    <thetext>Created attachment 209648
mylyn/context/zip</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2069964</commentid>
    <comment_count>3</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2012-02-23 09:02:43 -0500</bug_when>
    <thetext>The NPE has been addressed through disabling support for cancellation for ongoing transfers in commit 1dd26ba24948eb518706d195cb76dd1514224f1d. Unfortunately there is no straight forward solution to provide cancellation in a thread-safe manner. I have opened bug 372332 to track that.</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="0"
              isprivate="0"
          >
            <attachid>209648</attachid>
            <date>2012-01-17 16:54:00 -0500</date>
            <delta_ts>2012-01-17 16:54:51 -0500</delta_ts>
            <desc>mylyn/context/zip</desc>
            <filename>mylyn-context.zip</filename>
            <type>application/octet-stream</type>
            <size>2958</size>
            <attacher name="Steffen Pingel">steffen.pingel</attacher>
            
              <data encoding="base64">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
</data>

          </attachment>
      

    </bug>

</bugzilla>