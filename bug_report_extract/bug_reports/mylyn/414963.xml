<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>414963</bug_id>
          
          <creation_ts>2013-08-13 08:44:00 -0400</creation_ts>
          <short_desc>fix URL in ConnectorDiscoveryRemoteTest</short_desc>
          <delta_ts>2013-08-23 10:04:32 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>14</classification_id>
          <classification>Mylyn</classification>
          <product>Mylyn Commons</product>
          <component>Discovery</component>
          <version>unspecified</version>
          <rep_platform>Macintosh</rep_platform>
          <op_sys>Mac OS X</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords>contributed</keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>3.9.1</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Steffen Pingel">steffen.pingel</reporter>
          <assigned_to name="Tomasz Zarna">tomasz.zarna</assigned_to>
          <cc>sam.davis</cc>
          <qa_contact name="Steffen Pingel">steffen.pingel</qa_contact>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2294177</commentid>
    <comment_count>0</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-08-13 08:44:00 -0400</bug_when>
    <thetext>Discovery tests indicate that the Jira connector repository specified in the discovery bundle isn&apos;t available any longer:

Failed to verify availability for com.atlassian.connector.eclipse.jira

https://hudson.eclipse.org/sandbox/job/mylyn-commons-gerrit/182/testReport/junit/org.eclipse.mylyn.discovery.tests.core/ConnectorDiscoveryRemoteTest/testVerifyAvailability/

The entry should be updated.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2295670</commentid>
    <comment_count>1</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-08-16 10:37:18 -0400</bug_when>
    <thetext>The stack trace from the build:

[2013-08-12T1-13-41] Status ERROR: org.eclipse.equinox.p2.repository code=1002 Unable to read repository at http://update.atlassian.com/atlassian-eclipse-plugin/e3.5/content.jar. java.net.SocketException: java.security.NoSuchAlgorithmException: Error constructing implementation (algorithm: Default, provider: SunJSSE, class: com.sun.net.ssl.internal.ssl.DefaultSSLContextImpl), Exception:
java.net.SocketException: java.security.NoSuchAlgorithmException: Error constructing implementation (algorithm: Default, provider: SunJSSE, class: com.sun.net.ssl.internal.ssl.DefaultSSLContextImpl)
	at javax.net.ssl.DefaultSSLSocketFactory.throwException(SSLSocketFactory.java:179)
	at javax.net.ssl.DefaultSSLSocketFactory.createSocket(SSLSocketFactory.java:199)
	at org.apache.commons.httpclient.protocol.SSLProtocolSocketFactory.createSocket(SSLProtocolSocketFactory.java:160)
	at org.apache.commons.httpclient.HttpConnection.tunnelCreated(HttpConnection.java:786)
	at org.apache.commons.httpclient.MultiThreadedHttpConnectionManager$HttpConnectionAdapter.tunnelCreated(MultiThreadedHttpConnectionManager.java:1521)
	at org.apache.commons.httpclient.HttpMethodDirector.executeConnect(HttpMethodDirector.java:514)
	at org.apache.commons.httpclient.HttpMethodDirector.executeWithRetry(HttpMethodDirector.java:391)
	at org.apache.commons.httpclient.HttpMethodDirector.executeMethod(HttpMethodDirector.java:171)
	at org.apache.commons.httpclient.HttpClient.executeMethod(HttpClient.java:397)
	at org.apache.commons.httpclient.HttpClient.executeMethod(HttpClient.java:346)
	at org.eclipse.ecf.provider.filetransfer.httpclient.HttpClientFileSystemBrowser.runRequest(HttpClientFileSystemBrowser.java:227)
	at org.eclipse.ecf.provider.filetransfer.browse.AbstractFileSystemBrowser$DirectoryJob.run(AbstractFileSystemBrowser.java:69)
	at org.eclipse.core.internal.jobs.Worker.run(Worker.java:54)
Caused by: java.security.NoSuchAlgorithmException: Error constructing implementation (algorithm: Default, provider: SunJSSE, class: com.sun.net.ssl.internal.ssl.DefaultSSLContextImpl)
	at java.security.Provider$Service.newInstance(Provider.java:1245)
	at sun.security.jca.GetInstance.getInstance(GetInstance.java:220)
	at sun.security.jca.GetInstance.getInstance(GetInstance.java:147)
	at javax.net.ssl.SSLContext.getInstance(SSLContext.java:125)
	at javax.net.ssl.SSLContext.getDefault(SSLContext.java:68)
	at javax.net.ssl.SSLSocketFactory.getDefault(SSLSocketFactory.java:102)
	... 11 more
Caused by: java.security.PrivilegedActionException: java.io.FileNotFoundException: /shared/mylyn/spingel/.keystore (No such file or directory)
	at java.security.AccessController.doPrivileged(Native Method)
	at com.sun.net.ssl.internal.ssl.DefaultSSLContextImpl.getDefaultKeyManager(DefaultSSLContextImpl.java:120)
	at com.sun.net.ssl.internal.ssl.DefaultSSLContextImpl.&lt;init&gt;(DefaultSSLContextImpl.java:40)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:39)
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)
	at java.lang.reflect.Constructor.newInstance(Constructor.java:513)
	at java.lang.Class.newInstance0(Class.java:355)
	at java.lang.Class.newInstance(Class.java:308)
	at java.security.Provider$Service.newInstance(Provider.java:1221)
	... 16 more
Caused by: java.io.FileNotFoundException: /shared/mylyn/spingel/.keystore (No such file or directory)
	at java.io.FileInputStream.open(Native Method)
	at java.io.FileInputStream.&lt;init&gt;(FileInputStream.java:106)
	at java.io.FileInputStream.&lt;init&gt;(FileInputStream.java:66)
	at com.sun.net.ssl.internal.ssl.DefaultSSLContextImpl$2.run(DefaultSSLContextImpl.java:123)
	at com.sun.net.ssl.internal.ssl.DefaultSSLContextImpl$2.run(DefaultSSLContextImpl.java:121)
	... 26 more

Steffen is the .keystore not needed anymore?
	
When running the test locally I get a failure for a different connector:

junit.framework.AssertionFailedError: 1 unavailable: Edgewall Trac
	at junit.framework.Assert.fail(Assert.java:50)
	at org.eclipse.mylyn.discovery.tests.core.ConnectorDiscoveryRemoteTest.testVerifyAvailability(ConnectorDiscoveryRemoteTest.java:83)
   ...
   
And @com.atlassian.connector.eclipse.jira@ is not among discovered connectors.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2296019</commentid>
    <comment_count>2</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-08-18 17:27:43 -0400</bug_when>
    <thetext>It looks like the update site has indeed moved to https. We should check with Atlassian if that&apos;s permanent and update the discovery listing accordingly. Regarding the tests I&apos;m not sure where if .keystore reference in the parent pom still makes sense. I think we should try removing it from org.eclipse.mylyn/org.eclipse.mylyn-parent/pom.xml and see where that leaves us.

pre. 
$ wget   http://update.atlassian.com/atlassian-eclipse-plugin/e3.5/content.jar
--2013-08-18 23:20:28--  http://update.atlassian.com/atlassian-eclipse-plugin/e3.5/content.jar
Resolving update.atlassian.com... 131.103.28.10
Connecting to update.atlassian.com|131.103.28.10|:80... connected.
HTTP request sent, awaiting response... 301 Moved Permanently
Location: https://update.atlassian.com/atlassian-eclipse-plugin/e3.5/content.jar [following]
--2013-08-18 23:20:28--  https://update.atlassian.com/atlassian-eclipse-plugin/e3.5/content.jar
Connecting to update.atlassian.com|131.103.28.10|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 91556 (89K) [application/java-archive]
Saving to: content.jar

100%[=================================================================================&gt;] 91,556       233KB/s   in 0.4s   

2013-08-18 23:20:30 (233 KB/s) - content.jar saved [91556/91556]</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2296191</commentid>
    <comment_count>3</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-08-19 08:02:35 -0400</bug_when>
    <thetext>(In reply to comment #2)
&gt; It looks like the update site has indeed moved to https. We should check with Atlassian if that&apos;s permanent

Asked the question here https://confluence.atlassian.com/display/IDEPLUGIN/Installing+the+Eclipse+Connector?focusedCommentId=393282063#comment-393282063 , but looking at the comments I think I already know the answer.

&gt; update the discovery listing accordingly

Where do I do it? I searched for &quot;update.atlassian.com&quot; in my workspace, but found got 0 hits.

&gt; try removing it from
&gt; org.eclipse.mylyn/org.eclipse.mylyn-parent/pom.xml and see where that leaves us.

A blind try: https://git.eclipse.org/r/15600</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2296222</commentid>
    <comment_count>4</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-08-19 09:17:45 -0400</bug_when>
    <thetext>(In reply to comment #3)
&gt; &gt; update the discovery listing accordingly
&gt; 
&gt; Where do I do it? I searched for &quot;update.atlassian.com&quot; in my workspace, but
&gt; found got 0 hits.

Right... that entry is contributed from the Tasktop directory. It would need to be updated there.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2296223</commentid>
    <comment_count>5</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-08-19 09:22:10 -0400</bug_when>
    <thetext>(In reply to comment #1)
&gt; When running the test locally I get a failure for a different connector:
&gt; junit.framework.AssertionFailedError: 1 unavailable: Edgewall Trac
&gt; at junit.framework.Assert.fail(Assert.java:50)
&gt; at
&gt; org.eclipse.mylyn.discovery.tests.core.ConnectorDiscoveryRemoteTest.testVerifyAvailability(ConnectorDiscoveryRemoteTest.java:83)
&gt; ...

That&apos;s an issue not only when running locally:
http://ci.mylyn.org/job/mylyn-commons-snapshot/522/testReport/org.eclipse.mylyn.discovery.tests.core/ConnectorDiscoveryRemoteTest/testVerifyAvailability/</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2297734</commentid>
    <comment_count>6</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-08-22 05:52:24 -0400</bug_when>
    <thetext>(In reply to comment #3)
&gt; &gt; the update site has indeed moved to https. We should check with Atlassian if that&apos;s permanent
&gt; Asked the question here
&gt; https://confluence.atlassian.com/display/IDEPLUGIN/Installing+the+Eclipse+Connector?focusedCommentId=393282063#comment-393282063

It sounds they still haven&apos;t decided, but lean toward https. From comments: _We want to release new Connector version (3.2.2) in 2-3 weeks and need to decide before that date. Let&apos;s wait for more feedback._

Steffen, can I update the Tasktop directory and perform a dry run to verify we&apos;re ok with the https switch? How do I do that?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2297772</commentid>
    <comment_count>7</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-08-22 07:14:48 -0400</bug_when>
    <thetext>Sam would be the best person to talk to. For testing you can download the jar specified http://www.eclipse.org/mylyn/discovery/directory-3.9.xml and modify it, create a custom directory and then use the system property to direct Mylyn to that: http://wiki.eclipse.org/Mylyn_FAQ#System_Properties.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2297773</commentid>
    <comment_count>8</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-08-22 07:15:17 -0400</bug_when>
    <thetext>Did you find out why tests fail for the Trac entry?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2297782</commentid>
    <comment_count>9</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-08-22 07:34:16 -0400</bug_when>
    <thetext>(In reply to comment #8)
&gt; Did you find out why tests fail for the Trac entry?

No, I haven&apos;t investigated that, but will do when done reviewing bug 413480.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2297965</commentid>
    <comment_count>10</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-08-22 11:56:36 -0400</bug_when>
    <thetext>The connector fails to validate because it&apos;s configured to use http://download.eclipse.org/tools/mylyn/update/e3.4 update site (which I guess no longer exists). At least this is how it&apos;s set up in  org.eclipse.mylyn.discovery-3.4.jar found under http://www.eclipse.org/mylyn/discovery/directory-3.3.xml [1].

[1] org.eclipse.mylyn.discovery.tests.DiscoveryTestConstants.DEFAULT_MYLYN_DISCOVERY_URL</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2298011</commentid>
    <comment_count>11</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-08-22 12:27:05 -0400</bug_when>
    <thetext>Ah, that&apos;s interesting, the webmasters removed the old redirects and now it&apos;s failing. We should fix the test URL to be consistent with the actual URL for the branch. Thanks for figuring that out!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2298078</commentid>
    <comment_count>12</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-08-22 14:58:33 -0400</bug_when>
    <thetext>(In reply to comment #11)
&gt; We should fix the test URL to be consistent with the actual
&gt; URL for the branch.

Is that http://archive.eclipse.org/mylyn/drops/3.4.3/v20110204-0608/e3.4 ?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2298081</commentid>
    <comment_count>13</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-08-22 15:19:01 -0400</bug_when>
    <thetext>No, sorry, I meant the directory URL for tests. Discovery is broken for Mylyn 3.3 but we don&apos;t have any driver to fix this right now. What I would like to do is to run tests against the current location which is http://www.eclipse.org/mylyn/discovery/directory-3.9.xml for the 3.9.x branch and http://www.eclipse.org/mylyn/discovery/directory-3.10.xml for master. 

We have a framework version defined in CoreUtil so we should be able to construct the right URL easily.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2298318</commentid>
    <comment_count>14</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-08-23 07:36:38 -0400</bug_when>
    <thetext>(In reply to comment #13)
&gt; We have a framework version defined in CoreUtil so we should be able to
&gt; construct the right URL easily.

Review: https://git.eclipse.org/r/15804</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2298361</commentid>
    <comment_count>15</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-08-23 08:49:21 -0400</bug_when>
    <thetext>(In reply to comment #7)
&gt; For testing you can download the jar
&gt; specified http://www.eclipse.org/mylyn/discovery/directory-3.9.xml and modify
&gt; it, create a custom directory and then use the system property to direct Mylyn to that.

Ok, I did that and noticed no issues when verifying JIRA connector availability after switching to *https*://update.atlassian.com/atlassian-eclipse-plugin/e3.5/</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2298390</commentid>
    <comment_count>16</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-08-23 09:52:11 -0400</bug_when>
    <thetext>Thanks! I merged the patch. For 3.9.x I&apos;m proposing that we make the most minimal fix: https://git.eclipse.org/r/#/c/15810/.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2298401</commentid>
    <comment_count>17</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-08-23 10:04:32 -0400</bug_when>
    <thetext>I merged both fixes. Let&apos;s discuss the JIRA issue separately since there is nothing we can do to fix it in Mylyn.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>