<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>325006</bug_id>
          
          <creation_ts>2010-09-10 15:28:00 -0400</creation_ts>
          <short_desc>handle links when transforming file based wikitext to eclipse help</short_desc>
          <delta_ts>2013-11-12 11:42:09 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>14</classification_id>
          <classification>Mylyn</classification>
          <product>Mylyn Docs</product>
          <component>Wikitext</component>
          <version>unspecified</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>2.0</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Henrik Lindberg">henrik.lindberg</reporter>
          <assigned_to name="Torkild Resheim">torkildr</assigned_to>
          <cc>d_a_carver</cc>
    
    <cc>torkildr</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>1812628</commentid>
    <comment_count>0</comment_count>
    <who name="Henrik Lindberg">henrik.lindberg</who>
    <bug_when>2010-09-10 15:28:09 -0400</bug_when>
    <thetext>When wikitext is transformed to eclipse help using the standalone ant task, wiki links are translated to references to the link name without appending &quot;.html&quot;.

A an example - the input:
See [details] for more information.

Is transformed to:
See &lt;a href=&quot;&lt;&lt;HELPROOT&gt;&gt;/details&quot;&gt;details&lt;/a&gt;

Minimal support for wiki links, just needs to output:

See &lt;a href=&quot;&lt;&lt;HELPROOT&gt;&gt;/details&quot;&gt;details&lt;/a&gt;</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1812667</commentid>
    <comment_count>1</comment_count>
    <who name="David Green">david.green</who>
    <bug_when>2010-09-10 17:03:57 -0400</bug_when>
    <thetext>Adding Dave Carver, who (from the newsgroup) is running into the same issue.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1818312</commentid>
    <comment_count>2</comment_count>
    <who name="Henrik Lindberg">henrik.lindberg</who>
    <bug_when>2010-09-23 12:35:05 -0400</bug_when>
    <thetext>(In reply to comment #0)
Typo 
&gt; Minimal support for wiki links, just needs to output:
&gt; 
&gt; See &lt;a href=&quot;&lt;&lt;HELPROOT&gt;&gt;/details&quot;&gt;details&lt;/a&gt;

Should have been
    See &lt;a href=&quot;&lt;&lt;HELPROOT&gt;&gt;/details.html&quot;&gt;details&lt;/a&gt;</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1818321</commentid>
    <comment_count>3</comment_count>
    <who name="David Carver">d_a_carver</who>
    <bug_when>2010-09-23 12:42:10 -0400</bug_when>
    <thetext>(In reply to comment #2)
&gt; (In reply to comment #0)
&gt; Typo 
&gt; &gt; Minimal support for wiki links, just needs to output:
&gt; &gt; 
&gt; &gt; See &lt;a href=&quot;&lt;&lt;HELPROOT&gt;&gt;/details&quot;&gt;details&lt;/a&gt;
&gt; 
&gt; Should have been
&gt;     See &lt;a href=&quot;&lt;&lt;HELPROOT&gt;&gt;/details.html&quot;&gt;details&lt;/a&gt;

Correct I ended up having to override a the emitAnchorHref() method to append the .html to the end of the links.

So I extended HtmlDocumentBuilder and did my own implementation (really a hack).  Here is the relevant code below:


	@Override
	protected void emitAnchorHref(String href) {
		writer.writeAttribute(&quot;href&quot;, makeUrlAbsolute(href)); //$NON-NLS-1$
	}
	
	private static final Pattern ABSOLUTE_URL_PATTERN = Pattern.compile(&quot;[a-zA-Z]{3,8}://?.*&quot;); //$NON-NLS-1$
	
	protected String makeUrlAbsolute(String url) {
		
		if (ABSOLUTE_URL_PATTERN.matcher(url).matches()) {
			return url;
		}
		if (url.startsWith(&quot;#&quot;)) { //$NON-NLS-1$
			return url;
		}
		if (url.endsWith(&quot;.jpg&quot;) || url.endsWith(&quot;.png&quot;) || url.endsWith(&quot;.gif&quot;) || url.endsWith(&quot;.JPG&quot;) || url.endsWith(&quot;.PNG&quot;) || url.endsWith(&quot;.GIF&quot;)) {
			return url;
		}
		String absoluteUrl = url + &quot;.html&quot;;
		return absoluteUrl;
	}

Now as I said it is a hack.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2267633</commentid>
    <comment_count>4</comment_count>
    <who name="Torkild Resheim">torkildr</who>
    <bug_when>2013-06-04 08:47:19 -0400</bug_when>
    <thetext>I need this one fixed.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2268836</commentid>
    <comment_count>5</comment_count>
    <who name="David Green">david.green</who>
    <bug_when>2013-06-05 14:51:28 -0400</bug_when>
    <thetext>things to consider:
# do we do this for all relative links without file extensions or just for links referencing files that are being transformed by the current Ant task?
# this should be handled correctly in the case of generation to single or multiple files (@multipleOutputFiles@ option on Ant task)
# does the implementation result in the same output when transforming source files individually as when transforming multiple source files together in a single fileset?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2268837</commentid>
    <comment_count>6</comment_count>
      <attachid>232007</attachid>
    <who name="David Green">david.green</who>
    <bug_when>2013-06-05 14:52:05 -0400</bug_when>
    <thetext>Created attachment 232007
mylyn/context/zip</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2268845</commentid>
    <comment_count>7</comment_count>
    <who name="Torkild Resheim">torkildr</who>
    <bug_when>2013-06-05 14:59:08 -0400</bug_when>
    <thetext>Thanks for your input David, I just sat down to take a second stab at this one :-)

(In reply to comment #5)
&gt; things to consider:
&gt; # do we do this for all relative links without file extensions or just for
&gt; links referencing files that are being transformed by the current Ant task?
I believe all relative links. Maybe test that the source files (with wiki markup) actually exists?

&gt; # this should be handled correctly in the case of generation to single or
&gt; multiple files (@multipleOutputFiles@ option on Ant task)
Maybe not the same issue, rather an improvement to @multipleOutputFiles@. But definitely yes.

&gt; # does the implementation result in the same output when transforming source
&gt; files individually as when transforming multiple source files together in a
&gt; single fileset?
Yes, that was my intention. I see no reason why it should not.

I noticed I broke a lot of markup language specific tests when doing my first attempt (it appears that tests are for some reason not executed locally during maven build). So I&apos;m investigating those.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2268849</commentid>
    <comment_count>8</comment_count>
    <who name="Torkild Resheim">torkildr</who>
    <bug_when>2013-06-05 15:15:23 -0400</bug_when>
    <thetext>I see at least most of the tests I broke expect links to be unchanged. This I think is only true if the document is still on a wiki. I this case we&apos;re handling a file based wiki, a concept that seem to be missing. 

I start to think that there should be some way of detecting a file based wiki and only do the link transformation if this is the case. Or it could be left to the user and we could simply add an option to the Ant tasks.

Lastly it would be cool if we could augment the Wiki preview browser to produce proper links between e.g. *.textile pages. So a link to @foo@ would render as a link to @foo.textile@ _and_ open in the Wiki editor (not in the browser). However that is another issue.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2268872</commentid>
    <comment_count>9</comment_count>
    <who name="Torkild Resheim">torkildr</who>
    <bug_when>2013-06-05 16:12:22 -0400</bug_when>
    <thetext>I have some work going on at https://git.eclipse.org/r/#/c/13578/</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2268887</commentid>
    <comment_count>10</comment_count>
    <who name="Torkild Resheim">torkildr</who>
    <bug_when>2013-06-05 16:36:53 -0400</bug_when>
    <thetext>The solution now looks like this:

* Added flag to HtmlDocumentBuilder indicating whether or not such
  transformation of links should be done.
* The flag is enabled when markup is converted to HTML using one of
  the purposed Ant tasks. It will also handle generation to multiple
  destination files.
* Links that are relative and does not have a file suffix are
  transformed. Links to anchors in other files are also handled.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2273290</commentid>
    <comment_count>11</comment_count>
    <who name="Torkild Resheim">torkildr</who>
    <bug_when>2013-06-17 08:56:02 -0400</bug_when>
    <thetext>David, unless you have any objections I would like merge the proposed change set into master.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2273403</commentid>
    <comment_count>12</comment_count>
    <who name="David Green">david.green</who>
    <bug_when>2013-06-17 11:35:01 -0400</bug_when>
    <thetext>Torkild, I&apos;d like to complete the code review before it gets merged.  I&apos;ll try to get to it this week.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2273617</commentid>
    <comment_count>13</comment_count>
    <who name="Torkild Resheim">torkildr</who>
    <bug_when>2013-06-17 15:57:10 -0400</bug_when>
    <thetext>(In reply to comment #12)
&gt; Torkild, I&apos;d like to complete the code review before it gets merged.  I&apos;ll try
&gt; to get to it this week.
Great! Thanks David.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2291165</commentid>
    <comment_count>14</comment_count>
    <who name="David Green">david.green</who>
    <bug_when>2013-08-02 12:44:19 -0400</bug_when>
    <thetext>Closed as part of backlog clean-up.  Please re-open if you&apos;d like to see this revisited, perhaps with a contribution.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2293498</commentid>
    <comment_count>15</comment_count>
    <who name="Torkild Resheim">torkildr</who>
    <bug_when>2013-08-11 06:23:50 -0400</bug_when>
    <thetext>Work is ongoing. See https://git.eclipse.org/r/#/c/13578/</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2329256</commentid>
    <comment_count>16</comment_count>
    <who name="Torkild Resheim">torkildr</who>
    <bug_when>2013-11-12 11:42:09 -0500</bug_when>
    <thetext>Fixed in https://git.eclipse.org/r/#/c/13578/</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="0"
              isprivate="0"
          >
            <attachid>232007</attachid>
            <date>2013-06-05 14:52:00 -0400</date>
            <delta_ts>2013-06-05 14:52:05 -0400</delta_ts>
            <desc>mylyn/context/zip</desc>
            <filename>mylyn-context.zip</filename>
            <type>application/octet-stream</type>
            <size>2660</size>
            <attacher name="David Green">david.green</attacher>
            
              <data encoding="base64">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
</data>

          </attachment>
      

    </bug>

</bugzilla>