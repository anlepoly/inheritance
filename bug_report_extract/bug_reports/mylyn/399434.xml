<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>399434</bug_id>
          
          <creation_ts>2013-01-29 14:42:00 -0500</creation_ts>
          <short_desc>error opening review when Git commit not available</short_desc>
          <delta_ts>2013-06-10 23:34:48 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>14</classification_id>
          <classification>Mylyn</classification>
          <product>Mylyn Reviews</product>
          <component>Gerrit Connector</component>
          <version>unspecified</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows 7</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>2.0</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Thomas Ehrnhoefer">thomas.ehrnhoefer</reporter>
          <assigned_to name="Miles Parker">milesparker</assigned_to>
          <cc>sam.davis</cc>
    
    <cc>steffen.pingel</cc>
    
    <cc>tomasz.zarna</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2209452</commentid>
    <comment_count>0</comment_count>
    <who name="Thomas Ehrnhoefer">thomas.ehrnhoefer</who>
    <bug_when>2013-01-29 14:42:30 -0500</bug_when>
    <thetext>Getting the following error (see comment#1) when opening a review.

Other reviews seem fine. The review remains italic in my task list.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2209455</commentid>
    <comment_count>1</comment_count>
    <who name="Thomas Ehrnhoefer">thomas.ehrnhoefer</who>
    <bug_when>2013-01-29 14:43:37 -0500</bug_when>
    <thetext>org.eclipse.mylyn.internal.gerrit.core.client.GerritException: org.eclipse.jgit.errors.MissingObjectException: Missing unknown 5b7bf9a7497259b40ac0962cc8e56fb1798bb102
	at org.eclipse.mylyn.internal.gerrit.core.client.JSonSupport.parseResponse(JSonSupport.java:210)
	at org.eclipse.mylyn.internal.gerrit.core.client.GerritService.invoke(GerritService.java:106)
	at $Proxy12.patchSetDetail2(Unknown Source)
	at org.eclipse.mylyn.internal.gerrit.core.client.GerritClient$8.execute(GerritClient.java:403)
	at org.eclipse.mylyn.internal.gerrit.core.client.GerritClient.executeOnce(GerritClient.java:930)
	at org.eclipse.mylyn.internal.gerrit.core.client.GerritClient.execute(GerritClient.java:916)
	at org.eclipse.mylyn.internal.gerrit.core.client.GerritClient.getPatchSetDetail(GerritClient.java:400)
	at org.eclipse.mylyn.internal.gerrit.core.client.GerritClient.getChange(GerritClient.java:472)
	at org.eclipse.mylyn.internal.gerrit.core.GerritTaskDataHandler.getTaskData(GerritTaskDataHandler.java:98)
	at org.eclipse.mylyn.internal.gerrit.core.GerritConnector.getTaskData(GerritConnector.java:148)
	at org.eclipse.mylyn.internal.tasks.core.sync.SynchronizeTasksJob.synchronizeTask(SynchronizeTasksJob.java:245)
	at org.eclipse.mylyn.internal.tasks.core.sync.SynchronizeTasksJob.runInternal(SynchronizeTasksJob.java:218)
	at org.eclipse.mylyn.internal.tasks.core.sync.SynchronizeTasksJob.run(SynchronizeTasksJob.java:153)
	at org.eclipse.mylyn.internal.tasks.core.sync.SynchronizeTasksJob.run(SynchronizeTasksJob.java:129)
	at org.eclipse.core.internal.jobs.Worker.run(Worker.java:54)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2209527</commentid>
    <comment_count>2</comment_count>
    <who name="Sam Davis">sam.davis</who>
    <bug_when>2013-01-29 16:30:53 -0500</bug_when>
    <thetext> It seems the connector should not fail to open the review just because it couldn&apos;t fetch the patch set.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2209712</commentid>
    <comment_count>3</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-01-30 04:53:11 -0500</bug_when>
    <thetext>The error is on the server side so there is nothing that we can do to fix it but the connector could fail more gracefully and just display an error for that particular patch set while still retrieving the remainder of the review.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2210228</commentid>
    <comment_count>4</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-01-30 19:37:54 -0500</bug_when>
    <thetext>I&apos;ve hit this a few times as well. The trouble is of course that I can&apos;t hit it now. :) Thomas, can you send me the review # this is breaking on? It would be nice to figure out a way to construct a broken one so that we could test against it.

Looking at it, it seems to make sense to absorb the exception at GerritClient L 472 and then continue loading patch sets. (I don&apos;t think there is any reason to assume that a missing object will always imply all patch sets will fail?)

But the question is what do we do at that point? I don&apos;t want to just log it -- we should surface to user. We could return a Status and then throw an exception back up at getTaskData. But even then, we may not want an exception if that is going to cause any of the other usages to fail. Thoughts?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2210342</commentid>
    <comment_count>5</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-01-31 05:02:03 -0500</bug_when>
    <thetext>As a start we could just show and empty patch set and log it. Having the error message available somewhere in the UI that the object is missing would be best.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2232273</commentid>
    <comment_count>6</comment_count>
    <who name="Sam Davis">sam.davis</who>
    <bug_when>2013-03-15 17:39:07 -0400</bug_when>
    <thetext>Possibly related to 403525: Internal Server Error causes review to be always incoming
https://bugs.eclipse.org/bugs/show_bug.cgi?id=403525</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2232287</commentid>
    <comment_count>7</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-03-15 17:48:40 -0400</bug_when>
    <thetext>*** Bug 403525 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2245732</commentid>
    <comment_count>8</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-04-18 17:59:24 -0400</bug_when>
    <thetext>Thomas, can you remind me of a sample bug # that has this issue? I want to check to see if this is still happening after all of the other changes we&apos;ve made.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2245747</commentid>
    <comment_count>9</comment_count>
    <who name="Thomas Ehrnhoefer">thomas.ehrnhoefer</who>
    <bug_when>2013-04-18 18:33:11 -0400</bug_when>
    <thetext>Sorry Miles, I don&apos;t know of any right now. If I recall Steffen had restored some history that made this work again</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2245756</commentid>
    <comment_count>10</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-04-18 19:04:34 -0400</bug_when>
    <thetext>(In reply to comment #9)
&gt; Sorry Miles, I don&apos;t know of any right now. If I recall Steffen had restored
&gt; some history that made this work again

I assume you mean on the Gerrit repos itself..

Assuming so, we&apos;ll need a way to test this, so I guess we should still leave this open for now.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2245816</commentid>
    <comment_count>11</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-04-19 02:58:50 -0400</bug_when>
    <thetext>If you want to test, just remove a revision from the Gerrit repository that is referenced by a review. To provision a VM with local Gerrit repositories do:

 cd org.eclipse.mylyn.gerrit.releng/
 vagrant up
 vagrant ssh</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2247611</commentid>
    <comment_count>12</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-04-23 17:08:22 -0400</bug_when>
    <thetext>*** Bug 406367 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2247614</commentid>
    <comment_count>13</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-04-23 17:10:34 -0400</bug_when>
    <thetext>(In reply to comment #11)
&gt; If you want to test, just remove a revision from the Gerrit repository that is
&gt; referenced by a review. To provision a VM with local Gerrit repositories do:
&gt; 
&gt; cd org.eclipse.mylyn.gerrit.releng/
&gt; vagrant up
&gt; vagrant ssh

I&apos;m impressed Steffen -- with just one command you managed to hard crash my Mac. :P Turned out to be a Virtual Box error, but it will take me a bit to get this set up.

Anyway, we&apos;ll need to fix for Kepler -- I&apos;m hoping to resolve this one sometime between M7 and RC1.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2248718</commentid>
    <comment_count>14</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-04-25 18:51:06 -0400</bug_when>
    <thetext>(In reply to comment #11)
&gt; If you want to test, just remove a revision from the Gerrit repository that is
&gt; referenced by a review.

This is probably a dumb question but how do I remove a revision? I can&apos;t even seem to get access to my localhost repos from w/in EGit client anyway..</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2248790</commentid>
    <comment_count>15</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-04-26 02:38:27 -0400</bug_when>
    <thetext>Remove all references and then do a gc.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2249107</commentid>
    <comment_count>16</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-04-26 12:47:41 -0400</bug_when>
    <thetext>(In reply to comment #15)
&gt; *Remove all references* and then do a gc.

That&apos;s the part I&apos;m not clear on. Can you give me the specific steps? :)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2249129</commentid>
    <comment_count>17</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-04-26 13:29:57 -0400</bug_when>
    <thetext>See http://stackoverflow.com/questions/1072171/how-do-you-remove-an-invalid-remote-branch-reference-from-git. The references to patch sets are the refs/changes... branches.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2260615</commentid>
    <comment_count>18</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-05-21 23:45:21 -0400</bug_when>
    <thetext>This should be handled marginally better in RC1, but I&apos;m still not sure I&apos;m testing it properly. We need to revist for RC2.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2270826</commentid>
    <comment_count>19</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-06-10 18:40:15 -0400</bug_when>
    <thetext>https://git.eclipse.org/r/#/c/13715/

A nicer solution for RC4. This one fails on the patch set only, preventing the patch set form being displayed at all and logging a warning only.

Thomas, Tomasz, Sam, Steffen, Please review asap for (last-minute) inclusion in Kepler.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2270880</commentid>
    <comment_count>20</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-06-10 23:34:48 -0400</bug_when>
    <thetext>Went ahead and merged for tmrws am build. Thomas please reopen if you&apos;re still seeing this on RC4.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>