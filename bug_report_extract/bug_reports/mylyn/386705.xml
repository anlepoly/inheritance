<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>386705</bug_id>
          
          <creation_ts>2012-08-06 15:52:00 -0400</creation_ts>
          <short_desc>expand patch set when hyperlink clicked</short_desc>
          <delta_ts>2013-02-05 18:16:05 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>14</classification_id>
          <classification>Mylyn</classification>
          <product>Mylyn Reviews</product>
          <component>Gerrit Connector</component>
          <version>unspecified</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows 7</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords>contributed, noteworthy</keywords>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>2.0</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Sam Davis">sam.davis</reporter>
          <assigned_to name="Miles Parker">milesparker</assigned_to>
          <cc>tomasz.zarna</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2145352</commentid>
    <comment_count>0</comment_count>
    <who name="Sam Davis">sam.davis</who>
    <bug_when>2012-08-06 15:52:16 -0400</bug_when>
    <thetext>When clicking https://gerrit.example.com/#/c/411/3 patch set 3 should be expanded.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2210218</commentid>
    <comment_count>1</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-01-30 19:17:46 -0500</bug_when>
    <thetext>You mean *instead* of opening the relevant web page?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2210224</commentid>
    <comment_count>2</comment_count>
    <who name="Sam Davis">sam.davis</who>
    <bug_when>2013-01-30 19:32:02 -0500</bug_when>
    <thetext>If you have the connector installed and the repository set up, it doesn&apos;t open a web page, it opens the review editor. This bug is about also expanding the patch set.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2210232</commentid>
    <comment_count>3</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-01-30 19:57:57 -0500</bug_when>
    <thetext>Thanks for the clarification. I had actually clicked on your example review url above. ;)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2210239</commentid>
    <comment_count>4</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-01-30 21:50:34 -0500</bug_when>
    <thetext>Proposed solution:

https://git.eclipse.org/r/#/c/10057/</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2210623</commentid>
    <comment_count>5</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-01-31 12:10:59 -0500</bug_when>
    <thetext>This is a great suggestion. Miles, the forms API provides FormPage.selectReveal() for this purpose. You can take a look at TaskEditorAttachmentPart for instance to see an example implementation.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2210653</commentid>
    <comment_count>6</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-01-31 13:03:43 -0500</bug_when>
    <thetext>(In reply to comment #5)
&gt; This is a great suggestion. Miles, the forms API provides
&gt; FormPage.selectReveal() for this purpose. You can take a look at
&gt; TaskEditorAttachmentPart for instance to see an example implementation.

Thanks for the reference. Looks like TaskEditorAttachmentPart uses it&apos;s own implementation. It&apos;s also using a CommonFormUtil#setExpanded hack because (as I also discovered) expandable composite doesn&apos;t seem to provide a good way to programmatically alter the expansion state *and* fire the notification, which the PatchSetSection relies on to lazily create the contents. I went with another approach which was to simply call the same code when we expanded programmatically.

 I missed the &quot;selection&quot; part of the reveal. I&apos;m going to add that. Otherwise, do you see any problem w/ the way it is implemented as is?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2210663</commentid>
    <comment_count>7</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-01-31 13:12:10 -0500</bug_when>
    <thetext>(In reply to comment #6)
&gt; (In reply to comment #5)
&gt; &gt; This is a great suggestion. Miles, the forms API provides
&gt; &gt; FormPage.selectReveal() for this purpose. You can take a look at
&gt; &gt; TaskEditorAttachmentPart for instance to see an example implementation.
&gt; 
&gt; Thanks for the reference. Looks like TaskEditorAttachmentPart uses it&apos;s own
&gt; implementation. It&apos;s also using a CommonFormUtil#setExpanded hack because (as I
&gt; also discovered) expandable composite doesn&apos;t seem to provide a good way to
&gt; programmatically alter the expansion state *and* fire the notification, which
&gt; the PatchSetSection relies on to lazily create the contents. 

Yes, I would prefer if we used the same approach consistently.

&gt; I missed the &quot;selection&quot; part of the reveal. I&apos;m going to add that. Otherwise,
&gt; do you see any problem w/ the way it is implemented as is?

I am not sure we need the section manager abstraction. I would prefer if the section simply expanded itself.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2210705</commentid>
    <comment_count>8</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-01-31 14:11:28 -0500</bug_when>
    <thetext>(In reply to comment #7)
&gt; I am not sure we need the section manager abstraction. I would prefer if the
&gt; section simply expanded itself.

Yep. By using the CommonFormUtil hack that forces the toggle notification, we&apos;re able to do away with all of that.  Please see https://git.eclipse.org/r/#/c/10057/4.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2211089</commentid>
    <comment_count>9</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-02-01 08:58:16 -0500</bug_when>
    <thetext>It looks like the code doesn&apos;t use FormPage.selectReveal(). Can you comment why you decided against using that?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2211245</commentid>
    <comment_count>10</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-02-01 14:45:06 -0500</bug_when>
    <thetext>(In reply to comment #9)
&gt; It looks like the code doesn&apos;t use FormPage.selectReveal(). Can you comment why
&gt; you decided against using that?

Tried it, but it didn&apos;t work. I don&apos;t think setting the input is the appropriate thing to do here. Then I looked at the pattern in AbstractTaskEditorAttributeSection#selectReveal that used CommonFormUtil.setExpanded(getSection(), true); it worked perfectly, so I went with that. I didn&apos;t use the  EditorUtil.reveal(..) part of that because there are some unneccesary calls and the scroll to sport was off -- not sure why, but I&apos;m thinking maybe because we&apos;re actually revealing a sub section.. (?)

I want to change the name of the method to reveal at Sam&apos;s suggestion but I&apos;ll hold on that to see if there are any other changes. I&apos;m also going to check if the patch set is already expanded.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2211306</commentid>
    <comment_count>11</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-02-01 17:12:11 -0500</bug_when>
    <thetext>Okay please see latest review. Steffen, there are some additional notes on why I chose the reveal strategy I did.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2211407</commentid>
    <comment_count>12</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-02-02 18:21:56 -0500</bug_when>
    <thetext>(In reply to comment #11)
&gt; Okay please see latest review. Steffen, there are some additional notes on why I
&gt; chose the reveal strategy I did.

Okay, sounds reasonable. I have rebased the change against the latest master. Under 4.3 the scrolling to the section didn&apos;t work but this might be a bug in 4.3 which is behaving in funny ways with the editors (haven&apos;t verified on other versions). Let me know if it works for you and we can merge.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2211994</commentid>
    <comment_count>13</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-02-04 15:16:16 -0500</bug_when>
    <thetext>(In reply to comment #12)
&gt; Okay, sounds reasonable. I have rebased the change against the latest master.
&gt; Under 4.3 the scrolling to the section didn&apos;t work but this might be a bug in
&gt; 4.3 which is behaving in funny ways with the editors (haven&apos;t verified on other
&gt; versions). Let me know if it works for you and we can merge.

It works fine here, but I&apos;m running 3.8. :) I can get a 4.2/4.3 setup going if you think that makes sense. I&apos;m also wondering if it might be a Linux thing, in which case we obviously need to address it. Do you see it on earlier versions? 

I&apos;m also getting an annoying thing happening.  Originally, I had the scroll to scroll the section such that it was at the top of the view port, but this code just scrolls the minimum extent needed to reveal. The scroll to works fine initially - it scrolls up to uncover the complete patch set, but then after the patch set is actually downloaded the controls look like they are layed out again, adding an additional 10pxs or so. That then puts the button bottoms slightly below the view port, which is kind of ugly.

I&apos;m not quite ready to merge yet in any case. I want to add a bit of test coverage for the URL handling.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2212024</commentid>
    <comment_count>14</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-02-04 16:15:19 -0500</bug_when>
    <thetext>(In reply to comment #13)
&gt; I&apos;m not quite ready to merge yet in any case. I want to add a bit of test
&gt; coverage for the URL handling.

I&apos;ve taken care of that. Note that I have put a small fix into the connector getTaskUrl code as well. I hope it&apos;s okay to put that into this patch, but it is neccessary to make the tests work properly.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2212691</commentid>
    <comment_count>15</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-02-05 18:15:46 -0500</bug_when>
    <thetext>The change was merged into master. Thanks very much for the contribution!</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>