<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>371599</bug_id>
          
          <creation_ts>2012-02-15 05:53:00 -0500</creation_ts>
          <short_desc>Workbench fails to start: Plug-in org.eclipse.mylyn.tasks.ui was unable to load class org.eclipse.mylyn.internal.tasks.ui.TaskTrimWidget</short_desc>
          <delta_ts>2012-02-25 09:36:45 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>14</classification_id>
          <classification>Mylyn</classification>
          <product>Mylyn Tasks</product>
          <component>Framework</component>
          <version>unspecified</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P1</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>3.7</target_milestone>
          <dependson>366858</dependson>
    
    <dependson>371611</dependson>
    
    <dependson>371626</dependson>
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Steffen Pingel">steffen.pingel</reporter>
          <assigned_to name="Steffen Pingel">steffen.pingel</assigned_to>
          <cc>matthias.sohn</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2065993</commentid>
    <comment_count>0</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2012-02-15 05:53:53 -0500</bug_when>
    <thetext>From http://dev.eclipse.org/mhonarc/lists/mylyn-dev/msg01528.html: I updated my Indigo SR1 based workbench and now I can&apos;t start it anymore.

!SUBENTRY 1 org.eclipse.equinox.registry 4 1 2012-02-15 10:48:49.920
!MESSAGE Plug-in org.eclipse.mylyn.tasks.ui was unable to load class org.eclipse.mylyn.internal.tasks.ui.TaskTrimWidget.
!STACK 0
org.eclipse.core.runtime.internal.adaptor.EclipseLazyStarter$TerminatingClassNotFoundException: An error occurred while automatically activating bundle org.eclipse.mylyn.tasks.ui (719).
	at org.eclipse.core.runtime.internal.adaptor.EclipseLazyStarter.postFindLocalClass(EclipseLazyStarter.java:122)
	at org.eclipse.osgi.baseadaptor.loader.ClasspathManager.findLocalClass(ClasspathManager.java:462)
	at org.eclipse.osgi.internal.baseadaptor.DefaultClassLoader.findLocalClass(DefaultClassLoader.java:216)
	at org.eclipse.osgi.internal.loader.BundleLoader.findLocalClass(BundleLoader.java:400)
	at org.eclipse.osgi.internal.loader.BundleLoader.findClassInternal(BundleLoader.java:476)
	at org.eclipse.osgi.internal.loader.BundleLoader.findClass(BundleLoader.java:429)
	at org.eclipse.osgi.internal.loader.BundleLoader.findClass(BundleLoader.java:417)
	at org.eclipse.osgi.internal.baseadaptor.DefaultClassLoader.loadClass(DefaultClassLoader.java:107)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:247)
	at org.eclipse.osgi.internal.loader.BundleLoader.loadClass(BundleLoader.java:345)
	at org.eclipse.osgi.framework.internal.core.BundleHost.loadClass(BundleHost.java:229)
	at org.eclipse.osgi.framework.internal.core.AbstractBundle.loadClass(AbstractBundle.java:1207)
	at org.eclipse.core.internal.registry.osgi.RegistryStrategyOSGI.createExecutableExtension(RegistryStrategyOSGI.java:174)
	at org.eclipse.core.internal.registry.ExtensionRegistry.createExecutableExtension(ExtensionRegistry.java:905)
	at org.eclipse.core.internal.registry.ConfigurationElement.createExecutableExtension(ConfigurationElement.java:243)
	at org.eclipse.core.internal.registry.ConfigurationElementHandle.createExecutableExtension(ConfigurationElementHandle.java:55)
	at org.eclipse.ui.internal.util.Util.safeLoadExecutableExtension(Util.java:879)
	at org.eclipse.ui.internal.menus.DynamicToolBarContributionItem.createContributionItem(DynamicToolBarContributionItem.java:183)
	at org.eclipse.ui.internal.menus.DynamicToolBarContributionItem.getContributionItem(DynamicToolBarContributionItem.java:176)
	at org.eclipse.ui.internal.menus.DynamicToolBarContributionItem.createControl(DynamicToolBarContributionItem.java:278)
	at org.eclipse.jface.action.ControlContribution.fill(ControlContribution.java:97)
	at org.eclipse.jface.action.ToolBarManager.update(ToolBarManager.java:353)
	at org.eclipse.jface.action.ToolBarManager.createControl(ToolBarManager.java:111)
	at org.eclipse.ui.internal.menus.TrimContributionManager$ToolBarTrimProxy.dock(TrimContributionManager.java:88)
	at org.eclipse.ui.internal.menus.TrimContributionManager.update(TrimContributionManager.java:265)
	at org.eclipse.ui.internal.WorkbenchWindow.updateLayoutDataForContents(WorkbenchWindow.java:3867)
	at org.eclipse.ui.internal.WorkbenchWindow.setLayoutDataForContents(WorkbenchWindow.java:3878)
	at org.eclipse.ui.internal.WorkbenchWindow.createDefaultContents(WorkbenchWindow.java:1150)
	at org.eclipse.ui.internal.WorkbenchWindowConfigurer.createDefaultContents(WorkbenchWindowConfigurer.java:623)
	at org.eclipse.ui.application.WorkbenchWindowAdvisor.createWindowContents(WorkbenchWindowAdvisor.java:300)
	at org.eclipse.ui.internal.WorkbenchWindow.createContents(WorkbenchWindow.java:1036)
	at org.eclipse.jface.window.Window.create(Window.java:431)
	at org.eclipse.ui.internal.Workbench$22.runWithException(Workbench.java:1211)
	at org.eclipse.ui.internal.StartupThreading$StartupRunnable.run(StartupThreading.java:31)
	at org.eclipse.swt.widgets.RunnableLock.run(RunnableLock.java:35)
	at org.eclipse.swt.widgets.Synchronizer.runAsyncMessages(Synchronizer.java:135)
	at org.eclipse.swt.widgets.Display.runAsyncMessages(Display.java:3938)
	at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3615)
	at org.eclipse.ui.application.WorkbenchAdvisor.openWindows(WorkbenchAdvisor.java:803)
	at org.eclipse.ui.internal.Workbench$33.runWithException(Workbench.java:1595)
	at org.eclipse.ui.internal.StartupThreading$StartupRunnable.run(StartupThreading.java:31)
	at org.eclipse.swt.widgets.RunnableLock.run(RunnableLock.java:35)
	at org.eclipse.swt.widgets.Synchronizer.runAsyncMessages(Synchronizer.java:135)
	at org.eclipse.swt.widgets.Display.runAsyncMessages(Display.java:3938)
	at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3615)
	at org.eclipse.ui.internal.Workbench.runUI(Workbench.java:2604)
	at org.eclipse.ui.internal.Workbench.access$4(Workbench.java:2494)
	at org.eclipse.ui.internal.Workbench$7.run(Workbench.java:674)
	at org.eclipse.core.databinding.observable.Realm.runWithDefault(Realm.java:332)
	at org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:667)
	at org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:149)
	at org.eclipse.ui.internal.ide.application.IDEApplication.start(IDEApplication.java:123)
	at org.eclipse.equinox.internal.app.EclipseAppHandle.run(EclipseAppHandle.java:196)
	at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:110)
	at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:79)
	at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:344)
	at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:179)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.eclipse.equinox.launcher.Main.invokeFramework(Main.java:622)
	at org.eclipse.equinox.launcher.Main.basicRun(Main.java:577)
	at org.eclipse.equinox.launcher.Main.run(Main.java:1410)
Caused by: org.osgi.framework.BundleException: The activator org.eclipse.mylyn.internal.tasks.ui.TasksUiPlugin for bundle org.eclipse.mylyn.tasks.ui is invalid
	at org.eclipse.osgi.framework.internal.core.AbstractBundle.loadBundleActivator(AbstractBundle.java:171)
	at org.eclipse.osgi.framework.internal.core.BundleContextImpl.start(BundleContextImpl.java:679)
	at org.eclipse.osgi.framework.internal.core.BundleHost.startWorker(BundleHost.java:381)
	at org.eclipse.osgi.framework.internal.core.AbstractBundle.start(AbstractBundle.java:299)
	at org.eclipse.osgi.framework.util.SecureAction.start(SecureAction.java:440)
	at org.eclipse.osgi.internal.loader.BundleLoader.setLazyTrigger(BundleLoader.java:268)
	at org.eclipse.core.runtime.internal.adaptor.EclipseLazyStarter.postFindLocalClass(EclipseLazyStarter.java:107)
	... 63 more
Caused by: java.lang.NoClassDefFoundError: org/eclipse/mylyn/commons/identity/spi/IdentityConnector
	at java.lang.Class.getDeclaredConstructors0(Native Method)
	at java.lang.Class.privateGetDeclaredConstructors(Class.java:2389)
	at java.lang.Class.getConstructor0(Class.java:2699)
	at java.lang.Class.newInstance0(Class.java:326)
	at java.lang.Class.newInstance(Class.java:308)
	at org.eclipse.osgi.framework.internal.core.AbstractBundle.loadBundleActivator(AbstractBundle.java:166)
	... 69 more
Caused by: java.lang.ClassNotFoundException: org.eclipse.mylyn.commons.identity.spi.IdentityConnector
	at org.eclipse.osgi.internal.loader.BundleLoader.findClassInternal(BundleLoader.java:513)
	at org.eclipse.osgi.internal.loader.BundleLoader.findClass(BundleLoader.java:429)
	at org.eclipse.osgi.internal.loader.BundleLoader.findClass(BundleLoader.java:417)
	at org.eclipse.osgi.internal.baseadaptor.DefaultClassLoader.loadClass(DefaultClassLoader.java:107)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:247)
	... 75 more</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2065996</commentid>
    <comment_count>1</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2012-02-15 05:55:51 -0500</bug_when>
    <thetext>Installed Mylyn features:

org.eclipse.mylyn.bugzilla_feature_3.7.0.I20111130-1139
org.eclipse.mylyn.builds_0.9.0.I20111130-1139
org.eclipse.mylyn.context_feature_3.7.0.I20111130-1139
org.eclipse.mylyn.cvs_0.9.0.I20111201-1239
org.eclipse.mylyn.gerrit.feature_0.9.0.I20111201-1313
org.eclipse.mylyn.git_0.9.0.I20111201-1239
org.eclipse.mylyn.hudson_0.9.0.I20111130-1139
org.eclipse.mylyn.ide_feature_3.7.0.I20111130-1139
org.eclipse.mylyn.java_feature_3.7.0.I20111130-1139
org.eclipse.mylyn.pde_feature_3.7.0.I20111130-1139
org.eclipse.mylyn.reviews.feature_0.9.0.I20111201-1313
org.eclipse.mylyn.team_feature_3.7.0.I20111130-1139
org.eclipse.mylyn.versions_0.9.0.I20111201-1239
org.eclipse.mylyn_feature_3.7.0.I20111130-1139

Installed Mylyn plug-ins:

org.eclipse.mylyn.commons.core_3.7.0.I20111214-1125.jar
org.eclipse.mylyn.commons.core_3.7.0.I20120212-0747.jar
org.eclipse.mylyn.commons.identity_0.9.0.I20111214-1125.jar
org.eclipse.mylyn.commons.identity_0.9.0.v20111206-0100.jar
org.eclipse.mylyn.commons.net_3.7.0.I20111214-1125.jar
org.eclipse.mylyn.commons.net_3.7.0.I20120212-0747.jar
org.eclipse.mylyn.commons.notifications_0.9.0.I20111130-1139.jar
org.eclipse.mylyn.commons.repositories_0.9.0.I20111214-1125.jar
org.eclipse.mylyn.commons.repositories_0.9.0.v20111206-0100.jar
org.eclipse.mylyn.commons.screenshots_3.7.0.I20111214-1125.jar
org.eclipse.mylyn.commons.screenshots_3.7.0.I20120212-0747.jar
org.eclipse.mylyn.commons.team_0.9.0.I20111214-1125.jar
org.eclipse.mylyn.commons.team_0.9.0.v20111206-0100.jar
org.eclipse.mylyn.commons.ui_3.7.0.I20111214-1125.jar
org.eclipse.mylyn.commons.ui_3.7.0.I20120212-0747.jar
org.eclipse.mylyn.commons.workbench_3.7.0.I20111214-1125.jar
org.eclipse.mylyn.commons.xmlrpc_3.7.0.I20111130-1139.jar
org.eclipse.mylyn.context.core_3.7.0.I20111130-1139.jar
org.eclipse.mylyn.context.tasks.ui_3.7.0.I20111130-1139.jar
org.eclipse.mylyn.context.ui_3.7.0.I20111130-1139.jar
org.eclipse.mylyn.cvs.core_0.9.0.I20111201-1239.jar
org.eclipse.mylyn.discovery.core_3.7.0.I20111130-1139.jar
org.eclipse.mylyn.discovery.ui_3.7.0.I20111130-1139.jar
org.eclipse.mylyn.gerrit.core_0.9.0.I20111201-1313.jar
org.eclipse.mylyn.gerrit.ui_0.9.0.I20111201-1313.jar
org.eclipse.mylyn.git.core_0.9.0.I20111201-1239.jar
org.eclipse.mylyn.git.ui_0.9.0.I20111201-1239.jar
org.eclipse.mylyn.help.ui_3.7.0.I20111130-1139.jar
org.eclipse.mylyn.hudson.core_0.9.0.I20111130-1139.jar
org.eclipse.mylyn.hudson.ui_0.9.0.I20111130-1139.jar
org.eclipse.mylyn.ide.ant_3.7.0.I20111130-1139.jar
org.eclipse.mylyn.ide.ui_3.7.0.I20111130-1139.jar
org.eclipse.mylyn.java.tasks_3.7.0.I20111130-1139.jar
org.eclipse.mylyn.java.ui_3.7.0.I20111130-1139.jar
org.eclipse.mylyn.monitor.core_3.7.0.I20111130-1139.jar
org.eclipse.mylyn.monitor.ui_3.7.0.I20111130-1139.jar
org.eclipse.mylyn.pde.ui_3.7.0.I20111130-1139.jar
org.eclipse.mylyn.resources.ui_3.7.0.I20111130-1139.jar
org.eclipse.mylyn.reviews.core_0.9.0.I20111201-1313.jar
org.eclipse.mylyn.reviews.ui_0.9.0.I20111201-1313.jar
org.eclipse.mylyn.tasks.bugs_3.7.0.I20111130-1139.jar
org.eclipse.mylyn.tasks.core_3.7.0.I20111130-1139.jar
org.eclipse.mylyn.tasks.search_3.7.0.I20111130-1139.jar
org.eclipse.mylyn.tasks.ui_3.7.0.I20111130-1139.jar
org.eclipse.mylyn.team.cvs_3.7.0.I20111130-1139.jar
org.eclipse.mylyn.team.ui_3.7.0.I20111130-1139.jar
org.eclipse.mylyn.versions.core_0.9.0.I20111201-1239.jar
org.eclipse.mylyn.versions.ui_0.9.0.I20111201-1239.jar
org.eclipse.mylyn.wikitext.core_1.6.0.I20111214-1125.jar
org.eclipse.mylyn.wikitext.core_1.6.0.I20120212-0747.jar
org.eclipse.mylyn.wikitext.mediawiki.core_1.6.0.I20111214-1125.jar
org.eclipse.mylyn.wikitext.mediawiki.core_1.6.0.I20120212-0747.jar</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2066008</commentid>
    <comment_count>2</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2012-02-15 06:06:50 -0500</bug_when>
    <thetext>The culprit is the 0.9.0.v20111206-0100 version of org.eclipse.mylyn.commons.identity which overrides the version that is expected by the installed version of org.eclipse.mylyn.tasks.ui:

org.eclipse.mylyn.commons.identity_0.9.0.I20111214-1125.jar
org.eclipse.mylyn.commons.identity_0.9.0.v20111206-0100.jar

It unfortunate that p2 updated some bundles in org.eclipse.commons.ui but did not update features. The updated bundles are empty stubs due to restructuring bundles (bug 350385). 

We need to address the problem on two levels:

* We need to check if there is anything that can be done to avoid this update scenario.
* We need to consider splitting the trim widget into a separate bundle to avoid activation of o.e.m.tasks.ui since the workbench does not handle class loading failures gracefully in this scenario.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2071132</commentid>
    <comment_count>3</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2012-02-25 09:36:45 -0500</bug_when>
    <thetext>I have done 3 things to address this problem:

* Requested a fix in platform to fix the failing workbench startup (bug 371611)
* Set stricter version constraints in the 3.6.5 release to prevent updating of stubs into 3.6.5 (bug 371626)
* Added the implementation back into the stubs but removed all extensions. This will ensure that if stubs are installed with Mylyn [3.6.0,3.6.5) or [3.7.0,3.7.0.I2012) the workbench will still load. In that case there will be a minor loss in functionality (missing New Team Repository Wizard and Team Repositories View) which is easy to recover from by updating to the latest 3.7.0 integration build.

Please reopen if anything was missed.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>