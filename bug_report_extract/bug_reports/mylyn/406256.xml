<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>406256</bug_id>
          
          <creation_ts>2013-04-22 16:41:00 -0400</creation_ts>
          <short_desc>GerritException when attempting to refresh editor contents</short_desc>
          <delta_ts>2013-04-25 18:57:32 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>14</classification_id>
          <classification>Mylyn</classification>
          <product>Mylyn Reviews</product>
          <component>Framework</component>
          <version>unspecified</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>2.0</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Miles Parker">milesparker</reporter>
          <assigned_to name="Miles Parker">milesparker</assigned_to>
          <cc>sam.davis</cc>
    
    <cc>steffen.pingel</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2246968</commentid>
    <comment_count>0</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-04-22 16:41:01 -0400</bug_when>
    <thetext>Sam&apos;s seeing this exception when he attempts to refresh the editor:

org.eclipse.mylyn.internal.gerrit.core.client.GerritException: Failed to obtain Gerrit configuration
 at org.eclipse.mylyn.internal.gerrit.core.client.GerritClient.refreshGerritConfig(GerritClient.java:603)
 at org.eclipse.mylyn.internal.gerrit.core.client.GerritClient.refreshConfig(GerritClient.java:619)
 at org.eclipse.mylyn.internal.gerrit.core.remote.GerritReviewRemoteFactory.pull(GerritReviewRemoteFactory.java:82)
 at org.eclipse.mylyn.internal.gerrit.core.remote.GerritReviewRemoteFactory.pull(GerritReviewRemoteFactory.java:1)
 at org.eclipse.mylyn.reviews.core.spi.remote.emf.RemoteEmfConsumer.pull(RemoteEmfConsumer.java:154)
 at org.eclipse.mylyn.reviews.core.spi.remote.JobRemoteService$1$1.run(JobRemoteService.java:63)
 at org.eclipse.core.internal.jobs.Worker.run(Worker.java:54)

It appears to have something to do with refreshing the configuration. We may be being too aggressive about it, which is creating Gerrit Remote timing issues? (Sam has a very fast connection to his review repos, something we don&apos;t have for out regular UI informal testing.)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2246969</commentid>
    <comment_count>1</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-04-22 16:42:45 -0400</bug_when>
    <thetext>Sam, please try: https://git.eclipse.org/r/#/c/12109/ We&apos;ll see if only refreshing the config once per session takes care of this.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2246997</commentid>
    <comment_count>2</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-04-22 17:33:55 -0400</bug_when>
    <thetext>Well, it fails a little more gracefully now and at least we&apos;re getting useful diagnostics now that we&apos;re not asking for the configuration. This is what I&apos;m seeing:

Steffen, any idea what might be happening here?

org.eclipse.mylyn.internal.gerrit.core.client.GerritException: Invalid xsrfKey in request
	at org.eclipse.mylyn.internal.gerrit.core.client.JSonSupport.parseResponse(JSonSupport.java:210)
	at org.eclipse.mylyn.internal.gerrit.core.client.GerritService.invoke(GerritService.java:106)
	at $Proxy6.patchScript(Unknown Source)
	at org.eclipse.mylyn.internal.gerrit.core.client.GerritClient$7.execute(GerritClient.java:371)
	at org.eclipse.mylyn.internal.gerrit.core.client.GerritClient.executeOnce(GerritClient.java:887)
	at org.eclipse.mylyn.internal.gerrit.core.client.GerritClient.execute(GerritClient.java:877)
	at org.eclipse.mylyn.internal.gerrit.core.client.GerritClient.getPatchScript(GerritClient.java:368)
	at org.eclipse.mylyn.internal.gerrit.core.client.GerritClient.loadPatchSetContent(GerritClient.java:305)
	at org.eclipse.mylyn.internal.gerrit.core.remote.PatchSetContentRemoteFactory.pull(PatchSetContentRemoteFactory.java:70)
	at org.eclipse.mylyn.internal.gerrit.core.remote.PatchSetContentIdRemoteFactory.pull(PatchSetContentIdRemoteFactory.java:43)
	at org.eclipse.mylyn.internal.gerrit.core.remote.PatchSetContentIdRemoteFactory.pull(PatchSetContentIdRemoteFactory.java:1)
	at org.eclipse.mylyn.reviews.core.spi.remote.emf.RemoteEmfConsumer.pull(RemoteEmfConsumer.java:154)
	at org.eclipse.mylyn.reviews.core.spi.remote.JobRemoteService$1$1.run(JobRemoteService.java:63)
	at org.eclipse.core.internal.jobs.Worker.run(Worker.java:54)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2247012</commentid>
    <comment_count>3</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-04-22 18:18:34 -0400</bug_when>
    <thetext>(In reply to comment #2)
&gt; Well, it fails a little more gracefully now and at least we&apos;re getting useful
&gt; diagnostics now that we&apos;re not asking for the configuration. This is what I&apos;m
&gt; seeing:
&gt; 
&gt; Steffen, any idea what might be happening here?
&gt; 
&gt; org.eclipse.mylyn.internal.gerrit.core.client.GerritException: Invalid xsrfKey
&gt; in request

That usually indicates that you are not authenticated properly, e.g. if the session has expired.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2247068</commentid>
    <comment_count>4</comment_count>
    <who name="Sam Davis">sam.davis</who>
    <bug_when>2013-04-22 21:41:44 -0400</bug_when>
    <thetext>I get the following exception when trying to open 2 reviews at the same time.

org.eclipse.mylyn.internal.gerrit.core.client.GerritException: Invalid xsrfKey in request
	at org.eclipse.mylyn.internal.gerrit.core.client.JSonSupport.parseResponse(JSonSupport.java:210)
	at org.eclipse.mylyn.internal.gerrit.core.client.GerritService.invoke(GerritService.java:106)
	at $Proxy15.changeDetailX(Unknown Source)
	at org.eclipse.mylyn.internal.gerrit.core.client.GerritClient$4.execute(GerritClient.java:292)
	at org.eclipse.mylyn.internal.gerrit.core.client.GerritClient.executeOnce(GerritClient.java:887)
	at org.eclipse.mylyn.internal.gerrit.core.client.GerritClient.execute(GerritClient.java:877)
	at org.eclipse.mylyn.internal.gerrit.core.client.GerritClient.getChangeDetail(GerritClient.java:289)
	at org.eclipse.mylyn.internal.gerrit.core.client.GerritClient.getChange(GerritClient.java:459)
	at org.eclipse.mylyn.internal.gerrit.core.remote.GerritReviewRemoteFactory.pull(GerritReviewRemoteFactory.java:85)
	at org.eclipse.mylyn.internal.gerrit.core.remote.GerritReviewRemoteFactory.pull(GerritReviewRemoteFactory.java:1)
	at org.eclipse.mylyn.reviews.core.spi.remote.emf.RemoteEmfConsumer.pull(RemoteEmfConsumer.java:154)
	at org.eclipse.mylyn.reviews.core.spi.remote.JobRemoteService$1$1.run(JobRemoteService.java:63)
	at org.eclipse.core.internal.jobs.Worker.run(Worker.java:54)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2248710</commentid>
    <comment_count>5</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-04-25 18:03:34 -0400</bug_when>
    <thetext>This is proving difficult to reproduce, but I&apos;ve seen it as well, though not recently. Sam, sorry, but are you still seeing this on Master?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2248722</commentid>
    <comment_count>6</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-04-25 18:57:32 -0400</bug_when>
    <thetext>Um, I couldn&apos;t reproduce it because I already fixed it. :D Merged: https://git.eclipse.org/r/#/c/12109</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>