<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>415788</bug_id>
          
          <creation_ts>2013-08-23 14:35:00 -0400</creation_ts>
          <short_desc>Ant wikitext-to-html task&apos;s multipleOutputFiles produces incorrect HTML filenames from accented heading</short_desc>
          <delta_ts>2013-11-11 15:40:52 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>14</classification_id>
          <classification>Mylyn</classification>
          <product>Mylyn Docs</product>
          <component>Wikitext</component>
          <version>unspecified</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>2.0</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Libor Jelinek">ljelinek</reporter>
          <assigned_to name="David Green">david.green</assigned_to>
          <cc>ljelinek</cc>
          <qa_contact name="David Green">david.green</qa_contact>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2298529</commentid>
    <comment_count>0</comment_count>
    <who name="Libor Jelinek">ljelinek</who>
    <bug_when>2013-08-23 14:35:16 -0400</bug_when>
    <thetext>Consider this example ant wikitext-to-html task

  &lt;wikitext-to-html
    title=&quot;Accented letters&quot;
    file=&quot;accents.textile&quot;
    markupLanguage=&quot;Textile&quot;
    validate=&quot;true&quot;
    failOnValidationError=&quot;true&quot;
    failOnValidationWarning=&quot;true&quot;
    sourceEncoding=&quot;UTF-8&quot;
    multipleOutputFiles=&quot;true&quot;
    formatOutput=&quot;true&quot; 
    navigationImages=&quot;true&quot;
    defaultAbsoluteLinkTarget=&quot;_blank&quot;
    copyrightNotice=&quot;${copyrightNotice}&quot;&gt;
      &lt;stylesheet url=&quot;../theme/css/main.css&quot; /&gt;
  &lt;/wikitext-to-html&gt;

accents.textile sources which produces invalid HTML filenames accents.html, -.html and -2.html:
  
  h1. Accented letters test

  h1. 

  Filename should be AAAAAACEEEEIIIINOOOOOUUUUY.html

  but actually is -.html

  h1. 

  Filename should be aaaaaaceeeeiiiinooooouuuuyy.html

  but actually is -2.html

I suggest to &quot;unaccent&quot; letters before creating filename with method similar to the following:

  /**
   * &quot;Un-accents&quot; char, i.e. convert accented char to unaccented ones.
   * 
   * @param original
   * @param replaceIllegalCharsWith
   * @return Unaccented original, empty string for null original. 
   */
  public static String unAccent(String original) {
    if (original == null)
      return &quot;&quot;;
  
    // Somebody suggest to use {InCombiningDiacriticalMarks} instead of {IsM}
    return Normalizer.normalize(original, Normalizer.Form.NFD).replaceAll(
        &quot;\\p{IsM}+&quot;, &quot;&quot;);
  }

Here is test:

  @Test
  public void testUnAccent() {
    // Western Europe letters
    assertEquals(&quot;AAAAAACEEEEIIIINOOOOOUUUUY&quot;, unAccent(&quot;&quot;));
    assertEquals(&quot;aaaaaaceeeeiiiinooooouuuuyy&quot;, unAccent(&quot;&quot;));
	
    // Czech http://cs.wikipedia.org/wiki/Abeceda
    assertEquals(&quot;ACDEEINORSTUUYZ&quot;, unAccent(&quot;&quot;));
    assertEquals(&quot;acdeeinorstuuy&quot;, unAccent(&quot;&quot;));
		
    // Slovak http://cs.wikipedia.org/wiki/Slovensk%C3%A1_abeceda
    assertEquals(&quot;ACDELLNOORSTUYZ&quot;, unAccent(&quot;&quot;));
    assertEquals(&quot;aacdllnoorstuyz&quot;, unAccent(&quot;&quot;));
}</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2299945</commentid>
    <comment_count>1</comment_count>
      <attachid>234845</attachid>
    <who name="Libor Jelinek">ljelinek</who>
    <bug_when>2013-08-28 07:47:03 -0400</bug_when>
    <thetext>Created attachment 234845
&quot;un-accenting&quot; HTML filenames

I&apos;ve fixed this by &quot;un-accenting&quot; any HTML filenames in DefaultSplittingStrategy and MarkupToHtmlTask classes. See attached patch.

This contribution complies with http://www.eclipse.org/legal/CoO.php.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2323577</commentid>
    <comment_count>2</comment_count>
    <who name="David Green">david.green</who>
    <bug_when>2013-10-26 00:39:01 -0400</bug_when>
    <thetext>Libor, thanks for the bug.  I&apos;ve pushed a change based on your recommendations, let me know what you think.

  https://git.eclipse.org/r/17791</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2328905</commentid>
    <comment_count>3</comment_count>
    <who name="David Green">david.green</who>
    <bug_when>2013-11-11 15:29:47 -0500</bug_when>
    <thetext>17791 has been merged.  Thanks for the contribution Libor.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2328910</commentid>
    <comment_count>4</comment_count>
    <who name="Libor Jelinek">ljelinek</who>
    <bug_when>2013-11-11 15:40:52 -0500</bug_when>
    <thetext>I thanks for making WikiText!</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="1"
              isprivate="0"
          >
            <attachid>234845</attachid>
            <date>2013-08-28 07:47:00 -0400</date>
            <delta_ts>2013-08-28 07:47:03 -0400</delta_ts>
            <desc>&quot;un-accenting&quot; HTML filenames</desc>
            <filename>wikitext- bug-15788.patch</filename>
            <type>text/plain</type>
            <size>2975</size>
            <attacher name="Libor Jelinek">ljelinek</attacher>
            
              <data encoding="base64">ZGlmZiAtLWdpdCBhL29yZy5lY2xpcHNlLm15bHluLndpa2l0ZXh0LmNvcmUvc3JjL29yZy9lY2xp
cHNlL215bHluL2ludGVybmFsL3dpa2l0ZXh0L2NvcmUvcGFyc2VyL2J1aWxkZXIvRGVmYXVsdFNw
bGl0dGluZ1N0cmF0ZWd5LmphdmEgYi9vcmcuZWNsaXBzZS5teWx5bi53aWtpdGV4dC5jb3JlL3Ny
Yy9vcmcvZWNsaXBzZS9teWx5bi9pbnRlcm5hbC93aWtpdGV4dC9jb3JlL3BhcnNlci9idWlsZGVy
L0RlZmF1bHRTcGxpdHRpbmdTdHJhdGVneS5qYXZhCmluZGV4IDRlMWUzZjguLjUxNjY3MzggMTAw
NjQ0Ci0tLSBhL29yZy5lY2xpcHNlLm15bHluLndpa2l0ZXh0LmNvcmUvc3JjL29yZy9lY2xpcHNl
L215bHluL2ludGVybmFsL3dpa2l0ZXh0L2NvcmUvcGFyc2VyL2J1aWxkZXIvRGVmYXVsdFNwbGl0
dGluZ1N0cmF0ZWd5LmphdmEKKysrIGIvb3JnLmVjbGlwc2UubXlseW4ud2lraXRleHQuY29yZS9z
cmMvb3JnL2VjbGlwc2UvbXlseW4vaW50ZXJuYWwvd2lraXRleHQvY29yZS9wYXJzZXIvYnVpbGRl
ci9EZWZhdWx0U3BsaXR0aW5nU3RyYXRlZ3kuamF2YQpAQCAtNyw5ICs3LDExIEBACiAgKgogICog
Q29udHJpYnV0b3JzOgogICogICAgIERhdmlkIEdyZWVuIC0gaW5pdGlhbCBBUEkgYW5kIGltcGxl
bWVudGF0aW9uCisgKiAgICAgTGlib3IgSmVsaW5layAtIGJ1ZyA0MTU3ODgKICAqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqLwogcGFja2FnZSBvcmcuZWNsaXBzZS5teWx5bi5pbnRlcm5hbC53aWtpdGV4
dC5jb3JlLnBhcnNlci5idWlsZGVyOwogCitpbXBvcnQgamF2YS50ZXh0Lk5vcm1hbGl6ZXI7CiBp
bXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CiBpbXBvcnQgamF2YS51dGlsLlNldDsKIApAQCAtNTQs
NiArNTYsMTAgQEAKIAl9CiAKIAlwcm90ZWN0ZWQgU3RyaW5nIGNvbXB1dGVTcGxpdFRhcmdldCgp
IHsKKwkJLy8gUmVwbGFjZSBhY2NlbnRlZCBsZXR0ZXJzIHdpdGggdW5hY2NlbnRlZCBvbmVzCisJ
CS8vIGh0dHBzOi8vYnVncy5lY2xpcHNlLm9yZy9idWdzL3Nob3dfYnVnLmNnaT9pZD00MTU3ODgK
KwkJbGFiZWwgPSBOb3JtYWxpemVyLm5vcm1hbGl6ZShsYWJlbCwgTm9ybWFsaXplci5Gb3JtLk5G
RCkucmVwbGFjZUFsbCgiXFxwe0lzTX0rIiwgIiIpOyAvLyROT04tTkxTLTEkIC8vJE5PTi1OTFMt
MiQKKwogCQlTdHJpbmcgY2FuZGlkYXRlID0gbnVsbDsKIAkJaWYgKGNhbmRpZGF0ZSA9PSBudWxs
KSB7CiAJCQlpZiAobGFiZWwgIT0gbnVsbCAmJiBsYWJlbC5sZW5ndGgoKSA+IDApIHsKQEAgLTcy
LDYgKzc4LDcgQEAKIAkJd2hpbGUgKCF0YXJnZXRzLmFkZChjb21wdXRlZFRhcmdldCkpIHsKIAkJ
CWNvbXB1dGVkVGFyZ2V0ID0gY2FuZGlkYXRlICsgKCsrc2VlZCk7CiAJCX0KKwogCQlyZXR1cm4g
Y29tcHV0ZWRUYXJnZXQgKyAiLmh0bWwiOyAvLyROT04tTkxTLTEkCiAJfQogCmRpZmYgLS1naXQg
YS9vcmcuZWNsaXBzZS5teWx5bi53aWtpdGV4dC5jb3JlL3NyYy9vcmcvZWNsaXBzZS9teWx5bi93
aWtpdGV4dC9jb3JlL3V0aWwvYW50dGFzay9NYXJrdXBUb0h0bWxUYXNrLmphdmEgYi9vcmcuZWNs
aXBzZS5teWx5bi53aWtpdGV4dC5jb3JlL3NyYy9vcmcvZWNsaXBzZS9teWx5bi93aWtpdGV4dC9j
b3JlL3V0aWwvYW50dGFzay9NYXJrdXBUb0h0bWxUYXNrLmphdmEKaW5kZXggOTY4ZDA3NS4uMmQz
MGRiOCAxMDA2NDQKLS0tIGEvb3JnLmVjbGlwc2UubXlseW4ud2lraXRleHQuY29yZS9zcmMvb3Jn
L2VjbGlwc2UvbXlseW4vd2lraXRleHQvY29yZS91dGlsL2FudHRhc2svTWFya3VwVG9IdG1sVGFz
ay5qYXZhCisrKyBiL29yZy5lY2xpcHNlLm15bHluLndpa2l0ZXh0LmNvcmUvc3JjL29yZy9lY2xp
cHNlL215bHluL3dpa2l0ZXh0L2NvcmUvdXRpbC9hbnR0YXNrL01hcmt1cFRvSHRtbFRhc2suamF2
YQpAQCAtNyw3ICs3LDggQEAKICAqCiAgKiBDb250cmlidXRvcnM6CiAgKiAgICAgRGF2aWQgR3Jl
ZW4gLSBpbml0aWFsIEFQSSBhbmQgaW1wbGVtZW50YXRpb24KLSAqICAgICBQZXRlciBTdGlicmFu
eSAtIGJ1ZyAyOTQzODMgCisgKiAgICAgUGV0ZXIgU3RpYnJhbnkgLSBidWcgMjk0MzgzCisgKiAg
ICAgTGlib3IgSmVsaW5layAtIGJ1ZyA0MTU3ODggCiAgKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8K
IHBhY2thZ2Ugb3JnLmVjbGlwc2UubXlseW4ud2lraXRleHQuY29yZS51dGlsLmFudHRhc2s7CiAK
QEAgLTE3LDYgKzE4LDcgQEAKIGltcG9ydCBqYXZhLmlvLk91dHB1dFN0cmVhbVdyaXRlcjsKIGlt
cG9ydCBqYXZhLmlvLldyaXRlcjsKIGltcG9ydCBqYXZhLnRleHQuTWVzc2FnZUZvcm1hdDsKK2lt
cG9ydCBqYXZhLnRleHQuTm9ybWFsaXplcjsKIGltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0Owog
aW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwogaW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwpAQCAt
MTg4LDYgKzE5MCwxMCBAQAogCQkJbmFtZSA9IG5hbWUuc3Vic3RyaW5nKDAsIG5hbWUubGFzdElu
ZGV4T2YoJy4nKSk7CiAJCX0KIAorCQkvLyBSZXBsYWNlIGFjY2VudGVkIGxldHRlcnMgd2l0aCB1
bmFjY2VudGVkIG9uZXMKKwkJLy8gaHR0cHM6Ly9idWdzLmVjbGlwc2Uub3JnL2J1Z3Mvc2hvd19i
dWcuY2dpP2lkPTQxNTc4OAorCQluYW1lID0gTm9ybWFsaXplci5ub3JtYWxpemUobmFtZSwgTm9y
bWFsaXplci5Gb3JtLk5GRCkucmVwbGFjZUFsbCgiXFxwe0lzTX0rIiwgIiIpOyAvLyROT04tTkxT
LTEkIC8vJE5PTi1OTFMtMiQKKwogCQlGaWxlIGh0bWxPdXRwdXRGaWxlID0gY29tcHV0ZUh0bWxG
aWxlKHNvdXJjZSwgbmFtZSk7CiAJCWlmICghaHRtbE91dHB1dEZpbGUuZXhpc3RzKCkgfHwgb3Zl
cndyaXRlIHx8IGh0bWxPdXRwdXRGaWxlLmxhc3RNb2RpZmllZCgpIDwgc291cmNlLmxhc3RNb2Rp
ZmllZCgpKSB7CiA=
</data>

          </attachment>
      

    </bug>

</bugzilla>