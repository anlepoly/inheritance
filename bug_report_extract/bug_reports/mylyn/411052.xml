<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>411052</bug_id>
          
          <creation_ts>2013-06-18 14:15:00 -0400</creation_ts>
          <short_desc>tests should delete created reviews in tear down (was: tests failing on Hudson when run against Gerrit 2.4.2)</short_desc>
          <delta_ts>2013-08-13 19:23:26 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>14</classification_id>
          <classification>Mylyn</classification>
          <product>Mylyn Reviews</product>
          <component>Framework</component>
          <version>unspecified</version>
          <rep_platform>Other</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>NEW</bug_status>
          <resolution></resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Miles Parker">milesparker</reporter>
          <assigned_to name="Project Inbox">mylyn-triaged</assigned_to>
          <cc>fchouinard</cc>
    
    <cc>lucas.panjer</cc>
    
    <cc>sam.davis</cc>
    
    <cc>steffen.pingel</cc>
    
    <cc>tomasz.zarna</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2274073</commentid>
    <comment_count>0</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-06-18 14:15:01 -0400</bug_when>
    <thetext>We&apos;re getting failures on the Gerrit and integration runs and it isn&apos;t clear what the cause is. In all of these cases, the tests ran properly against local Gerrit (2.5.4) instances as well as on previous Hudson tests for the same change sets. Please see:

https://git.eclipse.org/r/#/c/13877/  &lt;-- Builds off of current master
https://git.eclipse.org/r/#/c/13878/  &lt;-- Builds off of last change before significant change to binary format.

All of these seem to be possibly due to time out issues.

Also, note failures on e.g. https://git.eclipse.org/r/#/c/13857/  that could also possibly be timeout related.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2274157</commentid>
    <comment_count>1</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-06-18 17:06:34 -0400</bug_when>
    <thetext>Tomek, are you seeing this failure on your local machine by chance? (If you don&apos;t have local Mylyn gerrit instance set up, let me know and I&apos;ll dig up the bug that explains.)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2274162</commentid>
    <comment_count>2</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-06-18 17:22:54 -0400</bug_when>
    <thetext>MIles, please fix the tests. You were the only one submitting changes lately.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2274166</commentid>
    <comment_count>3</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-06-18 17:35:15 -0400</bug_when>
    <thetext>Steffen, see the reviews above. These are tests for changes that previously passed, so it looks like something is going wrong with the test bed itself. I&apos;ll go back even further to verify this is the case.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2274170</commentid>
    <comment_count>4</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-06-18 17:41:23 -0400</bug_when>
    <thetext>(In reply to comment #2)
&gt; You were the only one submitting changes lately.

Note that Tomek&apos;s tsts are failing too. ;) https://git.eclipse.org/r/#/c/13886/</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2274195</commentid>
    <comment_count>5</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-06-18 19:02:34 -0400</bug_when>
    <thetext>Steffen, I think the issue might be simply that http://mylyn.org/gerrit-2.4.2/ is down and or running very slowly. I can&apos;t reach it w/ a browser, but I can 2.5.4. Can we get a reboot on it or something?

Note also integration tests:

https://hudson.eclipse.org/hudson/view/Mylyn/job/mylyn-reviews-nightly/2281/

This is failing even though previous two tests didn&apos;t have significant changes.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2274268</commentid>
    <comment_count>6</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-06-19 04:40:20 -0400</bug_when>
    <thetext>Thanks for looking into it. Sam, Tomek, can you restart the affected process? You can also re-run the provisioning job at http://ci.mylyn.org/view/Provisioning/job/mylyn-puppet-gerrit/ which will restart all Gerrit servers.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2274302</commentid>
    <comment_count>7</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-06-19 06:33:30 -0400</bug_when>
    <thetext>(In reply to comment #6)
&gt; You can also re-run the provisioning job

Done. I&apos;m retriggering all aborted builds now as 2.4.2 is responsive again:

* https://git.eclipse.org/r/#/c/13886/ : https://hudson.eclipse.org/sandbox/job/mylyn-reviews-gerrit/612/ =&gt; 616
* https://git.eclipse.org/r/#/c/13877/ : https://hudson.eclipse.org/sandbox/job/mylyn-reviews-gerrit/608/ =&gt; 617
* https://git.eclipse.org/r/#/c/13878/ : https://hudson.eclipse.org/sandbox/job/mylyn-reviews-gerrit/609/ =&gt; 618
* https://git.eclipse.org/r/#/c/13857/ : https://hudson.eclipse.org/sandbox/job/mylyn-reviews-gerrit/610/ =&gt; 619

When running locally, I still get the failures in PatchSetRemoteFactoryTest, first time seen in https://hudson.eclipse.org/sandbox/job/mylyn-reviews-gerrit/607/</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2274305</commentid>
    <comment_count>8</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-06-19 06:37:03 -0400</bug_when>
    <thetext>(In reply to comment #7)
&gt; first time seen in
&gt; https://hudson.eclipse.org/sandbox/job/mylyn-reviews-gerrit/607/

Should read: https://hudson.eclipse.org/sandbox/job/mylyn-reviews-gerrit/604/ or &quot;last time seen&quot; :)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2274492</commentid>
    <comment_count>9</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-06-19 12:06:43 -0400</bug_when>
    <thetext>From looking at the very long list of reviews it seems that we need to add clean up logic to the tests. Otherwise the server will get slow and consume too much memory over time.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2274500</commentid>
    <comment_count>10</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-06-19 12:14:40 -0400</bug_when>
    <thetext>(In reply to comment #9)
&gt; From looking at the very long list of reviews it seems that we need to add clean
&gt; up logic to the tests. Otherwise the server will get slow and consume too much
&gt; memory over time.

Yes I was wondering the same thing. I&apos;m not sure how to delete reviews from API, actually.. Another thought is to simply nuke the vm periodically.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2274513</commentid>
    <comment_count>11</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-06-19 12:52:16 -0400</bug_when>
    <thetext>Darn, now we&apos;re getting a bad gateway.. https://hudson.eclipse.org/sandbox/job/mylyn-reviews-gerrit/621/ :(</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2274521</commentid>
    <comment_count>12</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-06-19 13:10:34 -0400</bug_when>
    <thetext>I cleared and re-provisioned the 2.4.2 and 2.5.4 repository as a one time measure so repositories were down for a moment. Tests should now be much faster again.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2274527</commentid>
    <comment_count>13</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-06-19 13:28:57 -0400</bug_when>
    <thetext>Thanks Steffen. Two questions for you and Tomek...

How can we resubmit builds w/o &quot;faking&quot; a commit and push?
For some reason the cancel build options isn&apos;t enabled for me. Is there any way to cancel running builds?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2274554</commentid>
    <comment_count>14</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-06-19 14:20:48 -0400</bug_when>
    <thetext>Build times are now down to 7 mins form a high of 24 mins. Thanks Steffen, this makes a big difference in productivity! Let me know if anyonre has any quick ideas about how to delete those existing reviews programmatically, otherwise I&apos;ll try to figure it out when we get these other issues squashed.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2276524</commentid>
    <comment_count>15</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-06-24 15:19:52 -0400</bug_when>
    <thetext>I&apos;m not sure what to do with this one. I&apos;m stumped on how to delete tests.

I don&apos;t think this one should block 2.0.1 -- it was only there because the tests were failing altogether -- so I&apos;m de-escalating, and removing milestone. Hope that&apos;s ok..</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2276998</commentid>
    <comment_count>16</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-06-25 13:35:09 -0400</bug_when>
    <thetext>It&apos;s...back.. https://hudson.eclipse.org/sandbox/job/mylyn-reviews-gerrit/660/testReport/org.eclipse.mylyn.gerrit.tests.ui/GerritUrlHandlerTest/testOpenUrl/

So we need to solve the issue of deleting these old reviews but I have no idea how to do that programmatically, or indeed if that&apos;s possible.

Tomasz is away this week, so perhaps it would be helpful for me to get admin access to this machine so that I can destroy the vm and bring up a new one when this occurs.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2277000</commentid>
    <comment_count>17</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-06-25 13:38:18 -0400</bug_when>
    <thetext>(In reply to comment #16)
&gt; Tomasz is away this week, so perhaps it would be helpful for me to get admin
&gt; access to this machine so that I can destroy the vm and bring up a new one
&gt; when this occurs.

Sorry, but no. It&apos;s not a VM and I don&apos;t want anyone who doesn&apos;t know the details of setup go in and destroy stuff. We&apos;ll have to wait for either Sam or Tomek to help out who have admin access.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2277006</commentid>
    <comment_count>18</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-06-25 13:47:40 -0400</bug_when>
    <thetext>(In reply to comment #17)
&gt; (In reply to comment #16)
&gt; &gt; Tomasz is away this week, so perhaps it would be helpful for me to get admin
&gt; &gt; access to this machine so that I can destroy the vm and bring up a new one
&gt; &gt; when this occurs.
&gt; 
&gt; Sorry, but no. It&apos;s not a VM and I don&apos;t want anyone who doesn&apos;t know the
&gt; details of setup go in and destroy stuff.

Ok, I assumed the Gerrit Server was a Vagrant instance just like the local ones we use for testing. Perhaps we need to increase the time-out for that URL test to begin with.

 

&gt; We&apos;ll have to wait for either Sam or
&gt; Tomek to help out who have admin access.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2277009</commentid>
    <comment_count>19</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-06-25 13:50:34 -0400</bug_when>
    <thetext>(In reply to comment #18)
&gt; Ok, I assumed the Gerrit Server was a Vagrant instance just like the local ones
&gt; we use for testing. Perhaps we need to increase the time-out for that URL test
&gt; to begin with.

It&apos;s provisioned with puppet but it&apos;s a hosted Linux vServer.

I don&apos;t think Gerrit actually supports deleting of reviews so we maybe best off clearing and re-provisioning the server every once in a while. 

Miles, if you want to move this forward feel free to push a review for the puppet scripts that supports clearing Gerrit instances prior to re-provisioning them. The Bugzilla scripts do something similar (by checking for a magic file) since Bugzilla doesn&apos;t support task deletion either.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2277515</commentid>
    <comment_count>20</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-06-26 13:55:36 -0400</bug_when>
    <thetext>(In reply to comment #19)
&gt; Miles, if you want to move this forward feel free to push a review for the
&gt; puppet scripts that supports clearing Gerrit instances prior to re-provisioning
&gt; them. The Bugzilla scripts do something similar (by checking for a magic file)
&gt; since Bugzilla doesn&apos;t support task deletion either.

Ouch, hot potato. ;D Just a note that I&apos;m not likely to get time to get up to speed on puppet etc. in the near future so perhaps this is something that Tomek can take a look at when he returns. Catch!</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2279694</commentid>
    <comment_count>21</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-07-02 07:00:30 -0400</bug_when>
    <thetext>(In reply to comment #20)
&gt; Ouch, hot potato. ;D Just a note that I&apos;m not likely to get time to get up
&gt; to speed on puppet etc. in the near future so perhaps this is something that
&gt; Tomek can take a look at when he returns. Catch!

I don&apos;t mind getting more familiar with puppet and Mylyn tests infrastructure in general, but I think I should focus on bug 395059 now.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2279867</commentid>
    <comment_count>22</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-07-02 12:36:53 -0400</bug_when>
    <thetext>Yep, makes sense. I don&apos;t think there is a particular rush, esp. given that you have the keys to the server and can give it a kick if you need to.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2279874</commentid>
    <comment_count>23</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-07-02 12:50:58 -0400</bug_when>
    <thetext>We should get this fixed as soon as possible since tests and hence builds will continue to fail. We shouldn&apos;t be publishing builds until this is fixed (even if the temporary solution is to clean up the database and restart the service again).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2279951</commentid>
    <comment_count>24</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-07-02 16:16:17 -0400</bug_when>
    <thetext>(In reply to comment #23)
&gt; We should get this fixed as soon as possible since tests and hence builds will
&gt; continue to fail. We shouldn&apos;t be publishing builds until this is fixed (even if
&gt; the temporary solution is to clean up the database and restart the service
&gt; again).

Fair point. I can play around w/ Puppet a bit as well, as I need to get up to speed on it too.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2281222</commentid>
    <comment_count>25</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-07-05 13:42:01 -0400</bug_when>
    <thetext>One strategy would be to delete the project. That seems possible, but kind of heinous:

http://code.google.com/p/gerrit/issues/detail?id=349</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2281507</commentid>
    <comment_count>26</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-07-08 04:43:25 -0400</bug_when>
    <thetext>It looks that GerritUrlHandlerTest.testOpenUrl() fails, because it blocks while calling RemoteUiService.modelExec(Runnable, boolean). Once the call is non-blocking you get an error msg saying &quot;Problem while retrieving Gerrit review.: Not Found null,&quot; which means that the connector is unable open a review from Gerrit 2.6 (see bug 395059).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2281787</commentid>
    <comment_count>27</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-07-08 14:10:33 -0400</bug_when>
    <thetext>(In reply to comment #26)
&gt; It looks that GerritUrlHandlerTest.testOpenUrl() fails, because it blocks while
&gt; calling RemoteUiService.modelExec(Runnable, boolean). Once the call is
&gt; non-blocking you get an error msg saying &quot;Problem while retrieving Gerrit
&gt; review.: Not Found null,&quot; which means that the connector is unable open a review
&gt; from Gerrit 2.6 (see bug 395059).

Ok, so what I&apos;m getting from this is that we have a failure that is surfacing for 2.6 and that failure is legitimate. But as we don&apos;t support 2.6 yet, why is this test active, and more importantly, how can we be passing all of the other tests? ;)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2281809</commentid>
    <comment_count>28</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-07-08 15:00:48 -0400</bug_when>
    <thetext>(In reply to comment #27)
&gt; But as we don&apos;t support 2.6 yet, why is this test active, 
&gt; and more importantly, how can we be passing all of the other tests? ;)

The test uses a hard-coded [1] fixture pointing to git.eclipse.org [2].

[1] https://git.eclipse.org/c/mylyn/org.eclipse.mylyn.reviews.git/tree/org.eclipse.mylyn.gerrit.tests/src/org/eclipse/mylyn/gerrit/tests/ui/GerritUrlHandlerTest.java#n52

[2] https://git.eclipse.org/c/mylyn/org.eclipse.mylyn.reviews.git/tree/org.eclipse.mylyn.gerrit.tests/src/org/eclipse/mylyn/gerrit/tests/support/GerritFixture.java#n24</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2282162</commentid>
    <comment_count>29</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-07-09 04:34:56 -0400</bug_when>
    <thetext>I&apos;d be helpful to provision a Gerrit instance on the test server that didn&apos;t rely on HTTP authentication but also allowed anonymous access so we don&apos;t have to rely on Eclipse.org for testing.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2282377</commentid>
    <comment_count>30</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-07-09 12:35:50 -0400</bug_when>
    <thetext>(In reply to comment #29)
&gt; I&apos;d be helpful to provision a Gerrit instance on the test server that didn&apos;t
&gt; rely on HTTP authentication but also allowed anonymous access so we don&apos;t have
&gt; to rely on Eclipse.org for testing.

+1, especially if we are to properly test for changes in authorization configuration from anon and back again. See https://git.eclipse.org/r/#/c/14294/6/org.eclipse.mylyn.gerrit.tests/src/org/eclipse/mylyn/gerrit/tests/core/client/GerritClientTest.java.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2282381</commentid>
    <comment_count>31</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-07-09 12:42:52 -0400</bug_when>
    <thetext>Shouldn&apos;t we mark the test as ignored for now and re-enable it on the first occasion? With the test failing Hudson is going to -1 all changes, making it hard to spot a new test failure.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2282391</commentid>
    <comment_count>32</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-07-09 13:01:42 -0400</bug_when>
    <thetext>(In reply to comment #31)
&gt; Shouldn&apos;t we mark the test as ignored for now and re-enable it on the first
&gt; occasion? With the test failing Hudson is going to -1 all changes, making it
&gt; hard to spot a new test failure.

Please feel free to do that and schedule a bug to re-enable it.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2282396</commentid>
    <comment_count>33</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-07-09 13:20:34 -0400</bug_when>
    <thetext>(In reply to comment #32)
&gt; (In reply to comment #31)
&gt; &gt; Shouldn&apos;t we mark the test as ignored for now and re-enable it on the first
&gt; &gt; occasion? With the test failing Hudson is going to -1 all changes, making it
&gt; &gt; hard to spot a new test failure.
&gt; 
&gt; Please feel free to do that and schedule a bug to re-enable it.

+1, I was almost afraid to suggest that. :)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2282489</commentid>
    <comment_count>34</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-07-09 15:23:24 -0400</bug_when>
    <thetext>(In reply to comment #32)
&gt; Please feel free to do that and schedule a bug to re-enable it.

It&apos;s bug 412620.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2291528</commentid>
    <comment_count>35</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-08-05 09:24:22 -0400</bug_when>
    <thetext>The recent failures in testPerformQueryAnonymous (the test is hanging forever) can have two reasons:
* cloning and push a new review takes very long time, see GerritHarness#ensureOneReviewExists()
* the list of reviews is huge, making the query for all open reviews run very long

In https://git.eclipse.org/r/#/c/15135/ I&apos;m trying to fix them both by cloning/pushing only when there&apos;s no review available and by narrowing the query to return a single review (instead of all).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2291801</commentid>
    <comment_count>36</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-08-06 07:51:40 -0400</bug_when>
    <thetext>(In reply to comment #35)
&gt; In https://git.eclipse.org/r/#/c/15135/ I&apos;m trying to fix them both by
&gt; cloning/pushing only when there&apos;s no review available and by narrowing the query
&gt; to return a single review (instead of all).

Apparently it wasn&apos;t enough, since https://hudson.eclipse.org/sandbox/job/mylyn-reviews-gerrit/878/console timed out not even getting to testPerformQueryAnonymous.

FWIW, the whole (passing) build takes now ~23 mins.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2291880</commentid>
    <comment_count>37</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-08-06 09:52:07 -0400</bug_when>
    <thetext>I&apos;ve just finished running a profiler on Gerrit tests to see if there is anything that can be done on our side to make the tests run faster. Over 3/4 of the time threads are sleeping, waiting for a server response. Which kind of confirms what Miles noticed in comment 14, where tests without that extra IO overhead were 3 times faster.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2292748</commentid>
    <comment_count>38</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-08-08 09:43:24 -0400</bug_when>
    <thetext>There is a Gerrit plugin [1] for deleting projects which we could run as part of the provisioning job.

[1] https://gerrit.googlesource.com/plugins/delete-project/</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2292842</commentid>
    <comment_count>39</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-08-08 12:43:38 -0400</bug_when>
    <thetext>(In reply to comment #38)
&gt; There is a Gerrit plugin [1] for deleting projects which we could run as
&gt; part of the provisioning job.
&gt; 
&gt; [1] https://gerrit.googlesource.com/plugins/delete-project/

Yep, see comment 25. :)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2293287</commentid>
    <comment_count>40</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-08-09 12:10:40 -0400</bug_when>
    <thetext>A work-in-progress review with delete-project plugin: https://git.eclipse.org/r/#/c/15295/</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2293539</commentid>
    <comment_count>41</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-08-11 23:02:44 -0400</bug_when>
    <thetext>We could also extend the tests to reuse existing reviews in cases where the review is not modified. Assuming that&apos;s the vast majority of cases it would slow down the problem.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2293593</commentid>
    <comment_count>42</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-08-12 04:26:02 -0400</bug_when>
    <thetext>Deleting projects could be an interesting option. I would require tests to first create a unique project though to avoid conflicts with tests running in parallel. I pushed a simple work-around here which extends the puppet scripts with an option to force re-provisining. We could simply run the job once a night for now: https://git.eclipse.org/r/#/c/15354/ .</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2293599</commentid>
    <comment_count>43</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-08-12 04:40:08 -0400</bug_when>
    <thetext>(In reply to comment #41)
&gt; We could also extend the tests to reuse existing reviews in cases where the
&gt; review is not modified.

I like the idea, but currently the tests don&apos;t do much except for pushing a review and then reading it. As they continue to cover more scenarios (like aborting, submitting, reviewing, etc) I can imagine a situation when we spend more time looking for a useful review rather than executing the test itself.

(In reply to comment #42)
&gt; I would require tests to first create a unique project though 
&gt; to avoid conflicts with tests running in parallel.

Nice, that should help.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2293652</commentid>
    <comment_count>44</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-08-12 07:23:45 -0400</bug_when>
    <thetext>(In reply to comment #43)
&gt; (In reply to comment #41)
&gt; &gt; We could also extend the tests to reuse existing reviews in cases where the
&gt; &gt; review is not modified.
&gt; 
&gt; I like the idea, but currently the tests don&apos;t do much except for pushing a
&gt; review and then reading it. As they continue to cover more scenarios (like
&gt; aborting, submitting, reviewing, etc) I can imagine a situation when we spend
&gt; more time looking for a useful review rather than executing the test itself.

I would cache that result and share it between tests so you only do the lookup once for a pre-defined review. Even if some tests still need to create separate reviews to set certain properties it could still help (but it&apos;s certainly not a general solution to the problem).</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2294333</commentid>
    <comment_count>45</comment_count>
    <who name="Tomasz Zarna">tomasz.zarna</who>
    <bug_when>2013-08-13 11:54:44 -0400</bug_when>
    <thetext>(In reply to comment #41)
&gt; We could also extend the tests to reuse existing reviews in cases where the
&gt; review is not modified.

This reminded me about https://git.eclipse.org/r/#/c/15135/ from comment 35.

Steffen&apos;s work-around from comment 42 worked great, so I don&apos;t think the issue is worth investing more time at the moment. I will try to tackle some of the remaining bugs for 2.0.1.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>