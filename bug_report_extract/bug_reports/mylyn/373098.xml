<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>373098</bug_id>
          
          <creation_ts>2012-03-02 09:15:00 -0500</creation_ts>
          <short_desc>[e4] support editor restore on task activation</short_desc>
          <delta_ts>2012-06-10 13:40:59 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>14</classification_id>
          <classification>Mylyn</classification>
          <product>Mylyn Context</product>
          <component>Framework</component>
          <version>unspecified</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords>plan</keywords>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>3.8</target_milestone>
          
          <blocked>321278</blocked>
    
    <blocked>376368</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Steffen Pingel">steffen.pingel</reporter>
          <assigned_to name="Steffen Pingel">steffen.pingel</assigned_to>
          <cc>deepakazad</cc>
    
    <cc>lars.vogel</cc>
    
    <cc>mik.kersten</cc>
    
    <cc>njbartlett</cc>
    
    <cc>pwebster</cc>
    
    <cc>remy.suen</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2074357</commentid>
    <comment_count>0</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2012-03-02 09:15:04 -0500</bug_when>
    <thetext>Editor restore on task activation is currently not supported on e4 (bug 350482). This is a key feature of the Task-focused Interface and should be supported through e4 APIs.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2074368</commentid>
    <comment_count>1</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2012-03-02 09:26:42 -0500</bug_when>
    <thetext>Summary:

When a task is activated Mylyn restores the workbench state (open editors) to the state that was captured when task was last active. This is very similar to how the workbench restores state on startup that was present on last shutdown.

* Eclipse 3.x had internal APIs in EditorManager to save and restore the state to an IMemento. This allowed Mylyn to reuse the workbench implementation for managing state. These APIs were removed in e4 since the workbench model is peristed differently.

* The API provided by IWorkbenchPage.openEditors(final IEditorInput[] inputs, final String[] editorIDs, final int matchFlags) is not sufficient since it does allow restoring additional state that is managed through IPersistableEditor.

What is needed is a new IMemento or stream based API for capturing workbench (editor) state.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2074569</commentid>
    <comment_count>2</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2012-03-02 13:17:38 -0500</bug_when>
    <thetext>Editor restore on e4:

* WorkbenchPage.setup() looks for all parts with id == CompatibilityEditor.MODEL_ELEMENT_ID
* State is stored in part.getPersisitedState()

Editor persistence on e4:

* Workbench.busyClose() invokes EditorReference.persist() which stores state into  part.getPersisitedState()</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2074574</commentid>
    <comment_count>3</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2012-03-02 13:25:06 -0500</bug_when>
    <thetext>I have pushed a proof of concept here that save and restores editors in the shared editor area: http://review.mylyn.org/#change,351.

To make this work I had to make EditorReference.persist() public. 

A useful optimization would be to invoke partService.showPart(editor, PartState.CREATE) instead of partService.showPart(editor, PartState.ACTIVATE). If the EditorReference tracked whether an editor had been activated EditorReference.persist() could do nothing in case the editor hadn&apos;t been activated and hence state had not changed. Currently this NPEs when text editors are created but not activated.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2106246</commentid>
    <comment_count>4</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2012-05-10 19:48:13 -0400</bug_when>
    <thetext>I took a first pass at this: https://git.eclipse.org/r/#/c/5888/ and pushed the changes into M7. This change supports saving and restoring legacy editors from the editor area of each workbench window. Editors that are dragged outside of the editor area should be ignored. This is a limitation but unfortunately we don&apos;t have the capacity to address that at the moment.

Lars, would you be able to give this a spin and let me know if you run into any problems?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2107251</commentid>
    <comment_count>5</comment_count>
    <who name="Lars Vogel">lars.vogel</who>
    <bug_when>2012-05-13 19:15:37 -0400</bug_when>
    <thetext>Partially works, some editors are restored but I also get:

---------
Factory org.eclipse.jdt.ui.ClassFileEditorInputFactory returned null from createElement for editor id=org.eclipse.jdt.ui.ClassFileEditorNoSource name=null
------

Also the &quot;Focus on Active Task&quot; Mylyn button in the package explorer is missing.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2119727</commentid>
    <comment_count>6</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2012-06-05 12:55:38 -0400</bug_when>
    <thetext>Thanks for testing!

&gt; Partially works, some editors are restored but I also get:
&gt; 
&gt; ---------
&gt; Factory org.eclipse.jdt.ui.ClassFileEditorInputFactory returned null from
&gt; createElement for editor id=org.eclipse.jdt.ui.ClassFileEditorNoSource name=null
&gt; ------

 I was able to restore class files but there is a known problem that looks similar to what you

261641: failed to open editor for a class file when activating task
https://bugs.eclipse.org/bugs/show_bug.cgi?id=261641(In reply to comment #5)

&gt; Also the &quot;Focus on Active Task&quot; Mylyn button in the package explorer is missing.

I suspect that you maybe missing the Mylyn Context Bridge for Java feature in your install.

I&apos;ll mark this bug as resolved since basic support has been implemented for e4. Please open new bugs if you notice problems or if you are missing features. We&apos;ll consider them for future releases.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2122211</commentid>
    <comment_count>7</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2012-06-10 13:40:59 -0400</bug_when>
    <thetext>*** Bug 380206 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>