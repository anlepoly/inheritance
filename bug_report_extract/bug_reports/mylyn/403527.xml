<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>403527</bug_id>
          
          <creation_ts>2013-03-15 18:16:00 -0400</creation_ts>
          <short_desc>[regression] comment hovers do not appear any longer when comparing files</short_desc>
          <delta_ts>2013-03-18 19:23:10 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>14</classification_id>
          <classification>Mylyn</classification>
          <product>Mylyn Reviews</product>
          <component>Framework</component>
          <version>unspecified</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P2</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>2.0</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Steffen Pingel">steffen.pingel</reporter>
          <assigned_to name="Miles Parker">milesparker</assigned_to>
          <cc>milesparker</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2232299</commentid>
    <comment_count>0</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-03-15 18:16:55 -0400</bug_when>
    <thetext>After updating to the latest comment hovers in the compare editor stopped working for me.

Steps:

1. Open https://git.eclipse.org/r/#/c/9414/
2. Double click on ReviewsLabelProvider under patch set 5
3. Scroll to comments
4. Hover over glasses annotation

The comment does not appear as expected.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2232301</commentid>
    <comment_count>1</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-03-15 18:17:31 -0400</bug_when>
    <thetext>Not sure if this exception in the log is related:

java.lang.NullPointerException
	at org.eclipse.mylyn.internal.reviews.ui.editors.parts.CommentPart.getSectionHeaderText(CommentPart.java:33)
	at org.eclipse.mylyn.internal.reviews.ui.editors.parts.ExpandablePart.updateSectionText(ExpandablePart.java:135)
	at org.eclipse.mylyn.internal.reviews.ui.editors.parts.ExpandablePart.createControl(ExpandablePart.java:92)
	at org.eclipse.mylyn.internal.reviews.ui.editors.parts.TopicPart.createControl(TopicPart.java:59)
	at org.eclipse.mylyn.internal.reviews.ui.annotations.CommentPopupDialog.setInput(CommentPopupDialog.java:172)
	at org.eclipse.mylyn.internal.reviews.ui.annotations.CommentInformationControl.setInput(CommentInformationControl.java:73)
	at org.eclipse.jface.text.AbstractInformationControlManager.internalShowInformationControl(AbstractInformationControlManager.java:1181)
	at org.eclipse.jface.text.AbstractInformationControlManager.presentInformation(AbstractInformationControlManager.java:1150)
	at org.eclipse.jface.text.AbstractHoverInformationControlManager.presentInformation(AbstractHoverInformationControlManager.java:902)
	at org.eclipse.jface.text.AbstractInformationControlManager.setInformation(AbstractInformationControlManager.java:418)
	at org.eclipse.jface.text.source.AnnotationBarHoverManager.computeInformation(AnnotationBarHoverManager.java:379)
	at org.eclipse.jface.text.AbstractInformationControlManager.doShowInformation(AbstractInformationControlManager.java:1131)
	at org.eclipse.jface.text.AbstractHoverInformationControlManager$MouseTracker.mouseHover(AbstractHoverInformationControlManager.java:519)
	at org.eclipse.swt.widgets.TypedListener.handleEvent(TypedListener.java:208)
	at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:84)
	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1276)
	at org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:3562)
	at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3186)
	at org.eclipse.ui.internal.Workbench.runEventLoop(Workbench.java:2701)
	at org.eclipse.ui.internal.Workbench.runUI(Workbench.java:2665)
	at org.eclipse.ui.internal.Workbench.access$4(Workbench.java:2499)
	at org.eclipse.ui.internal.Workbench$7.run(Workbench.java:679)
	at org.eclipse.core.databinding.observable.Realm.runWithDefault(Realm.java:332)
	at org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:668)
	at org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:149)
	at org.eclipse.ui.internal.ide.application.IDEApplication.start(IDEApplication.java:124)
	at org.eclipse.equinox.internal.app.EclipseAppHandle.run(EclipseAppHandle.java:196)
	at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:110)
	at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:79)
	at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:353)
	at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:180)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:601)
	at org.eclipse.equinox.launcher.Main.invokeFramework(Main.java:629)
	at org.eclipse.equinox.launcher.Main.basicRun(Main.java:584)
	at org.eclipse.equinox.launcher.Main.run(Main.java:1438)
	at org.eclipse.equinox.launcher.Main.main(Main.java:1414)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2232310</commentid>
    <comment_count>2</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-03-15 18:40:04 -0400</bug_when>
    <thetext>I can reproduce this. Investigating now.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2232315</commentid>
    <comment_count>3</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-03-15 18:50:17 -0400</bug_when>
    <thetext>Yep, this is something that has already been fixed in the experimental branch*, but I&apos;ll fix it in another quick review to make sure it gets in.

* https://git.eclipse.org/r/#/c/11012/4/org.eclipse.mylyn.gerrit.core/src/org/eclipse/mylyn/internal/gerrit/core/remote/PatchSetContentRemoteFactory.java</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2232322</commentid>
    <comment_count>4</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-03-15 19:09:00 -0400</bug_when>
    <thetext>https://git.eclipse.org/r/#/c/11216

(I tired to add this under testing but it&apos;s difficult because of the current model design. We need to get rid of the topic/comment confusion at the next model refactoring.)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2232338</commentid>
    <comment_count>5</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-03-15 19:39:26 -0400</bug_when>
    <thetext>
Steffen: 
&gt; I would suggest to also make the UI code more robust to handle null authors and add a test for that.

Miles:
&gt;I&apos;m sort of inclined to enforce it at the model level. It&apos;s a 1..1 relationship, this should &quot;never&quot; actually be a null value, but in worse case a stand-in unknown user value. Once we have proper model validation, we should be able to trap these issues w/o polluting the UI code w/ a ton of null checks. OTOH, a null check never hurt anyone..

I think we should merge to get this in, but I also think we need to figure out what we want to do with above. Now that we finally do have the model retrieval under testing, I&apos;d like to handle everything possible at the model level.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2232351</commentid>
    <comment_count>6</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-03-15 20:01:13 -0400</bug_when>
    <thetext>I&apos;m not sure that requiring a non null author is a valid constraint on the model but if we can guarantee that it&apos;s certainly better than adding null checks all over. Do you have a bug that provides more background on the model validation that is planned?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2232356</commentid>
    <comment_count>7</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-03-15 20:06:44 -0400</bug_when>
    <thetext>There is now. :) bug 403537</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2233245</commentid>
    <comment_count>8</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-03-18 18:21:37 -0400</bug_when>
    <thetext>Miles, is this done or do you plan on doing further work on this?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2233254</commentid>
    <comment_count>9</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-03-18 18:47:09 -0400</bug_when>
    <thetext>Well, we&apos;ve handled the regression. I suggested that we leave it open for follow-up, but I&apos;m happy to close it as well.

I was waiting to see if you wanted to take a look, but I just went ahead and merged https://git.eclipse.org/r/#/c/11216/2.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2233266</commentid>
    <comment_count>10</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-03-18 19:23:10 -0400</bug_when>
    <thetext>Thanks! Let&apos;s close this, it&apos;s unlikely that we&apos;ll revisit if we haven&apos;t take the time now and as you said, the error is fixed.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>