<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>420385</bug_id>
          
          <creation_ts>2013-10-25 09:49:00 -0400</creation_ts>
          <short_desc>Mylyn reviews.core plugin.xml breaks other EMF-using products</short_desc>
          <delta_ts>2013-10-26 08:39:53 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>14</classification_id>
          <classification>Mylyn</classification>
          <product>Mylyn Reviews</product>
          <component>Framework</component>
          <version>unspecified</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>VERIFIED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P1</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>2.0.2</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ben Cox">benjamin.cox</reporter>
          <assigned_to name="Steffen Pingel">steffen.pingel</assigned_to>
          <cc>milesparker</cc>
    
    <cc>tomasz.zarna</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2323255</commentid>
    <comment_count>0</comment_count>
    <who name="Ben Cox">benjamin.cox</who>
    <bug_when>2013-10-25 09:49:49 -0400</bug_when>
    <thetext>The Gerrit reviews.core plugin.xml [1] is a bad neighbour.

It contains an org.eclipse.emf.ecore.extension_parser extension that says that all *.xml files should be parsed with the ReviewsResourceFactory. This is very bad - it means that all other products that ask the EMF ResourceFactoryRegistry for a ResourceFactory (which would normally get it by matching content type or fall back to the default XMIResourceFactory) instead get given the ReviewsResourceFactory. This then attempts to parse that XML from the other product as a binary-serialized ReviewsResource, which of course fails and the other product fails to read or write its model to the file.

I suggest that the extension_parser registered for ReviewsResourceFactory should be removed entirely (if Mylyn retrieves the ReviewsResourceFactory directly), or it should be altered to choose a more appropriate extension (&quot;reviews&quot; seems like the best candidate from a quick glance at the files Mylyn stores).

This problem was detected using Rational Team Concert in the same Eclipse as Mylyn Gerrit reviews [2], though it would also affect any other product that relies on the EMF ResourceFactoryRegistry to read XML/XMI files with an &apos;xml&apos; extension.

[1] http://git.eclipse.org/c/mylyn/org.eclipse.mylyn.reviews.git/tree/org.eclipse.mylyn.reviews.core/plugin.xml
[2] https://jazz.net/jazz/resource/itemName/com.ibm.team.workitem.WorkItem/286681</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2323288</commentid>
    <comment_count>1</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-10-25 10:26:52 -0400</bug_when>
    <thetext>Thanks for bringing this to our attention. Miles, can you comment on this?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2323307</commentid>
    <comment_count>2</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-10-25 10:51:01 -0400</bug_when>
    <thetext>Miles, do you have any concerns with merging this patch? https://git.eclipse.org/r/#/c/17773/ . I manually tested without the extension and did notice any problems.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2323451</commentid>
    <comment_count>3</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-10-25 14:53:02 -0400</bug_when>
    <thetext>Yes, thanks Bob. Certainly this is an anti-pattern to say the least. This was an oversight and crept in when the code was regenerated because the reviews file extension was set to &apos;xml&apos;. This should really never be the case.

Steffen, to prevent this from happening again, I&apos;ve also changed the genmodel to replace the &apos;xml&apos; w/ reviews. It&apos;s building now. I don&apos;t know when we have to get this in for 3.10 but I&apos;ll leave it to you to merge.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2323490</commentid>
    <comment_count>4</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-10-25 16:06:30 -0400</bug_when>
    <thetext>Thanks very much, Miles. I&apos;ll cherry-pick the change onto the 3.9 and 3.10 branches to make it available as soon as possible.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2323496</commentid>
    <comment_count>5</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-10-25 16:19:58 -0400</bug_when>
    <thetext>A release build that includes the fix is now running here: https://hudson.eclipse.org/hudson/view/Mylyn/job/mylyn-3.10.x-release/3/console .

Once that&apos;s done the build will be available from http://download.eclipse.org/mylyn/snapshots/3.10/ . It would be great if you could verify that this fixes the problem for you.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2323635</commentid>
    <comment_count>6</comment_count>
    <who name="Ben Cox">benjamin.cox</who>
    <bug_when>2013-10-26 08:39:53 -0400</bug_when>
    <thetext>Thanks for the really quick responses on this, guys - it&apos;s really heartening. I suspected EMF/Ecore generation was doing the automatic extension creation - it&apos;s a bit sneaky like that, I know from my own experience.

I&apos;ve been able to verify using the 3.10 snapshot from yesterday, and can verify that the files created by RTC are being correctly saved and read.

I&apos;ve also performed a sanity check by using the host OSGi console to call &quot;pt -v org.eclipse.emf.ecore.extension_parser&quot;. No results from Mylyn - thank you!</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>