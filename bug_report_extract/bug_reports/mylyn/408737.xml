<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>408737</bug_id>
          
          <creation_ts>2013-05-22 15:00:00 -0400</creation_ts>
          <short_desc>[regression] Spurious &quot;model-related&quot; RuntimeException (Attempted to execute a model-related operation in a non-model thread.)</short_desc>
          <delta_ts>2013-06-24 19:22:26 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>14</classification_id>
          <classification>Mylyn</classification>
          <product>Mylyn Reviews</product>
          <component>Framework</component>
          <version>unspecified</version>
          <rep_platform>Macintosh</rep_platform>
          <op_sys>Mac OS X</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P2</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>2.0</target_milestone>
          
          <blocked>409343</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Miles Parker">milesparker</reporter>
          <assigned_to name="Miles Parker">milesparker</assigned_to>
          <cc>sam.davis</cc>
    
    <cc>tomasz.zarna</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2261073</commentid>
    <comment_count>0</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-05-22 15:00:29 -0400</bug_when>
    <thetext>This is one that Sam first reported and I was just able to confirm. We&apos;re getting a RTE when opening the reviews, which causes a lot of havoc because we then don&apos;t have the patch set detail we expect to have. See traces below.

Unfortunately, it&apos;s a self-inflicted wound. I put in a check for model access where we really don&apos;t need one. (It should be safe to access a non-list value from outside the thread.)

1.

java.lang.RuntimeException: Attempted to execute a model-related operation in a non-model thread.
	at org.eclipse.mylyn.reviews.ui.spi.remote.RemoteUiService.ensureModelThread(RemoteUiService.java:45)
	at org.eclipse.mylyn.reviews.core.spi.remote.emf.AbstractRemoteEmfFactory.getLocalKey(AbstractRemoteEmfFactory.java:260)
	at org.eclipse.mylyn.reviews.core.spi.remote.emf.AbstractRemoteEmfFactory.getConsumerForModel(AbstractRemoteEmfFactory.java:218)
	at org.eclipse.mylyn.internal.gerrit.core.remote.PatchSetDetailRemoteFactory.getRemoteObjectForLocalKey(PatchSetDetailRemoteFactory.java:90)
	at org.eclipse.mylyn.internal.gerrit.core.remote.PatchSetDetailRemoteFactory.getRemoteObjectForLocalKey(PatchSetDetailRemoteFactory.java:1)
	at org.eclipse.mylyn.reviews.core.spi.remote.emf.AbstractRemoteEmfFactory.getRemoteKeyForLocalKey(AbstractRemoteEmfFactory.java:304)
	at org.eclipse.mylyn.reviews.core.spi.remote.emf.RemoteEmfConsumer.pull(RemoteEmfConsumer.java:141)
	at org.eclipse.mylyn.internal.gerrit.core.remote.PatchSetContentIdRemoteFactory.pull(PatchSetContentIdRemoteFactory.java:43)
	at org.eclipse.mylyn.internal.gerrit.core.remote.PatchSetContentIdRemoteFactory.pull(PatchSetContentIdRemoteFactory.java:1)
	at org.eclipse.mylyn.reviews.core.spi.remote.emf.RemoteEmfConsumer.pull(RemoteEmfConsumer.java:157)
	at org.eclipse.mylyn.reviews.core.spi.remote.JobRemoteService$1$1.run(JobRemoteService.java:63)
	at org.eclipse.core.internal.jobs.Worker.run(Worker.java:54)
	
2.

Caused by: java.lang.NullPointerException
	at org.eclipse.mylyn.internal.gerrit.ui.factories.SubmitUiFactory.isExecutable(SubmitUiFactory.java:38)
	at org.eclipse.mylyn.reviews.ui.spi.factories.AbstractUiFactory.createControl(AbstractUiFactory.java:60)
	at org.eclipse.mylyn.reviews.ui.spi.factories.AbstractUiFactoryProvider.createButtons(AbstractUiFactoryProvider.java:38)
	at org.eclipse.mylyn.reviews.ui.spi.editor.ReviewSetContentSection.updateButtons(ReviewSetContentSection.java:333)
	at org.eclipse.mylyn.reviews.ui.spi.editor.ReviewSetContentSection.updateReview(ReviewSetContentSection.java:354)
	at org.eclipse.mylyn.reviews.ui.spi.editor.ReviewSetSection.updateModelContent(ReviewSetSection.java:78)
	at org.eclipse.mylyn.reviews.ui.spi.editor.AbstractReviewSection$1.update(AbstractReviewSection.java:69)
	at org.eclipse.mylyn.reviews.core.spi.remote.emf.RemoteEmfClient.checkUpdate(RemoteEmfClient.java:52)
	at org.eclipse.mylyn.reviews.core.spi.remote.emf.RemoteEmfClient.updated(RemoteEmfClient.java:84)
	at org.eclipse.mylyn.reviews.core.spi.remote.emf.RemoteEmfConsumer$ConsumerAdapter.notifyChanged(RemoteEmfConsumer.java:85)
	at org.eclipse.emf.common.notify.impl.BasicNotifierImpl.eNotify(BasicNotifierImpl.java:374)
	at org.eclipse.emf.common.notify.impl.NotificationChainImpl.dispatch(NotificationChainImpl.java:98)
	at org.eclipse.emf.common.notify.impl.NotificationChainImpl.dispatch(NotificationChainImpl.java:86)
	at org.eclipse.mylyn.reviews.core.spi.remote.emf.RemoteEmfConsumer.applyModel(RemoteEmfConsumer.java:237)
	at org.eclipse.mylyn.reviews.core.spi.remote.JobRemoteService$1$2$1.run(JobRemoteService.java:80)
	at org.eclipse.ui.internal.UILockListener.doPendingWork(UILockListener.java:164)
	at org.eclipse.ui.internal.UISynchronizer$3.run(UISynchronizer.java:158)
	at org.eclipse.swt.widgets.RunnableLock.run(RunnableLock.java:35)
	at org.eclipse.swt.widgets.Synchronizer.runAsyncMessages(Synchronizer.java:135)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2261079</commentid>
    <comment_count>1</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-05-22 15:04:23 -0400</bug_when>
    <thetext>Steps to reproduce:

Select many (non-chaced, e.g. new) reviews and open them all at once.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2261084</commentid>
    <comment_count>2</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-05-22 15:06:25 -0400</bug_when>
    <thetext>https://git.eclipse.org/r/13059</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2261102</commentid>
    <comment_count>3</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-05-22 15:30:59 -0400</bug_when>
    <thetext>If this does happen, we also have no way to rebuild the bad task by asking the user to delete it. See also bug 408745. Not sure where we should fail here.

Also, perhaps we should do a better job of handling the case where the degenerate case where the change isn&apos;t available from the patch set, but I&apos;m still thinking that that is an aberration.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2263122</commentid>
    <comment_count>4</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-05-25 15:01:30 -0400</bug_when>
    <thetext>https://git.eclipse.org/r/13154  [experimental!!]</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2270856</commentid>
    <comment_count>5</comment_count>
    <who name="Miles Parker">milesparker</who>
    <bug_when>2013-06-10 20:13:34 -0400</bug_when>
    <thetext>Fixed in https://git.eclipse.org/r/#/c/13154/.</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>