<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>410062</bug_id>
          
          <creation_ts>2013-06-06 08:20:00 -0400</creation_ts>
          <short_desc>[api] settings page constructor should not rely on overridden methods</short_desc>
          <delta_ts>2013-06-13 15:23:43 -0400</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>14</classification_id>
          <classification>Mylyn</classification>
          <product>Mylyn Tasks</product>
          <component>Framework</component>
          <version>unspecified</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>3.10</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Benjamin Muskalla">benjamin.muskalla</reporter>
          <assigned_to name="Benjamin Muskalla">benjamin.muskalla</assigned_to>
          <cc>steffen.pingel</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>2269180</commentid>
    <comment_count>0</comment_count>
    <who name="Benjamin Muskalla">benjamin.muskalla</who>
    <bug_when>2013-06-06 08:20:16 -0400</bug_when>
    <thetext>Using @AbstractRepositorySettingsPage@ and trying to dynamically lookup the connector kind fails as the constructor directly calls @getConnectorKind@, giving implementers no chance to intercept. Depending on your connector architecture, you already got the right connector instance to pass into the settings page.
My suggestion is to provide an additional constructor that takes a RepositoryConnector instead of looking it up from the registry.
This also enables easier testing of the settings page as you can directly inject a mock connector instead of relying on the global registry to provide one.

To quote Effective Java

bc. 
There are a few more restrictions that a class must obey to allow inheritance. Constructors must not invoke overridable methods, directly or indirectly. If you violate this rule, program failure will result. The superclass constructor runs before the subclass constructor, so the overriding method in the subclass will be invoked before the subclass constructor has run. If the overriding method depends on any initialization performed by the subclass constructor, the method will not behave as expected.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2269202</commentid>
    <comment_count>1</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-06-06 08:49:24 -0400</bug_when>
    <thetext>Proposed implementation: https://git.eclipse.org/r/#/c/13615/.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2269226</commentid>
    <comment_count>2</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-06-06 09:21:59 -0400</bug_when>
    <thetext>The change was merged.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2272125</commentid>
    <comment_count>3</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-06-12 15:37:55 -0400</bug_when>
    <thetext>I pushed another change along the same lines to handle the case where an existing repository is provided: https://git.eclipse.org/r/#/c/13779/.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2272543</commentid>
    <comment_count>4</comment_count>
    <who name="Sam Davis">sam.davis</who>
    <bug_when>2013-06-13 13:58:58 -0400</bug_when>
    <thetext>Note that 13779 still violates the restriction because getConnectorKind is overridden.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2272570</commentid>
    <comment_count>5</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2013-06-13 15:23:43 -0400</bug_when>
    <thetext>Yes, you are right, this isn&apos;t a complete fix but it&apos;s good enough to address the problem while retaining backwards compatibility. When we break API we should properly fix this (but at that point we would make a lot more changes to the settings page, I&apos;m sure).</thetext>
  </long_desc>
      
      

    </bug>

</bugzilla>