<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<!DOCTYPE bugzilla SYSTEM "https://bugs.eclipse.org/bugs/page.cgi?id=bugzilla.dtd">

<bugzilla version="4.4.7"
          urlbase="https://bugs.eclipse.org/bugs/"
          
          maintainer="webmaster@eclipse.org"
>

    <bug>
          <bug_id>339474</bug_id>
          
          <creation_ts>2011-03-10 03:29:00 -0500</creation_ts>
          <short_desc>replace dependency on com.google.gwt.user with com.google.gwt.servlet</short_desc>
          <delta_ts>2011-12-24 10:36:39 -0500</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>14</classification_id>
          <classification>Mylyn</classification>
          <product>Mylyn Reviews</product>
          <component>Gerrit Connector</component>
          <version>unspecified</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc></bug_file_loc>
          <status_whiteboard></status_whiteboard>
          <keywords></keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>0.9</target_milestone>
          <dependson>367530</dependson>
    
    <dependson>367537</dependson>
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Steffen Pingel">steffen.pingel</reporter>
          <assigned_to name="Steffen Pingel">steffen.pingel</assigned_to>
          <cc>gunnar</cc>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0" >
    <commentid>1896334</commentid>
    <comment_count>0</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2011-03-10 03:29:50 -0500</bug_when>
    <thetext>The message in the Orbit news group indicates that com.google.gwt.user should not be installed: http://www.eclipse.org/forums/index.php?t=msg&amp;th=205709&amp;start=0&amp;S=b0fecff194fd8ddcf280e5ebccbf8ed8

The Gerrit connector makes use of com.google.gwt.user.client.rpc.AsyncCallback which is provided by the bundle and hence users will end up with com.google.gwt.user when the Gerrit connector is installed. Is that a concern?</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1896335</commentid>
    <comment_count>1</comment_count>
    <who name="Gunnar Wagenknecht">gunnar</who>
    <bug_when>2011-03-10 03:33:28 -0500</bug_when>
    <thetext>GWT provides two libraries.

* gwt-user.jar
Used for development time when developing and compiling GWT modules.

* gwt-servlet.jar
Deployed on the server.


This maps one-on-one to the bundles available in Orbit. They are covered by the same CQ because the servlet bundle is just a subset of the user bundle.

* com.google.gwt.user
Used for development time when developing and compiling GWT modules.

* com.google.gwt.servlet
Deployed on the server.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1896336</commentid>
    <comment_count>2</comment_count>
    <who name="Gunnar Wagenknecht">gunnar</who>
    <bug_when>2011-03-10 03:33:53 -0500</bug_when>
    <thetext>Sorry, thought this was filled against Orbit. ;)</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1896339</commentid>
    <comment_count>3</comment_count>
    <who name="Gunnar Wagenknecht">gunnar</who>
    <bug_when>2011-03-10 03:37:36 -0500</bug_when>
    <thetext>Note, in OSGi world it should matter. Please make sure to use Import-Package with the proper version requirement set. This will resolve to the servlet bundle. The user bundle does intentionally not export versions on the packages. P2 will also only resolve to the servlet bundle.

Another recommendation I have is to develop the GWT module _not_ in an OSGi bundle but as a separate pure Java project. At runtime (when deployed on the server) a GWT module is pure JavaScript which doesn&apos;t need any Java packages at all. Thus, the dependencies are only used at development time. This is a bit confusing, though.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1896353</commentid>
    <comment_count>4</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2011-03-10 04:02:03 -0500</bug_when>
    <thetext>Thanks for the detailed background. That&apos;s exactly what I was looking for :).

The com.google.gwtjsonrpc library imports the packages which don&apos;t seem to be part of the servlet bundle:

 com.google.gwt.user.rebind,
 com.google.gwt.user.server.rpc,

I guess we should also add version constraints which are currently missing. I&apos;ll have to take another pass through these bundles...

(In reply to comment #3)
&gt; Note, in OSGi world it should matter. Please make sure to use Import-Package
&gt; with the proper version requirement set. This will resolve to the servlet
&gt; bundle. The user bundle does intentionally not export versions on the packages.
&gt; P2 will also only resolve to the servlet bundle.

Hmm, we distribute the 2.0.4 version of the gwt.user bundle and p2 seems to install that without complaint.

&gt; Another recommendation I have is to develop the GWT module _not_ in an OSGi
&gt; bundle but as a separate pure Java project. At runtime (when deployed on the
&gt; server) a GWT module is pure JavaScript which doesn&apos;t need any Java packages at
&gt; all. Thus, the dependencies are only used at development time. This is a bit
&gt; confusing, though.

We are not actually using the bundles in the classical GWT way but we are need them since they are transitive dependencies of bundles that are part of the Gerrit server. We are using the classes to deserialize the JSON stream from the server but have custom transport layer that is not using GWT.

I&apos;ll check if we could reduce imports to packages available in the gwt.servlet bundle.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>1896417</commentid>
    <comment_count>5</comment_count>
    <who name="Gunnar Wagenknecht">gunnar</who>
    <bug_when>2011-03-10 06:02:34 -0500</bug_when>
    <thetext>(In reply to comment #4)
&gt;  com.google.gwt.user.rebind,
&gt;  com.google.gwt.user.server.rpc,

Indeed, rebind isn&apos;t usually part of that but server.rpc is. Hmm. Distributing the full user bundle just because of that package seems wrong. Maybe we can get a comment from the developers if that package is really needed at runtime on the server? AFAIK the rebind functionality is only part of the client and doesn&apos;t work on the server anyway.

&gt; Hmm, we distribute the 2.0.4 version of the gwt.user bundle and p2 seems to
&gt; install that without complaint.

Ouch. It shouldn&apos;t. Maybe I need to add different instructions to a p2.inf. It really should go only into a target platform. But maybe we need to rethink the way the bundles are structured currently.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2044500</commentid>
    <comment_count>6</comment_count>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2011-12-24 10:36:35 -0500</bug_when>
    <thetext>I have updated the target platform definitions and version constraints in the gerrit bundles.</thetext>
  </long_desc><long_desc isprivate="0" >
    <commentid>2044501</commentid>
    <comment_count>7</comment_count>
      <attachid>208796</attachid>
    <who name="Steffen Pingel">steffen.pingel</who>
    <bug_when>2011-12-24 10:36:39 -0500</bug_when>
    <thetext>Created attachment 208796
mylyn/context/zip</thetext>
  </long_desc>
      
          <attachment
              isobsolete="0"
              ispatch="0"
              isprivate="0"
          >
            <attachid>208796</attachid>
            <date>2011-12-24 10:36:00 -0500</date>
            <delta_ts>2011-12-24 10:36:39 -0500</delta_ts>
            <desc>mylyn/context/zip</desc>
            <filename>mylyn-context.zip</filename>
            <type>application/octet-stream</type>
            <size>2142</size>
            <attacher name="Steffen Pingel">steffen.pingel</attacher>
            
              <data encoding="base64">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
</data>

          </attachment>
      

    </bug>

</bugzilla>